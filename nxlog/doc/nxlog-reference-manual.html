<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>NXLOG Community Edition Reference Manual for v2.9.1716</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="en" class="book" title="NXLOG Community Edition Reference Manual for v2.9.1716"><div class="titlepage"><div><div><h1 class="title"><a name="nxlog_reference_manual"></a>
  NXLOG Community Edition Reference Manual for 
   v2.9.1716

</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Botond</span> <span class="surname">Botyanszki</span></h3><code class="email">&lt;<a class="email" href="mailto:boti@nxlog.org">boti@nxlog.org</a>&gt;</code></div></div></div><div><p class="copyright">Copyright ï¿½ 2009-2014 NXLog Ltd.</p></div><div><p class="pubdate">2009-12-15</p></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#introduction">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#intro_overview">Overview</a></span></dt><dt><span class="section"><a href="#intro_features">Features</a></span></dt><dd><dl><dt><span class="section"><a href="#features_multiplatform">Multiplatform</a></span></dt><dt><span class="section"><a href="#features_modular">Modular architecture</a></span></dt><dt><span class="section"><a href="#features_client_server_mode">Client-server mode</a></span></dt><dt><span class="section"><a href="#features_srcdst">Log message sources and destinations</a></span></dt><dt><span class="section"><a href="#features_security">Importance of security</a></span></dt><dt><span class="section"><a href="#features_scalable">Scalable multi-threaded architecture</a></span></dt><dt><span class="section"><a href="#features_io">High performance I/O</a></span></dt><dt><span class="section"><a href="#features_buffering">Message buffering</a></span></dt><dt><span class="section"><a href="#features_prioritized_processing">Prioritized processing</a></span></dt><dt><span class="section"><a href="#features_no_message_dropping">Avoiding lost messages</a></span></dt><dt><span class="section"><a href="#features_config_syntax">Apache-style configuration syntax</a></span></dt><dt><span class="section"><a href="#features_config_language">Built-in config language</a></span></dt><dt><span class="section"><a href="#features_scheduling">Scheduled tasks</a></span></dt><dt><span class="section"><a href="#features_log_rotation">Log rotation</a></span></dt><dt><span class="section"><a href="#features_formats">Different log message formats</a></span></dt><dt><span class="section"><a href="#feature_processing">Advanced message processing capabilites</a></span></dt><dt><span class="section"><a href="#features_offline_mode">Offline processing mode</a></span></dt><dt><span class="section"><a href="#features_i18n">Character set and i18n support</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#quickstart">2. Installation and quickstart</a></span></dt><dd><dl><dt><span class="section"><a href="#quickstart_windows">Microsoft Windows</a></span></dt><dt><span class="section"><a href="#quickstart_linux">GNU/Linux</a></span></dt><dd><dl><dt><span class="section"><a href="#quickstart_linux_deb">Installing from DEB packages (Debian, Ubuntu)</a></span></dt><dt><span class="section"><a href="#quickstart_linux_rpm">Installing from RPM packages (CentOS, RedHat)</a></span></dt><dt><span class="section"><a href="#quickstart_linux_common">Configuring nxlog on GNU/Linux</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#architecture">3. Architecture and concepts</a></span></dt><dd><dl><dt><span class="section"><a href="#arch_history">History</a></span></dt><dt><span class="section"><a href="#arch_concepts">Concepts</a></span></dt><dt><span class="section"><a href="#arch_arch">Architecture</a></span></dt></dl></dd><dt><span class="chapter"><a href="#config">4. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#config_include">File inclusion</a></span></dt><dt><span class="section"><a href="#config_define">Constant and macro definitions</a></span></dt><dt><span class="section"><a href="#config_global">Global directives</a></span></dt><dt><span class="section"><a href="#config_modules">Modules</a></span></dt><dd><dl><dt><span class="section"><a href="#config_module_common">Common module directives</a></span></dt></dl></dd><dt><span class="section"><a href="#config_routes">Routes</a></span></dt><dd><dl><dt><span class="section"><a href="#config_route_priority">Priority</a></span></dt><dt><span class="section"><a href="#config_route_path">Path</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#lang">5. Language</a></span></dt><dd><dl><dt><span class="section"><a href="#lang_types">Types</a></span></dt><dt><span class="section"><a href="#lang_expressions">Expressions</a></span></dt><dd><dl><dt><span class="section"><a href="#lang_literals">Literals</a></span></dt><dt><span class="section"><a href="#lang_fields">Fields</a></span></dt><dt><span class="section"><a href="#lang_operations">Operations</a></span></dt><dt><span class="section"><a href="#lang_functions">Functions</a></span></dt></dl></dd><dt><span class="section"><a href="#lang_statements">Statements</a></span></dt><dd><dl><dt><span class="section"><a href="#lang_statement_assignment">Assignment</a></span></dt><dt><span class="section"><a href="#lang_statement_block">Block</a></span></dt><dt><span class="section"><a href="#lang_statement_procedures">Procedures</a></span></dt><dt><span class="section"><a href="#lang_statement_if">If-Else</a></span></dt></dl></dd><dt><span class="section"><a href="#lang_variables">Variables</a></span></dt><dt><span class="section"><a href="#lang_stat">Statistical counters</a></span></dt><dt><span class="section"><a href="#lang_exported_funcproc">List of available functions and procedures</a></span></dt><dd><dl><dt><span class="section"><a href="#core_funcproc">Functions and procedures exported by core</a></span></dt><dt><span class="section"><a href="#lang_exported_module_funcproc">Functions and procedures exported by modules</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#modules">6. Modules</a></span></dt><dd><dl><dt><span class="section"><a href="#modules_extension">Extension modules</a></span></dt><dd><dl><dt><span class="section"><a href="#xm_csv">CSV (xm_csv)</a></span></dt><dt><span class="section"><a href="#xm_json">JSON (xm_json)</a></span></dt><dt><span class="section"><a href="#xm_xml">XML (xm_xml)</a></span></dt><dt><span class="section"><a href="#xm_kvp">Key-value pairs (xm_kvp)</a></span></dt><dt><span class="section"><a href="#xm_gelf">GELF (xm_gelf)</a></span></dt><dt><span class="section"><a href="#xm_charconv">Character set conversion (xm_charconv)</a></span></dt><dt><span class="section"><a href="#xm_fileop">File operations (xm_fileop)</a></span></dt><dt><span class="section"><a href="#xm_multiline">Multi-line message parser (xm_multiline)</a></span></dt><dt><span class="section"><a href="#xm_syslog">Syslog (xm_syslog)</a></span></dt><dt><span class="section"><a href="#xm_exec">External program execution (xm_exec)</a></span></dt><dt><span class="section"><a href="#xm_perl">Perl (xm_perl)</a></span></dt><dt><span class="section"><a href="#xm_wtmp">WTMP (xm_wtmp)</a></span></dt></dl></dd><dt><span class="section"><a href="#modules_input">Input modules</a></span></dt><dd><dl><dt><span class="section"><a href="#core_fields">Fields generated by core</a></span></dt><dt><span class="section"><a href="#im_dbi">DBI (im_dbi)</a></span></dt><dt><span class="section"><a href="#im_exec">Program (im_exec)</a></span></dt><dt><span class="section"><a href="#im_file">File (im_file)</a></span></dt><dt><span class="section"><a href="#im_internal">Internal (im_internal)</a></span></dt><dt><span class="section"><a href="#im_kernel">Kernel (im_kernel)</a></span></dt><dt><span class="section"><a href="#im_mark">Mark (im_mark)</a></span></dt><dt><span class="section"><a href="#im_mseventlog">MS EventLog for Windows XP/2000/2003 (im_mseventlog)</a></span></dt><dt><span class="section"><a href="#im_msvistalog">MS EventLog for Windows 2008/Vista and later (im_msvistalog)</a></span></dt><dt><span class="section"><a href="#im_null">Null (im_null)</a></span></dt><dt><span class="section"><a href="#im_ssl">TLS/SSL (im_ssl)</a></span></dt><dt><span class="section"><a href="#im_tcp">TCP (im_tcp)</a></span></dt><dt><span class="section"><a href="#im_udp">UDP (im_udp)</a></span></dt><dt><span class="section"><a href="#im_uds">Unix Domain Socket (im_uds)</a></span></dt></dl></dd><dt><span class="section"><a href="#modules_processor">Processor modules</a></span></dt><dd><dl><dt><span class="section"><a href="#pm_blocker">Blocker (pm_blocker)</a></span></dt><dt><span class="section"><a href="#pm_buffer">Buffer (pm_buffer)</a></span></dt><dt><span class="section"><a href="#pm_evcorr">Event correlator (pm_evcorr)</a></span></dt><dt><span class="section"><a href="#pm_filter">Filter (pm_filter)</a></span></dt><dt><span class="section"><a href="#pm_norepeat">Message deduplicator (pm_norepeat)</a></span></dt><dt><span class="section"><a href="#pm_null">Null (pm_null)</a></span></dt><dt><span class="section"><a href="#pm_pattern">Pattern matcher (pm_pattern)</a></span></dt><dt><span class="section"><a href="#pm_transformer">Message format converter (pm_transformer)</a></span></dt></dl></dd><dt><span class="section"><a href="#modules_output">Output modules</a></span></dt><dd><dl><dt><span class="section"><a href="#om_blocker">Blocker (om_blocker)</a></span></dt><dt><span class="section"><a href="#om_dbi">DBI (om_dbi)</a></span></dt><dt><span class="section"><a href="#om_exec">Program (om_exec)</a></span></dt><dt><span class="section"><a href="#om_file">File (om_file)</a></span></dt><dt><span class="section"><a href="#om_http">HTTP(s) (om_http)</a></span></dt><dt><span class="section"><a href="#om_null">Null (om_null)</a></span></dt><dt><span class="section"><a href="#om_ssl">TLS/SSL (om_ssl)</a></span></dt><dt><span class="section"><a href="#om_tcp">TCP (om_tcp)</a></span></dt><dt><span class="section"><a href="#om_udp">UDP (om_udp)</a></span></dt><dt><span class="section"><a href="#om_uds">UDS (om_uds)</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#offline">7. Offline log processing</a></span></dt><dd><dl><dt><span class="section"><a href="#nxlog_processor">nxlog-processor</a></span></dt></dl></dd><dt><span class="chapter"><a href="#sources">8. Reading and receiving logs</a></span></dt><dd><dl><dt><span class="section"><a href="#sources_os">Operating Systems</a></span></dt><dd><dl><dt><span class="section"><a href="#sources_os_windows">Microsoft Windows</a></span></dt><dt><span class="section"><a href="#sources_os_linux">GNU/Linux</a></span></dt><dt><span class="section"><a href="#sources_os_android">Android</a></span></dt></dl></dd><dt><span class="section"><a href="#sources_network">Network</a></span></dt><dd><dl><dt><span class="section"><a href="#sources_network_udp">UDP</a></span></dt><dt><span class="section"><a href="#sources_network_tcp">TCP</a></span></dt><dt><span class="section"><a href="#sources_network_ssl">TLS/SSL over TCP</a></span></dt><dt><span class="section"><a href="#sources_network_syslog">Syslog</a></span></dt></dl></dd><dt><span class="section"><a href="#sources_database">Database</a></span></dt><dd><dl><dt><span class="section"><a href="#sources_database_dbi">Using im_dbi</a></span></dt><dt><span class="section"><a href="#sources_database_odbc">Using im_odbc</a></span></dt></dl></dd><dt><span class="section"><a href="#sources_file">Files</a></span></dt><dt><span class="section"><a href="#sources_program">External programs and scripts</a></span></dt><dt><span class="section"><a href="#sources_app">Applications</a></span></dt><dd><dl><dt><span class="section"><a href="#sources_app_apache">Apache HTTP Server</a></span></dt><dt><span class="section"><a href="#sources_app_tomcat">Apache Tomcat and java application logs</a></span></dt></dl></dd><dt><span class="section"><a href="#sources_device">Devices</a></span></dt><dd><dl><dt><span class="section"><a href="#sources_device_cisco">Cisco</a></span></dt><dt><span class="section"><a href="#sources_device_checkpoint">Checkpoint</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#processing">9. Processing logs</a></span></dt><dd><dl><dt><span class="section"><a href="#processing_parsers">Parsing various formats</a></span></dt><dd><dl><dt><span class="section"><a href="#processing_parsers_w3c">W3C Extended Log File Format</a></span></dt><dt><span class="section"><a href="#processing_parsers_combined_log_format">NCSA Combined Log Format</a></span></dt><dt><span class="section"><a href="#processing_parsers_csv">Field delimited formats (CSV)</a></span></dt><dt><span class="section"><a href="#processing_parsers_json">JSON</a></span></dt><dt><span class="section"><a href="#processing_parsers_xml">XML</a></span></dt></dl></dd><dt><span class="section"><a href="#processing_datetime">Parsing date and time strings</a></span></dt><dt><span class="section"><a href="#processing_filtering">Filtering messages</a></span></dt><dd><dl><dt><span class="section"><a href="#processing_filtering_drop">Using drop()</a></span></dt><dt><span class="section"><a href="#processing_filtering_pm_filter">Filtering through pm_filter</a></span></dt></dl></dd><dt><span class="section"><a href="#processing_multiline">Dealing with multi-line messages</a></span></dt><dd><dl><dt><span class="section"><a href="#processing_multiline_module_vars">Using module variables</a></span></dt><dt><span class="section"><a href="#processing_multiline_xm_multiline">Using xm_multiline</a></span></dt></dl></dd><dt><span class="section"><a href="#processing_alerting_scripts">Alerting, calling external scripts and programs</a></span></dt><dd><dl><dt><span class="section"><a href="#processing_calling_scripts_om_exec">Sending all messages to an external program</a></span></dt><dt><span class="section"><a href="#processing_calling_scripts_xm_exec">Invoking a script or program for each message</a></span></dt><dt><span class="section"><a href="#processing_calling_scripts_alerting">Alerting</a></span></dt></dl></dd><dt><span class="section"><a href="#processing_rewrite">Rewriting and modifying messages</a></span></dt><dt><span class="section"><a href="#processing_format_conversion">Message format conversion</a></span></dt><dt><span class="section"><a href="#processing_charset_conversion">Character set conversion</a></span></dt><dt><span class="section"><a href="#processing_discarding">Discarding messages</a></span></dt><dt><span class="section"><a href="#processing_rate_limiting">Rate limiting</a></span></dt><dt><span class="section"><a href="#processing_buffering">Buffering</a></span></dt><dt><span class="section"><a href="#processing_pattern_matching">Pattern matching and message classification</a></span></dt><dd><dl><dt><span class="section"><a href="#processing_pattern_matching_regexp">Regular expressions in the Exec directive</a></span></dt><dt><span class="section"><a href="#processing_pattern_matching_pm_pattern">Using pm_pattern</a></span></dt></dl></dd><dt><span class="section"><a href="#processing_correlation">Event correlation</a></span></dt><dt><span class="section"><a href="#processing_log_rotation">Log rotation and retention</a></span></dt><dt><span class="section"><a href="#processing_explicit_drop">Explicit drop</a></span></dt></dl></dd><dt><span class="chapter"><a href="#forwarding">10. Forwarding and storing logs</a></span></dt><dd><dl><dt><span class="section"><a href="#forwarding_format">Data format of the output</a></span></dt><dt><span class="section"><a href="#forwarding_network">Forwarding over the network</a></span></dt><dt><span class="section"><a href="#forwarding_files_sockets">Sending to sockets and files</a></span></dt><dt><span class="section"><a href="#forwarding_database">Storing logs in a database</a></span></dt></dl></dd><dt><span class="chapter"><a href="#tips">11. Tips and tricks</a></span></dt><dd><dl><dt><span class="section"><a href="#tips_no_logs">Detecting a dead agent or log source</a></span></dt></dl></dd><dt><span class="chapter"><a href="#troubleshooting">12. Troubleshooting</a></span></dt><dd><dl><dt><span class="section"><a href="#troubleshooting_logging">nxlog's internal logs</a></span></dt><dd><dl><dt><span class="section"><a href="#troubleshooting_logfile">Check the contents of the LogFile</a></span></dt><dt><span class="section"><a href="#troubleshooting_im_internal">Injecting own logs into a route</a></span></dt><dt><span class="section"><a href="#troubleshooting_loglevel">LogLevel</a></span></dt><dt><span class="section"><a href="#troubleshooting_foreground">Running in foreground</a></span></dt><dt><span class="section"><a href="#troubleshooting_exec_log_info">Using log_info() in the Exec directive</a></span></dt></dl></dd><dt><span class="section"><a href="#troubleshooting_common_problems">Common problems</a></span></dt><dd><dl><dt><span class="section"><a href="#troubleshooting_common_problems_missing_logdata">Missing logdata</a></span></dt><dt><span class="section"><a href="#troubleshooting_common_problems_invalid_conf">nxlog failed to start, cannot read configuration file</a></span></dt><dt><span class="section"><a href="#troubleshooting_common_problems_nxlog_log_in_use">nxlog.log is in use by another application and cannot be accessed</a></span></dt><dt><span class="section"><a href="#troubleshooting_common_problems_connection_refused">Connection refused when trying to connect to im_tcp or im_ssl</a></span></dt></dl></dd><dt><span class="section"><a href="#troubleshooting_log_message_content">console.logging the data</a></span></dt><dt><span class="section"><a href="#troubleshooting_console.logging">console.logging</a></span></dt><dd><dl><dt><span class="section"><a href="#troubleshooting_console.logging_memleaks">console.logging memory leaks</a></span></dt></dl></dd></dl></dd></dl></div><div class="list-of-examples"><p><b>List of Examples</b></p><dl><dt>4.1. <a href="#idp29927232">File inclusion example</a></dt><dt>4.2. <a href="#idp29928544">Config file inclusion with wildcards</a></dt><dt>4.3. <a href="#idp29932816">Example for using defines</a></dt><dt>4.4. <a href="#idp29934960">Incorrect use of a define</a></dt><dt>4.5. <a href="#idp30163136">Two scheduled jobs in the context of the im_tcp module</a></dt><dt>4.6. <a href="#idp30170672">Simle Exec statement</a></dt><dt>4.7. <a href="#idp30172000">Exec statement spanning multiple lines</a></dt><dt>4.8. <a href="#idp30173520">Equivalent use of statements in Exec</a></dt><dt>4.9. <a href="#idp30177216">Using the Exec block</a></dt><dt>4.10. <a href="#idp30196064">TCP input assuming nxlog format</a></dt><dt>4.11. <a href="#idp30213024">TCP output sending messages in nxlog format</a></dt><dt>4.12. <a href="#idp30216976">Route block</a></dt><dt>4.13. <a href="#idp30220912">Prioritized processing</a></dt><dt>4.14. <a href="#config_example_routes">Different routes</a></dt><dt>5.1. <a href="#idp31115312">Using brackets around expressions</a></dt><dt>5.2. <a href="#idp31108592">Unsetting a value of a field</a></dt><dt>5.3. <a href="#idp31101088">Setting an integer value</a></dt><dt>5.4. <a href="#idp31084112">Setting a string value</a></dt><dt>5.5. <a href="#idp31080304">A regular expression match operation</a></dt><dt>5.6. <a href="#idp31076480">Setting a datetime value</a></dt><dt>5.7. <a href="#idp31059216">Typical use of the 'not' operand</a></dt><dt>5.8. <a href="#idp31055024">Unary negation</a></dt><dt>5.9. <a href="#lang_defined_example">Use of the unary 'defined' operation</a></dt><dt>5.10. <a href="#idp31039152">Regular expression based string matching</a></dt><dt>5.11. <a href="#idp31034816">Replace whitespace occurences</a></dt><dt>5.12. <a href="#idp31028656">Dot matches all characters</a></dt><dt>5.13. <a href="#idp31011952">Regular expression based string matching</a></dt><dt>5.14. <a href="#idp30982352">Comparing integers</a></dt><dt>5.15. <a href="#idp30951584">Comparing for inequality</a></dt><dt>5.16. <a href="#idp30940496">Less</a></dt><dt>5.17. <a href="#idp30919792">Less or equal</a></dt><dt>5.18. <a href="#idp30498592">Greater</a></dt><dt>5.19. <a href="#idp30909280">Greater or equal</a></dt><dt>5.20. <a href="#idp30901632">And operation</a></dt><dt>5.21. <a href="#idp30894144">Or</a></dt><dt>5.22. <a href="#idp30867392">Concatenation</a></dt><dt>5.23. <a href="#idp30853888">Subtraction</a></dt><dt>5.24. <a href="#idp30846032">Multiplication</a></dt><dt>5.25. <a href="#idp30839168">Division</a></dt><dt>5.26. <a href="#idp30829536">Modulo</a></dt><dt>5.27. <a href="#idp30824048">IN</a></dt><dt>5.28. <a href="#idp30816160">NOT IN</a></dt><dt>5.29. <a href="#idp30808128">Function call</a></dt><dt>5.30. <a href="#idp30804320">Assignment</a></dt><dt>5.31. <a href="#idp30797968">Conditional statement block</a></dt><dt>5.32. <a href="#idp30795408">Procedure call</a></dt><dt>5.33. <a href="#idp30785488">Conditional statements</a></dt><dt>5.34. <a href="#idp30784464">Emulating switch with if-else</a></dt><dt>5.35. <a href="#lang_variable_example_corr">Simple event correlation using module variables</a></dt><dt>5.36. <a href="#idp30761072">Simple event correlation using statistical counters</a></dt><dt>6.1. <a href="#xm_csv_example1">Complex CSV format conversion</a></dt><dt>6.2. <a href="#xm_json_example1">Syslog to JSON format conversion</a></dt><dt>6.3. <a href="#xm_json_example2">Converting Windows EventLog to Syslog encapsulated JSON</a></dt><dt>6.4. <a href="#xm_xml_example1">Syslog to XML format conversion</a></dt><dt>6.5. <a href="#xm_xml_example2">Converting Windows EventLog to Syslog encapsulated XML</a></dt><dt>6.6. <a href="#xm_kvp_example_simple">Simple KVP parsing</a></dt><dt>6.7. <a href="#xm_kvp_example_cisco_acs">Parsing KVPs in Cisco ACS syslog</a></dt><dt>6.8. <a href="#xm_kvp_example_sidewinder">Parsing KVPs in Sidewinder logs</a></dt><dt>6.9. <a href="#xm_kvp_example_apache_url">Parsing URL request parameters in Apache access logs</a></dt><dt>6.10. <a href="#xm_gelf_example1">Sending Windows EventLog to Graylog2 in GELF</a></dt><dt>6.11. <a href="#xm_gelf_example_file">Forwarding custom log files to Graylog2 in GELF</a></dt><dt>6.12. <a href="#xm_gelf_example_csv">Parsing a CSV file and sending it to Graylog2 in GELF</a></dt><dt>6.13. <a href="#xm_charconv_example">Character set autodetection of various input encodings</a></dt><dt>6.14. <a href="#xm_fileop_example1">Rotation of the internal LogFile</a></dt><dt>6.15. <a href="#xm_multiline_example_5">Parsing multi-line XML logs and converting to JSON</a></dt><dt>6.16. <a href="#xm_multiline_example_4">Parsing DICOM logs</a></dt><dt>6.17. <a href="#xm_multiline_example_1">Multi-line messages with a fixed string header</a></dt><dt>6.18. <a href="#xm_multiline_example_2">Multi-line messages with fixed line count</a></dt><dt>6.19. <a href="#xm_multiline_example_3">Multi-line messages with a syslog header</a></dt><dt>6.20. <a href="#xm_syslog_example_syslog_bsd_file">Sending a file as BSD syslog over UDP</a></dt><dt>6.21. <a href="#xm_syslog_example_bsd_udp">Collecting BSD style syslog messages over UDP</a></dt><dt>6.22. <a href="#xm_syslog_example_ietf_udp">Collecting IETF style syslog messages over UDP</a></dt><dt>6.23. <a href="#xm_syslog_example_bsd_ietf_udp">Collecting both IETF and BSD style syslog messages over the same UDP port</a></dt><dt>6.24. <a href="#xm_syslog_example_ietf_ssl">Collecting IETF style syslog messages over TLS/SSL</a></dt><dt>6.25. <a href="#xm_syslog_example_ietf_tcpout">Forwarding IETF syslog over TCP</a></dt><dt>6.26. <a href="#xm_syslog_example1">Conditional rewrite of the syslog facility - version 1</a></dt><dt>6.27. <a href="#xm_syslog_example2">Conditional rewrite of the syslog facility - version 2</a></dt><dt>6.28. <a href="#idp34928096">nxlog acting as a cron daemon</a></dt><dt>6.29. <a href="#idp34930576">Sending email alerts</a></dt><dt>6.30. <a href="#xm_perl_example1">Using the built-in perl interpreter</a></dt><dt>6.31. <a href="#xm_wtmp_example1">WTMP to JSON format conversion</a></dt><dt>6.32. <a href="#idp35064896">Reading from a MySQL database</a></dt><dt>6.33. <a href="#idp35085968">Emulating im_file</a></dt><dt>6.34. <a href="#idp35162976">Forwarding logs from a file to a remote host</a></dt><dt>6.35. <a href="#idp35226880">Forwaring internal messages over syslog udp</a></dt><dt>6.36. <a href="#idp35241888">Storing raw kernel logs into a file</a></dt><dt>6.37. <a href="#idp35300352">Using the im_mark module</a></dt><dt>6.38. <a href="#idp35414144">Forwarding EventLogs from a windows machine to a remote host</a></dt><dt>6.39. <a href="#idp35584976">Forwarding Windows EventLog from a windows machine to a remote host in syslog format</a></dt><dt>6.40. <a href="#idp35641952">Reading binary data forwarded from another nxlog agent</a></dt><dt>6.41. <a href="#idp35676368">Using the im_tcp module</a></dt><dt>6.42. <a href="#idp35717392">Using the im_udp module</a></dt><dt>6.43. <a href="#idp35739136">Using the im_uds module</a></dt><dt>6.44. <a href="#idp35770400">Using the pm_blocker module</a></dt><dt>6.45. <a href="#idp35815664">Using a memory buffer to protect against udp message loss</a></dt><dt>6.46. <a href="#idp35957408">Correlation rules</a></dt><dt>6.47. <a href="#idp35972480">Dropping messages conditionally</a></dt><dt>6.48. <a href="#idp35982464">Filtering messages</a></dt><dt>6.49. <a href="#idp36031472">Filtering out duplicated messages</a></dt><dt>6.50. <a href="#idp36065072">A simple pattern database</a></dt><dt>6.51. <a href="#idp36091024">Using the pm_pattern module</a></dt><dt>6.52. <a href="#idp36170544">Using the pm_transformer module</a></dt><dt>6.53. <a href="#idp36181008">Testing buffering with the om_blocker module</a></dt><dt>6.54. <a href="#idp36205264">Storing syslog in a PostgreSQL database</a></dt><dt>6.55. <a href="#idp36209856">Storing logs in a MySQL database</a></dt><dt>6.56. <a href="#idp36231200">Piping logs to an external program</a></dt><dt>6.57. <a href="#idp36292736">Storing raw syslog messages into a file</a></dt><dt>6.58. <a href="#om_file_config_example_rotate1">File rotation based on size</a></dt><dt>6.59. <a href="#idp36344176">Sending logs over HTTPS</a></dt><dt>6.60. <a href="#idp36397152">Writing nxlog binary data to another nxlog agent</a></dt><dt>6.61. <a href="#idp36425936">Transferring raw logs over TCP</a></dt><dt>6.62. <a href="#idp36445808">Sending raw syslog over udp</a></dt><dt>6.63. <a href="#idp36462080">Using the om_uds module</a></dt><dt>8.1. <a href="#idp31140096">Parsing tomcat logs into fields</a></dt><dt>8.2. <a href="#idp30032704">Cisco Secure Access Control Server</a></dt><dt>8.3. <a href="#idp30038000">Cisco PIX and Cisco ASA</a></dt><dt>9.1. <a href="#idp33701584">Parsing the W3C Extended Log File Format using xm_csv</a></dt><dt>9.2. <a href="#processing_parsers_combined_log_format_example">Parsing apache logs in Combined Log Format</a></dt><dt>9.3. <a href="#idp32581744">Using the parsedate() function</a></dt><dt>9.4. <a href="#idp32586464">Parsing date and time from Exchange logs</a></dt><dt>9.5. <a href="#idp33593520">Parsing multiline messages using module variables</a></dt><dt>9.6. <a href="#idp32549856">Using sleep for rate limiting</a></dt><dt>9.7. <a href="#idp32561856">Regular expression based message classification</a></dt><dt>9.8. <a href="#idp33275344">Rotation of the internal LogFile</a></dt><dt>9.9. <a href="#idp33278640">File rotation based on size</a></dt><dt>9.10. <a href="#idp31670992">Explicitly dropping messages when the network module is blocked</a></dt><dt>10.1. <a href="#idp30031456">Forwarding EventLogs from a windows machine to a remote host in the SNARE Agent format</a></dt><dt>11.1. <a href="#idp30023600">Alerting on absence of log messages</a></dt><dt>12.1. <a href="#idp31684240">Assignment after drop()</a></dt><dt>12.2. <a href="#troubleshooting_example_file_write">Writing the values of fields to an external file</a></dt><dt>12.3. <a href="#troubleshooting_example_log_info">Writing the values of fields to the internal log</a></dt><dt>12.4. <a href="#troubleshooting_example_to_json">Dumping all the fields</a></dt></dl></div><div class="chapter" title="Chapterï¿½1.ï¿½Introduction"><div class="titlepage"><div><div><h2 class="title"><a name="introduction"></a>Chapterï¿½1.ï¿½Introduction</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#intro_overview">Overview</a></span></dt><dt><span class="section"><a href="#intro_features">Features</a></span></dt><dd><dl><dt><span class="section"><a href="#features_multiplatform">Multiplatform</a></span></dt><dt><span class="section"><a href="#features_modular">Modular architecture</a></span></dt><dt><span class="section"><a href="#features_client_server_mode">Client-server mode</a></span></dt><dt><span class="section"><a href="#features_srcdst">Log message sources and destinations</a></span></dt><dt><span class="section"><a href="#features_security">Importance of security</a></span></dt><dt><span class="section"><a href="#features_scalable">Scalable multi-threaded architecture</a></span></dt><dt><span class="section"><a href="#features_io">High performance I/O</a></span></dt><dt><span class="section"><a href="#features_buffering">Message buffering</a></span></dt><dt><span class="section"><a href="#features_prioritized_processing">Prioritized processing</a></span></dt><dt><span class="section"><a href="#features_no_message_dropping">Avoiding lost messages</a></span></dt><dt><span class="section"><a href="#features_config_syntax">Apache-style configuration syntax</a></span></dt><dt><span class="section"><a href="#features_config_language">Built-in config language</a></span></dt><dt><span class="section"><a href="#features_scheduling">Scheduled tasks</a></span></dt><dt><span class="section"><a href="#features_log_rotation">Log rotation</a></span></dt><dt><span class="section"><a href="#features_formats">Different log message formats</a></span></dt><dt><span class="section"><a href="#feature_processing">Advanced message processing capabilites</a></span></dt><dt><span class="section"><a href="#features_offline_mode">Offline processing mode</a></span></dt><dt><span class="section"><a href="#features_i18n">Character set and i18n support</a></span></dt></dl></dd></dl></div><div class="section" title="Overview"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="intro_overview"></a>Overview</h2></div></div></div><p>
     Today's IT infrasturcture can be very demanding in terms of event logs. Hundreds of different
     devices, applications, appliances produce vast amounts of event log messages. These must be
     handled in real time, forwarded or stored in a central location after filtering,
     message classification, correlation and other typical log processing tasks. In most
     organizations these tasks are solved by connecting a dozen different scripts and programs
     which all have their custom format and configuration.
     nxlog is a high-performance multi-platform log management solution aimed at solving these
     tasks and doing it all in one place.
   </p><p>
    nxlog can work in a heterogenous environment collecting event logs from thousands of different
    sources in many formats. nxlog can accept event logs from tcp, udp, file, database and
    various other sources in different formats such as syslog, windows event log etc.
    It can perform log rewrite, correlation, alerting, pattern matching, execute scheduled jobs,
    or even log rotation.
    It was designed to be able to fully utilize todays multi-core CPU systems. Its multi-threaded
    architecture enables input, log processing and output tasks to be executed in parallel. 
    Using a high-performance I/O layer it is capable of handling thousands of simultaneous
    client connections and process log volumes above the 100.000 EPS range. 
    nxlog tries hard to minimize loosing log messages, it does not drop any unless instructed to.
    It can process input sources in a prioritized order, meaning that a higher priority source
    will be always processed before others. This can further help avoiding UDP message loss
    for example. In case of network congestion or other log transmission problems, nxlog can
    buffer messages on the disk or in memory.
    Using loadable modules it supports different input sources and log formats, not only 
    limited to syslog but windows event log, audit logs or even custom binary application logs.
    It is possible to further extend its functionality by using custom loadable modules
    similarly to the Apache Web server.
    In addition to the online log processing mode it can be used to process logs in batch mode
    in an offline fashion.
    A powerful configuration language with an Apache style configuration file syntax enables
    it to rewrite logs, send alerts, execute external scripts or do virtually anything based
    on any criteria specified using the nxlog configuration language.
   </p></div><div class="section" title="Features"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="intro_features"></a>Features</h2></div></div></div><div class="section" title="Multiplatform"><div class="titlepage"><div><div><h3 class="title"><a name="features_multiplatform"></a>Multiplatform</h3></div></div></div><p>
      nxlog is built to utilize the Apache Portable Runtime Library (libapr), the same solid 
      foundation as the Apache Webserver is built on which enables nxlog to run on many different
      operating systems including different Unix flavors (Linux, HP-UX, Solaris, *BSD etc).
      It compiles and runs as a native Windows application without requiring the CygWin
      libraries on Microsoft Windows platforms.
    </p></div><div class="section" title="Modular architecture"><div class="titlepage"><div><div><h3 class="title"><a name="features_modular"></a>Modular architecture</h3></div></div></div><p>
      nxlog has a lightweight modular architecture, pluggable modules are available to 
      provide different features and functions similarly to the Apache HTTP server.
      Log format parsers, transmission protocol handlers, database handlers and nxlog language 
      extensions are such modules. A module is only loaded if it is necessary, this helps
      reduce memory as well.
      The core of nxlog only contains code to handle files and sockets in addition to the
      configuration parser and the lightweight built-in language engine. All transport
      protocol handlers, format parsers (such as syslog) etc reside in modules.
      Modules have a common API, developers can easily write new modules and extend the
      functionality of nxlog.
    </p></div><div class="section" title="Client-server mode"><div class="titlepage"><div><div><h3 class="title"><a name="features_client_server_mode"></a>Client-server mode</h3></div></div></div><p>
      nxlog can act as a client and/or a server. It can collect logs from local files and
      the operating system then forward it to to a remote server. It can accept connections
      and receive logs over the network then write these to a database or files or forward
      it further. It all depends how it is configured.
    </p></div><div class="section" title="Log message sources and destinations"><div class="titlepage"><div><div><h3 class="title"><a name="features_srcdst"></a>Log message sources and destinations</h3></div></div></div><p>
      In addition to reading from and writing to log files, nxlog supports different
      protocols on the network and transport layer such as TCP, UDP, TLS/SSL and
      Unix Domain Socket. It can both read and write from such sources and can convert
      between then, read input from an UDP socket and send out in TCP for example.
    </p><p>
      Many database servers are supported (PostgreSQL, MySQL, Oracle, MsSQL, SqlLite, Sybase, etc)
      through database input and output modules so that log messages or data extracted from 
      log messages can be stored or read from a database.
    </p></div><div class="section" title="Importance of security"><div class="titlepage"><div><div><h3 class="title"><a name="features_security"></a>Importance of security</h3></div></div></div><p>
      On unix systems nxlog can be instructed to run as a normal user by dorpping its root
      privileges. Modules requiring special privileges (e.g. kernel, tcp port bind below 1024) 
      use Linux capabilites and do not require it to be running as root.
    </p><p>
      To secure data and event logs, nxlog provides TLS/SSL transport so that messages cannot
      be intercepted and/or altered during transmission.
    </p></div><div class="section" title="Scalable multi-threaded architecture"><div class="titlepage"><div><div><h3 class="title"><a name="features_scalable"></a>Scalable multi-threaded architecture</h3></div></div></div><p>
      Using an event based architecture, tasks within nxlog are processed in a parallel fashion.
      Non-blocking I/O is used wherever possible and a worker thread pool takes care of
      handling ready to be processed log messages. Reading input, writing output and
      log processing (parsing, pattern matching, etc) are all handled in parallel.
      For example when single threaded syslog daemons block trying to write output to a file
      or database, UDP input will be lost. The multi-threaded architecture of nxlog not only
      avoids this problem but enables to fully utilize today's multi-core and multi-processor
      systems for maximum throughput.
    </p></div><div class="section" title="High performance I/O"><div class="titlepage"><div><div><h3 class="title"><a name="features_io"></a>High performance I/O</h3></div></div></div><p>
     Traditional POSIX systems provide the select(2) and/or poll(2) system calls to
     monitor file descriptors, unfortunately using these methods is not scalable.
     Modern operating systems have some I/O readiness notification API to enable 
     handling a large number of open files and network connections simultaneously.
     nxlog is capable of using these high-performance I/O readieness notification
     APIs and can handle thousands of simultaneous network connections. Together
     with its massively multi-threaded architecture, this enables nxlog to process log messages
     from thousands of simultaneous network connections above the hundred thousand event
     per second (EPS) range.
    </p></div><div class="section" title="Message buffering"><div class="titlepage"><div><div><h3 class="title"><a name="features_buffering"></a>Message buffering</h3></div></div></div><p>
      When write blocks on the sending side, because of a network trouble for example, 
      nxlog will throttle back on the input side using flow control. In some cases it is preferable that the logs
      are continued to be read on the input side, to avoid dropping UDP syslog messages for example.
      There is a module avalable which makes it possible to buffer log messages to disk
      and/or memory. When the problems are solved and the system is back in order
      and can send out messages faster then being received, then the buffer is automatically 
      emptied.
      
      Together with the nxlog language it is also possible to do conditional buffering
      based on different parameters (time or system load for example).
    </p></div><div class="section" title="Prioritized processing"><div class="titlepage"><div><div><h3 class="title"><a name="features_prioritized_processing"></a>Prioritized processing</h3></div></div></div><p>
      Not all log sources are always equally important. Some systems send critical logs
      which should be processed at a higher priority than others.
      nxlog supports assigning priorites to log routes, this ensures that higher priority
      log messages are dealt with (read, processed and written/sent out) first, only then
      are the messages with lower priorities handled.
      For example this can help avoiding the situation where a TCP input can overload the
      system leading to dropped incoming UDP syslog messages.
    </p></div><div class="section" title="Avoiding lost messages"><div class="titlepage"><div><div><h3 class="title"><a name="features_no_message_dropping"></a>Avoiding lost messages</h3></div></div></div><p>
      Built-in flow control ensures that nxlog does not drop log messages and you will not
      see any logs such as the following:
      </p><pre class="programlisting">Dec 18 18:42:42 server syslog-ng[1234]: STATS: dropped 42</pre><p>
      Though nxlog can be explicitly instructed to drop log messages depending on certain 
      conditions in order to avoid a possible resource exhaustion or filter out unwanted messages.
    </p><p>
      UDP syslog is a typical case where a message can be lost due to the nature of the UDP
      protocol. If the kernel buffer becomes full because it is not read, the operating
      system will drop any further received UDP messages.
      If a log processing system is busy processing logs, reading from TCP and UDP and
      writing to database or disk, the kernel UDP buffer can fill quickly.
      Utilizing the above mentioned 
      <a class="link" href="#features_scalable" title="Scalable multi-threaded architecture">parallel processing</a>,
      <a class="link" href="#features_buffering" title="Message buffering">buffering</a> and
      <a class="link" href="#features_prioritized_processing" title="Prioritized processing">I/O prioritization</a>
      features it is possible to greatly reduce losing UDP syslog messages.
      Of course using TCP can help avoiding message loss, unfortunately there
      are many archaic devices which only support UDP syslog.
    </p></div><div class="section" title="Apache-style configuration syntax"><div class="titlepage"><div><div><h3 class="title"><a name="features_config_syntax"></a>Apache-style configuration syntax</h3></div></div></div><p>
      nxlog uses Apache style configuration file syntax. This format is in use by many other
      popular system daemons and tools as it is easy to read and/or generate by both humans
      and scripts.
    </p></div><div class="section" title="Built-in config language"><div class="titlepage"><div><div><h3 class="title"><a name="features_config_language"></a>Built-in config language</h3></div></div></div><p>
      A built-in configuration language enables administrators to create complex rules,
      format or rewrite messages or execute some action. Using this language it is
      possible to do virtually anything without the need to forward messages to an external
      script. Loadable modules can register their own procedures and functions to further
      extend the capabilities of the nxlog language.
    </p><p>
      Perl is a highly popular language in solving log processing tasks. The built-in nxlog
      language is very similar in syntax to Perl.
      In addition to the normal operations it supports polymorphic functions and procedures,
      regular expressions with captured substrings.
      It should be fairly trivial to write and understand by people experienced in Perl
      programming unlike some macro based configuration languages found in other solutions.
    </p></div><div class="section" title="Scheduled tasks"><div class="titlepage"><div><div><h3 class="title"><a name="features_scheduling"></a>Scheduled tasks</h3></div></div></div><p>
      nxlog has a built-in scheduler similar to cron, but with more advanced capabilities
      to specify the timings. Using this feature, administrators can automate tasks such 
      as log rotation or system health check from within nxlog without having to use
      external scheduler tools.
      Each module can schedule any number of actions to be executed through the built-in
      nxlog language.
    </p></div><div class="section" title="Log rotation"><div class="titlepage"><div><div><h3 class="title"><a name="features_log_rotation"></a>Log rotation</h3></div></div></div><p>
      Log files can be rotated by size or time without the need of external log rotation
      tools. Log rotation can also be scheduled in order to guarantee timely file rotation.
    </p><p>
      The file input reader module supports external log-rotation scripts, it can detect when
      an input file was moved/renamed and will reopen its input. Similarly, the file output
      writer module can also monitor when the file being written to is rotated and will
      reopen its original output.
      This way it is possible to keep using external log rotation tools without the need
      to migrate to the built-in log rotation.
    </p></div><div class="section" title="Different log message formats"><div class="titlepage"><div><div><h3 class="title"><a name="features_formats"></a>Different log message formats</h3></div></div></div><p>
      Nxlog supports both the older legacy syslog format (RFC 3164) and the newer IETF Syslog
      standard (RFC 5424) and it can also produce syslog in the Snare Agent format.
      nxlog is not only a syslog daemon but can handle many other protocols and log file
      formats such as Windows Event Log, Checkpoint logs through LEA, OS audit logs,
      log message data in comma separated (CSV) format or delimited, GELF, JSON, XML or custom
      application logs. It can parse and generate most of these formats as well.
      It is only a matter of selecting the appropriate log format parser.
      Log format parsers are also provided by loadable modules, nxlog  will only use
      parsers which are configured and required for its log processing.
      For example if the log processing task does not deal with any syslog data,
      then there is no need to load the syslog module at all.
    </p><p>
      Using regular expressions and string operation functions of the built-in nxlog
      language, any data can be extracted from log messages and can be converted
      to any format required.
      It is possible to configure nxlog in such a way that it reads log messages in
      one format then converts it internally to a different one and sends the output
      to another destination enabling on-the-fly log conversion. For example it is
      possible to convert Windows Event Log to syslog on a Windows host and send it
      to a central syslog server.
    </p><p>
      By using log format parser functions, nxlog can handle multi-line log messages (such
      as the Apache Tomcat log) or even custom binary formats.
      A special nxlog message format can preserve the parsed fields of log messages and 
      transfer these across the network or store in files which alleviates the need to
      parse the messages again at the reception without loosing any information.
    </p></div><div class="section" title="Advanced message processing capabilites"><div class="titlepage"><div><div><h3 class="title"><a name="feature_processing"></a>Advanced message processing capabilites</h3></div></div></div><p>
      In addition to the features provided by the above mentioned built-in nxlog language,
      using additional modules nxlog is capable to solve all tasks related to log message
      processing such as message classification, event correlation, pattern matching, 
      message filtering, rewrite, conditional alerting etc.
    </p></div><div class="section" title="Offline processing mode"><div class="titlepage"><div><div><h3 class="title"><a name="features_offline_mode"></a>Offline processing mode</h3></div></div></div><p>
      Sometimes messages need to be processed in an offline fashion, convert log files to
      another format, filter out messages or load files into a database for log analysis 
      purposes.
      nxlog can also work in an offline mode when it processes log messages until there is
      no more input and then exits, so it is possible to do batch processing tasks
      with it as well.
    </p><p>
      It is an important factor that in offline mode the time of the event and the current
      time are not the same and are not even close. Many log processing tools assume the
      event time to be the current time, thus making offline processing impossible.
      Due to network problems and buffering it is possible that log messages are not 
      received instantly but with some delay. Making decisions based on event reception time 
      instead of the timestamp provided in the message is a big mistake and can lead to
      false alarms in event correlation engines for example.
      By using the event time available in messages, nxlog can work properly in both offline
      and online mode with log messages. This is escpecially important to be able to do proper
      time based event correlation in real-time and in offline mode as well.
    </p></div><div class="section" title="Character set and i18n support"><div class="titlepage"><div><div><h3 class="title"><a name="features_i18n"></a>Character set and i18n support</h3></div></div></div><p>
      Log messages can be emitted in different languages and character sets. It is 
      also a common problem that the messages use different character sets even for one 
      language. For example Microsoft Windows systems use the UTF-16 character set,
      other systems can create messages using the UTF-8 encoding. UTF-8 has become a 
      standard on Unix systems, yet some legacy applications and system settings
      create log messages using another codepage, for example latin-2 or ISO-8859-2 in
      Eastern Europe or EUC-JP in Japan.
    </p><p>
      Comparing two strings in different character sets can likely fail.
      Also some database engines only support storing text data in one character set only,
      trying to insert text in a different character set can result in an error and
      data loss.
      It is a good practice to normalize logs to a common character set such as UTF-8
      in order to overcome these problems.
    </p><p>
      nxlog supports explicit character set conversion from one character set to another.
      In addition it can also detect the character set of a string and convert it to
      a specific character set. Using charset autodetection, nxlog is capable of normalizing
      log messages which can contain strings in mixed character sets even without knowing
      the exact encoding of the source log message.
    </p></div></div></div><div class="chapter" title="Chapterï¿½2.ï¿½Installation and quickstart"><div class="titlepage"><div><div><h2 class="title"><a name="quickstart"></a>Chapterï¿½2.ï¿½Installation and quickstart</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#quickstart_windows">Microsoft Windows</a></span></dt><dt><span class="section"><a href="#quickstart_linux">GNU/Linux</a></span></dt><dd><dl><dt><span class="section"><a href="#quickstart_linux_deb">Installing from DEB packages (Debian, Ubuntu)</a></span></dt><dt><span class="section"><a href="#quickstart_linux_rpm">Installing from RPM packages (CentOS, RedHat)</a></span></dt><dt><span class="section"><a href="#quickstart_linux_common">Configuring nxlog on GNU/Linux</a></span></dt></dl></dd></dl></div><p>
    This chapter will guide to quickly get nxlog set up and running.
  </p><div class="section" title="Microsoft Windows"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="quickstart_windows"></a>Microsoft Windows</h2></div></div></div><p>
     </p><div class="variablelist"><dl><dt><span class="term">Install the MSI pacakge</span></dt><dd><p>
	     Run the nxlog installer using the MSI package, accept the license agreement and click finish.
	   </p></dd><dt><span class="term">Edit nxlog.conf</span></dt><dd><p>
	     The nxlog configuration file <code class="filename">nxlog.conf</code> is put under
	     <code class="filename">C:\Program Files\nxlog\conf</code> or 
	     <code class="filename">C:\Program Files (x86)\nxlog\conf</code> on 64bit 
	     architectures.
	     Using a text editor such as notepad.exe, open <code class="filename">nxlog.conf</code>.
	   </p></dd><dt><span class="term">Verify the ROOT path in nxlog.conf</span></dt><dd><p>
	     The windows installer uses the <code class="filename">C:\Program Files\nxlog</code>
	     directory for the installation.
	     On 64bit machines this is <code class="filename">C:\Program Files (x86)\nxlog</code>.
	     We refer to this as the <code class="filename">ROOT</code> path.
	     Please verify the <code class="filename">nxlog.conf</code> configuration file and use the appropriate
	     ROOT path:
	     </p><pre class="programlisting">
define ROOT C:\Program Files\nxlog
 or
define ROOT C:\Program Files (x86)\nxlog
</pre><p>
	   </p></dd><dt><span class="term">Configure nxlog</span></dt><dd><p>
	     The most common use-case for nxlog on windows is to collect logs from the EventLog
	     subsystem and forward it over the network.
	     Here is a simple configuration which reads the EventLog and forwards it over UDP
	     in the SNARE agent format.
	     </p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module      xm_syslog
&lt;/Extension&gt;

&lt;Input internal&gt;
    Module      im_internal
&lt;/Input&gt;

&lt;Input eventlog&gt;
    Module      im_msvistalog
&lt;/Input&gt;

&lt;Output out&gt;
    Module      om_udp
    Host        192.168.1.1
    Port        514
    Exec        to_syslog_snare();
&lt;/Output&gt;

&lt;Route 1&gt;
    Path        eventlog, internal =&gt; out
&lt;/Route&gt;</pre><p>
	     There are endless configurations for Windows systems depending on what to collect
	     and how to send or store. Please read the relevant chapters from this manual:
	     </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
		 <a class="link" href="#sources" title="Chapterï¿½8.ï¿½Reading and receiving logs">Reading and receiving logs</a>
	       </td></tr><tr><td>
		 <a class="link" href="#processing" title="Chapterï¿½9.ï¿½Processing logs">Processing logs</a>
	       </td></tr><tr><td>
		 <a class="link" href="#forwarding" title="Chapterï¿½10.ï¿½Forwarding and storing logs">Forwarding and storing logs</a>
	       </td></tr></table><p>
	   </p></dd><dt><span class="term">Start nxlog</span></dt><dd><p>
	     nxlog can be started using the following methods:
	     </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
		 Start the Service Manager, find 'nxlog' in the list. Select it and
		 start the service.
	       </td></tr><tr><td>
		 Double-click on <code class="filename">nxlog.exe</code>.
	       </td></tr></table><p>
	   </p></dd><dt><span class="term">Check the logs</span></dt><dd><p>
	     The default configuration instructs nxlog to write its own logs to the file located
	     at <code class="filename">C:\Program Files\nxlog\data\nxlog.log</code> or
	     <code class="filename">C:\Program Files (x86)\nxlog\data\nxlog.log</code>.
	     Open it with notepad.exe and check for errors. Note that some text editors
	     (such as wordpad) need exclusive locking and will refuse to open the log file while
	     nxlog is running.
	   </p></dd></dl></div><p>
   </p></div><div class="section" title="GNU/Linux"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="quickstart_linux"></a>GNU/Linux</h2></div></div></div><div class="section" title="Installing from DEB packages (Debian, Ubuntu)"><div class="titlepage"><div><div><h3 class="title"><a name="quickstart_linux_deb"></a>Installing from DEB packages (Debian, Ubuntu)</h3></div></div></div><p>

       </p><div class="variablelist"><dl><dt><span class="term">Install the dependencies first</span></dt><dd><p>
	       To list the dependencies, use the following command:
	       </p><pre class="programlisting">dpkg-deb -f nxlog_1.4.581_amd64.deb Depends</pre><p>
	       Then make sure all listed dependencies are installed.
	       Alternatively you can run <span class="command"><strong>apt-get install -f</strong></span> after trying
	       to install the package with dpkg and getting an error due to the missing
	       dependencies.
	     </p></dd><dt><span class="term">Install the deb package</span></dt><dd><p>
	       To install the deb package, issue the following command as root:
	       </p><pre class="programlisting">dpkg -i nxlog_1.4.581_amd64.deb</pre><p>
	     </p></dd></dl></div><p>
     </p></div><div class="section" title="Installing from RPM packages (CentOS, RedHat)"><div class="titlepage"><div><div><h3 class="title"><a name="quickstart_linux_rpm"></a>Installing from RPM packages (CentOS, RedHat)</h3></div></div></div><p>
       Install the rpm package with the following command:
       </p><pre class="programlisting">rpm &#8211;ivh nxlog-1.4.581-1.x86_64.rpm</pre><p>
     </p></div><div class="section" title="Configuring nxlog on GNU/Linux"><div class="titlepage"><div><div><h3 class="title"><a name="quickstart_linux_common"></a>Configuring nxlog on GNU/Linux</h3></div></div></div><p>
       After the package is installed check and edit the configuration file located at 
       <code class="filename">/etc/nxlog/nxlog.conf</code>. It contains an example configuration which
       you will likely want to modify to suit your needs.
       Please read the relevant chapters from this manual on how to configure nxlog:
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
	   <a class="link" href="#sources" title="Chapterï¿½8.ï¿½Reading and receiving logs">Reading and receiving logs</a>
	 </td></tr><tr><td>
	   <a class="link" href="#processing" title="Chapterï¿½9.ï¿½Processing logs">Processing logs</a>
	 </td></tr><tr><td>
	   <a class="link" href="#forwarding" title="Chapterï¿½10.ï¿½Forwarding and storing logs">Forwarding and storing logs</a>
	 </td></tr></table><p>
     </p></div></div></div><div class="chapter" title="Chapterï¿½3.ï¿½Architecture and concepts"><div class="titlepage"><div><div><h2 class="title"><a name="architecture"></a>Chapterï¿½3.ï¿½Architecture and concepts</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#arch_history">History</a></span></dt><dt><span class="section"><a href="#arch_concepts">Concepts</a></span></dt><dt><span class="section"><a href="#arch_arch">Architecture</a></span></dt></dl></div><div class="section" title="History"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="arch_history"></a>History</h2></div></div></div><p>
     For a few years we have been using a modified version of msyslog. It is also capable
     of using plugins for different inputs and outputs. Unfortunately, like many other
     syslog implementations, it was based on the BSD syslog with a single threaded 
     architecture. Since it was a syslog daemon, everything had to be converted to syslog.
     We soon realized that something better is needed with the
     <a class="link" href="#intro_features" title="Features">features</a> required by a modern logging solution.
   </p><p>
     We started looking for other solutions. There were a few possible alternatives
     to msyslog with some nice features (e.g. rsyslog, syslog-ng, etc), but none of them
     qualified. Most of them were still single threaded, syslog oriented without native support
     for MS Windows, in addition to awkward configuration syntax, ugly source-code and so on.
     So I decided that it would be easier for us on the long term to design and write nxlog
     from scratch instead of hacking something else. 
     Thus nxlog was born in 2009 and has been a closed source product heavily used in several
     production deployments since.
     The source code of NXLOG Community Edition was released in November 2011.
   </p></div><div class="section" title="Concepts"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="arch_concepts"></a>Concepts</h2></div></div></div><p>
     Most log processing solutions are built around the same concept. The input is read
     from a source, then the log messages are processed. Finally output is written or sent to
     a sink in other terminology.
   </p><p>
     When an event occurs in an application or a device, depending on its configuration
     a log message is emitted. This is usually referred to as an "event log"
     or "log message".
     These log messages can have different formats and can be transmitted over different
     protocols depending on the actual implementation.
   </p><p><a name="arch_concept_field"></a>
     There is one thing common in all event log messages. All contain important data such
     as user names, IP addresses, application names, etc. This way an event can be represented
     as a list of key-value pairs which we call a "field".
     The name of the field is the key and the field data is the value.
     In another terminology this meta-data is sometimes referred to as event property or
     message tag.
     The following example illustrates a syslog message:
     </p><pre class="programlisting">&lt;30&gt;Nov 21 11:40:27 log4ensics sshd[26459]: Accepted publickey for log4ensics from 192.168.1.1 port 41193 ssh2</pre><p>
     The fields extracted from this message are as follows:
     </p><pre class="programlisting">
AuthMethod             publickey
SourceIPAddress        192.168.1.1
AccountName            log4ensics
SyslogFacility         DAEMON
SyslogSeverity         INFO
Severity               INFO
EventTime              2009-11-21 11:40:27.0
Hostname               log4ensics
ProcessID              26459
SourceName             sshd
Message                Accepted publickey for log4ensics from 192.168.1.1 port 41193 ssh2
</pre><p>
     
     nxlog will try to use the <a class="ulink" href="http://cee.mitre.org" target="_top">Common Event Expression standard</a>
     for the field names once the standard is stable.
   </p><p><a name="arch_concept_raw_event"></a>
     nxlog has a special field, $raw_event. This field is handled by the transport
     (UDP, TCP, File, etc) modules to read input into and write output from it.
     This field is also used later to parse the log message into further fields by various
     functions, procedures and modules.
   </p></div><div class="section" title="Architecture"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="arch_arch"></a>Architecture</h2></div></div></div><p>
     By utilizing <a class="link" href="#modules" title="Chapterï¿½6.ï¿½Modules">loadable modules</a>, the plugin architecture
     of nxlog allows it to read data from any kind of input, parse and convert the format
     of the messages and then send it to any kind of output.
     Different input, processor and output modules can be used at the same time to cover
     all the requirements of the logging environment.
     The following figure illustrates the flow of log messages using this architecture.
     </p><div class="mediaobject"><img src="../figures/architecture.png" alt="Architecture"><div class="caption"><p>Architecture</p></div></div><p>
   </p><p>
     The core of nxlog is responsible for parsing the configuration file, montitoring files
     and sockets, and managing internal events. It has an event based architecture,
     all modules can dispatch events to the core. The nxlog core will take care of the
     event and will optionally pass it to a module for processing.
     nxlog is a multi-threaded application, the main thread is responsible for monitoring files
     and sockets. These are added to the core by the different 
     <a class="link" href="#modules_input" title="Input modules">input</a> and
     <a class="link" href="#modules_output" title="Output modules">output</a> modules. There is a dedicated thread
     handling internal events. It sleeps until the next event is to be processed then wakes
     up and dispatches the event to a worker thread.
     nxlog implements a worker thread-pool model. Worker threads receive an event which
     must be processed immediately. This way the nxlog core can centrally control all events
     and the order of their execution making
     <a class="link" href="#features_prioritized_processing" title="Prioritized processing">prioritized processing</a> possible.
     Modules which handle sockets or files are written to use non-blocking I/O in order to
     ensure that the worker threads never block. The files and sockets monitored by the main
     thread also dispatch events which are then delegated to the workers.
     Each event belonging to the same module is executed in sequential order, not concurrently.
     This ensures that message order is kept and gives a great benefit of not having to
     deal with concurrency issues in modules. Yet the modules (worker threads) run concurrently,
     thus the global log processing flow is greatly parallelized.
   </p><p>
     When an input module receives data, it creates an internal representation of the log
     message which is basically a structure containing the raw event data and any optional
     fields.
     This log message is then pushed to the queue of the next module in the route and
     an internal event is generated to signal the availability of the data.
     The next module after the input module in a route can be either a processor module
     or an output module.
     Actually an input or output module can also process data through built in code or 
     using the <a class="link" href="#config_module_exec" title="Exec">nxlog language execution</a>
     framework. The only difference is that processor modules are run in another worker thread,
     thus parallelizng log processing even more. Considering that processor modules can also
     be chained, this can efficiently distribute work among multiple CPUs or CPU cores in the
     system.
   </p></div></div><div class="chapter" title="Chapterï¿½4.ï¿½Configuration"><div class="titlepage"><div><div><h2 class="title"><a name="config"></a>Chapterï¿½4.ï¿½Configuration</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#config_include">File inclusion</a></span></dt><dt><span class="section"><a href="#config_define">Constant and macro definitions</a></span></dt><dt><span class="section"><a href="#config_global">Global directives</a></span></dt><dt><span class="section"><a href="#config_modules">Modules</a></span></dt><dd><dl><dt><span class="section"><a href="#config_module_common">Common module directives</a></span></dt></dl></dd><dt><span class="section"><a href="#config_routes">Routes</a></span></dt><dd><dl><dt><span class="section"><a href="#config_route_priority">Priority</a></span></dt><dt><span class="section"><a href="#config_route_path">Path</a></span></dt></dl></dd></dl></div><p>
     nxlog uses 
     <a class="ulink" href="http://httpd.apache.org/docs/2.0/configuring.html#syntax" target="_top">Apache-style</a>
     configuration files. The configuration file is loaded from its default location or it can
     be explicitly specified with the <code class="option">-c</code> command line argument.
   </p><p>
     The config file is made up of blocks and directives. Blocks are similar to xml tags
     containing multiple directives.
     Directive names are case insensitive but arguments are not always. A directive and its
     argument must be specified on the same line. Values spanning multiple lines must have
     the newline escaped with the backslash "\".
     A typical case for this is the <a class="link" href="#config_module_exec" title="Exec">Exec</a> directive.
     Blank lines are ignored.
   </p><p>
     Lines starting with the hashmark "#" are comments and are ignored.
   </p><p>
     The configuration file can be logically divided into three parts:
     <a class="link" href="#config_global" title="Global directives">global parameters</a>,
     <a class="link" href="#config_modules" title="Modules">module definitions and their configuration</a> and
     <a class="link" href="#config_routes" title="Routes">routes</a> which link the modules together according
     to the data flow required.
   </p><div class="section" title="File inclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="config_include"></a>File inclusion</h2></div></div></div><p>
       Using the 'include' directive it is possible to specify a file which will be
       included in the current config file. Special care must be taken when specifing 
       files with relative filenames. The <a class="link" href="#config_global_spooldir">SpoolDir</a>
       directive will only take effect after the configuration was parsed, so relative paths
       specified with the 'include' directive are relative to the working directory where nxlog was
       started from.
     </p><p>
       The include directive also supports wildcarded file names (e.g. <code class="filename">*.conf</code>)
       so that it is possible to include a set of files within a directory without the need
       to explicitly list all.
     </p><p>
       </p><div class="example"><a name="idp29927232"></a><p class="title"><b>Exampleï¿½4.1.ï¿½File inclusion example</b></p><div class="example-contents"><pre class="programlisting">include modules/module1.conf</pre></div></div><p><br class="example-break">
       </p><div class="example"><a name="idp29928544"></a><p class="title"><b>Exampleï¿½4.2.ï¿½Config file inclusion with wildcards</b></p><div class="example-contents"><pre class="programlisting">include /etc/nxlog.d/*.conf</pre></div></div><p><br class="example-break">
     </p></div><div class="section" title="Constant and macro definitions"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="config_define"></a>Constant and macro definitions</h2></div></div></div><p>
       Defines are useful if there are many instances in the code where the same value must be used,
       directory or host names are typical cases. In such cases the value can be configured with a
       single definition.
       This can be used to not only define constants but any string like code snippets or parser rules.
     </p><p>
       An nxlog define works similarly as in C where the preprocessor substitutes the value in places
       where the macro is used, i.e. the nxlog configuration parser will first replace all occurences
       of the defined name with its value, only after this substitution will the configuration check
       occur.
     </p><p>
       </p><div class="example"><a name="idp29932816"></a><p class="title"><b>Exampleï¿½4.3.ï¿½Example for using defines</b></p><div class="example-contents"><pre class="programlisting">
define BASEDIR /var/log
define IGNORE_console.log if $raw_event =~ /console.log/ drop();

&lt;Input messages&gt;
    Module      im_file
    File        '%BASEDIR%/messages'
&lt;/Input&gt;

&lt;Input proftpd&gt;
    Module      im_file
    File        '%BASEDIR%/proftpd.log'
    Exec        %IGNORE_console.log%
&lt;/Input&gt;</pre></div></div><p><br class="example-break">

       The following example shows an incorrect use if the define directive. After substitution
       the <code class="function">drop()</code> procedure will be always executed, only the warning
       message is emitted conditionally.
       </p><div class="example"><a name="idp29934960"></a><p class="title"><b>Exampleï¿½4.4.ï¿½Incorrect use of a define</b></p><div class="example-contents"><pre class="programlisting">
define ACTION log_warning("dropping message"); drop();

&lt;Input messages&gt;
    Module      im_file
    File        '/var/log/messages'
    Exec        if $raw_event =~ /dropme/ %ACTION%
&lt;/Input&gt;</pre></div></div><p><br class="example-break">
       To avoid this problem, the defined action should be one code block, i.e. it should be enclosed
       within curly braces:
       </p><pre class="programlisting">define ACTION { log_warning("dropping message"); drop(); }</pre><p>
     </p></div><div class="section" title="Global directives"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="config_global"></a>Global directives</h2></div></div></div><p>
       </p><div class="variablelist"><dl><dt><span class="term"><a name="config_global_moduledir"></a>ModuleDir</span></dt><dd>
	       By default the nxlog binaries have a compiled-in value for the directory to
	       search for loadable modules. This can be overrridden with this directive.
	       The module directory contains subdirectories for each module type (extension,
	       input, output, processor) and the module binaries are located in those.
	     </dd><dt><span class="term"><a name="config_global_pidfile"></a>PidFile</span></dt><dd>
	       Under Unix operating systems nxlog writes a pid file as other system daemons do.
	       The default value can be overridden with this directive in case multiple
	       daemon instances need to be running.
	       This directive has no effect on MS Windows or with the 
	       <a class="link" href="#nxlog_processor" title="nxlog-processor">nxlog-processor</a>.
	     </dd><dt><span class="term"><a name="config_global_logfile"></a>LogFile</span></dt><dd>
	       nxlog will write its internal log to this file. If this directive is not
	       specified, self logging is disabled. Not that the
	       <a class="link" href="#im_internal" title="Internal (im_internal)">im_internal</a> module can be also
	       used to direct internal log messages to files or different output destinations,
	       but this does not support loglevel below 'info'.
	       This LogFile directive is especially usefull for console.logging.
	     </dd><dt><span class="term"><a name="config_global_loglevel"></a>LogLevel</span></dt><dd>
	       This directive has five possible values: CRITICAL, ERROR, WARNING, INFO, console.log
	       It will set the logging level used for LogFile and the standard output if
	       nxlog is started in the forground.
	       By default the LogLevel is INFO.
	     </dd><dt><span class="term"><a name="config_global_suppressrepeatinglogs"></a>SuppressRepeatingLogs</span></dt><dd>
	       Under some circumstances it is possible for nxlog to generate an extreme amount
	       of internal logs consisting of the same message due to a misconfiguration or
	       software bug. This can lead to an extreme usage of disk space by
	       <a class="link" href="#config_global_logfile">LogFile</a> and nxlog can quickly fill
	       up the disk. With this directive nxlog will write at most 2 lines per second
	       if the same message is generated successively by emitting
	       <span class="quote">&#8220;<span class="quote">last message repeated x times</span>&#8221;</span> will suppress these messages.
	       This directive takes a boolean value (TRUE or FALSE).
	       If this directive is not specified in the config file, it defaults to TRUE, i.e.
	       repeating message suppression is enabled.
	     </dd><dt><span class="term"><a name="config_global_nocache"></a>NoCache</span></dt><dd>
	       Some modules save data to a cache file which is persisted across a
	       shutdown/restart. Modules such as <a class="link" href="#im_file" title="File (im_file)">im_file</a>
	       will save the file position in order to be able to continue reading from
	       the same position where it left off after a restart.
	       This caching mechanism can be explicitely turned off with this directive,
	       this is mostly useful with the <a class="link" href="#nxlog_processor" title="nxlog-processor">nxlog-processor</a>
	       in offline mode.
	       This directive takes a boolean value (TRUE or FALSE).
	       If this directive is not specified in the config file, it defaults to FALSE, i.e.
	       caching is enabled.
	     </dd><dt><span class="term"><a name="config_global_cachedir"></a>CacheDir</span></dt><dd>
	       This directive specifies a directory where the cache file called
	       <code class="filename">configcache.dat</code> should be written to.
	       This directive has a compiled-in value which is used by default.
	     </dd><dt><span class="term"><a name="config_global_user"></a>User</span></dt><dd>
	       nxlog will drop to user specified with this directive. This is useful if
	       nxlog needs privileged access to some system resources such as kernel
	       messages or port bind below 1024.
	       On Linux systems it will use capabilites to be able to access these resources.
	       In this case nxlog must be started as root.
	       The user can be specified by name or by numeric id.
	       This directive has no effect on MS Windows or with the 
	       <a class="link" href="#nxlog_processor" title="nxlog-processor">nxlog-processor</a>.
	     </dd><dt><span class="term"><a name="config_global_group"></a>Group</span></dt><dd>
	       Similar to <a class="link" href="#config_global_user">User</a>, nxlog will set the group ID
	       to be running under.
	       The group can be specified by name or by numeric id.
	       This directive has no effect on MS Windows or with the 
	       <a class="link" href="#nxlog_processor" title="nxlog-processor">nxlog-processor</a>.
	     </dd><dt><span class="term"><a name="config_global_rootdir"></a>RootDir</span></dt><dd>
	       nxlog will set its root directory to the value specified with this
	       directive. If <a class="link" href="#config_global_spooldir">SpoolDir</a> is also set,
	       this will be relative to the value of RootDir, i.e.
	       chroot() is called first.
	       This directive has no effect on MS Windows or with the 
	       <a class="link" href="#nxlog_processor" title="nxlog-processor">nxlog-processor</a>.
	     </dd><dt><span class="term"><a name="config_global_spooldir"></a>SpoolDir</span></dt><dd>
	       nxlog will change its working directory to the value specified with this 
	       directive.
	       This is useful with files created through relative filenames, e.g. with
	       <a class="link" href="#om_file" title="File (om_file)">om_file</a> and in case of core dumps.
	       This directive has no effect with the 
	       <a class="link" href="#nxlog_processor" title="nxlog-processor">nxlog-processor</a>.
	     </dd><dt><span class="term"><a name="config_global_threads"></a>Threads</span></dt><dd>
	       This optional directive specifies the number of worker threads to use.
	       The number of the worker threads is calculated and set to an optimal value if
	       this directive is not defined.
	       You should not set this unless you know what you are doing.
	     </dd><dt><span class="term"><a name="config_global_flowcontrol"></a>FlowControl</span></dt><dd>
	       This optional boolean directive specifies whether all input and processor modules
	       should use flow-control.
	       This defaults to TRUE.
	       See the description of the module level
	       <a class="link" href="#config_module_flowcontrol" title="FlowControl">FlowControl</a> directive
	       for more information.
	     </dd><dt><span class="term"><a name="config_global_nofreeonexit"></a>NoFreeOnExit</span></dt><dd>
	       This directive has only a console.logging purpuse. When set to TRUE,
	       nxlog will not free module resources on exit. Otherwise valgrind is unable
	       to show proper stack trace locations in module function calls.
	       The default value is FALSE if not specified.
	     </dd><dt><span class="term"><a name="config_global_ignoreerrors"></a>IgnoreErrors</span></dt><dd>
	       If set to FALSE, nxlog will stop if it encounters a problem with the configuration file
	       such as an invalid module directive or if there are other problems which would prevent
	       all modules functioning correctly.
	       If set to TRUE, nxlog will start after logging the problem.
	       The default value is TRUE if the directive is not specified.
	     </dd><dt><span class="term"><a name="config_global_panic"></a>Panic</span></dt><dd>
	       A panic condition is a critical state which usually indicates a bug.
	       Assertions are used in nxlog code for checking conditions where the code
	       will not work unless the asserted condition is satisfied.
	       Failing assertions result in a panic and these also suggest a bug in the code.
	       A typical case is checking for NULL pointers before pointer dereference.
	       Assertions have also a security value.
	       This directive can take three different values: HARD, SOFT or OFF.
	       HARD will cause an abort in case the assertion fails. This is how most
	       C based programs work.
	       SOFT will cause an exception to be thrown at the place of the panic/assertion. In case
	       of NULL pointer checks this is identical to a NullPointerException in Java.
	       It is possible that nxlog can recover from exceptions and can continue to
	       process log messages, or at least the other modules can.
	       In case of assertion failure the location and the condition is printed
	       at CRITICAL loglevel in HARD mode and ERROR loglevel in SOFT mode.
	       If Panic is set to OFF, the failing condition is only printed in the logs but
	       the execution will continue on the normal code path. Most of the time
	       this will result in a segmentation fault or other undefined behavior, though
	       there can be a case where turning off a buggy assertion or panic lurking somewhere in
	       the code will solve the problems caused by it in HARD/SOFT mode.
	       The default value for Panic is SOFT.
	     </dd></dl></div><p>
     </p></div><div class="section" title="Modules"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="config_modules"></a>Modules</h2></div></div></div><p>nxlog will only load modules which are used and specified in the configuration file.
       The followin is a skeleton config block for an input module:
</p><pre class="programlisting">
&lt;Input instancename&gt;
    Module      im_module
    ...
&lt;/Input&gt;</pre><p>
      The instance name must be unique, can contain only the characters [a-zA-Z0-9_-].
      The inctance name is referenced from the
      <a class="link" href="#config_routes" title="Routes">route</a> definition as well as the
      <a class="link" href="#config_module_processors" title="Processors">Processors</a> directive.
      Four types of <a class="link" href="#modules" title="Chapterï¿½6.ï¿½Modules">modules</a> exist in nxlog,
      these must be decalred with the Input, Processor, Output and Extension tags.
     </p><div class="section" title="Common module directives"><div class="titlepage"><div><div><h3 class="title"><a name="config_module_common"></a>Common module directives</h3></div></div></div><p>
	 The following directives are common in all modules.
       </p><div class="section" title="Module"><div class="titlepage"><div><div><h4 class="title"><a name="config_module_module"></a>Module</h4></div></div></div><p>
	   This directive is mandatory as it specifies which loadable binary should
	   be loaded. The module binary has a .so extension on Unix and a .dll on MS Windows
	   platforms and resides under the <a class="link" href="#config_global_moduledir">ModuleDir</a>
	   location.
	   All module binary names are prefixed with either im_, pm_, om_, xm_. These stand
	   for input module, processor module, output module and extension module.
	 </p><p>
	   It is possible that multiple instances use the same loadable binary. In this case
	   the binary is only loaded once but instantiated multiple times.
	   Different module instances may have different configuration.
	 </p></div><div class="section" title="FlowControl"><div class="titlepage"><div><div><h4 class="title"><a name="config_module_flowcontrol"></a>FlowControl</h4></div></div></div><p>
	   This optional boolean directive specifies whether the module should be using flow-control.
	   This can be used only in <em class="replaceable"><code>Input</code></em> and
	   <em class="replaceable"><code>Processor</code></em> modules.
	   Flow-control is enabled by default if this directive is not sepcified.
	   This module-level directive can be used to override the global
	   <a class="link" href="#config_global_flowcontrol">FlowControl</a> directive.
	 </p><p>
	   When flow-control is in effect, a module (input or processor) which tries to forward
	   log data to the next module in the route will be suspended if the next module cannot
	   accept more data.
	   For example if a network module (e.g. om_tcp) cannot forward logs because of a network
	   error, the proceeding module in the route will be paused.
	   When flow-control is disabled, the module will drop the log record if the queue
	   of the next module in the route is full.
	 </p><p>
	   Disabling flow-control can be also useful when more output modules are configured to store
	   or forward log data. When flow-control is enabled, the output modules will only store/forward
	   log data if all outputs are functional.
	   Consider the case when log data is stored in a file using om_file and also forwarded
	   over the network using om_tcp.
	   When flow-control is enabled, a network disconnection will make the data flow stall
	   and log data will not be written into the local file either. With flow-control disabled,
	   nxlog will write log data to the file and will drop messages that the om_tcp network
	   module cannot forward.
	 </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	     It is recommended to disable FlowControl when the <a class="link" href="#im_uds" title="Unix Domain Socket (im_uds)">im_uds</a>
	     module is used to collect local syslog from the <code class="filename">/dev/log</code> unix
	     domain socket. Otherwise the syslog() system call will block in all programs which
	     are trying to write to the system log if the Output queue becomes full and this will
	     result in an unresponsive system.
	   </p></div></div><div class="section" title="Schedule"><div class="titlepage"><div><div><h4 class="title"><a name="config_module_schedule"></a>Schedule</h4></div></div></div><p>
	   The Schedule block can be used to execute periodic jobs such as log rotation or
	   any other task. Scheduled jobs have the same priority as the module.
	   The schedule block has the following directives:
	   </p><div class="variablelist"><dl><dt><span class="term"><a name="config_module_schedule_when"></a>When</span></dt><dd><p>
		   This directive takes a value similar to a crontab entry which consists of
		   five space separated definitions for minute, hour, day, month and weekday.
		   See the crontab(5) manual for the field definitions. It supports lists as
		   comma separated values and/or ranges. Step values are also supported with
		   the slash. Month and week days are not supported, these must be defined
		   with numeric values.
		   The following extensions are also supported:
</p><pre class="programlisting">
              @yearly        Run once a year, "0 0 1 1 *".
              @annually      (same as @yearly)
              @monthly       Run once a month, "0 0 1 * *".
              @weekly        Run once a week, "0 0 * * 0".
              @daily         Run once a day, "0 0 * * *".
              @midnight      (same as @daily)
              @hourly        Run once an hour, "0 * * * *".
</pre><p>
		 </p></dd><dt><span class="term"><a name="config_module_schedule_every"></a>Every</span></dt><dd>
		   In addition to the crontab format it is possible to schedule execution
		   at periodic intervals. With the crontab format it is not possible to
		   run jobs every five days for example, this directive enables it in a simple way.
		   It takes an integer value with an optional unit.
		   The unit can be one of the following: sec, min, hour, day, week.
		   If the unit is not specified, the value is assumed to be in seconds.
		 </dd><dt><span class="term"><a name="config_module_schedule_first"></a>First</span></dt><dd>
		   This directive sets the first execution time. If the value is in the past, 
		   the next execution time is calculated as if nxlog has been running since
		   and jobs will not be run to make up the missed events in the past.
		   The directive takes a <a class="link" href="#lang_literal_datetime">datetime</a>
		   literal value.
		 </dd><dt><span class="term"><a name="config_module_schedule_exec"></a>Exec</span></dt><dd>
		   The Exec directive takes one or more nxlog 
		   <a class="link" href="#lang_statements" title="Statements">statement</a>. This is the code which is
		   actually being scheduled. Multiple Exec directives can be specified within
		   one Schedule block, so this behaves the same as the
		   <a class="link" href="#config_module_exec" title="Exec">Exec</a> directive of the modules. See
		   that for more details.
		   Note that it is not possible to use <a class="link" href="#lang_fields" title="Fields">fields</a>
		   in statements here because execution is not triggered by log messages.
		 </dd></dl></div><p>
	   </p><div class="example"><a name="idp30163136"></a><p class="title"><b>Exampleï¿½4.5.ï¿½Two scheduled jobs in the context of the im_tcp module</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input in&gt;
    Module	im_tcp
    Port	2345

    &lt;Schedule&gt;
	Every	1 sec
	First   2010-12-17 00:19:06
	Exec	log_info("scheduled execution at " + now());
    &lt;/Schedule&gt;

    &lt;Schedule&gt;
	When	1 */2 2-4 * *
	Exec	log_info("scheduled execution at " + now());
    &lt;/Schedule&gt;
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"tmp/output"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
	 </p></div><div class="section" title="Exec"><div class="titlepage"><div><div><h4 class="title"><a name="config_module_exec"></a>Exec</h4></div></div></div><p>
	   The Exec directive/block contains <a class="link" href="#lang_statements" title="Statements">statements</a> in the
	   <a class="link" href="#lang" title="Chapterï¿½5.ï¿½Language">nxlog language</a> which are
	   executed when a module receives a log message. This directive is available in all
	   <a class="link" href="#modules_input" title="Input modules">input</a>,
	   <a class="link" href="#modules_processor" title="Processor modules">processor</a> and
	   <a class="link" href="#modules_output" title="Output modules">output</a> modules. It is not available in 
	   <a class="link" href="#modules_extension" title="Extension modules">extension</a> modules because these don't handle
	   log messages directly. 

	   </p><div class="example"><a name="idp30170672"></a><p class="title"><b>Exampleï¿½4.6.ï¿½Simle Exec statement</b></p><div class="example-contents"><pre class="programlisting">
Exec	if $Hostname = 'myhost';
</pre></div></div><p><br class="example-break">

	   Due to the limitations of the apache configuration file format, each directive
	   must be one line unless it contains a trailing backslash "\" character.

	   </p><div class="example"><a name="idp30172000"></a><p class="title"><b>Exampleï¿½4.7.ï¿½Exec statement spanning multiple lines</b></p><div class="example-contents"><pre class="programlisting">
Exec	if $Message =~ /something interesting/       \
           log_info("found something interesting");  \
        else                                         \
           log_console.log("found nothing interesting");
</pre></div></div><p><br class="example-break">

	   More than one Exec directive/block may be specified. In this case these are executed in the order of appearance.

	   </p><div class="example"><a name="idp30173520"></a><p class="title"><b>Exampleï¿½4.8.ï¿½Equivalent use of statements in Exec</b></p><div class="example-contents"><pre class="programlisting">
Exec	log_info("first"); \
        log_info("second");
# The above is the same as the following:
Exec	log_info("first");
Exec    log_info("second");
</pre></div></div><p><br class="example-break">
	   </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	       You cannot split the lines using multiple Exec directives in the previous example because the Exec directive must
	       contain a full statement. It is only possible to split the Exec directive if it
	       contains multiple statements as in this example above.
	     </p></div><p>

	 </p><p>
	   The <em class="replaceable"><code>Exec</code></em> directive can be also used as a block.
	   If you need to use multiple statements spanning more than one line, it is recommended
	   to use the <em class="replaceable"><code>&lt;Exec&gt;</code></em> block instead.

	   </p><div class="example"><a name="idp30177216"></a><p class="title"><b>Exampleï¿½4.9.ï¿½Using the Exec block</b></p><div class="example-contents"><pre class="programlisting">
Exec	log_info("first"); \
        log_info("second");

# The above is the same as the following:
&lt;Exec&gt;
	log_info("first");
        log_info("second");
&lt;/Exec&gt;
	   </pre></div></div><p><br class="example-break">
	 </p></div><div class="section" title="Processors"><div class="titlepage"><div><div><h4 class="title"><a name="config_module_processors"></a>Processors</h4></div></div></div><p>
	   The 'Processors' directive has been obsoleted and is no longer available.
	 </p></div><div class="section" title="InputType"><div class="titlepage"><div><div><h4 class="title"><a name="config_inputtype"></a>InputType</h4></div></div></div><p>
	   This directive specifies the name of the registered input reader function to be used
	   for parsing raw events from input data. Names are treated case insensitively.
	 </p><p>
	   This is a common directive only for stream oriented input modules:
	   <a class="link" href="#im_file" title="File (im_file)">im_file</a>,
	   <a class="link" href="#im_exec" title="Program (im_exec)">im_exec</a>,
	   <a class="link" href="#im_ssl" title="TLS/SSL (im_ssl)">im_ssl</a>,
	   <a class="link" href="#im_tcp" title="TCP (im_tcp)">im_tcp</a>,
	   <a class="link" href="#im_udp" title="UDP (im_udp)">im_udp</a>,
	   <a class="link" href="#im_uds" title="Unix Domain Socket (im_uds)">im_uds</a>.
	   Note that im_udp may only work properly if log messages do not span multiple packets
	   and log messages are within the UDP message size limit.
	   Otherwise the loss of a packet may lead to parse errors.
	 </p><p>
	   These modules work by filling an input buffer with data read from the source. If the read
	   operation was successfull (i.e. there was data coming from the source), the module calls
	   the specified callback function. If this is not explicitly specified, it will use
	   the module default.
	 </p><p>
	   Modules may provide custom input reader functions. Once these are registered into
	   the nxlog core, the modules listed above will be capable of using these. This
	   makes it easier to implement custom protocols because these can be developed without
	   the need of taking care about the transport layer.
	 </p><p>
	   The following input reader functions are provided by the nxlog core:
	   </p><div class="variablelist"><dl><dt><span class="term"><a name="config_inputtype_linebased"></a>LineBased</span></dt><dd>
		   The input is assumed to contain log messages separated by newlines.
		   Thus if an LF (\n) or CRLF (\r\n) is found, the function considers that it has
		   reached the end of the log message.
		 </dd><dt><span class="term"><a name="config_inputtype_dgram"></a>Dgram</span></dt><dd>
		   Once the buffer is filled with data, it is considered to be one log message.
		   This is the default for the 
		   <a class="link" href="#im_udp" title="UDP (im_udp)">im_udp</a> input module, since UDP syslog messages
		   arrive in separate packets.
		 </dd><dt><span class="term"><a name="config_inputtype_binary"></a>Binary</span></dt><dd>
		   The input is parsed in the nxlog binary format which is capable of preserving
		   parsed fields of the log messages.
		   The <a class="link" href="#config_inputtype_linebased">LineBased</a> reader is
		   capable of automatically detecting log messages in the Binary nxlog format,
		   it is only recommended to configure InputType to Binary if no compatibility with
		   other logging software is required.
		 </dd></dl></div><p>
	   </p><div class="example"><a name="idp30196064"></a><p class="title"><b>Exampleï¿½4.10.ï¿½TCP input assuming nxlog format</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input in&gt;
    Module	im_tcp
    Port	2345
    InputType	Binary
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"tmp/output"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;

</pre></div></div><p><br class="example-break">
	 </p></div><div class="section" title="OutputType"><div class="titlepage"><div><div><h4 class="title"><a name="config_outputtype"></a>OutputType</h4></div></div></div><p>
	   This directive specifies the name of the registered output writer function to be used
	   for formatting raw events when sending to different destinations.
	   Names are treated case insensitively.
	 </p><p>
	   This is a common directive only for stream oriented output modules:
	   <a class="link" href="#om_file" title="File (om_file)">om_file</a>,
	   <a class="link" href="#om_exec" title="Program (om_exec)">om_exec</a>,
	   <a class="link" href="#om_ssl" title="TLS/SSL (om_ssl)">om_ssl</a>,
	   <a class="link" href="#om_tcp" title="TCP (om_tcp)">om_tcp</a>,
	   <a class="link" href="#om_udp" title="UDP (om_udp)">om_udp</a>,
	   <a class="link" href="#om_uds" title="UDS (om_uds)">om_uds</a>.
	 </p><p>
	   These modules work by filling the output buffer with data to be written to the
	   destination. The specified callback function is called before the write operation.
	   If this is not explicitly specified, it will use the module default.
	 </p><p>
	   Modules may provide custom output formatter functions. Once these are registered into
	   the nxlog core, the modules listed above will be capable of using these. This
	   makes it easier to implement custom protocols because these can be developed without
	   the need to take care about the transport layer.
	 </p><p>
	   The following output writer functions are provided by the nxlog core:
	   </p><div class="variablelist"><dl><dt><span class="term"><a name="config_outputtype_linebased"></a>LineBased</span></dt><dd>
		   The output will contain log messages separated by newlines (CRLF).
		 </dd><dt><span class="term"><a name="config_outputtype_dgram"></a>Dgram</span></dt><dd>
		   Once the buffer is filled with data, it is considered to be one log message.
		   This is the default for the 
		   <a class="link" href="#om_udp" title="UDP (om_udp)">om_udp</a> output module, since UDP syslog messages
		   are sent in separate packets.
		 </dd><dt><span class="term"><a name="config_outputtype_binary"></a>Binary</span></dt><dd>
		   The output is written in the nxlog binary format which is capable of preserving
		   parsed fields of the log messages.
		 </dd></dl></div><p>
	   </p><div class="example"><a name="idp30213024"></a><p class="title"><b>Exampleï¿½4.11.ï¿½TCP output sending messages in nxlog format</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input in&gt;
    Module	im_file
    File	"tmp/input"
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_tcp
    Port	2345
    Host	localhost
    OutputType	Binary
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;

</pre></div></div><p><br class="example-break">
	 </p></div></div></div><div class="section" title="Routes"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="config_routes"></a>Routes</h2></div></div></div><p>
       Routes define the flow and processing order of the log messages. The route must have a
       name and a Path. The name is specified similarly to the instance name in a module block.
	 </p><div class="example"><a name="idp30216976"></a><p class="title"><b>Exampleï¿½4.12.ï¿½Route block</b></p><div class="example-contents"><pre class="programlisting">
&lt;Route example&gt;
    Path	in1, in2 =&gt; proc =&gt; out1, out2
&lt;/Route&gt;	   </pre></div></div><p><br class="example-break">
     </p><div class="section" title="Priority"><div class="titlepage"><div><div><h3 class="title"><a name="config_route_priority"></a>Priority</h3></div></div></div><p>
	 This directive is optional. It takes an integer value as a parameter, its value must
	 be in the range of 1-100. It defaults to 10 if it is not explicitly specified.
	 Log messages in routes with a lower priority value will be processed before others.
       </p><p>
	 Actually this value is assigned to each module part of the route. The internal
	 events of the modules are processed in priority order by the nxlog engine,
	 thus modules of a route with a lower priority value (higher priority) will
	 process log messages first.
       </p><p>
	 This directive can be especially usefull to minimize syslog UDP message loss for
	 example.
	 </p><div class="example"><a name="idp30220912"></a><p class="title"><b>Exampleï¿½4.13.ï¿½Prioritized processing</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input tcpin&gt;
    Module	im_tcp
    Host	localhost
    Port	514
&lt;/Input&gt;

&lt;Input udpin&gt;
    Module	im_udp
    Host	localhost
    Port	514
&lt;/Input&gt;

&lt;Output tcpfile&gt;
    Module	om_file
    File	"/var/log/tcp.log"
&lt;/Output&gt;

&lt;Output udpfile&gt;
    Module	om_file
    File	"/var/log/udp.log"
&lt;/Output&gt;

&lt;Route udp&gt;
    Priority	1
    Path	udpin =&gt; udpfile
&lt;/Route&gt;

&lt;Route tcp&gt;
    Priority	2
    Path	tcpin =&gt; tcpfile
&lt;/Route&gt;



</pre></div></div><p><br class="example-break">
       </p></div><div class="section" title="Path"><div class="titlepage"><div><div><h3 class="title"><a name="config_route_path"></a>Path</h3></div></div></div><p>
	 The Path directive is where the data flow is defined.
	 First the instance name of input modules are specified. If more than one input reads
	 log messages which fed data into the route, then these must be separated by a comma.
	 Input modules are followed by an arrow "=&gt;" sign. Either processor modules or
	 output modules follow. Processor modules must be separated by arrows, not commas,
	 because they receive log messages in order, unlike input and output modules which
	 work in parallel. Output modules are separated by commas.
	 The syntax for the PATH directive is illustrated by the following:
	 </p><pre class="programlisting">
Path	INPUT1[, INPUT2...] =&gt; [PROCESSOR1 [=&gt; PROCESSOR2...] =&gt;] OUTPUT1[, OUTPUT2...]
</pre><p>
	 The Path must contain at least an input and an output module. The following example
	 shows different routes.
	 </p><div class="example"><a name="config_example_routes"></a><p class="title"><b>Exampleï¿½4.14.ï¿½Different routes</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input in1&gt;
    Module	im_null
&lt;/Input&gt;

&lt;Input in2&gt;
    Module	im_null
&lt;/Input&gt;

&lt;Processor p1&gt;
    Module	pm_null
&lt;/Processor&gt;

&lt;Processor p2&gt;
    Module	pm_null
&lt;/Processor&gt;

&lt;Output out1&gt;
    Module	om_null
&lt;/Output&gt;

&lt;Output out2&gt;
    Module	om_null
&lt;/Output&gt;

&lt;Route 1&gt;
    # no processor modules
    Path	in1 =&gt; out1
&lt;/Route&gt;

&lt;Route 2&gt;
    # one processor module
    Path	in1 =&gt; p1 =&gt; out1
&lt;/Route&gt;

&lt;Route 3&gt;
    # multiple modules
    Path	in1, in2 =&gt; p1 =&gt; p2 =&gt; out1, out2
&lt;/Route&gt;

</pre></div></div><p><br class="example-break">

       </p></div></div></div><div class="chapter" title="Chapterï¿½5.ï¿½Language"><div class="titlepage"><div><div><h2 class="title"><a name="lang"></a>Chapterï¿½5.ï¿½Language</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#lang_types">Types</a></span></dt><dt><span class="section"><a href="#lang_expressions">Expressions</a></span></dt><dd><dl><dt><span class="section"><a href="#lang_literals">Literals</a></span></dt><dt><span class="section"><a href="#lang_fields">Fields</a></span></dt><dt><span class="section"><a href="#lang_operations">Operations</a></span></dt><dt><span class="section"><a href="#lang_functions">Functions</a></span></dt></dl></dd><dt><span class="section"><a href="#lang_statements">Statements</a></span></dt><dd><dl><dt><span class="section"><a href="#lang_statement_assignment">Assignment</a></span></dt><dt><span class="section"><a href="#lang_statement_block">Block</a></span></dt><dt><span class="section"><a href="#lang_statement_procedures">Procedures</a></span></dt><dt><span class="section"><a href="#lang_statement_if">If-Else</a></span></dt></dl></dd><dt><span class="section"><a href="#lang_variables">Variables</a></span></dt><dt><span class="section"><a href="#lang_stat">Statistical counters</a></span></dt><dt><span class="section"><a href="#lang_exported_funcproc">List of available functions and procedures</a></span></dt><dd><dl><dt><span class="section"><a href="#core_funcproc">Functions and procedures exported by core</a></span></dt><dt><span class="section"><a href="#lang_exported_module_funcproc">Functions and procedures exported by modules</a></span></dt></dl></dd></dl></div><p>
     The nxlog core contains support for using a built-in interpreted language. This language
     can be used to make complex decisions or build expressions in the nxlog configuration
     file.
     The code written in the nxlog language is similar to Perl which is a common tool for
     developers and administrators to solve log processing tasks. When nxlog starts
     and reads its configuration file, directives containing nxlog language code are
     parsed and compiled into a pseudo-code. If a syntax error is found, nxlog will print
     the error. The pseudo-code is then evaluated at run-time, similarly to other interpreted
     languages.
   </p><p>
     The nxlog language can be used in two ways. Some module directives (e.g. file names) require
     a value, for these <a class="link" href="#lang_expressions" title="Expressions">expressions</a> can be used if
     supported by the module.
     Other directives such as <a class="link" href="#config_module_exec" title="Exec">Exec</a> take a
     <a class="link" href="#lang_statements" title="Statements">statement or statements</a> as argument.
   </p><p>
     In addition to the built-in <a class="link" href="#lang_functions" title="Functions">functions</a> and
     <a class="link" href="#lang_statement_procedures" title="Procedures">procedures</a> provided by the nxlog core,
     modules can register additional functions and procedures. This enables developers to
     extend the language through loadable modules so that additional processing features can be
     executed such as message formatters and parsers or data lookup functions.
   </p><p>
     Due to the simplicity of the language there is no error handling (except for function
     return values) available to the
     administrator. If an error occurs during the execution of the nxlog pseudo-code, 
     usually the error is printed in the nxlog logs. If an error occurs during log message 
     processing it is also possible for the message to be dropped. In case sophisticated
     error handling or more complex processing is a requirement, the message processing
     can be implemented in an external script or program, in a dedicated nxlog module or
     in perl via the <a class="link" href="#xm_perl" title="Perl (xm_perl)">xm_perl</a> module.
   </p><div class="section" title="Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="lang_types"></a>Types</h2></div></div></div><p>
     The nxlog language is a typed language, this allows stricter syntax checking when
     parsing the configuration while trying to enforce type-safety.
     Though <a class="link" href="#lang_fields" title="Fields">fields</a> and some
     functions can return values with a type which can only be determined at run-time.
     The language provides only simple types, complex types such as arrays and
     hashes (associative arrays) are not supported. 
     See <a class="link" href="#xm_perl" title="Perl (xm_perl)">xm_perl</a> if you require such complex processing
     rules.
     The language also supports the 
     <a class="link" href="#lang_literal_undef">undefined</a> value similarly to Perl.
     The following types are provided by the nxlog language:
      </p><div class="variablelist"><dl><dt><span class="term"><a name="lang_type_unknown"></a>Unknown</span></dt><dd>
	      This is a special type for values where the type cannot be determined at
	      compile time and for values which are uninitialized. The
	      <a class="link" href="#lang_literal_undef">undef literal</a> and
	      <a class="link" href="#lang_fields" title="Fields">fields</a> without a value have also an
	      unknown type.
	      The unknown type can be also thought of as 'any' in case of function and 
	      procedure api declarations.
	    </dd><dt><span class="term"><a name="lang_type_boolean"></a>Boolean</span></dt><dd>
	      A boolean value which is either TRUE, FALSE or undefined.
	      Note that an undefined boolean is not the same as a FALSE value.
	    </dd><dt><span class="term"><a name="lang_type_integer"></a>Integer</span></dt><dd>
	      An integer which can hold a signed 64 bit value in addition to the
	      undefined value. Floating point values are not supported.
	    </dd><dt><span class="term"><a name="lang_type_string"></a>String</span></dt><dd>
	      A string is an array of characters in any character set. The
	      <a class="link" href="#lang_type_binary">binary</a> type should be used for values
	      where the NUL byte can also occur.
	      An undefined string is not the same as an empty string.
	      Strings have a limited length to prevent resource exhaustion problems, this
	      is a compile-time value currently set to 1M.
	    </dd><dt><span class="term"><a name="lang_type_datetime"></a>Datetime</span></dt><dd>
	      A datetime holds a microsecond value elapsed since the Epoch and is always
	      stored in UTC/GMT.
	    </dd><dt><span class="term"><a name="lang_type_ip4addr"></a>IPv4 Address</span></dt><dd>
	      Stores a dotted quad IPv4 address in an internal format (integer).
	    </dd><dt><span class="term"><a name="lang_type_ip6addr"></a>IPv6 Address</span></dt><dd>
	      Stores an IPv6 address in an internal format.
	    </dd><dt><span class="term"><a name="lang_type_regexp"></a>Regular expression</span></dt><dd>
	      A regular expression can only be used with the 
	      <a class="link" href="#lang_binop_regmatch">=~</a> or
	      <a class="link" href="#lang_binop_notregmatch">!~</a> operators.
	    </dd><dt><span class="term"><a name="lang_type_binary"></a>Binary</span></dt><dd>
	      This type can hold an array of bytes.
	    </dd><dt><span class="term"><a name="lang_type_varargs"></a>Variadic arguments</span></dt><dd>
	      This is a special type only used in function and procedure api declarations
	      to indicate variadic arguments.
	    </dd></dl></div><p>
   </p></div><div class="section" title="Expressions"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="lang_expressions"></a>Expressions</h2></div></div></div><p>
     Expressions are a subset of the nxlog languge. Some module directives take an
     expression as a parameter which is then dynamically evaluated at run-time to a value.
     Expressions can also be used in statements.
   </p><p>
     The following language elements are expressions:
     <a class="link" href="#lang_literals" title="Literals">literals</a>,
     <a class="link" href="#lang_fields" title="Fields">fields</a>,
     <a class="link" href="#lang_operations" title="Operations">binary and unary operations</a>,
     <a class="link" href="#lang_functions" title="Functions">functions</a>.
     In addition, brackets can be used around expressions as shown in the example below.
     Brackets can also help in writing more readable code.
     </p><div class="example"><a name="idp31115312"></a><p class="title"><b>Exampleï¿½5.1.ï¿½Using brackets around expressions</b></p><div class="example-contents"><pre class="programlisting">
if 1 + 1 == (1 + 1) log_info("2");
if (1 + 1) == (1 + 1) log_info("2");
if ((1 + 1) == (1 + 1)) log_info("2");
</pre></div></div><p><br class="example-break">

   </p><div class="section" title="Literals"><div class="titlepage"><div><div><h3 class="title"><a name="lang_literals"></a>Literals</h3></div></div></div><p>
       A literal is a representation of a fixed value.
       A literal is an <a class="link" href="#lang_expressions" title="Expressions">expression</a>.
       </p><div class="variablelist"><dl><dt><span class="term"><a name="lang_literal_undef"></a>Undef</span></dt><dd><p>
	       The undef literal has an <a class="link" href="#lang_type_unknown">unknown</a> type.
	       It can be also used in an 
	       <a class="link" href="#lang_statement_assignment" title="Assignment">assignment</a> to unset a value 
	       of a <a class="link" href="#lang_fields" title="Fields">field</a>, for example:
	       </p><div class="example"><a name="idp31108592"></a><p class="title"><b>Exampleï¿½5.2.ï¿½Unsetting a value of a field</b></p><div class="example-contents"><pre class="programlisting">
$ProcessID = undef;
</pre></div></div><p><br class="example-break">
	     </p></dd><dt><span class="term"><a name="lang_literal_boolean"></a>Boolean</span></dt><dd><p>
	       A boolean literal is either TRUE or FALSE. It is case insensitive, so
	       True, False, true, false are also valid.
	     </p></dd><dt><span class="term"><a name="lang_literal_integer"></a>Integer</span></dt><dd><p>
	       An integer starts with a minus "-" sign if it is negative. The "0X" or "0x"
	       prepended modifier means a hexadecimal notation.
	       The "K", "M" and "G" modifiers are also supported which can be appended to
	       mean Kilo (1024), Mega (1024^2) and Giga (1024^3).
	       </p><div class="example"><a name="idp31101088"></a><p class="title"><b>Exampleï¿½5.3.ï¿½Setting an integer value</b></p><div class="example-contents"><pre class="programlisting">
$Limit = 42M;
</pre></div></div><p><br class="example-break">
	     </p></dd><dt><span class="term"><a name="lang_literal_string"></a>String</span></dt><dd><p>
	       String literals are quoted characters using either single or double quotes.
	       String literals specified with double quotes can contain the following escape
	       sequences.
	       </p><div class="variablelist"><dl><dt><span class="term">\\</span></dt><dd><p>
		       The backslash (<em class="replaceable"><code>\</code></em>) character.
		     </p></dd><dt><span class="term">\"</span></dt><dd><p>
		       The double quote (<em class="replaceable"><code>"</code></em>) character.
		     </p></dd><dt><span class="term">\n</span></dt><dd><p>
		       Line feed (LF).
		     </p></dd><dt><span class="term">\r</span></dt><dd><p>
		       Carriage return (CR).
		     </p></dd><dt><span class="term">\t</span></dt><dd><p>
		       Horizontal tab.
		     </p></dd><dt><span class="term">\b</span></dt><dd><p>
		       Audible bell.
		     </p></dd><dt><span class="term">\xXX</span></dt><dd><p>
		       A single byte in the form of a two digit hexadecimal number.
		       For example the line-feed character can also be expressed as
		       <em class="replaceable"><code>\x0A</code></em>.
		     </p></dd></dl></div><p>
	       </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
		   String literals in single quotes do not process the escape sequences. 
		   <em class="replaceable"><code>"\n"</code></em> is a single character (LF) while 
		   <em class="replaceable"><code>'\n'</code></em> is two characters.
		   The following comparison is FALSE for this reason:
		   </p><pre class="programlisting">"\n" == '\n'</pre><p>
		   Extra care should be taken with the backslash when using double
		   quoted string literals to specify file paths on windows.
		   See <a class="link" href="#im_file_config_file_note" title="Note">this note</a> for the file directive of im_file about the possible complications.
		 </p></div><p>
	       </p><div class="example"><a name="idp31084112"></a><p class="title"><b>Exampleï¿½5.4.ï¿½Setting a string value</b></p><div class="example-contents"><pre class="programlisting">
$Message = "Test message";
</pre></div></div><p><br class="example-break">
	     </p></dd><dt><span class="term"><a name="lang_literal_regexp"></a>Regular expression</span></dt><dd><p>
	       Regular expressions must be quoted with slashes as in Perl. Captured substrings
	       are accessible through a numeric reference such as $1. The full subject
	       string is placed into $0.
	       </p><div class="example"><a name="idp31080304"></a><p class="title"><b>Exampleï¿½5.5.ï¿½A regular expression match operation</b></p><div class="example-contents"><pre class="programlisting">
if $Message =~ /^Test (\S+)/ log_info("captured: " + $1);

</pre></div></div><p><br class="example-break">
	     </p></dd><dt><span class="term"><a name="lang_literal_datetime"></a>Datetime</span></dt><dd><p>
	       The datetime literal is an unquoted representation of a time value expressing
	       local time in the format of YYYY-MM-DD hh:mm:ss
	       </p><div class="example"><a name="idp31076480"></a><p class="title"><b>Exampleï¿½5.6.ï¿½Setting a datetime value</b></p><div class="example-contents"><pre class="programlisting">
$EventTime = 2000-01-02 03:04:05;
</pre></div></div><p><br class="example-break">
	     </p></dd><dt><span class="term"><a name="lang_literal_ip4addr"></a>IPv4 Address</span></dt><dd><p>
	       An IPv4 literal value is expressed in dotted quad notation such as 
	       <em class="replaceable"><code>192.168.1.1</code></em>.
	     </p></dd><dt><span class="term"><a name="lang_literal_ip6addr"></a>IPv6 Address</span></dt><dd><p>
	       An IPv6 literal value is expressed by 8 groups of 16-bit hexadecimal values
	       separated by colons (:) such as 
	       <em class="replaceable"><code>2001:0db8:85a3:0000:0000:8a2e:0370:7334</code></em>.
	     </p></dd></dl></div><p>
     </p></div><div class="section" title="Fields"><div class="titlepage"><div><div><h3 class="title"><a name="lang_fields"></a>Fields</h3></div></div></div><p>
       A log message can be broken up into fields by parsers or is already emitted as a list
       of fields as discussed <a class="link" href="#arch_concept_field">earlier</a>.
       The field has a name and in the nxlog language it is represented with the dollar "$"
       sign prepended to the name of the field, similarly to Perl's scalar variables.
       The name of the field is allowed to have the following characters:
</p><pre class="programlisting">[[:alpha:]_][[:alnum:]\._]*</pre><p>
       A field which does not exist has an <a class="link" href="#lang_type_unknown">unknown</a>
       type.
       A field is an <a class="link" href="#lang_expressions" title="Expressions">expression</a> which evaluates to a
       value.
       Fields are only available in an evaluation context which is triggered by a log
       message.
       For example using a value of a field in the 
       <a class="link" href="#config_module_schedule_exec">Exec directive of a schedule block</a>
       will result in a run-time error because this scheduled execution is not triggered 
       by a log message.
       Fields are passed along the route and are available in each successive module in the
       chain. Eventually the output module is responsible for writing these.
       Stream oriented modules emit the data contained in $raw_event unless
       <a class="link" href="#config_outputtype" title="OutputType">OutputType</a> is set to something else (i.e. Binary).
     </p></div><div class="section" title="Operations"><div class="titlepage"><div><div><h3 class="title"><a name="lang_operations"></a>Operations</h3></div></div></div><p>
       Similarly to other programming languages and especially Perl, the nxlog language
       has unary and binary operations which are 
       <a class="link" href="#lang_expressions" title="Expressions">expressions</a> and evaluate to a value.
     </p><div class="section" title="Unary operations"><div class="titlepage"><div><div><h4 class="title"><a name="lang_unary_operations"></a>Unary operations</h4></div></div></div><p>
	 Unary operations work with a single operand. Currently the following unary operations are 
	 available. It is possible to use brackets around the operand to which makes it look like
	 a function call as in <a class="link" href="#lang_defined_example" title="Exampleï¿½5.9.ï¿½Use of the unary 'defined' operation">this example</a>.

	 </p><div class="variablelist"><dl><dt><span class="term"><a name="lang_unop_not"></a>not</span></dt><dd><p>
		 The 'not' operator expects a boolean value. It will evaluate to undef if
		 the value is undefined. If it receives an unknown value which evaluates to
		 a non-boolean, it will result in a run-time execution error.
		 </p><div class="example"><a name="idp31059216"></a><p class="title"><b>Exampleï¿½5.7.ï¿½Typical use of the 'not' operand</b></p><div class="example-contents"><pre class="programlisting">
if not $success log_error("failure");
</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_unop_neg"></a>-</span></dt><dd><p>
		 The unary negation operator before an integer is very similar to a negative 
		 integer, except that two or more minus "-" signs are not valid for an integer
		 literal.
		 </p><div class="example"><a name="idp31055024"></a><p class="title"><b>Exampleï¿½5.8.ï¿½Unary negation</b></p><div class="example-contents"><pre class="programlisting">if - -1 != 1 log_error("this should never be printed");</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_unop_defined"></a>defined</span></dt><dd><p>
		 The defined operation will evaluate to TRUE if the operand is defined,
		 otherwise it is FALSE.
		 </p><div class="example"><a name="lang_defined_example"></a><p class="title"><b>Exampleï¿½5.9.ï¿½Use of the unary 'defined' operation</b></p><div class="example-contents"><pre class="programlisting">
if defined 1 log_info("1");
if defined(2) log_info("2");
if defined undef log_info("never printed");
</pre></div></div><p><br class="example-break">
	       </p></dd></dl></div><p>
       </p></div><div class="section" title="Binary operations"><div class="titlepage"><div><div><h4 class="title"><a name="lang_binary_operations"></a>Binary operations</h4></div></div></div><p>
	 Binary operations work with two operands and evaluate to a value. The type of
	 the evaluated value depends on the type of the operands.
	 Execution might result in a run-time error if the type of the operands are unknown
	 at compile time and evaluate to types which are incompatible with the binary operation.
	 The operations are described with the following syntax:
	 </p><pre class="programlisting">TYPE_OF_LEFT_OPERAND BINARY_OPERATION TYPE_OF_RIGHT_OPERAND = TYPE_OF_EVALUATED_VALUE</pre><p>
	 Below is a list of currently supported binary operations.

	 </p><div class="variablelist"><dl><dt><span class="term"><a name="lang_binop_regmatch"></a>=~</span></dt><dd><p>
		 This is the regular expression match operation as in Perl. The PCRE engine is used to to execute
		 the regular expressions. This operation takes a string and
		 a regexp operand and evaluates to a boolean value which will be TRUE if the regular
		 expression matches the subject string.
		 Captured substrings are accessible through a numeric reference such as $1.
		 The full subject string is placed into $0.
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_type_string">string</a>
		       =~
		       <a class="link" href="#lang_type_regexp">regexp</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_regexp">regexp</a>
		       =~
		       <a class="link" href="#lang_type_string">string</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp31039152"></a><p class="title"><b>Exampleï¿½5.10.ï¿½Regular expression based string matching</b></p><div class="example-contents"><pre class="programlisting">
if $Message =~ /^Test message/ log_info("matched");
</pre></div></div><p><br class="example-break">

		 Regexp based string substitution is also supported with the 
		 <em class="replaceable"><code>s///</code></em> operator.
	       </p><p>
		 The following regular expression modiers are supported:

		 </p><div class="variablelist"><dl><dt><span class="term">g</span></dt><dd><p>
			 The <em class="replaceable"><code>/g</code></em>
			 modifier can be used for global replacement.
			 </p><div class="example"><a name="idp31034816"></a><p class="title"><b>Exampleï¿½5.11.ï¿½Replace whitespace occurences</b></p><div class="example-contents"><pre class="programlisting">
if $SourceName =~ s/\s/_/g log_info("removed all whitespace in SourceName");

</pre></div></div><p><br class="example-break">
		       </p></dd><dt><span class="term">s</span></dt><dd><p>
			 The <em class="replaceable"><code>.</code></em> normally matches any character except newline.
			 The <em class="replaceable"><code>/s</code></em>
			 modifier can be used to have the <em class="replaceable"><code>.</code></em> match all 
			 characters including line terminator characters (LF and CRLF).
			 </p><div class="example"><a name="idp31028656"></a><p class="title"><b>Exampleï¿½5.12.ï¿½Dot matches all characters</b></p><div class="example-contents"><pre class="programlisting">
if $Message =~ /failure/s log_info("failure string present in the message");
</pre></div></div><p><br class="example-break">
		       </p></dd><dt><span class="term">m</span></dt><dd><p>
			 The <em class="replaceable"><code>/m</code></em>
			 modifier can be used to treat the string as multiple lines, i.e. 
			 <em class="replaceable"><code>^</code></em> and <em class="replaceable"><code>$</code></em> match newlines within data.
		       </p></dd><dt><span class="term">i</span></dt><dd><p>
			 The <em class="replaceable"><code>/i</code></em>
			 modifier does case insensitive matching.
		       </p></dd></dl></div><p>

		 Variables and captured substring references cannot be used inside the reqular expression
		 or the regexp substitution operator, these will be treated literally as is.
	       </p></dd><dt><span class="term"><a name="lang_binop_notregmatch"></a>!~</span></dt><dd><p>
		 This is the opposite of <a class="link" href="#lang_binop_regmatch">=~</a>,
		 the expression will evaluate to TRUE if the regular expresion does not match
		 on the subject string.
		 It can be also written as 
		 <a class="link" href="#lang_unop_not">not</a>
		 LEFT_OPERAND
		 <a class="link" href="#lang_binop_regmatch">=~</a>
		 RIGHT_OPERAND
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_type_string">string</a>
		       !~
		       <a class="link" href="#lang_type_regexp">regexp</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_regexp">regexp</a>
		       !~
		       <a class="link" href="#lang_type_string">string</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd></dl></div><p>
		 The <em class="replaceable"><code>s///</code></em> substitution operator is also supported.
		 </p><div class="example"><a name="idp31011952"></a><p class="title"><b>Exampleï¿½5.13.ï¿½Regular expression based string matching</b></p><div class="example-contents"><pre class="programlisting">
if $Message !~ /^Test message/ log_info("didn't match");
</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_binop_equal"></a>==</span></dt><dd><p>
		 This operator compares two values for equality.
		 Comparing a defined value with an undefined results in 
		 <a class="link" href="#lang_literal_undef">undef</a>!
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_literal_undef">undef</a>
		       ==
		       <a class="link" href="#lang_literal_undef">undef</a>
		       =
		       <a class="link" href="#lang_literal_boolean">TRUE</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_string">string</a>
		       ==
		       <a class="link" href="#lang_type_string">string</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_integer">integer</a>
		       ==
		       <a class="link" href="#lang_type_integer">integer</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_boolean">boolean</a>
		       ==
		       <a class="link" href="#lang_type_boolean">boolean</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       ==
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_ip4addr">ip4addr</a>
		       ==
		       <a class="link" href="#lang_type_ip4addr">ip4addr</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_ip4addr">ip4addr</a>
		       ==
		       <a class="link" href="#lang_type_string">string</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_string">string</a>
		       ==
		       <a class="link" href="#lang_type_ip4addr">ip4addr</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp30982352"></a><p class="title"><b>Exampleï¿½5.14.ï¿½Comparing integers</b></p><div class="example-contents"><pre class="programlisting">
if $SeverityValue == 1 log_info("severity is one");
</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_binop_notequal"></a>!=</span></dt><dd><p>
		 This operator compares two values for inequality.
		 Comparing a defined value with an undefined results in 
		 <a class="link" href="#lang_literal_undef">undef</a>!
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_literal_undef">undef</a>
		       !=
		       <a class="link" href="#lang_literal_undef">undef</a>
		       =
		       <a class="link" href="#lang_literal_boolean">FALSE</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_string">string</a>
		       !=
		       <a class="link" href="#lang_type_string">string</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_integer">integer</a>
		       !=
		       <a class="link" href="#lang_type_integer">integer</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_boolean">boolean</a>
		       !=
		       <a class="link" href="#lang_type_boolean">boolean</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       !=
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_ip4addr">ip4addr</a>
		       !=
		       <a class="link" href="#lang_type_ip4addr">ip4addr</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_ip4addr">ip4addr</a>
		       !=
		       <a class="link" href="#lang_type_string">string</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_string">string</a>
		       !=
		       <a class="link" href="#lang_type_ip4addr">ip4addr</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp30951584"></a><p class="title"><b>Exampleï¿½5.15.ï¿½Comparing for inequality</b></p><div class="example-contents"><pre class="programlisting">
if $SeverityValue != 1 log_info("severity is not one");
</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_binop_less"></a>&lt;</span></dt><dd><p>
		 This operation will evaluate to TRUE if the left operand is less than the operand
		 on the right, FALSE otherwise.
		 Comparing a defined value with an undefined results in 
		 <a class="link" href="#lang_literal_undef">undef</a>!
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_type_integer">integer</a>
		       &lt;
		       <a class="link" href="#lang_type_integer">integer</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       &lt;
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp30940496"></a><p class="title"><b>Exampleï¿½5.16.ï¿½Less</b></p><div class="example-contents"><pre class="programlisting">
if $SeverityValue &lt; 1 log_info("severity is less than one");
</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_binop_le"></a>&lt;=</span></dt><dd><p>
		 This operation will evaluate to TRUE if the left operand is less than or
		 equal to the operand on the right, FALSE otherwise.
		 Comparing a defined value with an undefined results in 
		 <a class="link" href="#lang_literal_undef">undef</a>!
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_type_integer">integer</a>
		       &lt;=
		       <a class="link" href="#lang_type_integer">integer</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       &lt;=
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp30919792"></a><p class="title"><b>Exampleï¿½5.17.ï¿½Less or equal</b></p><div class="example-contents"><pre class="programlisting">
if $SeverityValue &lt; 1 log_info("severity is less than or equal to one");
</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_binop_greater"></a>&gt;</span></dt><dd><p>
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_type_integer">integer</a>
		       &gt;
		       <a class="link" href="#lang_type_integer">integer</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       &gt;
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp30498592"></a><p class="title"><b>Exampleï¿½5.18.ï¿½Greater</b></p><div class="example-contents"><pre class="programlisting">
if $SeverityValue &gt; 1 log_info("severity is greater than one");
</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_binop_ge"></a>&gt;=</span></dt><dd><p>
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_type_integer">integer</a>
		       &gt;=
		       <a class="link" href="#lang_type_integer">integer</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       &gt;=
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp30909280"></a><p class="title"><b>Exampleï¿½5.19.ï¿½Greater or equal</b></p><div class="example-contents"><pre class="programlisting">
if $SeverityValue &gt;= 1 log_info("severity is greater than or equal to one");
</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_binop_and"></a>and</span></dt><dd><p>
		 This is the boolean 'and' operation which evaluates to TRUE if and
		 only if both operands are TRUE.
		 The operation will evaluate to 
		 <a class="link" href="#lang_literal_undef">undef</a> if either operand is
		 undefined.
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_type_boolean">boolean</a>
		       and
		       <a class="link" href="#lang_type_boolean">boolean</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp30901632"></a><p class="title"><b>Exampleï¿½5.20.ï¿½And operation</b></p><div class="example-contents"><pre class="programlisting">
if $SeverityValue == 1 and $FacilityValue == 2 log_info("1 and 2");
</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_binop_or"></a>or</span></dt><dd><p>
		 This is the boolean 'and' operation which evaluates to TRUE if either
		 operand is TRUE.
		 The operation will evaluate to 
		 <a class="link" href="#lang_literal_undef">undef</a> if both operands are
		 undefined.
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_type_boolean">boolean</a>
		       or
		       <a class="link" href="#lang_type_boolean">boolean</a>
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp30894144"></a><p class="title"><b>Exampleï¿½5.21.ï¿½Or</b></p><div class="example-contents"><pre class="programlisting">
if $SeverityValue == 1 or $SeverityValue == 2 log_info("1 or 2");
</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_binop_plus"></a>+</span></dt><dd><p>
		 This operation will result in an integer if both operands are integers.
		 If either operand is a string, the result will be a string where 
		 non-string typed values are converted to a string. In this case it acts as
		 a concatenation operator (which is the dot "." operator in Perl).
		 Adding an undefined value to a non-string will result in undef.
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_type_integer">integer</a>
		       +
		       <a class="link" href="#lang_type_integer">integer</a>
		       =
		       <a class="link" href="#lang_type_integer">integer</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_string">string</a>
		       +
		       <a class="link" href="#lang_literal_undef">undef</a>
		       =
		       <a class="link" href="#lang_type_string">string</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_literal_undef">undef</a>
		       +
		       <a class="link" href="#lang_type_string">string</a>
		       =
		       <a class="link" href="#lang_type_string">string</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_literal_undef">undef</a>
		       +
		       <a class="link" href="#lang_literal_undef">undef</a>
		       =
		       <a class="link" href="#lang_literal_undef">undef</a>
		     </span></dt><dd>
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_string">string</a>
		       +
		       <a class="link" href="#lang_type_string">string</a>
		       =
		       <a class="link" href="#lang_type_string">string</a>
		     </span></dt><dd>
			 Concatenate two strings.
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       +
		       <a class="link" href="#lang_type_integer">integer</a>
		       =
		       <a class="link" href="#lang_type_datetime">datetime</a>
		     </span></dt><dd>
			 Add the number of seconds in the right value to the datetime stored in the left value.
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_integer">integer</a>
		       +
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       =
		       <a class="link" href="#lang_type_datetime">datetime</a>
		     </span></dt><dd>
			 Add the number of seconds in the left value to the datetime stored in the right value.
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp30867392"></a><p class="title"><b>Exampleï¿½5.22.ï¿½Concatenation</b></p><div class="example-contents"><pre class="programlisting">
if 1 + "a" == "1a" log_info("this will be printed");
</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_binop_minus"></a>-</span></dt><dd><p>
		 Subtraction. The result will be undef if either operand is undefined.
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_type_integer">integer</a>
		       -
		       <a class="link" href="#lang_type_integer">integer</a>
		       =
		       <a class="link" href="#lang_type_integer">integer</a>
		     </span></dt><dd>
			 Subtract two integers.
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       -
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       =
		       <a class="link" href="#lang_type_integer">integer</a>
		     </span></dt><dd>
			 Subtract two datetime types. The result is the difference between to two expressed in microseconds.
		       </dd><dt><span class="term">
		       <a class="link" href="#lang_type_datetime">datetime</a>
		       -
		       <a class="link" href="#lang_type_integer">integer</a>
		       =
		       <a class="link" href="#lang_type_datetime">datetime</a>
		     </span></dt><dd>
			 Subtract the number of seconds from the datetime stored in the left value.
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp30853888"></a><p class="title"><b>Exampleï¿½5.23.ï¿½Subtraction</b></p><div class="example-contents"><pre class="programlisting">
if 4 - 1 == 3 log_info("four minus one is three");
</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_binop_mul"></a>*</span></dt><dd><p>
		 Multiply an integer with another. The result will be undef if either
		 operand is undefined.
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_type_integer">integer</a>
		       *
		       <a class="link" href="#lang_type_integer">integer</a>
		       =
		       <a class="link" href="#lang_type_integer">integer</a>
		     </span></dt><dd>
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp30846032"></a><p class="title"><b>Exampleï¿½5.24.ï¿½Multiplication</b></p><div class="example-contents"><pre class="programlisting">
if 4 * 2 == 8 log_info("four times two is eight");
</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_binop_div"></a>/</span></dt><dd><p>
		 Divide an integer with another. The result will be undef if either
		 operand is undefined. Since the result is an integer, fractional
		 parts are lost.
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_type_integer">integer</a>
		       /
		       <a class="link" href="#lang_type_integer">integer</a>
		       =
		       <a class="link" href="#lang_type_integer">integer</a>
		     </span></dt><dd>
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp30839168"></a><p class="title"><b>Exampleï¿½5.25.ï¿½Division</b></p><div class="example-contents"><pre class="programlisting">
if 9 / 4 == 2 log_info("9 divided by 4 is 2");
</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_binop_mod"></a>%</span></dt><dd><p>
		 This is the modulo operation. Divides an integer with another and returns
		 the remainder. The result will be undef if either
		 operand is undefined. 
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_type_integer">integer</a>
		       %
		       <a class="link" href="#lang_type_integer">integer</a>
		       =
		       <a class="link" href="#lang_type_integer">integer</a>
		     </span></dt><dd>
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp30829536"></a><p class="title"><b>Exampleï¿½5.26.ï¿½Modulo</b></p><div class="example-contents"><pre class="programlisting">
if 3 % 2 == 1 log_info("three mod two is one");
</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_binop_in"></a>IN</span></dt><dd><p>
		 This operation will evaluate to TRUE if the left operand is equal to any of the expressions in the list
		 on the right, FALSE otherwise.
		 Comparing a undefined value results in 
		 <a class="link" href="#lang_literal_undef">undef</a>!
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_type_unknown">unknown</a>
		       IN
		       <a class="link" href="#lang_type_unknown">unknown</a>, 
		       <a class="link" href="#lang_type_unknown">unknown</a> ...
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp30824048"></a><p class="title"><b>Exampleï¿½5.27.ï¿½IN</b></p><div class="example-contents"><pre class="programlisting">
if $EventID IN (1000, 1001, 1004, 4001) log_info("EventID found");

</pre></div></div><p><br class="example-break">
	       </p></dd><dt><span class="term"><a name="lang_binop_not_in"></a>NOT IN</span></dt><dd><p>
		 This operation is equivalent to NOT expr IN expr_list.
		 </p><div class="variablelist"><dl><dt><span class="term">
		       <a class="link" href="#lang_type_unknown">unknown</a>
		       NOT IN
		       <a class="link" href="#lang_type_unknown">unknown</a>, 
		       <a class="link" href="#lang_type_unknown">unknown</a> ...
		       =
		       <a class="link" href="#lang_type_boolean">boolean</a>
		     </span></dt><dd>
		       </dd></dl></div><p>
		 </p><div class="example"><a name="idp30816160"></a><p class="title"><b>Exampleï¿½5.28.ï¿½NOT IN</b></p><div class="example-contents"><pre class="programlisting">
if $EventID NOT IN (1000, 1001, 1004, 4001) log_info("EventID not in list");

</pre></div></div><p><br class="example-break">
	       </p></dd></dl></div><p>
       </p></div></div><div class="section" title="Functions"><div class="titlepage"><div><div><h3 class="title"><a name="lang_functions"></a>Functions</h3></div></div></div><p>
       A function is an <a class="link" href="#lang_expressions" title="Expressions">expression</a> which always returns
       a value. A function cannot be used without using its return value. In contrast to
       procedures, a function never modifies its arguments, the state of the nxlog engine or
       the state of a module.
       Functions can be polymorphic, the same function can take different arguments. 
       Some functions also support variadic arguments denoted by the
       <a class="link" href="#lang_type_varargs">varargs</a> argument type.
       
       See the <a class="link" href="#lang_exported_funcproc" title="List of available functions and procedures">list of available functions</a>.
       </p><div class="example"><a name="idp30808128"></a><p class="title"><b>Exampleï¿½5.29.ï¿½Function call</b></p><div class="example-contents"><pre class="programlisting">
$current.time = now();
if now() &gt; 2000-01-01 00:00:00 log_info("we are in the 21st century");
</pre></div></div><p><br class="example-break">
     </p></div></div><div class="section" title="Statements"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="lang_statements"></a>Statements</h2></div></div></div><p>
     Directives such as <a class="link" href="#config_module_exec" title="Exec">Exec</a> take a statement as
     argument.
     After a statement is evaluated, usually the result will be a change in the state of
     the nxlog engine, the state of a module or the log message. 
     A statement is terminated by a semicolon ";". Multiple statements can be specified and
     these will be evaluated and executed in order.
     The following elements can be used in statements. There is no loop operation (for, while)
     in the nxlog language.
   </p><div class="section" title="Assignment"><div class="titlepage"><div><div><h3 class="title"><a name="lang_statement_assignment"></a>Assignment</h3></div></div></div><p>
       The assignment operation "=" loads the value from the expression evaluated on the right
       into a <a class="link" href="#lang_fields" title="Fields">field</a> on the left.
      </p><div class="example"><a name="idp30804320"></a><p class="title"><b>Exampleï¿½5.30.ï¿½Assignment</b></p><div class="example-contents"><pre class="programlisting">
$event.rcvd = now();
</pre></div></div><p><br class="example-break">
     </p></div><div class="section" title="Block"><div class="titlepage"><div><div><h3 class="title"><a name="lang_statement_block"></a>Block</h3></div></div></div><p>
       A block consists of one or more statements within curly braces "{}". This is
       typically used with <a class="link" href="#lang_statement_if" title="If-Else">conditional statements</a>
       as in the example below.
      </p><div class="example"><a name="idp30797968"></a><p class="title"><b>Exampleï¿½5.31.ï¿½Conditional statement block</b></p><div class="example-contents"><pre class="programlisting">
if now() &gt; 2000-01-01 00:00:00
{
   log_info("we are in the");
   log_info("21st century");
}
</pre></div></div><p><br class="example-break">
     </p></div><div class="section" title="Procedures"><div class="titlepage"><div><div><h3 class="title"><a name="lang_statement_procedures"></a>Procedures</h3></div></div></div><p>
       Though both functions can take arguments, procedures are the opposite of function calls.
       Procedures never return a value, thus these can be used as
       <a class="link" href="#lang_statements" title="Statements">statements</a>.
       A procedure can modify its argument if it is a field, or it can modify the state of
       the nxlog engine, the state of a module or the log message.
       Procedures can also be polymorphic, the same procedure can take different arguments. 
       Some procedures also support variadic arguments denoted by the
       <a class="link" href="#lang_type_varargs">varargs</a> argument type.
       
       See the <a class="link" href="#lang_exported_funcproc" title="List of available functions and procedures">list of available procedures</a>.
     </p><div class="example"><a name="idp30795408"></a><p class="title"><b>Exampleï¿½5.32.ï¿½Procedure call</b></p><div class="example-contents"><pre class="programlisting">
log_info("this is a procedure call");
</pre></div></div><br class="example-break"></div><div class="section" title="If-Else"><div class="titlepage"><div><div><h3 class="title"><a name="lang_statement_if"></a>If-Else</h3></div></div></div><p>
       A conditional statement starts with the "if" keyword followed by a boolean
       expression and a statement. The "else" with another statement is optional.
       Brackets around the expression are also optional.
      </p><div class="example"><a name="idp30785488"></a><p class="title"><b>Exampleï¿½5.33.ï¿½Conditional statements</b></p><div class="example-contents"><pre class="programlisting">
if now() &gt; 2000-01-01 00:00:00 log_info("we are in the 21st century");

# same as above but with brackets
if ( now() &gt; 2000-01-01 00:00:00 ) log_info("we are in the 21st century");

# conditional statement block
if now() &gt; 2000-01-01 00:00:00
{
   log_info("we are in the 21st century");
}

# conditional statement block with an else branch
if now() &gt; 2000-01-01 00:00:00
{
   log_info("we are in the 21st century");
}
else log_info("we are not yet in the 21st century");
</pre></div></div><p><br class="example-break">
      Simliarly to Perl, the nxlog language doesn't have a switch statement. This can be
      accomplished by the appropriate use of conditional if-else statements as in the example 
      below.
      </p><div class="example"><a name="idp30784464"></a><p class="title"><b>Exampleï¿½5.34.ï¿½Emulating switch with if-else</b></p><div class="example-contents"><pre class="programlisting">
if ( $value == 1 )
   log_info("1");
else if ( $value == 2 )
   log_info("2");
else if ( $value == 3 )
   log_info("3");
else 
   log_info("default");
</pre></div></div><p><br class="example-break">
     </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	 The Perl shorthand "elsif" is not supported. There is no "unless" either.
       </p></div></div></div><div class="section" title="Variables"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="lang_variables"></a>Variables</h2></div></div></div><p>
      <a class="link" href="#lang_fields" title="Fields">Fields</a> are not persistent because the scope of these
      is the log message itself, though fields can be used for storing temporary data during
      the processing of one log message or to pass values across modules along the route.
      Unfortunately if we need to store some value persistently, for example to set a state
      on a condition, then the fields cannot be used.
    </p><p>
      The nxlog engine supports module variables for this purpose. A module variable is
      referenced by a string value. A module variable can only be accessed from the
      same module due to concurrency reasons. A module variable with the same name is a different
      variable when referenced from another module.
      A module variable can be created with an expiry value or it can have an infinite 
      lifetime. If a variable is created with a lifetime, it will be destroyed automatically
      when the lifetime expires. This can be also used as a means of a garbage collection
      method, or it can reset the value of the variable automatically.
      The module variables can store values of any type. Module variables are supported
      by all modules automatically.
      See <a class="link" href="#core_proc_create_var">create_var()</a>,
      <a class="link" href="#core_proc_delete_var">delete_var()</a>,
      <a class="link" href="#core_proc_set_var">set_var()</a> and 
      <a class="link" href="#core_func_get_var">get_var()</a> for using module variables.
      </p><div class="example"><a name="lang_variable_example_corr"></a><p class="title"><b>Exampleï¿½5.35.ï¿½Simple event correlation using module variables</b></p><div class="example-contents"><p>
	  If the number of login failures exceeds 3 within 45 seconds, then
	  we generate an internal log message.
	</p><pre class="programlisting">
if $Message =~ /login failure/
{
   if not defined get_var('login_failures')
   { # create the variable if it doesn't exist
       create_var('login_failures', 45);
       set_var('login_failures', 1);
   }
   else
   { # increase the variable and check if it is over the limit
       set_var('login_failures', get_var('login_failures') + 1);
       if get_var('login_failures') &gt;= 3 
           log_warning("3 or more login failures detected within 45 seconds");
   }
}
</pre><p><a name="lang_variable_example_corr_note"></a>
	  Note that this method is a bad example for this task, becuase the lifetime of the
	  variable is not affected by <a class="link" href="#core_proc_set_var">set_var()</a>.
	  For example if there is one login failure at time 0s, then three login failures
	  at 45s, 46s and 47sec, then this algorithm will not be able to detect this,
	  because the variable will be automatically cleared at 45s, and the last three
	  login failures are not noticed even though they happened within 3 seconds.
	  Also note that this method can only work in real time because the timing
	  is not based on values available in the log message, though this can be 
	  reprogrammed by storing the event time in another variable.
	</p></div></div><p><br class="example-break">
    </p></div><div class="section" title="Statistical counters"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="lang_stat"></a>Statistical counters</h2></div></div></div><p>
      Statistical counters are similar to <a class="link" href="#lang_variables" title="Variables">variables</a>
      but these only support integers. The difference is that statistical counters
      can use different algorithms to recalculate their value every time they are updated
      or read.
      A statistical counter can be created with the 
      <a class="link" href="#core_proc_create_stat">create_stat()</a> procedure calls.
      The following types are available for statistical counters:
      </p><div class="variablelist"><dl><dt><span class="term">COUNT</span></dt><dd>
	      This will aggregate the values added, so the value of the counter 
	      will increase if only positive integers are added until the counter
	      is destroyed, or indefinitely if the counter has no expiry.
	    </dd><dt><span class="term">COUNTMIN</span></dt><dd>
	      This will calculate the minimum value of the counter.
	    </dd><dt><span class="term">COUNTMAX</span></dt><dd>
	      This will calculate the maximum value of the counter.
	    </dd><dt><span class="term">AVG</span></dt><dd>
	      This algorithm calculates the average over the specified interval.
	    </dd><dt><span class="term">AVGMIN</span></dt><dd>
	      This algorithm calculates the average over the specified interval and
	      the value of the counter is always the lowest which was ever calculated 
	      during the lifetime of the counter.
	    </dd><dt><span class="term">AVGMAX</span></dt><dd>
	      Similar to AVGMIN but returns the highest value calculated 
	      during the lifetime of the counter.
	    </dd><dt><span class="term">RATE</span></dt><dd>
	      This calculates the value over the specified interval, can be used to
	      calculate events per second (EPS) values.
	    </dd><dt><span class="term">RATEMIN</span></dt><dd>
	      Will return the lowest rate calculated during the lifetime of the counter.
	    </dd><dt><span class="term">RATEMAX</span></dt><dd>
	      Will return the highest rate calculated during the lifetime of the counter.
	    </dd><dt><span class="term">GRAD</span></dt><dd>
	      This calculates the change of the rate of the counter over the specified
	      interval, which is the gradient.
	    </dd><dt><span class="term">GRADMIN</span></dt><dd>
	      Lowest gradient calculated during the lifetime of the counter.
	    </dd><dt><span class="term">GRADMAX</span></dt><dd>
	      Highest gradient calculated during the lifetime of the counter.
	    </dd></dl></div><p>
      A statistical counter will only return a value if the time specified in the
      interval argument has elapsed since it was created. Statistical counters can
      be also created with a lifetime. When they expire, they will be destoryed 
      similarly to module variables.
    </p><p>
      After a statistical counter is created, it can be updated with the 
      <a class="link" href="#core_proc_add_stat">add_stat()</a> procedure call.
      The value of the counter can be read with the 
      <a class="link" href="#core_func_get_stat">get_stat()</a> function call.
      The value of the statistical counter is recalculated during these calls, but it 
      does never happen automatically in a timed fashion, so this can lead to
      slight distortion of the calculated value if the add and read operations
      are infrequent.
    </p><p>
      Another feature of statistical counters is that it is possible to specify a time value
      both during <a class="link" href="#core_proc_create_stat">creation</a>,
      <a class="link" href="#core_proc_add_stat">update</a> and 
      <a class="link" href="#core_func_get_stat">read</a> making offline log processing possible.
      </p><div class="example"><a name="idp30761072"></a><p class="title"><b>Exampleï¿½5.36.ï¿½Simple event correlation using statistical counters</b></p><div class="example-contents"><p>
	  If the number of login failures exceeds 3 within 45 seconds, then
	  we generate an internal log message.
	  This accomplishes the exact same task as our
	  <a class="link" href="#lang_variable_example_corr" title="Exampleï¿½5.35.ï¿½Simple event correlation using module variables">previous algorithm</a> did
	  with module variables, except that this is a lot simpler. 
	  In addition, this method is more precise, because it uses the timestamp from the
	  log message instead of relying on the current time, so it is possible to use this
	  for offline log analysis as well.
	</p><pre class="programlisting">
if $Message =~ /login failure/
{
   # create will no do anything if the counter already exists
   create_stat('login_failures', 'RATE', 45, $EventTime);
   add_stat('login_failures', 1, $EventTime);
   if get_stat('login_failures', $EventTime) &gt;= 3
      log_warning("3 or more login failures detected within 45 seconds");
}
</pre><p>
	  Note that this is still not perfect because the time window used in the rate
	  calculation does not shift, so the problem 
	  <a class="link" href="#lang_variable_example_corr_note">described in our previous example</a>
	  also affects this version and it is possible that this algorith does not work in
	  some situations.
	</p></div></div><p><br class="example-break">
    </p></div><div class="section" title="List of available functions and procedures"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="lang_exported_funcproc"></a>List of available functions and procedures</h2></div></div></div><p></p><div class="section" title="Functions and procedures exported by core"><div class="titlepage"><div><div><h3 class="title"><a name="core_funcproc"></a>Functions and procedures exported by core</h3></div></div></div><div class="section" title="Functions exported by core"><div class="titlepage"><div><div><h4 class="title"><a name="core_functions"></a>Functions exported by core</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="core_func_lc"></a>
       <code class="function">string lc(string arg);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Convert a string to lower case.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_uc"></a>
       <code class="function">string uc(string arg);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Convert a string to upper case.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_now"></a>
       <code class="function">datetime now();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the current time.</dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_datetime">datetime</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_type"></a>
       <code class="function">string type(unknown arg);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Returns the type of a variable. Can be "boolean", "integer", "string", "datetime",
       "ip4addr", "ip6addr", "regexp", "binary". For values with the unknown type, it 
       returns undef.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_unknown">unknown</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_microsecond"></a>
       <code class="function">integer microsecond(datetime datetime);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the microsecond part from the time value.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">datetime</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_second"></a>
       <code class="function">integer second(datetime datetime);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the second part from the time value.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">datetime</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_minute"></a>
       <code class="function">integer minute(datetime datetime);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the minute part from the time value.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">datetime</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_hour"></a>
       <code class="function">integer hour(datetime datetime);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the hour part from the time value.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">datetime</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_day"></a>
       <code class="function">integer day(datetime datetime);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the day part from the time value.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">datetime</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_month"></a>
       <code class="function">integer month(datetime datetime);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the month part from the datetime value.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">datetime</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_year"></a>
       <code class="function">integer year(datetime datetime);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the year part from the datetime value.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">datetime</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_fix_year"></a>
       <code class="function">datetime fix_year(datetime datetime);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Set year value to current in a datetime which was parsed with a
       missing year such as BSD syslog or cisco timestamps.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">datetime</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_datetime">datetime</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_dayofweek"></a>
       <code class="function">integer dayofweek(datetime datetime);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>The number of days since Sunday in the range of 0-6.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">datetime</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_dayofyear"></a>
       <code class="function">integer dayofyear(datetime datetime);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the day number of the year in the range of 1-366.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">datetime</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_string"></a>
       <code class="function">string string(unknown arg);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Convert the argument to string.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_unknown">unknown</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_integer"></a>
       <code class="function">integer integer(unknown arg);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse and convert the string argument to an integer. For datetime type it returns the number of microseconds since epoh </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_unknown">unknown</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_datetime"></a>
       <code class="function">datetime datetime(integer arg);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Convert the integer argument expressing the number of microseconds since epoch to datetime.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_datetime">datetime</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_parsedate"></a>
       <code class="function">datetime parsedate(string arg);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse a datetime argument. Returns an undefined datetime type if it cannot parse the argument so that the user can fix the error, e.g. $EventTime = parsedate($somestring); if not defined($EventTime) $EventTime = now();</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_datetime">datetime</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_strftime"></a>
       <code class="function">string strftime(datetime datetime, string fmt);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Convert a datetime to a string with the given format. See the manual of strftime(3) for the format specification.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">datetime</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd><dt><span class="term">fmt</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_strptime"></a>
       <code class="function">datetime strptime(string input, string fmt);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Convert a string to a datetime with the given format. See the manual of strptime(3) for the format specification.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">input</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">fmt</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_datetime">datetime</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_hostname"></a>
       <code class="function">string hostname();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the hostname (short form).</dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_hostname_fqdn"></a>
       <code class="function">string hostname_fqdn();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the FQDN hostname. This function will return the short form if the FQDN hostname cannot be determined.</dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_host_ip"></a>
       <code class="function">ip4addr host_ip();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the first non-loopback IP address the hostname resolves to.</dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_ip4addr">ip4addr</a>
           </dd></dl></div></dd><dt><span class="term">
       <code class="function">ip4addr host_ip(integer nth);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the nth non-loopback IP address the hostname resolves to. The nth argument starts from 1.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">nth</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_ip4addr">ip4addr</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_get_var"></a>
       <code class="function">unknown get_var(string varname);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the value of the variable or undef if it doesn't exist.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">varname</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_unknown">unknown</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_get_stat"></a>
       <code class="function">integer get_stat(string statname);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the value of the statistical counter or undef if it doesn't exist.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">statname</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <code class="function">integer get_stat(string statname, datetime time);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the value of the statistical counter or undef if it doesn't exist. The time argument specifies the current time.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">statname</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">time</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_ip4addr"></a>
       <code class="function">ip4addr ip4addr(integer arg);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Convert the integer argument to an ip4addr type.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_ip4addr">ip4addr</a>
           </dd></dl></div></dd><dt><span class="term">
       <code class="function">ip4addr ip4addr(integer arg, boolean ntoa);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Convert the integer argument to an ip4addr type. If 'ntoa' is set to true, the integer is assumed to be in network byte order. Instead of '1.2.3.4' the result will be '4.3.2.1'.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd><dt><span class="term">ntoa</span></dt><dd>
                type: <a class="link" href="#lang_type_boolean">boolean</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_ip4addr">ip4addr</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_substr"></a>
       <code class="function">string substr(string src, integer from);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the string starting at the byte offset specified in 'from'.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">src</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">from</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <code class="function">string substr(string src, integer from, integer to);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return a substring specified with the starting and ending positions as byte offsets from the beginning of the string.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">src</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">from</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd><dt><span class="term">to</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_replace"></a>
       <code class="function">string replace(string subject, string src, string dst);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Replace all occurences of 'src' with 'dst' in the 'subject' string.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">subject</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">src</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">dst</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <code class="function">string replace(string subject, string src, string dst, integer count);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Replace 'count' number occurences of 'src' with 'dst' in the 'subject' string.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">subject</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">src</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">dst</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">count</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_size"></a>
       <code class="function">integer size(string str);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return the size of the string 'str' in bytes.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">str</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="core_func_dropped"></a>
       <code class="function">boolean dropped();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return TRUE if the currently processed event has been already dropped.</dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_boolean">boolean</a>
           </dd></dl></div></dd></dl></div></div><div class="section" title="Procedures exported by core"><div class="titlepage"><div><div><h4 class="title"><a name="core_procedures"></a>Procedures exported by core</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="core_proc_log_console.log"></a>
       <code class="function">log_console.log(unknown arg, varargs args);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Print the argument(s) at console.log log level.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_unknown">unknown</a>
               </dd><dt><span class="term">args</span></dt><dd>
                type: <a class="link" href="#lang_type_varargs">varargs</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="core_proc_console.log"></a>
       <code class="function">console.log(unknown arg, varargs args);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Print the argument(s) at console.log log level. Same as log_console.log().</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_unknown">unknown</a>
               </dd><dt><span class="term">args</span></dt><dd>
                type: <a class="link" href="#lang_type_varargs">varargs</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="core_proc_log_info"></a>
       <code class="function">log_info(unknown arg, varargs args);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Print the argument(s) at INFO log level.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_unknown">unknown</a>
               </dd><dt><span class="term">args</span></dt><dd>
                type: <a class="link" href="#lang_type_varargs">varargs</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="core_proc_log_warning"></a>
       <code class="function">log_warning(unknown arg, varargs args);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Print the argument(s) at WARNING log level.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_unknown">unknown</a>
               </dd><dt><span class="term">args</span></dt><dd>
                type: <a class="link" href="#lang_type_varargs">varargs</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="core_proc_log_error"></a>
       <code class="function">log_error(unknown arg, varargs args);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Print the argument(s) at ERROR log level.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_unknown">unknown</a>
               </dd><dt><span class="term">args</span></dt><dd>
                type: <a class="link" href="#lang_type_varargs">varargs</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="core_proc_delete"></a>
       <code class="function">delete(unknown arg);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Delete the field from the event, i.e. delete($field).
Note that doing '$field = undef' is not the same, though after both operations
the field will be undefined.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_unknown">unknown</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="core_proc_create_var"></a>
       <code class="function">create_var(string varname);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Create a module variable with the specified name. The variable will be created with an infinite lifetime.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">varname</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <code class="function">create_var(string varname, integer lifetime);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Create a module variable with the specified name with the lifetime given in seconds.
If the lifetime expires, the variable is deleted automatically and get_var(name) will return undef.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">varname</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">lifetime</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <code class="function">create_var(string varname, datetime expiry);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Create a module variable with the specified name. Expiry specifies when the variable should be deleted automatically.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">varname</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">expiry</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="core_proc_delete_var"></a>
       <code class="function">delete_var(string varname);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Delete the module variable with the specified name if it exists.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">varname</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="core_proc_set_var"></a>
       <code class="function">set_var(string varname, unknown value);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Set a value of a module variable. If the variable does not exist, it will be created with an infinite lifetime.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">varname</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">value</span></dt><dd>
                type: <a class="link" href="#lang_type_unknown">unknown</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="core_proc_create_stat"></a>
       <code class="function">create_stat(string statname, string type);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Create a module statistical counter with the specified name using the current time.
       The statistical counter will be created with an infinite lifetime.
       The type argument can be any of the following to select the required algorithm
       for calculating the value of the statistical counter: COUNT, COUNTMIN, COUNTMAX
       AVG, AVGMIN, AVGMAX, RATE, RATEMIN, RATEMAX, GRAD, GRADMIN, GRADMAX.
       See the statistical counters section for the description of these.
       This procedure with two parameters can only be used with COUNT, otherwise the 
       interval parameter must be specified.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">statname</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">type</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <code class="function">create_stat(string statname, string type, integer interval);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Create a module statistical counter with the specified name to be calculated over 'interval' seconds and using the current time. The statistical counter will be created with an infinite lifetime.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">statname</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">type</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">interval</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <code class="function">create_stat(string statname, string type, integer interval, datetime time);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Create a module statistical counter with the specified name to be calculated over 'interval' seconds and the time value specified in the argument named 'time'.  The statistical counter will be created with an infinite lifetime.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">statname</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">type</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">interval</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd><dt><span class="term">time</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <code class="function">create_stat(string statname, string type, integer interval, datetime time, integer lifetime);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Create a module statistical counter with the specified name to be calculated over 'interval' seconds and the time value specified in the argument named 'time'.  The statistical counter will expire after 'lifetime' seconds.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">statname</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">type</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">interval</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd><dt><span class="term">time</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd><dt><span class="term">lifetime</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <code class="function">create_stat(string statname, string type, integer interval, datetime time, datetime expiry);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Create a module statistical counter with the specified name to be calculated over 'interval' seconds and the time value specified in the argument named 'time'.  The statistical counter will expire at 'expiry'.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">statname</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">type</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">interval</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd><dt><span class="term">time</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd><dt><span class="term">expiry</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="core_proc_add_stat"></a>
       <code class="function">add_stat(string statname, integer value);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Add 'value' to the statistical counter using the current time.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">statname</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">value</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <code class="function">add_stat(string statname, integer value, datetime time);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Add 'value' to the statistical counter using the time specified in the argument named 'time'.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">statname</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">value</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd><dt><span class="term">time</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="core_proc_sleep"></a>
       <code class="function">sleep(integer interval);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Sleep the specified number of microseconds. This procedure is provided for testing
       purposes mostly. It can be used as a poor man's rate limiting tool, though its use
       is not recommended.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">interval</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="core_proc_drop"></a>
       <code class="function">drop();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Drop the currently processed event's log and don't execute further statements.</dd></dl></div></dd><dt><span class="term">
       <a name="core_proc_rename_field"></a>
       <code class="function">rename_field(string old, string new);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Rename a field.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">old</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">new</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="core_proc_reroute"></a>
       <code class="function">reroute(string routename);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Move the currently processed event data to the route specified in the argument.
       The event data will enter the route as if it was received by an input module there.
       Note that flow-control is explicitly disabled when moving data with reroute() and the data will be dropped if the queue of the target module(s) is full.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">routename</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="core_proc_add_to_route"></a>
       <code class="function">add_to_route(string routename);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Copy the currently processed event data to the the route specified in the argument.
       This procedure makes a copy of the data and the original will be processed normally.
       Note that flow-control is explicitly disabled when moving data with reroute() and the data will not be added if the queue of the target module(s) is full.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">routename</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd></dl></div></div></div><div class="section" title="Functions and procedures exported by modules"><div class="titlepage"><div><div><h3 class="title"><a name="lang_exported_module_funcproc"></a>Functions and procedures exported by modules</h3></div></div></div><p>
	</p><div class="variablelist"><dl><dt><span class="term">xm_syslog</span></dt><dd>
		<a class="link" href="#xm_syslog_functions" title="Functions exported by xm_syslog">Functions</a> and
		<a class="link" href="#xm_syslog_procedures" title="Procedures exported by xm_syslog">procedures</a> exported by 
		<a class="link" href="#xm_syslog" title="Syslog (xm_syslog)">xm_syslog</a>
	      </dd><dt><span class="term">om_file</span></dt><dd>
		<a class="link" href="#om_file_functions" title="Functions exported by om_file">Functions</a> and
		<a class="link" href="#om_file_procedures" title="Procedures exported by om_file">procedures</a> exported by 
		<a class="link" href="#om_file" title="File (om_file)">om_file</a>
	      </dd></dl></div><p>
      </p></div></div></div><div class="chapter" title="Chapterï¿½6.ï¿½Modules"><div class="titlepage"><div><div><h2 class="title"><a name="modules"></a>Chapterï¿½6.ï¿½Modules</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#modules_extension">Extension modules</a></span></dt><dd><dl><dt><span class="section"><a href="#xm_csv">CSV (xm_csv)</a></span></dt><dt><span class="section"><a href="#xm_json">JSON (xm_json)</a></span></dt><dt><span class="section"><a href="#xm_xml">XML (xm_xml)</a></span></dt><dt><span class="section"><a href="#xm_kvp">Key-value pairs (xm_kvp)</a></span></dt><dt><span class="section"><a href="#xm_gelf">GELF (xm_gelf)</a></span></dt><dt><span class="section"><a href="#xm_charconv">Character set conversion (xm_charconv)</a></span></dt><dt><span class="section"><a href="#xm_fileop">File operations (xm_fileop)</a></span></dt><dt><span class="section"><a href="#xm_multiline">Multi-line message parser (xm_multiline)</a></span></dt><dt><span class="section"><a href="#xm_syslog">Syslog (xm_syslog)</a></span></dt><dt><span class="section"><a href="#xm_exec">External program execution (xm_exec)</a></span></dt><dt><span class="section"><a href="#xm_perl">Perl (xm_perl)</a></span></dt><dt><span class="section"><a href="#xm_wtmp">WTMP (xm_wtmp)</a></span></dt></dl></dd><dt><span class="section"><a href="#modules_input">Input modules</a></span></dt><dd><dl><dt><span class="section"><a href="#core_fields">Fields generated by core</a></span></dt><dt><span class="section"><a href="#im_dbi">DBI (im_dbi)</a></span></dt><dt><span class="section"><a href="#im_exec">Program (im_exec)</a></span></dt><dt><span class="section"><a href="#im_file">File (im_file)</a></span></dt><dt><span class="section"><a href="#im_internal">Internal (im_internal)</a></span></dt><dt><span class="section"><a href="#im_kernel">Kernel (im_kernel)</a></span></dt><dt><span class="section"><a href="#im_mark">Mark (im_mark)</a></span></dt><dt><span class="section"><a href="#im_mseventlog">MS EventLog for Windows XP/2000/2003 (im_mseventlog)</a></span></dt><dt><span class="section"><a href="#im_msvistalog">MS EventLog for Windows 2008/Vista and later (im_msvistalog)</a></span></dt><dt><span class="section"><a href="#im_null">Null (im_null)</a></span></dt><dt><span class="section"><a href="#im_ssl">TLS/SSL (im_ssl)</a></span></dt><dt><span class="section"><a href="#im_tcp">TCP (im_tcp)</a></span></dt><dt><span class="section"><a href="#im_udp">UDP (im_udp)</a></span></dt><dt><span class="section"><a href="#im_uds">Unix Domain Socket (im_uds)</a></span></dt></dl></dd><dt><span class="section"><a href="#modules_processor">Processor modules</a></span></dt><dd><dl><dt><span class="section"><a href="#pm_blocker">Blocker (pm_blocker)</a></span></dt><dt><span class="section"><a href="#pm_buffer">Buffer (pm_buffer)</a></span></dt><dt><span class="section"><a href="#pm_evcorr">Event correlator (pm_evcorr)</a></span></dt><dt><span class="section"><a href="#pm_filter">Filter (pm_filter)</a></span></dt><dt><span class="section"><a href="#pm_norepeat">Message deduplicator (pm_norepeat)</a></span></dt><dt><span class="section"><a href="#pm_null">Null (pm_null)</a></span></dt><dt><span class="section"><a href="#pm_pattern">Pattern matcher (pm_pattern)</a></span></dt><dt><span class="section"><a href="#pm_transformer">Message format converter (pm_transformer)</a></span></dt></dl></dd><dt><span class="section"><a href="#modules_output">Output modules</a></span></dt><dd><dl><dt><span class="section"><a href="#om_blocker">Blocker (om_blocker)</a></span></dt><dt><span class="section"><a href="#om_dbi">DBI (om_dbi)</a></span></dt><dt><span class="section"><a href="#om_exec">Program (om_exec)</a></span></dt><dt><span class="section"><a href="#om_file">File (om_file)</a></span></dt><dt><span class="section"><a href="#om_http">HTTP(s) (om_http)</a></span></dt><dt><span class="section"><a href="#om_null">Null (om_null)</a></span></dt><dt><span class="section"><a href="#om_ssl">TLS/SSL (om_ssl)</a></span></dt><dt><span class="section"><a href="#om_tcp">TCP (om_tcp)</a></span></dt><dt><span class="section"><a href="#om_udp">UDP (om_udp)</a></span></dt><dt><span class="section"><a href="#om_uds">UDS (om_uds)</a></span></dt></dl></dd></dl></div><p>
    nxlog uses loadable modules similarly to the Apache HTTP server, these are also called
    as plugins in another terminology.
    There are four types of modules: 
    <a class="link" href="#modules_extension" title="Extension modules">extension</a>,
    <a class="link" href="#modules_input" title="Input modules">input</a>,
    <a class="link" href="#modules_processor" title="Processor modules">processor</a> and
    <a class="link" href="#modules_output" title="Output modules">output</a> modules.
    This chapter deals with the features and configuration of each specific module.
    General concepts about <a class="link" href="#config_modules" title="Modules">configuring modules</a>
    were discussed in the <a class="link" href="#config" title="Chapterï¿½4.ï¿½Configuration">Configuration</a> chapter earlier.
  </p><div class="section" title="Extension modules"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="modules_extension"></a>Extension modules</h2></div></div></div><p>
     Extension modules do not process log messages directly, and for this reason their
     instances cannot be part of a <a class="link" href="#config_routes" title="Routes">route</a>.
     These modules can enhance the features of nxlog in different ways such as exporting new
     <a class="link" href="#lang_exported_module_funcproc" title="Functions and procedures exported by modules">functions and procedures</a>,
     registering additional I/O reader and writer functions to be used with modules
     supporting the <a class="link" href="#config_outputtype" title="OutputType">OutputType</a> and
     <a class="link" href="#config_inputtype" title="InputType">InputType</a> directives.
     Also there are many possibilities to hook an extension module into the nxlog engine,
     the following modules will illustrate this.
   </p><div class="section" title="CSV (xm_csv)"><div class="titlepage"><div><div><h3 class="title"><a name="xm_csv"></a>CSV (xm_csv)</h3></div></div></div><p>
    This module provides functions and procedures to process data formatted as
    comma separated values (CSV) and allows to convert to CSV and parse CSV into
    <a class="link" href="#lang_fields" title="Fields">fields</a>.
  </p><p>
    The <a class="link" href="#pm_transformer" title="Message format converter (pm_transformer)">pm_transformer</a> module also provides a simple
    interface to parse and generate CSV lines, but with the API this xm_csv module exports
    to the nxlog language, it is possible to solve a lot more complex tasks involving CSV
    formatted data.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      It is possible to use more than one xm_csv module instance with different options in order
      to support different CSV formats at the same time.
      For this reason, functions and procedures exported by the module are public and 
      must be referenced by the module instance name.
    </p></div><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="xm_csv_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the xm_csv module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="xm_csv_config_quotechar"></a>QuoteChar</span></dt><dd><p>
	      This optional directive takes a single character 
	      (see <a class="link" href="#xm_csv_config_char" title="Specifying characters for quote, escape and delimiter">below</a>)
	      as argument to specify the quote 
	      character used to enclose fields.
	      If <a class="link" href="#xm_csv_config_quoteoptional">QuoteOptional</a> is
	      TRUE, then only <a class="link" href="#lang_type_string">string</a> type fields
	      are quoted.
	      If this directive is not specified, the default quote character is the double-quote
	      character (").
  	    </p></dd><dt><span class="term"><a name="xm_csv_config_escapechar"></a>EscapeChar</span></dt><dd><p>
	      This optional directive takes a single character 
	      (see <a class="link" href="#xm_csv_config_char" title="Specifying characters for quote, escape and delimiter">below</a>)
	      as argument to specify the escape 
	      character used to escape special characters.
	      The escape character is used to prefix the following characters:
	      the escape character itself,
	      the <a class="link" href="#xm_csv_config_quotechar">quote character</a> and
	      the <a class="link" href="#xm_csv_config_delimiter">delimiter character</a>.
	      If <a class="link" href="#xm_csv_config_escapecontrol">EscapeControl</a> is TRUE,
	      the \n, \r, \t, \b (newline, carriage-return, tab, backspace) control characters
	      are also escaped.
	      If this directive is not specified, the default escape character is the backslash
	      character (\).
  	    </p></dd><dt><span class="term"><a name="xm_csv_config_delimiter"></a>Delimiter</span></dt><dd><p>
	      This optional directive takes a single character 
	      (see <a class="link" href="#xm_csv_config_char" title="Specifying characters for quote, escape and delimiter">below</a>)
	      as argument to specify the
	      delimiter character used to separate fields.
	      If this directive is not specified, the default delimiter character is the comma
	      character (,).
	      Note that there is no delimiter after the last field.
  	    </p></dd><dt><span class="term"><a name="xm_csv_config_quoteoptional"></a>QuoteOptional</span></dt><dd><p>
	      This directive has been deprecated in favor of
	      <a class="link" href="#xm_csv_config_quotemethod">QuoteMethod</a>, please use
	      that instead.
  	    </p></dd><dt><span class="term"><a name="xm_csv_config_quotemethod"></a>QuoteMethod</span></dt><dd><p>
	      This optional directive can take the following values:
	      </p><div class="variablelist"><dl><dt><span class="term">String</span></dt><dd><p>
		      Only <a class="link" href="#lang_type_string">string</a> type fields will be quoted.
		      Has the same effect as <a class="link" href="#xm_csv_config_quoteoptional">QuoteOptional</a>
		      set to <em class="replaceable"><code>TRUE</code></em>. This is the default behavior if the
		      QuoteMethod directive is not specified.
  		    </p></dd><dt><span class="term">All</span></dt><dd><p>
		      All fields will be quoted.
  		    </p></dd><dt><span class="term">None</span></dt><dd><p>
		      Nothing will be quoted. This can be problematic if the field value (typically 
		      text that can contain any character) can contain the delimiter character.
		      Make sure that this is escaped or replaced with something else.
  		    </p></dd></dl></div><p>

	      Note that this directive only effects CSV generation when using
	      <a class="link" href="#xm_csv_func_to_csv">to_csv()</a>.
	      The CSV parser can automatically detect the quotation.
  	    </p></dd><dt><span class="term"><a name="xm_csv_config_escapecontrol"></a>EscapeControl</span></dt><dd><p>
	      If this optional boolean directive is set to TRUE, control characters
	      are also escaped. 
	      See the <a class="link" href="#xm_csv_config_escapechar">EscapeChar</a>
	      directive for details.
	      If this directive is not specified, control characters are escaped by default.
	      Note that this is necessary in order to allow single line CSV field lists
	      which contain line-breaks.
  	    </p></dd><dt><span class="term"><a name="xm_csv_config_fields"></a>Fields</span></dt><dd><p>
	      This is a comma separated list of fields which will be filled from the input
	      parsed. Field names with or without the dollar sign "$" are also accepted.
	      This directive is mandatory.
	      The fields will be stored as <a class="link" href="#lang_type_string">strings</a>
	      by default unless their type is explicitely specified with the
	      <a class="link" href="#xm_csv_config_fieldtypes">FieldTypes</a> directive.
  	    </p></dd><dt><span class="term"><a name="xm_csv_config_fieldtypes"></a>FieldTypes</span></dt><dd><p>
	      This optional directive specifies the list of types corresponding to the
	      field names defined in <a class="link" href="#xm_csv_config_fields">Fields</a>.
	      If specified, the number of types must match the number of field names specified
	      with <a class="link" href="#xm_csv_config_fields">Fields</a>.
	      If this directive is omitted, all fields will be stored as 
	      <a class="link" href="#lang_type_string">strings</a>.
	      This directive has no effect on the fields-to-csv conversion.
  	    </p></dd><dt><span class="term"><a name="xm_csv_config_undefvalue"></a>UndefValue</span></dt><dd><p>
	      This optional directive specifies a string which will be treated as an undefined value.
	      This is particularly useful when <a class="link" href="#processing_parsers_w3c" title="W3C Extended Log File Format">parsing the W3C format</a> where
	      the dash "-" marks an omitted field.
  	    </p></dd></dl></div><p>
    </p><div class="section" title="Specifying characters for quote, escape and delimiter"><div class="titlepage"><div><div><h5 class="title"><a name="xm_csv_config_char"></a>Specifying characters for quote, escape and delimiter</h5></div></div></div><p>
	The <a class="link" href="#xm_csv_config_quotechar">QuoteChar</a>, 
	<a class="link" href="#xm_csv_config_escapechar">EscapeChar</a> and
	<a class="link" href="#xm_csv_config_delimiter">Delimiter</a> can be specified in different ways, 
	mainly due to the nature of the config file format.
	As of this writing, the module does not support multi character strings for these parameters.
	</p><div class="variablelist"><dl><dt><span class="term"><a name="xm_csv_config_char_single"></a>Unquoted single character</span></dt><dd><p>
		Printable characters can be specified as an unquoted character,
		except for the backslash '\'. Example:
		</p><pre class="programlisting">Delimiter ;</pre><p>
	      </p></dd><dt><span class="term"><a name="xm_csv_config_char_control"></a>Control characters</span></dt><dd><p>
		The following non-printable characters can be specified with escape sequences:
		</p><div class="variablelist"><dl><dt><span class="term">\a</span></dt><dd>
			audible alert (bell)
  		      </dd><dt><span class="term">\b</span></dt><dd>
			backspace
  		      </dd><dt><span class="term">\t</span></dt><dd>
			horizontal tab
  		      </dd><dt><span class="term">\n</span></dt><dd>
			newline
  		      </dd><dt><span class="term">\v</span></dt><dd>
			vertical tab
  		      </dd><dt><span class="term">\f</span></dt><dd>
			formfeed
  		      </dd><dt><span class="term">\r</span></dt><dd>
			carriage return
  		      </dd></dl></div><p>
		To use TAB delimiting:
		</p><pre class="programlisting">Delimiter \t</pre><p>
  	      </p></dd><dt><span class="term"><a name="xm_csv_config_char_single_quote"></a>A character in single quotes</span></dt><dd><p>
		The config parser strips whitespace, so it is not possible to define space as
		the delimiter unless it is enclosed within quotes:
		</p><pre class="programlisting">Delimiter ' '</pre><p>
		Printable characters can also be enclosed:
		</p><pre class="programlisting">Delimiter ';'</pre><p>
		The backslash can be specified when enclosed within quotes:
		</p><pre class="programlisting">Delimiter '\'</pre><p>
  	      </p></dd><dt><span class="term"><a name="xm_csv_config_char_double_quote"></a>A character in double quotes</span></dt><dd><p>
		Double quotes can be used similarly to single quotes:
		</p><pre class="programlisting">Delimiter " "</pre><p>
		The backslash can be specified when enclosed within double quotes:
		</p><pre class="programlisting">Delimiter "\"</pre><p>
  	      </p></dd><dt><span class="term"><a name="xm_csv_config_char_hex_code"></a>A hexadecimal ASCII code</span></dt><dd><p>
		Hexadecimal ASCII character codes are also accepted starting with '0x'.
		For example the space can be specified as:
		</p><pre class="programlisting">Delimiter 0x20</pre><p>
		This is equivalent to:
		</p><pre class="programlisting">Delimiter " "</pre><p>
  	      </p></dd></dl></div><p>
	
      </p></div></div><div class="section" title="Functions and procedures exported by xm_csv"><div class="titlepage"><div><div><h4 class="title"><a name="xm_csv_funcproc"></a>Functions and procedures exported by xm_csv</h4></div></div></div><div class="section" title="Functions exported by xm_csv"><div class="titlepage"><div><div><h5 class="title"><a name="xm_csv_functions"></a>Functions exported by xm_csv</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_csv_func_to_csv"></a>
       <code class="function">string to_csv();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Convert the specified fields to a single CSV formatted string.</dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd></dl></div></div><div class="section" title="Procedures exported by xm_csv"><div class="titlepage"><div><div><h5 class="title"><a name="xm_csv_procedures"></a>Procedures exported by xm_csv</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_csv_proc_parse_csv"></a>
       <code class="function">parse_csv();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse the raw_event field as csv input</dd></dl></div></dd><dt><span class="term">
       <code class="function">parse_csv(string source);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse the given string as CSV format</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">source</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_csv_proc_to_csv"></a>
       <code class="function">to_csv();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Format the specified fields as CSV and put it into the 'raw_event' field.</dd></dl></div></dd></dl></div></div></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="xm_csv_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="xm_csv_example1"></a><p class="title"><b>Exampleï¿½6.1.ï¿½Complex CSV format conversion</b></p><div class="example-contents"><p>
	  This example illustrates the power of nxlog and the xm_csv module.
	  It shows that not only can the module parse and create CSV formatted input and
	  output, but using multiple xm_csv modules it is possible to reorder, add, remove or
	  modify fields and output these in a different CSV format.
	</p><pre class="programlisting">
&lt;Extension csv1&gt;
    Module      xm_csv
    Fields	$id, $name, $number
    FieldTypes  integer, string, integer
    Delimiter	,
&lt;/Extension&gt;

&lt;Extension csv2&gt;
    Module      xm_csv
    Fields	$id, $number, $name, $date
    Delimiter	;
&lt;/Extension&gt;

&lt;Input filein&gt;
    Module	im_file
    File	"tmp/input"
    Exec	csv1-&gt;parse_csv(); \
    		$date = now(); \
                if not defined $number $number = 0; \
                csv2-&gt;to_csv();
&lt;/Input&gt;

&lt;Output fileout&gt;
    Module	om_file
    File	"tmp/output"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	filein =&gt; fileout
&lt;/Route&gt;
</pre><p>
	  Samples for the input and output files processed by the above config are shown below.
	  </p><pre class="programlisting">1, "John K.", 42
2, "Joe F.", 43
</pre><p>
	  </p><pre class="programlisting">1;42;"John K.";2011-01-15 23:45:20
2;43;"Joe F.";2011-01-15 23:45:20
</pre><p>
	</p></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="JSON (xm_json)"><div class="titlepage"><div><div><h3 class="title"><a name="xm_json"></a>JSON (xm_json)</h3></div></div></div><p>
    This module provides functions and procedures to process data formatted as
    <a class="ulink" href="http://json.org" target="_top">JSON</a> and allows to convert to JSON and parse JSON into
    <a class="link" href="#lang_fields" title="Fields">fields</a>.

    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	NXLog does not support complex variables such as arrays and maps. For this reason accessing nested JSON fields is not possible.
      </p></div><p>

    Unfortunately the JSON specification does not define a type for datetime values so these are represented as JSON strings.
    The JSON parser in <em class="replaceable"><code>xm_json</code></em> can automatically detect datetime values so that you will not explicitly need
    to use <a class="link" href="#core_func_parsedate">parsedate()</a>.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="xm_json_config"></a>Configuration</h4></div></div></div><p>
      The module does not have any module specific configuration directives.
    </p></div><div class="section" title="Functions and procedures exported by xm_json"><div class="titlepage"><div><div><h4 class="title"><a name="xm_json_funcproc"></a>Functions and procedures exported by xm_json</h4></div></div></div><div class="section" title="Functions exported by xm_json"><div class="titlepage"><div><div><h5 class="title"><a name="xm_json_functions"></a>Functions exported by xm_json</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_json_func_to_json"></a>
       <code class="function">string to_json();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Converts the fields to JSON and returns it as a string value.
       Fields having a leading dot (.) or underscore (_) and the 'raw_event' will be automatically
       excluded.
     </dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd></dl></div></div><div class="section" title="Procedures exported by xm_json"><div class="titlepage"><div><div><h5 class="title"><a name="xm_json_procedures"></a>Procedures exported by xm_json</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_json_proc_parse_json"></a>
       <code class="function">parse_json();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse the raw_event field as json input</dd></dl></div></dd><dt><span class="term">
       <code class="function">parse_json(string source);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse the given string as JSON format</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">source</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_json_proc_to_json"></a>
       <code class="function">to_json();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Convert the fields to JSON and put this into the 'raw_event' field.
       Fields having a leading dot (.) or underscore (_) and the 'raw_event' will be automatically
       excluded.
     </dd></dl></div></dd></dl></div></div></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="xm_json_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="xm_json_example1"></a><p class="title"><b>Exampleï¿½6.2.ï¿½Syslog to JSON format conversion</b></p><div class="example-contents"><p>
	  The following configuration accepts syslog (both legacy and RFC5424) and converts it to JSON.
	</p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Extension json&gt;
    Module	xm_json
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_tcp
    Port	1514
    Host	0.0.0.0
    Exec	parse_syslog(); to_json();
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"/var/log/json.txt"
&lt;/Output&gt;

&lt;Route r&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre><p>
	  A sample is shown for the input and its corresponding output:
	  </p><pre class="programlisting">&lt;30&gt;Sep 30 15:45:43 host44.localdomain.hu acpid: 1 client rule loaded
	  </pre><p>
	  </p><pre class="programlisting">{"MessageSourceAddress":"127.0.0.1","EventReceivedTime":"2011-03-08 14:22:41","SyslogFacilityValue":1,\
"SyslogFacility":"DAEMON","SyslogSeverityValue":5,"SyslogSeverity":"INFO","SeverityValue":2,"Severity":"INFO",\
"Hostname":"host44.localdomain.hu","EventTime":"2011-09-30 14:45:43","SourceName":"acpid","Message":"1 client rule loaded "}
	  </pre><p>
	</p></div></div><p><br class="example-break">

      </p><div class="example"><a name="xm_json_example2"></a><p class="title"><b>Exampleï¿½6.3.ï¿½Converting Windows EventLog to Syslog encapsulated JSON</b></p><div class="example-contents"><p>
	  The following configuration reads the Windows EventLog and converts it into the legacy syslog
	  format where the message part contains the fields in JSON.
	</p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module      xm_syslog
&lt;/Extension&gt;

&lt;Extension json&gt;
    Module      xm_json
&lt;/Extension&gt;

&lt;Input in&gt;
    Module      im_msvistalog
    Exec        $Message = to_json(); to_syslog_bsd();
&lt;/Input&gt;

&lt;Output out&gt;
    Module      om_tcp
    Host        192.168.1.1
    Port        1514
&lt;/Output&gt;


&lt;Route r&gt;
    Path        in =&gt; out
&lt;/Route&gt;

</pre><p>
	  A sample output is shown:
	  </p><pre class="programlisting">&lt;14&gt;Mar  8 14:40:11 WIN-OUNNPISDHIG Service_Control_Manager: {"EventTime":"2012-03-08 14:40:11","EventTimeWritten":"2012-03-08 14:40:11",\
"Hostname":"WIN-OUNNPISDHIG","EventType":"INFO","SeverityValue":2,"Severity":"INFO","SourceName":"Service Control Manager",\
"FileName":"System","EventID":7036,"CategoryNumber":0,"RecordNumber":6788,"Message":"The nxlog service entered the running state. ",\
"EventReceivedTime":"2012-03-08 14:40:12"}
</pre><p>
	</p></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="XML (xm_xml)"><div class="titlepage"><div><div><h3 class="title"><a name="xm_xml"></a>XML (xm_xml)</h3></div></div></div><p>
    This module provides functions and procedures to process data formatted as
    Extensible Markup Language (XML) and allows to convert to XML and parse XML into
    <a class="link" href="#lang_fields" title="Fields">fields</a>.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="xm_xml_config"></a>Configuration</h4></div></div></div><p>
      The module does not have any module specific configuration directives.
    </p></div><div class="section" title="Functions and procedures exported by xm_xml"><div class="titlepage"><div><div><h4 class="title"><a name="xm_xml_funcproc"></a>Functions and procedures exported by xm_xml</h4></div></div></div><div class="section" title="Functions exported by xm_xml"><div class="titlepage"><div><div><h5 class="title"><a name="xm_xml_functions"></a>Functions exported by xm_xml</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_xml_func_to_xml"></a>
       <code class="function">string to_xml();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Converts the fields to XML and returns it as a string value.
       Fields having a leading dot (.) or underscore (_) and the 'raw_event' will be automatically
       excluded.
     </dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd></dl></div></div><div class="section" title="Procedures exported by xm_xml"><div class="titlepage"><div><div><h5 class="title"><a name="xm_xml_procedures"></a>Procedures exported by xm_xml</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_xml_proc_parse_xml"></a>
       <code class="function">parse_xml();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse the raw_event field as xml input</dd></dl></div></dd><dt><span class="term">
       <code class="function">parse_xml(string source);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse the given string as XML format</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">source</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_xml_proc_to_xml"></a>
       <code class="function">to_xml();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Convert the fields to XML and put this into the 'raw_event' field.
       Fields having a leading dot (.) or underscore (_) and the 'raw_event' will be automatically
       excluded.
     </dd></dl></div></dd></dl></div></div></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="xm_xml_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="xm_xml_example1"></a><p class="title"><b>Exampleï¿½6.4.ï¿½Syslog to XML format conversion</b></p><div class="example-contents"><p>
	  The following configuration accepts Syslog (both legacy and RFC5424) and converts it to XML.
	</p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Extension xml&gt;
    Module	xm_xml
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_tcp
    Port	1514
    Host	0.0.0.0
    Exec	parse_syslog(); to_xml();
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"/var/log/log.xml"
&lt;/Output&gt;

&lt;Route r&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre><p>
	  A sample is shown for the input and its corresponding output:
	  </p><pre class="programlisting">&lt;30&gt;Sep 30 15:45:43 host44.localdomain.hu acpid: 1 client rule loaded
	  </pre><p>
	  </p><pre class="programlisting">&lt;Event&gt;&lt;MessageSourceAddress&gt;127.0.0.1&lt;/MessageSourceAddress&gt;&lt;EventReceivedTime&gt;2012-03-08 15:05:39&lt;/EventReceivedTime&gt;\
&lt;SyslogFacilityValue&gt;3&lt;/SyslogFacilityValue&gt;&lt;SyslogFacility&gt;DAEMON&lt;/SyslogFacility&gt;&lt;SyslogSeverityValue&gt;6&lt;/SyslogSeverityValue&gt;\
&lt;SyslogSeverity&gt;INFO&lt;/SyslogSeverity&gt;&lt;SeverityValue&gt;2&lt;/SeverityValue&gt;&lt;Severity&gt;INFO&lt;/Severity&gt;&lt;Hostname&gt;host44.localdomain.hu&lt;/Hostname&gt;\
&lt;EventTime&gt;2012-09-30 15:45:43&lt;/EventTime&gt;&lt;SourceName&gt;acpid&lt;/SourceName&gt;&lt;Message&gt;1 client rule loaded&lt;/Message&gt;&lt;/Event&gt;
	  </pre><p>
	</p></div></div><p><br class="example-break">

      </p><div class="example"><a name="xm_xml_example2"></a><p class="title"><b>Exampleï¿½6.5.ï¿½Converting Windows EventLog to Syslog encapsulated XML</b></p><div class="example-contents"><p>
	  The following configuration reads the Windows EventLog and converts it into the legacy syslog
	  format where the message part contains the fields in XML.
	</p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module      xm_syslog
&lt;/Extension&gt;

&lt;Extension xml&gt;
    Module      xm_xml
&lt;/Extension&gt;

&lt;Input in&gt;
    Module      im_msvistalog
    Exec        $Message = to_xml(); to_syslog_bsd();
&lt;/Input&gt;

&lt;Output out&gt;
    Module      om_tcp
    Host        192.168.1.1
    Port        1514
&lt;/Output&gt;


&lt;Route r&gt;
    Path        in =&gt; out
&lt;/Route&gt;

</pre><p>
	  A sample output is shown:
	  </p><pre class="programlisting">&lt;14&gt;Mar  8 15:12:12 WIN-OUNNPISDHIG Service_Control_Manager: &lt;Event&gt;&lt;EventTime&gt;2012-03-08 15:12:12&lt;/EventTime&gt;\
&lt;EventTimeWritten&gt;2012-03-08 15:12:12&lt;/EventTimeWritten&gt;&lt;Hostname&gt;WIN-OUNNPISDHIG&lt;/Hostname&gt;&lt;EventType&gt;INFO&lt;/EventType&gt;\
&lt;SeverityValue&gt;2&lt;/SeverityValue&gt;&lt;Severity&gt;INFO&lt;/Severity&gt;&lt;SourceName&gt;Service Control Manager&lt;/SourceName&gt;\
&lt;FileName&gt;System&lt;/FileName&gt;&lt;EventID&gt;7036&lt;/EventID&gt;&lt;CategoryNumber&gt;0&lt;/CategoryNumber&gt;&lt;RecordNumber&gt;6791&lt;/RecordNumber&gt;\
&lt;Message&gt;The nxlog service entered the running state. &lt;/Message&gt;&lt;EventReceivedTime&gt;2012-03-08 15:12:14&lt;/EventReceivedTime&gt;&lt;/Event&gt;
</pre><p>
	</p></div></div><p><br class="example-break">    </p></div></div><div class="section" title="Key-value pairs (xm_kvp)"><div class="titlepage"><div><div><h3 class="title"><a name="xm_kvp"></a>Key-value pairs (xm_kvp)</h3></div></div></div><p>
    This module provides functions and procedures to process data formatted as
    key-value pairs (KVPs), also commonly called as name-value pairs.
    The module can both parse and generate data formatted as key-value pairs.
  </p><p>
    It is quite common to have a different set of keys in each log line in the form of
    key-value formatted messages. Extracting values from such logs using regular expressions
    can be quite cumbersome. The xm_kvp extension module solves this problem by
    automating this process.
  </p><p>
    Log messages containing key-value pairs typically look like the following:
    </p><pre class="programlisting">key1: value1, key2: value2, key42: value42
key1="value 1"; key2="value 2"
Application=smtp, Event='Protocol Conversation', status='Client Request', ClientRequest='HELO 1.2.3.4'
</pre><p>
    I.e. keys are usually separated from the value using an equal sign (=) or the colon (:) and
    the key-value pairs are delimited with a comma (,), semicolon (;) or space.
    In addition, values and keys may be quoted and can contain escaping. 
    The module will try to guess the format or this can be explicitly specified using
    the configuration directives listed below.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      It is possible to use more than one xm_kvp module instance with different options in order
      to support different KVP formats at the same time.
      For this reason, functions and procedures exported by the module are public and 
      must be referenced by the module instance name.
    </p></div><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="xm_kvp_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the xm_kvp module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="xm_kvp_config_keyquotechar"></a>KeyQuoteChar</span></dt><dd><p>
	      This optional directive takes a single character 
	      (see <a class="link" href="#xm_kvp_config_char" title="Specifying characters for quote, escape and delimiter">below</a>)
	      as argument to specify the quote character used to enclose key names.
	      If this directive is not specified, the module will accept keys quoted in
	      single and double quotes in addition to unquoted keys.
  	    </p></dd><dt><span class="term"><a name="xm_kvp_config_valuequotechar"></a>ValueQuoteChar</span></dt><dd><p>
	      This optional directive takes a single character 
	      (see <a class="link" href="#xm_kvp_config_char" title="Specifying characters for quote, escape and delimiter">below</a>)
	      as argument to specify the quote character used to enclose values.
	      If this directive is not specified, the module will accept keys quoted in
	      single and double quotes in addition to unquoted values.
	      Normally, but not neccessarily, quotation is used when the value contains
	      space and or the KVDelimiter character.
  	    </p></dd><dt><span class="term"><a name="xm_kvp_config_escapechar"></a>EscapeChar</span></dt><dd><p>
	      This optional directive takes a single character 
	      (see <a class="link" href="#xm_kvp_config_char" title="Specifying characters for quote, escape and delimiter">below</a>)
	      as argument to specify the escape 
	      character used to escape special characters.
	      The escape character is used to prefix the following characters:
	      the <a class="link" href="#xm_kvp_config_keyquotechar">EscapeChar</a> itself and
	      the <a class="link" href="#xm_kvp_config_keyquotechar">KeyQuoteChar</a> or
	      the <a class="link" href="#xm_kvp_config_valuequotechar">ValueQuoteChar</a>.
	      
	      If <a class="link" href="#xm_kvp_config_escapecontrol">EscapeControl</a> is TRUE,
	      the \n, \r, \t, \b (newline, carriage-return, tab, backspace) control characters
	      are also escaped.
	      If this directive is not specified, the default escape character is the backslash
	      character (\).
  	    </p></dd><dt><span class="term"><a name="xm_kvp_config_kvdelimiter"></a>KVDelimiter</span></dt><dd><p>
	      This optional directive takes a single character 
	      (see <a class="link" href="#xm_kvp_config_char" title="Specifying characters for quote, escape and delimiter">below</a>)
	      as argument to specify the
	      delimiter character used to separate the key from the value.
	      If this directive is not specified, the module will try to guess the 
	      delimiter used which can be either a colon (:) or the equal-sign (=).
  	    </p></dd><dt><span class="term"><a name="xm_kvp_config_kvpdelimiter"></a>KVPDelimiter</span></dt><dd><p>
	      This optional directive takes a single character 
	      (see <a class="link" href="#xm_kvp_config_char" title="Specifying characters for quote, escape and delimiter">below</a>)
	      as argument to specify the
	      delimiter character used to separate the key-value pairs.
	      If this directive is not specified, the module will try to guess the 
	      delimiter used which can be either a comma (,) semicolon (;) or the space.
  	    </p></dd><dt><span class="term"><a name="xm_kvp_config_escapecontrol"></a>EscapeControl</span></dt><dd><p>
	      If this optional boolean directive is set to TRUE, control characters
	      are also escaped. 
	      See the <a class="link" href="#xm_kvp_config_escapechar">EscapeChar</a>
	      directive for details.
	      If this directive is not specified, control characters are escaped by default.
	      Note that this is necessary in order to allow single line KVP field lists
	      which contain line-breaks.
  	    </p></dd></dl></div><p>
    </p><div class="section" title="Specifying characters for quote, escape and delimiter"><div class="titlepage"><div><div><h5 class="title"><a name="xm_kvp_config_char"></a>Specifying characters for quote, escape and delimiter</h5></div></div></div><p>
	The <a class="link" href="#xm_kvp_config_valuequotechar">ValueQuoteChar</a>, 
	<a class="link" href="#xm_kvp_config_valuequotechar">KeyQuoteChar</a>, 
	<a class="link" href="#xm_kvp_config_escapechar">EscapeChar</a>,
	<a class="link" href="#xm_kvp_config_kvdelimiter">KVDelimiter</a> and
	<a class="link" href="#xm_kvp_config_kvpdelimiter">KVPDelimiter</a> can be specified in different ways, 
	mainly due to the nature of the config file format.
	As of this writing, the module does not support multi character strings for these parameters.
	</p><div class="variablelist"><dl><dt><span class="term"><a name="xm_kvp_config_char_single"></a>Unquoted single character</span></dt><dd><p>
		Printable characters can be specified as an unquoted character,
		except for the backslash '\'. Example:
		</p><pre class="programlisting">Delimiter ;</pre><p>
	      </p></dd><dt><span class="term"><a name="xm_kvp_config_char_control"></a>Control characters</span></dt><dd><p>
		The following non-printable characters can be specified with escape sequences:
		</p><div class="variablelist"><dl><dt><span class="term">\a</span></dt><dd>
			audible alert (bell)
  		      </dd><dt><span class="term">\b</span></dt><dd>
			backspace
  		      </dd><dt><span class="term">\t</span></dt><dd>
			horizontal tab
  		      </dd><dt><span class="term">\n</span></dt><dd>
			newline
  		      </dd><dt><span class="term">\v</span></dt><dd>
			vertical tab
  		      </dd><dt><span class="term">\f</span></dt><dd>
			formfeed
  		      </dd><dt><span class="term">\r</span></dt><dd>
			carriage return
  		      </dd></dl></div><p>
		To use TAB delimiting:
		</p><pre class="programlisting">KVPDelimiter \t</pre><p>
  	      </p></dd><dt><span class="term"><a name="xm_kvp_config_char_single_quote"></a>A character in single quotes</span></dt><dd><p>
		The config parser strips whitespace, so it is not possible to define space as
		the delimiter unless it is enclosed within quotes:
		</p><pre class="programlisting">KVPDelimiter ' '</pre><p>
		Printable characters can also be enclosed:
		</p><pre class="programlisting">KVPDelimiter ';'</pre><p>
		The backslash can be specified when enclosed within quotes:
		</p><pre class="programlisting">EscapeChar '\'</pre><p>
  	      </p></dd><dt><span class="term"><a name="xm_kvp_config_char_double_quote"></a>A character in double quotes</span></dt><dd><p>
		Double quotes can be used similarly to single quotes:
		</p><pre class="programlisting">KVPDelimiter " "</pre><p>
		The backslash can be specified when enclosed within double quotes:
		</p><pre class="programlisting">EscapeChar "\"</pre><p>
  	      </p></dd></dl></div><p>
	
      </p></div></div><div class="section" title="Functions and procedures exported by xm_kvp"><div class="titlepage"><div><div><h4 class="title"><a name="xm_kvp_funcproc"></a>Functions and procedures exported by xm_kvp</h4></div></div></div><div class="section" title="Functions exported by xm_kvp"><div class="titlepage"><div><div><h5 class="title"><a name="xm_kvp_functions"></a>Functions exported by xm_kvp</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_kvp_func_to_kvp"></a>
       <code class="function">string to_kvp();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Convert the internal fields to a single KVP formatted string.</dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd></dl></div></div><div class="section" title="Procedures exported by xm_kvp"><div class="titlepage"><div><div><h5 class="title"><a name="xm_kvp_procedures"></a>Procedures exported by xm_kvp</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_kvp_proc_parse_kvp"></a>
       <code class="function">parse_kvp();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse the raw_event field as key-value pairs and populate the internal fields using the key names.</dd></dl></div></dd><dt><span class="term">
       <code class="function">parse_kvp(string source);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse the given string key-value pairs and populate the internal fields using the key names.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">source</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_kvp_proc_to_kvp"></a>
       <code class="function">to_kvp();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Format the internal fields as KVP and put this into the 'raw_event' field.</dd></dl></div></dd><dt><span class="term">
       <a name="xm_kvp_proc_reset_kvp"></a>
       <code class="function">reset_kvp();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Reset the kvp parser so that the autodetected KeyQuoteChar, ValueQouteChar, KVDelimiter and KVPDelimiter characters can be detected again.</dd></dl></div></dd></dl></div></div></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="xm_kvp_config_examples"></a>Configuration examples</h4></div></div></div><p>
      The following examples show various use-cases for parsing KVPs either embedded in another
      encapsulating format (e.g. syslog) or simply on their own. 
      To do something with the logs we convert these to JSON , though obviously there are dozens
      of other options. These examples use files for input and output, this can be also changed
      to use UDP syslog or some other protocol.
      </p><div class="example"><a name="xm_kvp_example_simple"></a><p class="title"><b>Exampleï¿½6.6.ï¿½Simple KVP parsing</b></p><div class="example-contents"><p>
	  The following two lines of input illustrate a simple KVP format where
	  each line consists of various keys and values assigned to them.
	  </p><pre class="programlisting">
Name=John, Age=42, Weight=84, Height=142
Name=Mike, Weight=64, Age=24, Pet=dog, Height=172

</pre><p>
	  To process this input we use the following configuration that will ignore lines starting with 
	  a hash (#) and parses others as key value pairs.
	  The parsed fields can be used in nxlog expressions. In this example we insert a new field
	  named $Overweight and set its value to TRUE if the conditions are met.
	  Finally a few automatically added fields are removed and the log is then converted
	  to JSON.
	</p><pre class="programlisting">
&lt;Extension kvp&gt;
    Module       xm_kvp
    KVPDelimiter ,
    KVDelimiter  =
    EscapeChar   \\
&lt;/Extension&gt;

&lt;Extension json&gt;
    Module       xm_json
&lt;/Extension&gt;

&lt;Input in&gt;
    Module       im_file
    File         "modules/extension/kvp/xm_kvp5.in"
    SavePos      FALSE
    ReadFromLast FALSE
    Exec         if $raw_event =~ /^#/ drop(); \
                 else \
                 { \
                   kvp-&gt;parse_kvp(); \
                   delete($EventReceivedTime); \
                   delete($SourceModuleName); \
                   delete($SourceModuleType); \
                   if ( integer($Weight) &gt; integer($Height) - 100 ) $Overweight = TRUE; \
                   to_json();\
                 }
&lt;/Input&gt;

&lt;Output out&gt;
    Module       om_file
    File         'tmp/output'
&lt;/Output&gt;

&lt;Route 1&gt;
    Path         in =&gt; out
&lt;/Route&gt;

</pre><p>
	  The output produced by the above configuration is as follows:
	  </p><pre class="programlisting">
{"Name":"John","Age":"42","Weight":"84","Height":"142","Overweight":true}
{"Name":"Mike","Weight":"64","Age":"24","Pet":"dog","Height":"172"}

</pre><p>
	</p></div></div><p><br class="example-break">

      </p><div class="example"><a name="xm_kvp_example_cisco_acs"></a><p class="title"><b>Exampleï¿½6.7.ï¿½Parsing KVPs in Cisco ACS syslog</b></p><div class="example-contents"><p>
	  The following line is from a Cisco ACS source:
	  </p><pre class="programlisting">
&lt;38&gt;2010-10-12 21:01:29 10.0.1.1 CisACS_02_FailedAuth 1k1fg93nk 1 0 Message-Type=Authen failed,User-Name=John,NAS-IP-Address=10.0.1.2,AAA Server=acs01
&lt;38&gt;2010-10-12 21:01:31 10.0.1.1 CisACS_02_FailedAuth 2k1fg63nk 1 0 Message-Type=Authen failed,User-Name=Foo,NAS-IP-Address=10.0.1.2,AAA Server=acs01

</pre><p>
	  The format is syslog which contains a set of values present in each record such
	  as the category name and an additional set of KVPs.
	  The following configuration can be used to process this and convert it to JSON:
	</p><pre class="programlisting">
&lt;Extension json&gt;
    Module      xm_json
&lt;/Extension&gt;

&lt;Extension syslog&gt;
    Module      xm_syslog
&lt;/Extension&gt;

&lt;Extension kvp&gt;
    Module      xm_kvp
    KVDelimiter =
    KVPDelimiter ,
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file
    SavePos     FALSE
    ReadFromLast FALSE
    File        "modules/extension/kvp/cisco_acs.in"
    Exec	parse_syslog_bsd();
    Exec	if ( $Message =~ /^CisACS_(\d\d)_(\S+) (\S+) (\d+) (\d+) (.*)$/ ) \
                { \
                   $ACSCategoryNumber = $1; \
                   $ACSCategoryName = $2; \
                   $ACSMessageId = $3; \
                   $ACSTotalSegments = $4; \
                   $ACSSegmentNumber = $5; \
                   $Message = $6; \
                   kvp-&gt;parse_kvp($Message); \
                } \
                else log_warning("does not match: " + to_json());   
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"tmp/output"
    Exec	delete($EventReceivedTime);
    Exec	to_json();
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;

</pre><p>
	  The converted JSON result is shown below:
	  </p><pre class="programlisting">
{"SourceModuleName":"in","SourceModuleType":"im_file","SyslogFacilityValue":4,"SyslogFacility":"AUTH","SyslogSeverityValue":6,"SyslogSeverity":"INFO","SeverityValue":2,"Severity":"INFO","Hostname":"10.0.1.1","EventTime":"2010-10-12 21:01:29","Message":"Message-Type=Authen failed,User-Name=John,NAS-IP-Address=10.0.1.2,AAA Server=acs01","ACSCategoryNumber":"02","ACSCategoryName":"FailedAuth","ACSMessageId":"1k1fg93nk","ACSTotalSegments":"1","ACSSegmentNumber":"0","Message-Type":"Authen failed","User-Name":"John","NAS-IP-Address":"10.0.1.2","AAA Server":"acs01"}
{"SourceModuleName":"in","SourceModuleType":"im_file","SyslogFacilityValue":4,"SyslogFacility":"AUTH","SyslogSeverityValue":6,"SyslogSeverity":"INFO","SeverityValue":2,"Severity":"INFO","Hostname":"10.0.1.1","EventTime":"2010-10-12 21:01:31","Message":"Message-Type=Authen failed,User-Name=Foo,NAS-IP-Address=10.0.1.2,AAA Server=acs01","ACSCategoryNumber":"02","ACSCategoryName":"FailedAuth","ACSMessageId":"2k1fg63nk","ACSTotalSegments":"1","ACSSegmentNumber":"0","Message-Type":"Authen failed","User-Name":"Foo","NAS-IP-Address":"10.0.1.2","AAA Server":"acs01"}

</pre><p>
	</p></div></div><p><br class="example-break">

      </p><div class="example"><a name="xm_kvp_example_sidewinder"></a><p class="title"><b>Exampleï¿½6.8.ï¿½Parsing KVPs in Sidewinder logs</b></p><div class="example-contents"><p>
	  The following line is from a Sidewinder log source:
	  </p><pre class="programlisting">
date="May 5 14:34:40 2009 MDT",fac=f_mail_filter,area=a_kmvfilter,type=t_mimevirus_reject,pri=p_major,pid=10174,ruid=0,euid=0,pgid=10174,logid=0,cmd=kmvfilter,domain=MMF1,edomain=MMF1,message_id=(null),srcip=66.74.184.9,mail_sender=&lt;habuzeid6@&#8230;&gt;,virus_name=W32/Netsky.c@MM!zip,reason="Message scan detected a Virus in msg Unknown, message being Discarded, and not quarantined"

</pre><p>
	  This can be parsed and converted to JSON with the following configuration:
	</p><pre class="programlisting">
&lt;Extension kvp&gt;
    Module	xm_kvp
    KVPDelimiter ,
    KVDelimiter =
    EscapeChar \\
    ValueQouteChar "
&lt;/Extension&gt;

&lt;Extension json&gt;
    Module	xm_json
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file
    File	"modules/extension/kvp/sidewinder.in"
    SavePos	FALSE
    ReadFromLast FALSE
    Exec	kvp-&gt;parse_kvp(); delete($EventReceivedTime); to_json();
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	'tmp/output'
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;

</pre><p>
	  The converted JSON result is shown below:
	  </p><pre class="programlisting">
{"SourceModuleName":"in","SourceModuleType":"im_file","date":"May 5 14:34:40 2009 MDT","fac":"f_mail_filter","area":"a_kmvfilter","type":"t_mimevirus_reject","pri":"p_major","pid":"10174","ruid":"0","euid":"0","pgid":"10174","logid":"0","cmd":"kmvfilter","domain":"MMF1","edomain":"MMF1","message_id":"(null)","srcip":"66.74.184.9","mail_sender":"&lt;habuzeid6@&#8230;&gt;","virus_name":"W32/Netsky.c@MM!zip","reason":"Message scan detected a Virus in msg Unknown, message being Discarded, and not quarantined"}

</pre><p>
	</p></div></div><p><br class="example-break">

      </p><div class="example"><a name="xm_kvp_example_apache_url"></a><p class="title"><b>Exampleï¿½6.9.ï¿½Parsing URL request parameters in Apache access logs</b></p><div class="example-contents"><p>
	  URLs in HTTP requests frequently contain URL parameters which are a special kind of key-value
	  pairs delimited by the ampersand (&amp;).
	  Here is an example of two HTTP requests logged by the Apache web server in the
	  Combined Log Format:
	  </p><pre class="programlisting">
192.168.1.1 - foo [11/Jun/2013:15:44:34 +0200] "GET /do?action=view&amp;obj_id=2 HTTP/1.1" 200 1514 "https://localhost" "Mozilla/5.0 (X11; Linux x86_64; rv:17.0) Gecko/17.0 Firefox/17.0"
192.168.1.1 - - [11/Jun/2013:15:44:44 +0200] "GET /do?action=delete&amp;obj_id=42 HTTP/1.1" 401 788 "https://localhost" "Mozilla/5.0 (X11; Linux x86_64; rv:17.0) Gecko/17.0 Firefox/17.0"

</pre><p>
	  The following configuration file parses the access log and extracts all the fields.
	  In this case the request parameters are extracted into the 
	  <em class="replaceable"><code>HTTPParams</code></em> field using a regular expression. This field is then
	  further parsed using the KVP parser.
	  At the end of the processing all fields are converted to the KVP format using the 
	  <a class="link" href="#xm_kvp_proc_to_kvp">to_kvp()</a> procedure of the 
	  <em class="replaceable"><code>kvp2</code></em> instance.
	</p><pre class="programlisting">
&lt;Extension kvp&gt;
    Module	xm_kvp
    KVPDelimiter &amp;
    KVDelimiter =
&lt;/Extension&gt;

&lt;Extension kvp2&gt;
    Module	xm_kvp
    KVPDelimiter ;
    KVDelimiter =
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file
    File	"modules/extension/kvp/apache_url.in"
    SavePos	FALSE
    ReadFromLast FALSE
    Exec    if $raw_event =~ /^(\S+) (\S+) (\S+) \[([^\]]+)\] \"(\S+) (.+) HTTP.\d\.\d\" (\d+) (\d+) \"([^\"]+)\" \"([^\"]+)\"/\
                { \
                  $Hostname = $1; \
                  if $3 != '-' $AccountName = $3; \
                  $EventTime = parsedate($4); \
                  $HTTPMethod = $5; \
                  $HTTPURL = $6; \
                  $HTTPResponseStatus = $7; \
                  $FileSize = $8; \
                  $HTTPReferer = $9; \
                  $HTTPUserAgent = $10; \
                  if $HTTPURL =~ /\?(.+)/ { $HTTPParams = $1; } \
                  kvp-&gt;parse_kvp($HTTPParams); \
                  delete($EventReceivedTime); \
                  kvp2-&gt;to_kvp(); \
                }
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	'tmp/output'
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;

</pre><p>
	  The two request parameters <em class="replaceable"><code>action</code></em> and <em class="replaceable"><code>obj_id</code></em>
	  then appear at the end of the KVP formated lines.
	  </p><pre class="programlisting">
SourceModuleName=in;SourceModuleType=im_file;Hostname=192.168.1.1;AccountName=foo;EventTime=2013-06-11 15:44:34;HTTPMethod=GET;HTTPURL=/do?action=view&amp;obj_id=2;HTTPResponseStatus=200;FileSize=1514;HTTPReferer=https://localhost;HTTPUserAgent='Mozilla/5.0 (X11; Linux x86_64; rv:17.0) Gecko/17.0 Firefox/17.0';HTTPParams=action=view&amp;obj_id=2;action=view;obj_id=2;
SourceModuleName=in;SourceModuleType=im_file;Hostname=192.168.1.1;EventTime=2013-06-11 15:44:44;HTTPMethod=GET;HTTPURL=/do?action=delete&amp;obj_id=42;HTTPResponseStatus=401;FileSize=788;HTTPReferer=https://localhost;HTTPUserAgent='Mozilla/5.0 (X11; Linux x86_64; rv:17.0) Gecko/17.0 Firefox/17.0';HTTPParams=action=delete&amp;obj_id=42;action=delete;obj_id=42;

</pre><p>
	  Note that url escaping is not handled.
	</p></div></div><p><br class="example-break">


    </p></div></div><div class="section" title="GELF (xm_gelf)"><div class="titlepage"><div><div><h3 class="title"><a name="xm_gelf"></a>GELF (xm_gelf)</h3></div></div></div><p>
    This module provides an output writer function which can be used to generate output 
    in Graylog Extended Log Format (GELF) and feed that into 
    <a class="ulink" href="http://graylog2.org" target="_top">Graylog2</a> or GELF compliant tools.
  </p><p>
    The advantage of using this module over syslog (e.g. Snare Agent and others) is that the GELF
    format contains structured data in JSON and makes the fields available for analysis. This
    is especially convenient with sources such as the Windows EventLog which already generate
    logs in a structured format.
  </p><p>
    The <a class="ulink" href="https://www.graylog2.org/resources/gelf" target="_top">GELF</a>
    output generated by this module includes all fields, except the following:
    </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
	The 'raw_event' field.
      </td></tr><tr><td>
	Fields starting with a leading dot (.).
      </td></tr><tr><td>
	Fields starting with a leading underscore (_).
      </td></tr></table><p>
    In order to make nxlog output GELF formatted data, the following needs to be done:

    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
	  Make sure the xm_gelf module is loaded:
	  </p><pre class="programlisting">
&lt;Extension gelf&gt;
    Module       xm_gelf
&lt;/Extension&gt;
</pre><p>
	</p></li><li class="listitem"><p>
          Set the <a class="link" href="#config_outputtype" title="OutputType">OutputType</a> to <em class="replaceable"><code>GELF_UDP</code></em> in your 
	  <a class="link" href="#om_udp" title="UDP (om_udp)">om_udp</a> output module:
	  </p><pre class="programlisting">
&lt;Output out&gt;
    Module      om_udp
    Host        127.0.0.1
    Port        12201
    OutputType  GELF_UDP
&lt;/Output&gt;
</pre><p>
	  
	  For <a class="link" href="#om_tcp" title="TCP (om_tcp)">om_tcp</a> make sure to use <em class="replaceable"><code>GELF_TCP</code></em>:
	  </p><pre class="programlisting">
&lt;Output out&gt;
    Module      om_tcp
    Host        127.0.0.1
    Port        12201
    OutputType  GELF_TCP
&lt;/Output&gt;
</pre><p>
	</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    For compatibility reasons <em class="replaceable"><code>GELF</code></em> is still valid and is equivalent to <em class="replaceable"><code>GELF_UDP</code></em>.
	  </p></div></li></ol></div><p>
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="xm_gelf_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the xm_kvp module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="xm_gelf_config_shortmessagelength"></a>ShortMessageLength</span></dt><dd><p>
	      This optional directive can be used to specify the length of the <em class="replaceable"><code>short_message</code></em>
	      field.
	      This defaults to 64 if the directive is not explicitly specified.
	      If the field <em class="replaceable"><code>short_message</code></em> or <em class="replaceable"><code>ShortMessage</code></em> is 
	      present, it will not be truncated.
  	    </p></dd><dt><span class="term"><a name="xm_gelf_config_usenulldelimiter"></a>UseNullDelimiter</span></dt><dd><p>
	      This optional boolean directive can be used to specify whether to use newline or NUL delimiter for 
	      <em class="replaceable"><code>GELF_TCP</code></em>.
	      This defaults to TRUE if not specified.
  	    </p></dd></dl></div><p>
    </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="xm_gelf_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="xm_gelf_example1"></a><p class="title"><b>Exampleï¿½6.10.ï¿½Sending Windows EventLog to Graylog2 in GELF</b></p><div class="example-contents"><p>
	  The following configuration reads the Windows EventLog and sends it to the
	  Graylog2 server in GELF format.
	</p><pre class="programlisting">
&lt;Extension gelf&gt;
    Module      xm_gelf
&lt;/Extension&gt;

&lt;Input in&gt;
    # Use 'im_mseventlog' for Windows XP, 2000 and 2003
    Module      im_msvistalog
# Uncomment the following to collect specific event logs only
#    Query       &lt;QueryList&gt;\
#                    &lt;Query Id="0"&gt;\
#                        &lt;Select Path="Application"&gt;*&lt;/Select&gt;\
#                        &lt;Select Path="System"&gt;*&lt;/Select&gt;\
#                        &lt;Select Path="Security"&gt;*&lt;/Select&gt;\
#                    &lt;/Query&gt;\
#                &lt;/QueryList&gt;
&lt;/Input&gt;

&lt;Output out&gt;
    Module      om_udp
    Host        192.168.1.1
    Port        12201
    OutputType  GELF
&lt;/Output&gt;

&lt;Route r&gt;
    Path        in =&gt; out
&lt;/Route&gt;

</pre></div></div><p><br class="example-break"> 
      </p><div class="example"><a name="xm_gelf_example_file"></a><p class="title"><b>Exampleï¿½6.11.ï¿½Forwarding custom log files to Graylog2 in GELF</b></p><div class="example-contents"><p>
	  You may want to collect custom application logs and send it out in the GELF format. See the following example about
	  setting the common and custom fields to make the data more useful for the other end.
	</p><pre class="programlisting">
&lt;Extension gelf&gt;
    Module	xm_gelf
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file
    File	"/var/log/app*.log"

    &lt;Exec&gt;
        # Set the $EventTime field usually found in the logs by extracting it with a regexp.
        # If this is not set, the current system time will be used which might be a little off.
        if $raw_event =~ /(\d\d\d\d\-\d\d-\d\d \d\d:\d\d:\d\d)/ $EventTime = parsedate($1);

        # Explicitly set the Hostname. This defaults to the system's hostname if unset.
        $Hostname = 'myhost';

        # Now set the severity level to something custom. This defaults to 'INFO' if unset.
        # We can use the following numeric values here which are the standard syslog values:
        # ALERT: 1, CRITICAL: 2, ERROR: 3, WARNING: 4, NOTICE: 5, INFO: 6, console.log: 7
        if $raw_event =~ /ERROR/ $SyslogSeverityValue = 3;
        else $SyslogSeverityValue = 6;

        # Set a field to contain the name of the source file
        $FileName = file_name();

        # To set a custom message, use the $Message field. The $raw_event field is used if $Message is unset.
        if $raw_event =~ /something important/ $Message = 'IMPORTANT!! ' + $raw_event;
    &lt;/Exec&gt;
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_udp
    Host	192.168.1.1
    Port	12201
    OutputType	GELF
&lt;/Output&gt;

&lt;Route r&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">

      </p><div class="example"><a name="xm_gelf_example_csv"></a><p class="title"><b>Exampleï¿½6.12.ï¿½Parsing a CSV file and sending it to Graylog2 in GELF</b></p><div class="example-contents"><p>
	  Using the following config file nxlog will read a CSV file containing 3 fields and
	  forwards it in GELF so that the fields will be available on the server.
	</p><pre class="programlisting">
&lt;Extension gelf&gt;
    Module	xm_gelf
&lt;/Extension&gt;

&lt;Extension csv&gt;
    Module	xm_csv
    Fields      $name, $number, $location
    FieldTypes  string, integer, string
    Delimiter   ,
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file
    File	"/var/log/app/csv.log"
    Exec        csv-&gt;parse_csv();
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_udp
    Host	192.168.1.1
    Port	12201
    OutputType	GELF
&lt;/Output&gt;

&lt;Route r&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">

    </p></div></div><div class="section" title="Character set conversion (xm_charconv)"><div class="titlepage"><div><div><h3 class="title"><a name="xm_charconv"></a>Character set conversion (xm_charconv)</h3></div></div></div><p>
    This module provides functions and procedures to convert strings between different 
    character sets (codepages).
    Reasons for the existence of this module are outlined in the
    <a class="link" href="#features_i18n" title="Character set and i18n support">Character set and i18n support</a> section.
  </p><p>
    The <a class="link" href="#xm_charconv_proc_convert_fields">convert_fields()</a> procedure
    and the <a class="link" href="#xm_charconv_func_convert">convert()</a> function supports
    all encodings available to iconv.
    See <span class="command"><strong>iconv -l</strong></span> for a list of encoding names.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="xm_charconv_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the xm_charconv module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="xm_charconv_config_autodetectcharsets"></a>AutodetectCharsets</span></dt><dd><p>
	      This optional directive takes a comma separated list of character set names.
	      When 'auto' is specified as the source encoding for convert() or convert_fields(),
	      these charsets will be tried for conversion.
  	    </p></dd></dl></div><p>
    </p></div><div class="section" title="Functions and procedures exported by xm_charconv"><div class="titlepage"><div><div><h4 class="title"><a name="xm_charconv_funcproc"></a>Functions and procedures exported by xm_charconv</h4></div></div></div><div class="section" title="Functions exported by xm_charconv"><div class="titlepage"><div><div><h5 class="title"><a name="xm_charconv_functions"></a>Functions exported by xm_charconv</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_charconv_func_convert"></a>
       <code class="function">string convert(string source, string srcencoding, string dstencoding);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       This function converts the source string to the encoding specified in 'dstencoding' from
       'srcencoding'. 'srcencoding' can be 'auto' to request auto detection.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">source</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">srcencoding</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">dstencoding</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd></dl></div></div><div class="section" title="Procedures exported by xm_charconv"><div class="titlepage"><div><div><h5 class="title"><a name="xm_charconv_procedures"></a>Procedures exported by xm_charconv</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_charconv_proc_convert_fields"></a>
       <code class="function">convert_fields(string srcencoding, string dstencoding);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Convert all string type fields of a log message from 'srcencoding' to 'dstencoding'.
       'srcencoding' can be "auto" to request auto detection.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">srcencoding</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">dstencoding</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd></dl></div></div></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="xm_charconv_config_examples"></a>Configuration examples</h4></div></div></div><p>
      This configuration shows an example of character set autodetection. The input file can
      contain differently encoded lines and using autodetection the module normalizes output
      to utf-8.
      </p><div class="example"><a name="xm_charconv_example"></a><p class="title"><b>Exampleï¿½6.13.ï¿½Character set autodetection of various input encodings</b></p><div class="example-contents"><p>
	</p><pre class="programlisting">
&lt;Extension charconv&gt;
    Module      xm_charconv
    AutodetectCharsets utf-8, euc-jp, utf-16, utf-32, iso8859-2
&lt;/Extension&gt;

&lt;Input filein&gt;
    Module	im_file
    File	"tmp/input"
    Exec	convert_fields("AUTO", "utf-8");
&lt;/Input&gt;

&lt;Output fileout&gt;
    Module	om_file
    File	"tmp/output"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	filein =&gt; fileout
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="File operations (xm_fileop)"><div class="titlepage"><div><div><h3 class="title"><a name="xm_fileop"></a>File operations (xm_fileop)</h3></div></div></div><p>
    This module provides functions and procedures to manipulate files. Coupled with a
    <a class="link" href="#config_module_schedule" title="Schedule">Schedule</a> block, this allows to implement
    various log rotation and retention policies, e.g.:
    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
	  log file retention based on file size,
	</p></li><li class="listitem"><p>
	  log file retention based on file age,
	</p></li><li class="listitem"><p>
	  cyclic log file rotation and retention.
	</p></li></ul></div><p>

    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	Rotating, renaming or removing the file written by <a class="link" href="#om_file" title="File (om_file)">om_file</a>
	is also supported with the help of the <a class="link" href="#om_file_proc_reopen">reopen</a>
	procedure.
      </p></div><p>
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="xm_fileop_config"></a>Configuration</h4></div></div></div><p>
      The module does not have any module specific configuration directives.
    </p></div><div class="section" title="Functions and procedures exported by xm_fileop"><div class="titlepage"><div><div><h4 class="title"><a name="xm_fileop_funcproc"></a>Functions and procedures exported by xm_fileop</h4></div></div></div><div class="section" title="Functions exported by xm_fileop"><div class="titlepage"><div><div><h5 class="title"><a name="xm_fileop_functions"></a>Functions exported by xm_fileop</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_fileop_func_file_read"></a>
       <code class="function">string file_read(string file);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Return the contents of the file as a string value.
       On error undef is returned and an error is logged.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_func_file_exists"></a>
       <code class="function">boolean file_exists(string file);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Return TRUE if the file exists and is a regular file.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_boolean">boolean</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_func_file_basename"></a>
       <code class="function">string file_basename(string file);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Strip the directory name from the full file path. 
       basename('/var/log/app.log') will return 'app.log'.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_func_file_dirname"></a>
       <code class="function">string file_dirname(string file);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Return the directory name of the full file path. 
       basename('/var/log/app.log') will return '/var/log'.
       Returns an empty string if 'file' does not contain any directory separators.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_func_file_mtime"></a>
       <code class="function">datetime file_mtime(string file);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Return the last modification time of the file.
       On error undef is returned and an error is logged.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_datetime">datetime</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_func_file_ctime"></a>
       <code class="function">datetime file_ctime(string file);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Return the creation or inode-changed time of the file.
       On error undef is returned and an error is logged.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_datetime">datetime</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_func_file_type"></a>
       <code class="function">string file_type(string file);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Return the type of the file. The following string values can be returned:
       FILE, DIR, CHAR, BLOCK, PIPE, LINK, SOCKET, UNKNOWN.
       On error undef is returned and an error is logged.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_func_file_size"></a>
       <code class="function">integer file_size(string file);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Return the size of the file.
       On error undef is returned and an error is logged.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_func_file_inode"></a>
       <code class="function">integer file_inode(string file);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Return the inode number of the file.
       On error undef is returned and an error is logged.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_func_dir_temp_get"></a>
       <code class="function">string dir_temp_get();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Return the name of a directory suitable as a temporary storage location.
     </dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_func_dir_exists"></a>
       <code class="function">boolean dir_exists(string path);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Return TRUE if the 'path' exists and is a directory.
       On error undef is returned and an error is logged.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">path</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_boolean">boolean</a>
           </dd></dl></div></dd></dl></div></div><div class="section" title="Procedures exported by xm_fileop"><div class="titlepage"><div><div><h5 class="title"><a name="xm_fileop_procedures"></a>Procedures exported by xm_fileop</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_fileop_proc_file_cycle"></a>
       <code class="function">file_cycle(string file);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Do a cyclic rotation on 'file'. 'file' will be moved to "'file'.1". If 
       "'file'.1" already exists it will be moved to "'file'.2" and so on.
       This procedure will reopen the LogFile if this is cycled.
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <code class="function">file_cycle(string file, integer max);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Do a cyclic rotation on 'file'. 'file' will be moved to "'file'.1". If 
       "'file'.1" already exists it will be moved to "'file'.2" and so on.
       'max' specifies the maximum number of files to keep. E.g. if 'max' is 5, "'file'.6" 
       will be deleted.
       This procedure will reopen the LogFile if this is cycled.
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">max</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_proc_file_rename"></a>
       <code class="function">file_rename(string old, string new);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Rename the file 'old' to 'new'. If the file 'new' exists, it will be overwritten.
       Moving files or directories across devices may not be possible.
       This procedure will reopen the LogFile if this is renamed.
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">old</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">new</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_proc_file_copy"></a>
       <code class="function">file_copy(string src, string dst);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Copy the file 'src' to 'dst'. 
       If file 'dst' already exists, its contents will be overwritten. 
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">src</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">dst</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_proc_file_remove"></a>
       <code class="function">file_remove(string file);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Remove the file 'file'. It is possible to specify a wildcard in filenames 
       (but not in the path). If you use backslash as the directory separator with wildcards,
       make sure to escape this (e.g. 'C:\\test\\*.log').
       This procedure will reopen the LogFile if this is removed.
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <code class="function">file_remove(string file, datetime older);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Remove the file 'file' if its creation time is older than the value specified in 'older'.
       It is possible to specify a wildcard in filenames (but not in the path).
       If you use backslash as the directory separator with wildcards,
       make sure to escape this (e.g. 'C:\\test\\*.log').
       This procedure will reopen the LogFile if this is removed.
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">older</span></dt><dd>
                type: <a class="link" href="#lang_type_datetime">datetime</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_proc_file_link"></a>
       <code class="function">file_link(string src, string dst);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Create a hardlink from 'src' to 'dst'.
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">src</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">dst</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_proc_file_append"></a>
       <code class="function">file_append(string src, string dst);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Append the contents of the file 'src' to 'dst'. 'dst' will be created if it does
       not exist.
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">src</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">dst</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_proc_file_write"></a>
       <code class="function">file_write(string file, string value);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Write value into 'file'. 'file' will be created if it does not exist.
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">value</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_proc_file_truncate"></a>
       <code class="function">file_truncate(string file);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Truncate the file to zero length. If 'file' does not exist, it will be created.
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <code class="function">file_truncate(string file, integer offset);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Truncate the file to the size specified in 'offset'. If 'file' does not exist, it will be created.
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">offset</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_proc_file_chown"></a>
       <code class="function">file_chown(string file, integer uid, integer gid);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Change file ownership. This function is only implemented on POSIX systems where chown() is 
       available in the underlying OS.
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">uid</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd><dt><span class="term">gid</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <code class="function">file_chown(string file, string user, string group);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Change file ownership. This function is only implemented on POSIX systems where chown() is 
       available in the underlying OS.
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">user</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">group</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_proc_file_chmod"></a>
       <code class="function">file_chmod(string file, integer mode);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Change file permission. This function is only implemented on POSIX systems where chmod() is 
       available in the underlying OS.
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">mode</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_proc_file_touch"></a>
       <code class="function">file_touch(string file);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Update the last modification time of 'file' or create it if 'file' does not exist.
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_proc_dir_make"></a>
       <code class="function">dir_make(string path);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Create a directory recursively (i.e. as 'mkdir -p').
       It succeeds if the directory already exists.
       An error is logged if the operation fails.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">path</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_fileop_proc_dir_remove"></a>
       <code class="function">dir_remove(string file);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Remove the directory from the filesystem.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd></dl></div></div></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="xm_fileop_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="xm_fileop_example1"></a><p class="title"><b>Exampleï¿½6.14.ï¿½Rotation of the internal LogFile</b></p><div class="example-contents"><p>
	  This example shows how to rotate the internal logfile based on time and size.
	</p><pre class="programlisting">
#define LOGFILE C:\Program Files\nxlog\data\nxlog.log
define LOGFILE /var/log/nxlog/nxlog.log

&lt;Extension fileop&gt;
    Module      xm_fileop

    # Check the size of our log file every hour and rotate if it is larger than 1Mb
    &lt;Schedule&gt;
        Every   1 hour
        Exec    if (file_size('%LOGFILE%') &gt;= 1M) file_cycle('%LOGFILE%', 2);
    &lt;/Schedule&gt;

    # Rotate our log file every week on sunday at midnight
    &lt;Schedule&gt;
        When    @weekly
        Exec    file_cycle('%LOGFILE%', 2);
    &lt;/Schedule&gt;
&lt;/Extension&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="Multi-line message parser (xm_multiline)"><div class="titlepage"><div><div><h3 class="title"><a name="xm_multiline"></a>Multi-line message parser (xm_multiline)</h3></div></div></div><p>
    Multi-line messages such as exception logs and stack traces are quite common in logs.
    Unfortunately when the log messages are stored in files or forwarded over the network
    without any encapsulation, the newline character present in messages spanning multiple lines
    confuse simple linebased parsers which treat every line as a separate event.
  </p><p>
    Multi-line events have one or more of the following properties:
    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
	  The first line has a header (e.g. timestamp + severity).
	</p></li><li class="listitem"><p>
	  The first line has a header and there is closing character sequence marking the end.
	</p></li><li class="listitem"><p>
	  The line count in the message can be variable (one or more) or the message can
	  have a fixed line count.
	</p></li></ul></div><p>
    
    This information allows the message to be reconstructed, i.e. lines to be concatenated which
    belong to a single event. This is how the xm_multiline module can join together multiple
    lines into a single message.
  </p><p>
    The name of the xm_multiline module instance can be used by input modules as the input
    reader specified with the <a class="link" href="#config_inputtype" title="InputType">InputType</a> directive.
    For each input source a separate context is maintained by the module so that multi-line 
    messages coming from several simultaneous sources can be still correctly processed.
    An input source is a file for <a class="link" href="#im_file" title="File (im_file)">im_file</a> (with wildcards it is
    one source for each file), a connection for <a class="link" href="#im_ssl" title="TLS/SSL (im_ssl)">im_ssl</a> and
    <a class="link" href="#im_tcp" title="TCP (im_tcp)">im_tcp</a>.
    Unfortunately <a class="link" href="#im_udp" title="UDP (im_udp)">im_udp</a> uses a single socket and is treated
    as a single source even if multiple UDP (e.g. syslog) senders are forwarding logs to it.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      By using <a class="link" href="#processing_multiline_module_vars" title="Using module variables">module variables</a> it is possible
      to accomplish the same what this module does. 
      The advantages of using this module over module variables are the following:
      </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
	    Processes messages more efficiently.
	  </p></li><li class="listitem"><p>
	    It yields a more readable configuration.
	  </p></li><li class="listitem"><p>
	    Module event counters are correctly updated (i.e. one increment for one multi-line
	    message and not per line).
	  </p></li><li class="listitem"><p>
	    It works on message source level (each file for a wildcarded im_file module instance
	    and each tcp connection for an im_tcp/im_ssl instance) and not on module instance level.
	  </p></li></ul></div><p>
    </p></div><p>
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="xm_multiline_config"></a>Configuration</h4></div></div></div><p>
      The following directives can be used to configure the xm_multiline module instance:
      </p><div class="variablelist"><dl><dt><span class="term"><a name="xm_multiline_config_headerline"></a>HeaderLine</span></dt><dd><p>
	      This directive takes a <a class="link" href="#lang_literal_string">string</a>
	      or a <a class="link" href="#lang_literal_regexp">regular expression</a> literal.
	      This will be matched against each line. When the match is successful, the
	      successive lines are appended until the next header line is read.
	      This directive is mandatory unless
	      <a class="link" href="#xm_multiline_config_fixedlinecount">FixedLineCount</a> is used.
	    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
		Until there is a new header read, the previous message is stored in the buffers
		because the module does not know where the message ends. The 
		<a class="link" href="#im_file" title="File (im_file)">im_file</a> module will forcibly flush this buffer 
		after the configured <a class="link" href="#im_file_config_pollinterval">PollInterval</a> 
		timeout.
		If this behaviour is unacceptable, consider using some kind of an encapsulation
		method (JSON, XML, RFC5425, etc) or use an end marker with 
		<a class="link" href="#xm_multiline_config_headerline">EndLine</a> if possible.
	      </p></div></dd><dt><span class="term"><a name="xm_multiline_config_endline"></a>EndLine</span></dt><dd><p>
	      This is similar to the <a class="link" href="#xm_multiline_config_headerline">HeaderLine</a>
	      directive.  This optional directive also takes a 
	      <a class="link" href="#lang_literal_string">string</a>
	      or a <a class="link" href="#lang_literal_regexp">regular expression</a> literal to be
	      matched against each line. When the match is successful the message
	      is considered complete and is emitted.
	    </p></dd><dt><span class="term"><a name="xm_multiline_config_fixedlinecount"></a>FixedLineCount</span></dt><dd><p>
	      This directive takes a positive integer number defining the number of lines to
	      concatenate.
	      This is mostly useful with log messages spanning a fixed number of lines. When
	      this number is defined, the module knows where the event message ends, thus it
	      does not suffer from the problem described above.
	    </p></dd><dt><span class="term"><a name="xm_multiline_config_exec"></a>Exec</span></dt><dd><p>
	      This directive is almost identical to the behavior of the 
	      <a class="link" href="#config_module_exec" title="Exec">Exec</a> directive used by the other
	      modules with the following differences:
	      </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
		    Each line is passed in $raw_event as it is read. The line includes
		    the line terminator.
		  </p></li><li class="listitem"><p>
		    Other fields cannot be used. If you want to store captured strings from
		    regular expression based matching in fields, you cannot do it here.
		  </p></li></ul></div><p>
	      This is mostly useful for filtering out some lines with the
	      <a class="link" href="#core_proc_drop">drop()</a> procedure or rewriting them.
	    </p></dd></dl></div><p>
    </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="xm_multiline_config_examples"></a>Configuration examples</h4></div></div></div><div class="example"><a name="xm_multiline_example_5"></a><p class="title"><b>Exampleï¿½6.15.ï¿½Parsing multi-line XML logs and converting to JSON</b></p><div class="example-contents"><p>
	  XML is commonly formatted as indented multi-line to make it more readable. 
	  In the following configuration file we use the 
	  <a class="link" href="#xm_multiline_config_headerline">HeaderLine</a> together with the 
	  <a class="link" href="#xm_multiline_config_headerline">HeaderLine</a> directive to parse the events which are
	  converted to JSON after some slight normalization.
          </p><pre class="programlisting">
&lt;Extension multiline&gt;
    Module	xm_multiline
    HeaderLine	/^&lt;event&gt;/
    EndLine	/^&lt;/event&gt;/
&lt;/Extension&gt;

&lt;Extension xmlparser&gt;
    Module	xm_xml
&lt;/Extension&gt;

&lt;Extension json&gt;
    Module	xm_json
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file
    File	"modules/extension/multiline/xm_multiline5.in"
    SavePos	FALSE
    ReadFromLast FALSE
    InputType	multiline
    &lt;Exec&gt;
      # Discard everything that doesn't seem to be an xml event   
      if $raw_event !~ /^&lt;event&gt;/ drop();

      # Parse the xml event
      parse_xml();

      # Rewrite some fields 
      $EventTime = parsedate($timestamp);
      delete($timestamp);
      delete($EventReceivedTime);

      # Convert to JSON
      to_json();
    &lt;/Exec&gt;
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	'tmp/output'
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;

</pre><p>
	  An input sample:
          </p><pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8"&gt;
&lt;event&gt;
  &lt;timestamp&gt;2012-11-23 23:00:00&lt;/timestamp&gt;
  &lt;severity&gt;ERROR&lt;/severity&gt;
  &lt;message&gt;
    Something bad happened.
    Please check the system.
  &lt;/message&gt;
&lt;/event&gt;
&lt;event&gt;
  &lt;timestamp&gt;2012-11-23 23:00:12&lt;/timestamp&gt;
  &lt;severity&gt;INFO&lt;/severity&gt;
  &lt;message&gt;
   System state is now back to normal.
  &lt;/message&gt;
&lt;/event&gt;

</pre><p>
	  The following output is produced:
          </p><pre class="programlisting">
{"SourceModuleName":"in","SourceModuleType":"im_file","severity":"ERROR","message":"\n    Something bad happened.\n    Please check the system.\n  ","EventTime":"2012-11-23 23:00:00"}
{"SourceModuleName":"in","SourceModuleType":"im_file","severity":"INFO","message":"\n   System state is now back to normal.\n  ","EventTime":"2012-11-23 23:00:12"}

</pre><p>
        </p></div></div><br class="example-break"><div class="example"><a name="xm_multiline_example_4"></a><p class="title"><b>Exampleï¿½6.16.ï¿½Parsing DICOM logs</b></p><div class="example-contents"><p>
	  Each log message has a header (TIMESTAMP INTEGER SEVERITY) which
	  is used as the message boundary. A regular expression is defined for this using the
	  <a class="link" href="#xm_multiline_config_headerline">HeaderLine</a> directive.
	  Each log message is prepended with an additional line containing dashes and is
	  output into a file.
          </p><pre class="programlisting">
&lt;Extension dicom-multi&gt;
    Module	xm_multiline
    HeaderLine	/^\d\d\d\d-\d\d-\d\d\d\d:\d\d:\d\d\.\d+\s+\d+\s+\S+\s+/
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file
    File	"modules/extension/multiline/xm_multiline4.in"
    SavePos	FALSE
    ReadFromLast FALSE
    InputType	dicom-multi
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	'tmp/output'
    Exec	$raw_event = "--------------------------------------\n" + $raw_event;
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;

</pre><p>
	  An input sample:
          </p><pre class="programlisting">
2011-12-1512:22:51.000000  4296   INFO   Association Request Parameteres:
Our Implementation Class UID:    2.16.124.113543.6021.2
Our Implementation Version Name: RZDCX_2_0_1_8
Their Implementation Class UID:   
Their Implementation Version Name:
Application Context Name:    1.2.840.10008.3.1.1.1
Requested Extended Negotiation: none
Accepted Extended Negotiation: none
2011-12-1512:22:51.000000  4296   console.log  Constructing Associate RQ PDU
2011-12-1512:22:51.000000  4296   console.log  WriteToConnection, length: 310, bytes written: 310, loop no: 1
2011-12-1512:22:51.015000  4296   console.log  PDU Type: Associate Accept, PDU Length: 216 + 6 bytes PDU header
  02  00  00  00  00  d8  00  01  00  00  50  41  43  53  20  20
  20  20  20  20  20  20  20  20  20  20  52  5a  44  43  58  20
  20  20  20  20  20  20  20  20  20  20  00  00  00  00  00  00
2011-12-1512:22:51.031000  4296   console.log  DIMSE sendDcmDataset: sending 146 bytes

</pre><p>
	  The following output is produced:
          </p><pre class="programlisting">
--------------------------------------
2011-12-1512:22:51.000000  4296   INFO   Association Request Parameteres:
Our Implementation Class UID:    2.16.124.113543.6021.2
Our Implementation Version Name: RZDCX_2_0_1_8
Their Implementation Class UID:   
Their Implementation Version Name:
Application Context Name:    1.2.840.10008.3.1.1.1
Requested Extended Negotiation: none
Accepted Extended Negotiation: none
--------------------------------------
2011-12-1512:22:51.000000  4296   console.log  Constructing Associate RQ PDU
--------------------------------------
2011-12-1512:22:51.000000  4296   console.log  WriteToConnection, length: 310, bytes written: 310, loop no: 1
--------------------------------------
2011-12-1512:22:51.015000  4296   console.log  PDU Type: Associate Accept, PDU Length: 216 + 6 bytes PDU header
  02  00  00  00  00  d8  00  01  00  00  50  41  43  53  20  20
  20  20  20  20  20  20  20  20  20  20  52  5a  44  43  58  20
  20  20  20  20  20  20  20  20  20  20  00  00  00  00  00  00
--------------------------------------
2011-12-1512:22:51.031000  4296   console.log  DIMSE sendDcmDataset: sending 146 bytes

</pre><p>
        </p></div></div><br class="example-break"><div class="example"><a name="xm_multiline_example_1"></a><p class="title"><b>Exampleï¿½6.17.ï¿½Multi-line messages with a fixed string header</b></p><div class="example-contents"><p>
	  The following configuration will process messages having a fixed string header containing
	  dashes. Each event is then prepended with a sharp (<em class="replaceable"><code>#</code></em>) and 
	  is output to a file.
          </p><pre class="programlisting">
&lt;Extension multiline&gt;
    Module	xm_multiline
    HeaderLine	"---------------"
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file
    File	"modules/extension/multiline/xm_multiline1.in"
    SavePos	FALSE
    ReadFromLast FALSE
    InputType	multiline
    Exec        $raw_event = "#" + $raw_event;
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	'tmp/output'
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;

</pre><p>
	  An input sample:
          </p><pre class="programlisting">
---------------
1
---------------
1
2
---------------
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
ccccccccccccccccccccccccccccccccccccc
dddd
---------------

</pre><p>
	  The following output is produced:
          </p><pre class="programlisting">
#---------------
1
#---------------
1
2
#---------------
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
ccccccccccccccccccccccccccccccccccccc
dddd
#---------------

</pre><p>
        </p></div></div><br class="example-break"><div class="example"><a name="xm_multiline_example_2"></a><p class="title"><b>Exampleï¿½6.18.ï¿½Multi-line messages with fixed line count</b></p><div class="example-contents"><p>
	  The following configuration will process messages having a fixed line count of 4.
	  Lines containing only whitespace are ignored and removed.
	  Each event is then prepended with a sharp (<em class="replaceable"><code>#</code></em>) and is output
	  to a file.
          </p><pre class="programlisting">
&lt;Extension multiline&gt;
    Module	xm_multiline
    FixedLineCount 4
    Exec	if $raw_event =~ /^\s*$/ drop();
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file
    File	"modules/extension/multiline/xm_multiline2.in"
    SavePos	FALSE
    ReadFromLast FALSE
    InputType	multiline
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	'tmp/output'
    Exec	$raw_event = "#" + $raw_event;
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;

</pre><p>
	  An input sample:
          </p><pre class="programlisting">
1
2
3
4
1asd 

2asdassad
3ewrwerew
4xcbccvbc

1dsfsdfsd
2sfsdfsdrewrwe

3sdfsdfsew
4werwerwrwe

</pre><p>
	  The following output is produced:
          </p><pre class="programlisting">
#1
2
3
4
#1asd 
2asdassad
3ewrwerew
4xcbccvbc
#1dsfsdfsd
2sfsdfsdrewrwe
3sdfsdfsew
4werwerwrwe

</pre><p>
        </p></div></div><br class="example-break"><div class="example"><a name="xm_multiline_example_3"></a><p class="title"><b>Exampleï¿½6.19.ï¿½Multi-line messages with a syslog header</b></p><div class="example-contents"><p>
	  Multi-line messages are frequently logged over syslog and they end up in log files.
	  Unfortunately from the result it looks that each line is one event with its own
	  syslog header. It can be a common requirement to merge these back into a single event
	  message.
	  The following configuration does just that. It strips the syslog header from the
	  netstat output stored as a traditional syslog formatted file and each message is then
	  printed again with a line of dashes used as a separator.
          </p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Extension netstat&gt;
    Module	xm_multiline
    FixedLineCount 4
    &lt;Exec&gt;
       parse_syslog_bsd();
       $raw_event = $Message + "\n";
    &lt;/Exec&gt;
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file
    File	"modules/extension/multiline/xm_multiline3.in"
    SavePos	FALSE
    ReadFromLast FALSE
    InputType	netstat
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	'tmp/output'
    Exec	$raw_event = "------------------------------------------------------------------------------------\n" + $raw_event;
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;

</pre><p>
	  An input sample:
          </p><pre class="programlisting">
Nov 21 11:40:27 hostname app[26459]: Iface   MTU Met   RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg
Nov 21 11:40:27 hostname app[26459]: eth2       1500 0  16936814      0      0 0      30486067      0      8      0 BMRU
Nov 21 11:40:27 hostname app[26459]: lo        16436 0  277217234      0      0 0      277217234      0      0      0 LRU
Nov 21 11:40:27 hostname app[26459]: tun0       1500 0    316943      0      0 0        368642      0      0      0 MOPRU
Nov 21 11:40:28 hostname app[26459]: Iface   MTU Met   RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg
Nov 21 11:40:28 hostname app[26459]: eth2       1500 0  16945117      0      0 0      30493583      0      8      0 BMRU
Nov 21 11:40:28 hostname app[26459]: lo        16436 0  277217234      0      0 0      277217234      0      0      0 LRU
Nov 21 11:40:28 hostname app[26459]: tun0       1500 0    316943      0      0 0        368642      0      0      0 MOPRU
Nov 21 11:40:29 hostname app[26459]: Iface   MTU Met   RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg
Nov 21 11:40:29 hostname app[26459]: eth2       1500 0  16945270      0      0 0      30493735      0      8      0 BMRU
Nov 21 11:40:29 hostname app[26459]: lo        16436 0  277217234      0      0 0      277217234      0      0      0 LRU
Nov 21 11:40:29 hostname app[26459]: tun0       1500 0    316943      0      0 0        368642      0      0      0 MOPRU

</pre><p>
	  The following output is produced:
          </p><pre class="programlisting">
------------------------------------------------------------------------------------
Iface   MTU Met   RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg
eth2       1500 0  16936814      0      0 0      30486067      0      8      0 BMRU
lo        16436 0  277217234      0      0 0      277217234      0      0      0 LRU
tun0       1500 0    316943      0      0 0        368642      0      0      0 MOPRU
------------------------------------------------------------------------------------
Iface   MTU Met   RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg
eth2       1500 0  16945117      0      0 0      30493583      0      8      0 BMRU
lo        16436 0  277217234      0      0 0      277217234      0      0      0 LRU
tun0       1500 0    316943      0      0 0        368642      0      0      0 MOPRU
------------------------------------------------------------------------------------
Iface   MTU Met   RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg
eth2       1500 0  16945270      0      0 0      30493735      0      8      0 BMRU
lo        16436 0  277217234      0      0 0      277217234      0      0      0 LRU
tun0       1500 0    316943      0      0 0        368642      0      0      0 MOPRU

</pre><p>
        </p></div></div><br class="example-break"></div></div><div class="section" title="Syslog (xm_syslog)"><div class="titlepage"><div><div><h3 class="title"><a name="xm_syslog"></a>Syslog (xm_syslog)</h3></div></div></div><p>
    This module provides support for the archaic BSD Syslog protocol as defined in
    RFC 3164 and the current IETF standard defined by RFC 5424-5426. This is achieved     
    by exporting functions and procedures usable from the nxlog language.
    The transport is handled by the respective input and output modules (i.e.
    <a class="link" href="#im_udp" title="UDP (im_udp)">im_udp</a>), this module only provides a parser and 
    helper functions to create syslog messages and handle facility and severity values.
  </p><p>
   The older but still widespread BSD syslog standard defines both the format and the
   transport protocol in RFC 3164. The transport protocol is UDP, but to provide 
   reliability and security, this line based format is also commonly transferred over
   TCP and SSL.
   There is a newer standard defined in RFC 5424 also known as the IETF syslog format
   which obsolotes the BSD syslog format. This format overcomes most of the limitations
   of the old BSD syslog and allows multi-line messages and proper timestamps.
   The transport method is defined in RFC 5426 for UDP and RFC 5425 for TLS/SSL.
  </p><p>
   Because the IETF Syslog format supports multi-line messages, RFC 5425 defines a special
   format to encapsulate these by prepending the payload size in ASCII to the IETF syslog message.
   Messages tranferred in UDP packets are self-contained and do not need this additional framing.
   The following input reader and output writer functions are provided by the xm_syslog
   module to support this TLS transport defined in RFC 5425.
   While RFC 5425 explicitly defines that the TLS network transport protocol is to be used, pure 
   TCP may be used if security is not a requirement. Syslog messages can be also persisted
   to files with this framing format using these functions.
    </p><div class="variablelist"><dl><dt><span class="term"><a name="xm_syslog_inputtype_syslog_tls"></a>InputType Syslog_TLS</span></dt><dd>
        This input reader function parses the payload size and then reads the message according
        to this value. It is required to support Syslog TLS transport defined in RFC 5425.
       </dd><dt><span class="term"><a name="xm_syslog_outputtype_syslog_tls"></a>OutputType Syslog_TLS</span></dt><dd>
        This output writer function prepends the payload size to the message.
        It is required to support Syslog TLS transport defined in RFC 5425.
       </dd></dl></div><p>
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      The <em class="replaceable"><code>Syslog_TLS</code></em> InputType/OutputType can work with any
      input/output such as <a class="link" href="#im_tcp" title="TCP (im_tcp)">im_tcp</a> or <a class="link" href="#im_file" title="File (im_file)">im_file</a>
      and it does not depend on SSL transport at all.
      The name <em class="replaceable"><code>Syslog_TLS</code></em> is a little misleading, it was chosen
      to refer to the octet-framing method described in RFC 5425 used for TLS transport.
    </p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      The <a class="link" href="#pm_transformer" title="Message format converter (pm_transformer)">pm_transformer</a> module can also parse and 
      create BSD and IETF syslog messages but using the functions and procedures provided
      by this module makes it possible to solve more complex tasks which 
      <a class="link" href="#pm_transformer" title="Message format converter (pm_transformer)">pm_transformer</a> is not capable of on its own.
    </p></div><p>
    Structured data in IETF syslog messages is parsed and put into nxlog fields. 
    The SD-ID will be prepended to the field name with a dot unless it is 'NXLOG@XXXX'.
    Consider the following syslog message:
    </p><pre class="programlisting">&lt;30&gt;1 2011-12-04T21:16:10.000000+02:00 host app procid msgid [exampleSDID@32473 eventSource="Application" eventID="1011"] Message part</pre><p>
    After this IETF formatted syslog message is parsed with 
    <a class="link" href="#xm_syslog_proc_parse_syslog_ietf">parse_syslog_ietf()</a>,
    there will be two additional fields: $exampleSDID.eventID and $exampleSDID.eventSource.
    When SD-ID is NXLOG, the field name will be the same as the SD-PARAM name.
    The two additional fields extracted from the structured data part of the following
    IETF syslog message are $eventID and $eventSource:
    </p><pre class="programlisting">&lt;30&gt;1 2011-12-04T21:16:10.000000+02:00 host app procid msgid [NXLOG@32473 eventSource="Application" eventID="1011"] Message part</pre><p>
    All fields parsed from the structured data part are <a class="link" href="#lang_type_string">string</a>s.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="xm_syslog_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the xm_syslog module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="xm_syslog_config_snaredelimiter"></a>SnareDelimiter</span></dt><dd><p>
	      This optional directive takes a single character as argument to specify the
	      delimiter character used to separate fields when using the
	      <a class="link" href="#xm_syslog_proc_parse_syslog_bsd">to_syslog_snare()</a>
	      procedure.
	      The character specification
	      works the same way as with the <a class="link" href="#xm_csv_config_char" title="Specifying characters for quote, escape and delimiter">xm_csv</a>
	      module.
	      If this directive is not specified, the default escape character is the tab
	      character (\t). In latter versions of Snare4 this has changed to #,
	      so you can use this configuration directive to specify an alternative delimiter.
	      Note that there is no delimiter after the last field.
  	    </p></dd><dt><span class="term"><a name="xm_syslog_snarereplacement"></a>SnareReplacement</span></dt><dd><p>
	      This optional directive takes a single character as argument to specify the
	      replacement character substituted in place of any occurences of the 
	      <a class="link" href="#xm_syslog_config_snaredelimiter">delimiter</a> character
	      inside the $Message field when invoking the
	      <a class="link" href="#xm_syslog_proc_parse_syslog_bsd">to_syslog_snare()</a>
	      procedure.
	      The character specification
	      works the same way as with the <a class="link" href="#xm_csv_config_char" title="Specifying characters for quote, escape and delimiter">xm_csv</a>
	      module.
	      If this directive is not specified, the default replacement character is space.
  	    </p></dd><dt><span class="term"><a name="xm_syslog_ietftimestampingmt"></a>IETFTimestampInGMT</span></dt><dd><p>
	      This optional boolean directive can be used to format the timestamps produced
	      by <a class="link" href="#xm_syslog_proc_to_syslog_ietf">to_syslog_ietf()</a>
	      in GMT instead of local time.
	      This defaults to FALSE so that local time is used by default with a timezone
	      indicator.
  	    </p></dd></dl></div><p>
    </p></div><div class="section" title="Functions and procedures exported by xm_syslog"><div class="titlepage"><div><div><h4 class="title"><a name="xm_syslog_funcproc"></a>Functions and procedures exported by xm_syslog</h4></div></div></div><div class="section" title="Functions exported by xm_syslog"><div class="titlepage"><div><div><h5 class="title"><a name="xm_syslog_functions"></a>Functions exported by xm_syslog</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_syslog_func_syslog_facility_value"></a>
       <code class="function">integer syslog_facility_value(string arg);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Convert a syslog facility string to an integer</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="xm_syslog_func_syslog_facility_string"></a>
       <code class="function">string syslog_facility_string(integer arg);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Convert a syslog facility value to a string</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="xm_syslog_func_syslog_severity_value"></a>
       <code class="function">integer syslog_severity_value(string arg);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Convert a syslog severity string to an integer</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="xm_syslog_func_syslog_severity_string"></a>
       <code class="function">string syslog_severity_string(integer arg);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Convert a syslog severity value to a string</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">arg</span></dt><dd>
                type: <a class="link" href="#lang_type_integer">integer</a>
               </dd></dl></div></dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd></dl></div></div><div class="section" title="Procedures exported by xm_syslog"><div class="titlepage"><div><div><h5 class="title"><a name="xm_syslog_procedures"></a>Procedures exported by xm_syslog</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_syslog_proc_parse_syslog"></a>
       <code class="function">parse_syslog();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse the raw_event field as either BSD Syslog (RFC3164) or IETF Syslog (RFC5424) format</dd></dl></div></dd><dt><span class="term">
       <code class="function">parse_syslog(string source);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse the given string as either BSD Syslog (RFC3164) or IETF Syslog (RFC5424) format</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">source</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_syslog_proc_parse_syslog_bsd"></a>
       <code class="function">parse_syslog_bsd();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse the raw_event field as BSD Syslog (RFC3164) format</dd></dl></div></dd><dt><span class="term">
       <code class="function">parse_syslog_bsd(string source);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse the given string as BSD Syslog (RFC3164) format</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">source</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_syslog_proc_parse_syslog_ietf"></a>
       <code class="function">parse_syslog_ietf();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse the raw_event field as IETF Syslog (RFC5424) format</dd></dl></div></dd><dt><span class="term">
       <code class="function">parse_syslog_ietf(string source);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Parse the given string as IETF Syslog (RFC5424) format</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">source</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_syslog_proc_to_syslog_bsd"></a>
       <code class="function">to_syslog_bsd();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Create a BSD Syslog formatted log message in $raw_event from the fields of the event. The fields that are used to construct the $raw_event field are $EventTime, $Hostname, $SourceName, $ProcessID, $Message or $raw_event, $SyslogSeverity or $SyslogSeverityValue or $Severity or $SeverityValue, $SyslogFacility or $SyslogFacilityValue. If the fields are not present, a sensible default is used.</dd></dl></div></dd><dt><span class="term">
       <a name="xm_syslog_proc_to_syslog_ietf"></a>
       <code class="function">to_syslog_ietf();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Create an IETF Syslog (RFC5424) formatted log message in $raw_event from the fields of the event. The fields that are used to construct the $raw_event field are $EventTime, $Hostname, $SourceName, $ProcessID, $Message or $raw_event, $SyslogSeverity or $SyslogSeverityValue or $Severity or $SeverityValue, $SyslogFacility or $SyslogFacilityValue. If the fields are not present, a sensible default is used.</dd></dl></div></dd><dt><span class="term">
       <a name="xm_syslog_proc_to_syslog_snare"></a>
       <code class="function">to_syslog_snare();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Create a SNARE Syslog formatted log message in $raw_event. Uses the following fields to construct $raw_event: $EventTime, $Hostname, $SeverityValue, $FileName, $EventID, $SourceName, $AccountName, $AccountType, $EventType, $Category, $Message.</dd></dl></div></dd></dl></div></div></div><div class="section" title="Fields generated by xm_syslog"><div class="titlepage"><div><div><h4 class="title"><a name="xm_syslog_fields"></a>Fields generated by xm_syslog</h4></div></div></div><p>
  The following fields are set by xm_syslog:

  </p><div class="variablelist"><dl><dt><span class="term"><a name="xm_syslog_field_raw_event"></a>$raw_event</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Will be set to a syslog formatted string after to_syslog_bsd() or to_syslog_ietf() is called.
      </p></dd><dt><span class="term"><a name="xm_syslog_field_Message"></a>$Message</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The message part of the syslog line, filled after parse_syslog_bsd() or parse_syslog_ietf() is called.
      </p></dd><dt><span class="term"><a name="xm_syslog_field_SyslogSeverityValue"></a>$SyslogSeverityValue</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The severity part of the syslog line, filled after parse_syslog_bsd() or parse_syslog_ietf() is called.
	The default severity is 5 (="notice").
      </p></dd><dt><span class="term"><a name="xm_syslog_field_SyslogSeverity"></a>$SyslogSeverity</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The severity part of the syslog line, filled after parse_syslog_bsd() or parse_syslog_ietf() is called.
	The default severity is "notice".
      </p></dd><dt><span class="term"><a name="xm_syslog_field_SeverityValue"></a>$SeverityValue</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	Normalized severity number of the event.
      </p></dd><dt><span class="term"><a name="xm_syslog_field_Severity"></a>$Severity</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Normalized severity name of the event.
      </p></dd><dt><span class="term"><a name="xm_syslog_field_SyslogFacilityValue"></a>$SyslogFacilityValue</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The facility part of the syslog line, filled after parse_syslog_bsd() or parse_syslog_ietf() is called.
	The default facility is 1 (="user").
      </p></dd><dt><span class="term"><a name="xm_syslog_field_SyslogFacility"></a>$SyslogFacility</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The facility part of the syslog line, filled after parse_syslog_bsd() or parse_syslog_ietf() is called.
	The default facility is "user".
      </p></dd><dt><span class="term"><a name="xm_syslog_field_EventTime"></a>$EventTime</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_datetime">datetime</a></td></tr></table><p>
	Will be set to the timestamp found in the syslog message after
	parse_syslog_bsd() or parse_syslog_ietf() is called. If the year value is missing, it is set to the current
	year.
      </p></dd><dt><span class="term"><a name="xm_syslog_field_Hostname"></a>$Hostname</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The hostname part of the syslog line, filled after parse_syslog_bsd() or parse_syslog_ietf() is called.
      </p></dd><dt><span class="term"><a name="xm_syslog_field_SourceName"></a>$SourceName</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The application/program part of the syslog line, filled after parse_syslog_bsd() or parse_syslog_ietf() is called.
      </p></dd><dt><span class="term"><a name="xm_syslog_field_MessageID"></a>$MessageID</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The MSGID part of the syslog message, filled after parse_syslog_ietf() is called.
      </p></dd><dt><span class="term"><a name="xm_syslog_field_ProcessID"></a>$ProcessID</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The process id in the syslog line, filled after parse_syslog_bsd() or parse_syslog_ietf() is called.
      </p></dd></dl></div><p>

 </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="xm_syslog_config_examples"></a>Configuration examples</h4></div></div></div><div class="example"><a name="xm_syslog_example_syslog_bsd_file"></a><p class="title"><b>Exampleï¿½6.20.ï¿½Sending a file as BSD syslog over UDP</b></p><div class="example-contents"><p>
          To send logs out in BSD syslog format over udp which are collected from files, use the
          <a class="link" href="#xm_syslog_proc_to_syslog_bsd">to_syslog_bsd()</a> procedure coupled
          with the <a class="link" href="#im_udp" title="UDP (im_udp)">om_udp</a> module as in the following example.
          </p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file

    # We monitor all files matching the wildcard.
    # Every line is read into the $raw_event field.
    File	"/var/log/app*.log"

    &lt;Exec&gt;
        # Set the $EventTime field usually found in the logs by extracting it with a regexp.
        # If this is not set, the current system time will be used which might be a little off.
        if $raw_event =~ /(\d\d\d\d\-\d\d-\d\d \d\d:\d\d:\d\d)/ $EventTime = parsedate($1);

        # Now set the severity to something custom. This defaults to 'INFO' if unset.
        if $raw_event =~ /ERROR/ $Severity = 'ERROR';
        else $Severity = 'INFO';

        # The facility can be also set, otherwise the default value is 'USER'.
        $SyslogFacility = 'AUDIT';

        # The SourceName field is called the TAG in RFC3164 terminology and is usually the process name.
        $SourceName = 'my_application';

        # It is also possible to rewrite the Hostname if you don't want to use the system's hostname.
        $Hostname = 'myhost';

        # The Message field is used if present, otherwise the current $raw_event is prepended with the
        # syslog headers.
        # You can do some modifications on the Message if required. Here we add the full path of the
        # source file to the end of message line.
        $Message = $raw_event + ' [' + file_name() + ']';

        # Now create our RFC3164 compliant syslog line using the fields set above and/or use sensible
        # defaults where possible. The result will be in $raw_event.
        to_syslog_bsd();
    &lt;/Exec&gt;
&lt;/Input&gt;

&lt;Output out&gt;
    # This module just sends the contents of the $raw_event field to the destination defined here,
    # one UDP packet per message.
    Module	om_udp
    Host	192.168.1.42
    Port	1514
&lt;/Output&gt;

&lt;Route 66&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre><p>
        </p></div></div><br class="example-break"><div class="example"><a name="xm_syslog_example_bsd_udp"></a><p class="title"><b>Exampleï¿½6.21.ï¿½Collecting BSD style syslog messages over UDP</b></p><div class="example-contents"><p>
         To collect BSD style syslog messages over UDP, use the 
         <a class="link" href="#xm_syslog_proc_parse_syslog_bsd">parse_syslog_bsd()</a> procedure coupled
         with the <a class="link" href="#im_udp" title="UDP (im_udp)">im_udp</a> module as in the following example.
         </p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_udp
    Host	0.0.0.0
    Port 	514
    Exec	parse_syslog_bsd();
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"/var/log/logmsg.txt"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre><p>
        </p></div></div><br class="example-break"><div class="example"><a name="xm_syslog_example_ietf_udp"></a><p class="title"><b>Exampleï¿½6.22.ï¿½Collecting IETF style syslog messages over UDP</b></p><div class="example-contents"><p>
         To collect IETF style syslog messages over UDP as defined by RFC 5424 and RFC 5426, use the 
         <a class="link" href="#xm_syslog_proc_parse_syslog_ietf">parse_syslog_ietf()</a> procedure coupled
         with the <a class="link" href="#im_udp" title="UDP (im_udp)">im_udp</a> module as in the following example.
         Note that the default port is 514 (as defined by RFC 5426), this is the same as for
         BSD syslog.
         </p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_udp
    Host	0.0.0.0
    Port 	514
    Exec	parse_syslog_ietf();
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"/var/log/logmsg.txt"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre><p>
        </p></div></div><br class="example-break"><div class="example"><a name="xm_syslog_example_bsd_ietf_udp"></a><p class="title"><b>Exampleï¿½6.23.ï¿½Collecting both IETF and BSD style syslog messages over the same UDP port</b></p><div class="example-contents"><p>
         To collect IETF and BSD style syslog messages over UDP, use the 
         <a class="link" href="#xm_syslog_proc_parse_syslog">parse_syslog()</a> procedure coupled
         with the <a class="link" href="#im_udp" title="UDP (im_udp)">im_udp</a> module as in the following example.
         This procedure is capable of detecting and parsing both syslog formats.
         Since 514 is the default UDP port number for both BSD and IETF syslog, this can be
         useful to collect both formats simultaneously. If you want to accept
         both formats on different ports then it makes sense to use the appropriate
         parsers as in the previous two examples.
         </p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_udp
    Host	0.0.0.0
    Port 	514
    Exec	parse_syslog();
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"/var/log/logmsg.txt"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre><p>
        </p></div></div><br class="example-break"><div class="example"><a name="xm_syslog_example_ietf_ssl"></a><p class="title"><b>Exampleï¿½6.24.ï¿½Collecting IETF style syslog messages over TLS/SSL</b></p><div class="example-contents"><p>
         To collect IETF style syslog messages over TLS/SSL as defined by RFC 5424 and RFC 5425, use the 
         <a class="link" href="#xm_syslog_proc_parse_syslog_ietf">parse_syslog_ietf()</a> procedure coupled
         with the <a class="link" href="#im_ssl" title="TLS/SSL (im_ssl)">im_ssl</a> module as in the following example.
         Note that the default port is 6514 in this case (as defined by RFC 5425).
         The payload format parser is handled by the <a class="link" href="#xm_syslog_inputtype_syslog_tls">Syslog_TLS</a>
         input reader.
         </p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_ssl
    Host	localhost
    Port	6514
    CAFile	%CERTDIR%/ca.pem
    CertFile	%CERTDIR%/client-cert.pem
    CertKeyFile	%CERTDIR%/client-key.pem
    KeyPass	secret
    InputType	Syslog_TLS
    Exec	parse_syslog_ietf();
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"/var/log/logmsg.txt"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre><p>
        </p></div></div><br class="example-break"><div class="example"><a name="xm_syslog_example_ietf_tcpout"></a><p class="title"><b>Exampleï¿½6.25.ï¿½Forwarding IETF syslog over TCP</b></p><div class="example-contents"><p>
	  The following configuration uses the
          <a class="link" href="#xm_syslog_proc_to_syslog_ietf">to_syslog_ietf()</a> procedure to
	  convert input to IETF syslog and forward it over TCP:
          </p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file
    File	"/var/log/input.txt"
    Exec	$TestField = "test value"; $Message = $raw_event;
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_tcp
    Host	127.0.0.1
    Port	1514
    Exec	to_syslog_ietf();
    OutputType	Syslog_TLS
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre><p>
	  Because of the Syslog_TLS framing, the raw data sent over TCP will look like the following:
</p><pre class="programlisting">
130 &lt;13&gt;1 2012-01-01T16:15:52.873750Z  - - - [NXLOG@14506 EventReceivedTime="2012-01-01 17:15:52" TestField="test value"] test message
</pre><p>
         This example shows that all fields - except those which are filled by the syslog parser -
         are added to the structured data part.
        </p></div></div><br class="example-break"><div class="example"><a name="xm_syslog_example1"></a><p class="title"><b>Exampleï¿½6.26.ï¿½Conditional rewrite of the syslog facility - version 1</b></p><div class="example-contents"><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_udp
    Port 	514
    Host	0.0.0.0
    Exec	parse_syslog_bsd();
&lt;/Input&gt;

&lt;Output fileout&gt;
    Module	om_file
    File	"/var/log/logmsg.txt"
    Exec	if $Message =~ /error/ $SeverityValue = syslog_severity_value("error");
    Exec	to_syslog_bsd();
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; fileout
&lt;/Route&gt;
</pre></div></div><br class="example-break"><div class="example"><a name="xm_syslog_example2"></a><p class="title"><b>Exampleï¿½6.27.ï¿½Conditional rewrite of the syslog facility - version 2</b></p><div class="example-contents"><p>
         The following example does almost the same thing as the previous example, except that the
         syslog parsing and rewrite is moved to a processor module and rewrite only occurs
         if the facility was modified.
         This can make it work faster on multi-core systems because the processor module runs
         in a separate thread. This method can also minimize UDP packet loss because the input
         module does not need to parse syslog messages and can process UDP packets faster.
	 </p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_udp
    Host	0.0.0.0
    Port 	514
&lt;/Input&gt;

&lt;Processor rewrite&gt;
    Module	pm_null
    Exec	parse_syslog_bsd();\
		if $Message =~ /error/ \
                {\
                  $SeverityValue = syslog_severity_value("error");\
                  to_syslog_bsd(); \
                }
&lt;/Processor&gt;

&lt;Output fileout&gt;
    Module	om_file
    File	"/var/log/logmsg.txt"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; rewrite =&gt; fileout
&lt;/Route&gt;
</pre><p>
        </p></div></div><br class="example-break"></div></div><div class="section" title="External program execution (xm_exec)"><div class="titlepage"><div><div><h3 class="title"><a name="xm_exec"></a>External program execution (xm_exec)</h3></div></div></div><p>
    This module provides two procedures which make it possible to execute external scripts
    or programs.
    The reason for providing these two procedures through this additional extension module is to
    keep the nxlog core small. A security advantage is that an administrator won't be able
    to execute arbitrarly scripts if this module is not loaded.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      The  <a class="link" href="#om_exec" title="Program (om_exec)">om_exec</a> and <a class="link" href="#im_exec" title="Program (im_exec)">im_exec</a>
      modules also provide support for running external programs, though the purpose of these
      is to pipe data to and read data from programs.
      The procedures provided by the xm_exec module do not pipe log message data, these
      are intended for multiple invocations. Though data can be still passed to the executed
      script/program as command line arguments.
    </p></div><div class="section" title="Functions and procedures exported by xm_exec"><div class="titlepage"><div><div><h4 class="title"><a name="xm_exec_funcproc"></a>Functions and procedures exported by xm_exec</h4></div></div></div><div class="section" title="Procedures exported by xm_exec"><div class="titlepage"><div><div><h5 class="title"><a name="xm_exec_procedures"></a>Procedures exported by xm_exec</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_exec_proc_exec"></a>
       <code class="function">exec(string command, varargs args);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Execute the command passing it the supplied arguments and wait for it to terminate.
       The command is executed in the caller module's context.
       Note that the module calling this procedure will block until the process terminates. 
       Use the exec_async() procedure to avoid this problem.
       All output written to STDOUT and STDERR by the spawned process is discarded.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">command</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">args</span></dt><dd>
                type: <a class="link" href="#lang_type_varargs">varargs</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_exec_proc_exec_async"></a>
       <code class="function">exec_async(string command, varargs args);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       This procedure executes the command passing it the supplied arguments and does not
       wait for it to terminate. 
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">command</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd><dt><span class="term">args</span></dt><dd>
                type: <a class="link" href="#lang_type_varargs">varargs</a>
               </dd></dl></div></dd></dl></div></dd></dl></div></div></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="xm_exec_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp34928096"></a><p class="title"><b>Exampleï¿½6.28.ï¿½nxlog acting as a cron daemon</b></p><div class="example-contents"><pre class="programlisting">
&lt;Extension exec&gt;
    Module	xm_exec
    &lt;Schedule&gt;
	Every	1 sec
	Exec	exec_async("/bin/true");
    &lt;/Schedule&gt;
&lt;/Extension&gt;
</pre></div></div><p><br class="example-break">
      </p><div class="example"><a name="idp34930576"></a><p class="title"><b>Exampleï¿½6.29.ï¿½Sending email alerts</b></p><div class="example-contents"><pre class="programlisting">
&lt;Extension exec&gt;
    Module	xm_exec
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_tcp
    Host	0.0.0.0
    Port	1514
    &lt;Exec&gt;
        if $raw_event =~ /alertcondition/ 
        {
           exec_async("/bin/sh", "-c", 'echo "' + $Hostname + '\n\nRawEvent:\n' + $raw_event +
                        '"|/usr/bin/mail -a "Content-Type: text/plain; charset=UTF-8" -s "ALERT" ' +
                        'user@domain.com');
        }
    &lt;/Exec&gt;
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"/var/log/messages"
&lt;/Output&gt;

&lt;Route r&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
      For another example see this configuration for <a class="link" href="#om_file_config_example_rotate1" title="Exampleï¿½6.58.ï¿½File rotation based on size">file rotation</a>.
    </p></div></div><div class="section" title="Perl (xm_perl)"><div class="titlepage"><div><div><h3 class="title"><a name="xm_perl"></a>Perl (xm_perl)</h3></div></div></div><p>
    This module makes it possible to execute perl code and process event data using the 
    <a class="ulink" href="http://json.org" target="_top">perl language</a> via a built-in perl interpreter.
    The perl interpreter is only loaded if the module is declared in the configuration.
    While the <a class="link" href="#lang" title="Chapterï¿½5.ï¿½Language">nxlog language</a> is already a powerful framework,
    it is not intended to be a full featured programming language. For example it does
    not provide lists, arrays, hashes and other features available in many high-level
    languages. Perl is widely used for log processing and it comes with a broad
    set of modules bundled or available from <a class="ulink" href="http://cpan.org" target="_top">CPAN</a>.
  </p><p>
    You can sometimes write faster code in C, but you can always write code faster in Perl.
    Code written in perl is also a lot safer because it is unlikely to crash.
    Exceptions in the perl code (croak/die) are handled properly and this will only result
    in an unfinished attempt at executing the log processing code but will not take down
    the whole nxlog process.
  </p><p>
    The module will parse the file specified in the
    <a class="link" href="#xm_perl_config_perlcode">PerlCode</a> directive when nxlog and the module 
    is started.
    This file should contain one or more methods which can be called from the 
    <a class="link" href="#config_module_exec" title="Exec">Exec</a> directive of any module which
    wants to do any log processing in perl. See the
    <a class="link" href="#xm_perl_config_examples" title="Configuration examples">example</a> below which illustrates
    the use of this module.
  </p><p>
    To acccess the fields and the event data from the perl code, you need to include
    the <em class="replaceable"><code>Log::Nxlog</code></em> module.
    This exports the following methods:
    </p><div class="variablelist"><dl><dt><span class="term">set_field_integer(event, key, value)</span></dt><dd><p>
	    Sets the integer value in the field named 'key'.
	  </p></dd><dt><span class="term">set_field_string(event, key, value)</span></dt><dd><p>
	    Sets the string value in the field named 'key'.
	  </p></dd><dt><span class="term">set_field_boolean(event, key, value)</span></dt><dd><p>
	    Sets the boolean value in the field named 'key'.
	  </p></dd><dt><span class="term">get_field(event, key)</span></dt><dd><p>
	    Retreive the value associated with the field named 'key'.
	    The method returns a scalar value if the key exist and the value is
	    defined, otherwise it returns undef.
	  </p></dd><dt><span class="term">delete_field(event, key)</span></dt><dd><p>
	    Delete the value associated with the field named 'key'.
	  </p></dd><dt><span class="term">field_type(event, key)</span></dt><dd><p>
	    Return a string representing the type of the value associated with the
	    field named 'key'. 
	  </p></dd><dt><span class="term">field_names(event)</span></dt><dd><p>
	    Return a list of the field names contained in the event data. Can be used
	    to iterate over all the fields.
	  </p></dd><dt><span class="term">log_console.log(msg)</span></dt><dd><p>
	    Send the message in the argument to the internal logger on console.log loglevel.
	    Does the same as the procedure named log_console.log() in nxlog.
	  </p></dd><dt><span class="term">log_info(msg)</span></dt><dd><p>
	    Send the message in the argument to the internal logger on INFO loglevel.
	    Does the same as the procedure named log_info() in nxlog.
	  </p></dd><dt><span class="term">log_warning(msg)</span></dt><dd><p>
	    Send the message in the argument to the internal logger on WARNING loglevel.
	    Does the same as the procedure named log_warning() in nxlog.
	  </p></dd><dt><span class="term">log_error(msg)</span></dt><dd><p>
	    Send the message in the argument to the internal logger on ERROR loglevel.
	    Does the same as the procedure named log_error() in nxlog.
	  </p></dd></dl></div><p>
    You should be able to read the POD documentation contained in 
    <code class="filename">Nxlog.pm</code> with <span class="command"><strong>perldoc Log::Nxlog</strong></span>.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="xm_perl_config"></a>Configuration</h4></div></div></div><p>
      The following directives can be used to configure the xm_perl module instance:
      </p><div class="variablelist"><dl><dt><span class="term"><a name="xm_perl_config_perlcode"></a>PerlCode</span></dt><dd><p>
	      This mandatory directive expects a file which contains valid perl code.
	      This file is read and parsed by the perl interpreter.
	      Methods defined in this file can be called with the 
	      <a class="link" href="#xm_perl_proc_call">call()</a> procedure.
	    </p></dd></dl></div><p>
    </p></div><div class="section" title="Functions and procedures exported by xm_perl"><div class="titlepage"><div><div><h4 class="title"><a name="xm_perl_funcproc"></a>Functions and procedures exported by xm_perl</h4></div></div></div><div class="section" title="Procedures exported by xm_perl"><div class="titlepage"><div><div><h5 class="title"><a name="xm_perl_procedures"></a>Procedures exported by xm_perl</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="xm_perl_proc_call"></a>
       <code class="function">call(string subroutine);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Calls the perl subroutine provided in the first argument.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">subroutine</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="xm_perl_proc_perl_call"></a>
       <code class="function">perl_call(string subroutine);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>Calls the perl subroutine provided in the first argument.</dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">subroutine</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd></dl></div></div></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="xm_perl_config_examples"></a>Configuration examples</h4></div></div></div><p>
      In this example logs are parsed as syslog then the data is passed to a perl method
      which does a GeoIP lookup on the source address of the incoming message.
      </p><div class="example"><a name="xm_perl_example1"></a><p class="title"><b>Exampleï¿½6.30.ï¿½Using the built-in perl interpreter</b></p><div class="example-contents"><p>
	  </p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Extension perl&gt;
    Module	xm_perl
    PerlCode	modules/extension/perl/processlogs.pl
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file
    File	'test.log'
    ReadFromLast FALSE
    SavePos	FALSE
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	'tmp/output'
    # First we parse the input natively from nxlog
    Exec	parse_syslog_bsd();
    # Now call the 'process' subroutine defined in 'processlogs.pl'
    Exec	perl_call("process");
    # You can also invoke this public procedure 'call' in case
    # of multiple xm_perl instances like this: 
    # Exec	perl-&gt;call("process");
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;

</pre><p>
	  The contents of the <code class="filename">processlogs.pl</code> perl script is as follows:
	  </p><pre class="programlisting">
use strict;
use warnings;

use Carp;
# FindBin is for adding a path to @INC, this not needed normally
use FindBin;
use lib "$FindBin::Bin/../../../../src/modules/extension/perl";

# Without Log::Nxlog you cannot access (read or modify) the event data
# so don't forget this:
use Log::Nxlog;

use Geo::IP;

my $geoip;

BEGIN
{
    # This will be called once when nxlog starts so you can use this to
    # initialize stuff here
    $geoip = Geo::IP-&gt;new(GEOIP_MEMORY_CACHE);
}


# this is the method which is invoked from 'Exec' for each event log
sub process
{
    # The event data is passed here when this method is invoked by the module
    my ( $event ) = @_;
    
    # We look up the county of the sender of the message
    my $msgsrcaddr = Log::Nxlog::get_field($event, 'MessageSourceAddress');
    if ( defined($msgsrcaddr) )
    {
	my $country = $geoip-&gt;country_code_by_addr($msgsrcaddr);
	$country = "unknown" unless ( defined($country) );
	Log::Nxlog::set_field_string($event, 'MessageSourceCountry', $country);
    }

    # Iterate over the fields
    foreach my $fname ( @{Log::Nxlog::field_names($event)} )
    {
	# Delete all fields except these
	if ( ! (($fname eq 'raw_event') ||
		($fname eq 'AccountName') ||
		($fname eq 'MessageSourceCountry')) )
	{
	    Log::Nxlog::delete_field($event, $fname);
	}
    }

    # Check a field and rename it if it matches
    my $accountname = Log::Nxlog::get_field($event, 'AccountName');
    if ( defined($accountname) &amp;&amp; ($accountname eq 'John') )
    {
	Log::Nxlog::set_field_string($event, 'AccountName', 'johnny');
	Log::Nxlog::log_info('renamed john');
    }
}

</pre><p>
	</p></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="WTMP (xm_wtmp)"><div class="titlepage"><div><div><h3 class="title"><a name="xm_wtmp"></a>WTMP (xm_wtmp)</h3></div></div></div><p>
    This module provides a parser function to process binary wtmp files. The module registers an parser function
    using the name of the extension module instance which can be used as the parameter of the 
    <a class="link" href="#config_inputtype" title="InputType">InputType</a> directive in input modules such as <a class="link" href="#im_file" title="File (im_file)">im_file</a>.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="xm_wtmp_config"></a>Configuration</h4></div></div></div><p>
      The module does not have any module specific configuration directives.
    </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="xm_wtmp_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="xm_wtmp_example1"></a><p class="title"><b>Exampleï¿½6.31.ï¿½WTMP to JSON format conversion</b></p><div class="example-contents"><p>
	  The following configuration accepts WTMP and converts it to JSON.
	</p><pre class="programlisting">
&lt;Extension wtmp&gt;
    Module    xm_wtmp
&lt;/Extension&gt;

&lt;Extension json&gt;
    Module    xm_json
&lt;/Extension&gt;

&lt;Input in&gt;
    Module    im_file
    File      '/var/log/wtmp'
    InputType wtmp
    Exec      to_json();
&lt;/Input&gt;

&lt;Output out&gt;
    Module    om_file
    File      '/var/log/wtmp.txt'
&lt;/Output&gt;

&lt;Route processwtmp&gt;
    Path      in =&gt; out
&lt;/Route&gt;
</pre><p>
	  The following is a sample output produced by the configuration above.
	  </p><pre class="programlisting">{"EventTime":"2013-10-01 09:39:59","AccountName":"root","Device":"pts/1",
 "LoginType":"login","EventReceivedTime":"2013-10-10 15:40:20",
 "SourceModuleName":"input","SourceModuleType":"im_file"}
{"EventTime":"2013-10-01 23:23:38","AccountName":"shutdown","Device":"no device",
 "LoginType":"shutdown","EventReceivedTime":"2013-10-11 10:58:00",
 "SourceModuleName":"input","SourceModuleType":"im_file"}
	  </pre><p>
	</p></div></div><p><br class="example-break">
    </p></div></div></div><div class="section" title="Input modules"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="modules_input"></a>Input modules</h2></div></div></div><p>
     Input modules are responsible for collecting event log data from various sources.
     The nxlog core will add a few fields in each input module, see the following section for the
     list of these.
   </p><div class="section" title="Fields generated by core"><div class="titlepage"><div><div><h3 class="title"><a name="core_fields"></a>Fields generated by core</h3></div></div></div><p>
  The following fields are set by core:

  </p><div class="variablelist"><dl><dt><span class="term"><a name="core_field_raw_event"></a>$raw_event</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Filled with data received from stream modules (im_file, im_tcp, etc).
      </p></dd><dt><span class="term"><a name="core_field_EventReceivedTime"></a>$EventReceivedTime</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_datetime">datetime</a></td></tr></table><p>
	Set to the time when the event is received. The value is not modified if the field already exists.
      </p></dd><dt><span class="term"><a name="core_field_SourceModuleName"></a>$SourceModuleName</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The name of the module instance is stored in this field for input modules. The value is not modified if the field already exists.
      </p></dd><dt><span class="term"><a name="core_field_SourceModuleType"></a>$SourceModuleType</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The type the module instance (such as 'im_file') is stored in this field for input modules. The value is not modified if the field already exists.
      </p></dd></dl></div><p>

 </p></div><div class="section" title="DBI (im_dbi)"><div class="titlepage"><div><div><h3 class="title"><a name="im_dbi"></a>DBI (im_dbi)</h3></div></div></div><p>
    The im_dbi module utilizes the <a class="ulink" href="http://libdbi.sourceforge.net" target="_top">libdbi</a>
    database abstraction library to enable pulling log data from various database engines supported
    by the library such as MySQL, PostgreSQL, MSSQL, Sybase, Oracle, SQLite, Firebird.
    You can specify the SELECT statement which will be executed periodically checking for new records.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      The im_dbi and om_dbi modules support GNU/Linux only because of the libdbi library.
      The im_odbc and om_odbc modules provide native database access on Windows (available only in 
      the NXLog Enterprise Edition).
    </p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      libdbi needs <a class="link" href="#im_dbi_config_driver">drivers</a> to be able to access
      the database engines. These are in the <em class="replaceable"><code>libdbd-*</code></em> packages on Debian and Ubuntu Linux.
      On Centos 5.6 there is a libdbi-drivers rpm package but this does seem to contain any 
      driver binaries under /usr/lib64/dbd. The real driver for MySQL lives in libdbi-dbd-mysql.
      Same for PostgreSQL. Make sure you have these installed, otherwise you will get a libdbi
      driver initialization error.
    </p></div><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="im_dbi_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the im_dbi module instance.

      </p><div class="variablelist"><dl><dt><span class="term"><a name="im_dbi_config_driver"></a>Driver</span></dt><dd>
	      This mandatory directive specifies the name of the libdbi driver which will be used
	      to connect to the database. 
	      You will need to provide a DRIVER name here for which a loadable driver module 
	      exists under the name libdbdDRIVER.so (usually under /usr/lib/dbd/).
	      The mysql driver is in the libdbdmysql.so file.
	    </dd><dt><span class="term"><a name="im_dbi_config_sql"></a>SQL</span></dt><dd>
	      This directive should specify the SELECT statement which is executed every 
	      <a class="link" href="#im_dbi_config_pollinterval">PollInterval</a> seconds.
	      The module automatically appends a <em class="replaceable"><code>WHERE id &gt; ? LIMIT 10</code></em> clause to the
	      statement.
	      The result set returned by the select statement must contain an 'id' column which is then stored
	      and used for the next query.
	    </dd><dt><span class="term"><a name="im_dbi_config_option"></a>Option</span></dt><dd>
	      This directive can be used to specify additional driver options such as
	      the connection parameters. The manual of the libdbi driver should contain
	      the available options which can be used here.
	    </dd><dt><span class="term"><a name="im_dbi_config_pollinterval"></a>PollInterval</span></dt><dd>
	      This directive specifies in seconds how frequently the module will check for
	      new records. If this directive is not specified it defaults 
	      to 1 second.
	      Fractional seconds may be specified, i.e. to check twice every second you should
	      set the following: <em class="replaceable"><code>PollInterval 0.5</code></em>
	    </dd><dt><span class="term"><a name="im_dbi_config_savepos"></a>SavePos</span></dt><dd>
	      This directive takes a boolean value of TRUE or FALSE and specifies whether
	      the position should be saved when nxlog exits.
	      The position will be read from the cache file upon startup.	      
	      The position is saved by default if this directive is not specified
	      in the configuration.
	      Even if SavePos is enabled, it can be explicitly turned off with the
	      <a class="link" href="#config_global_nocache">NoCache</a> directive.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="im_dbi_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp35064896"></a><p class="title"><b>Exampleï¿½6.32.ï¿½Reading from a MySQL database</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input dbiin&gt;
    Module	im_dbi
    SavePos	TRUE
    Driver	mysql
    Option	host 127.0.0.1
    Option	username mysql
    Option	password mysql
    Option      dbname logdb 
    SQL 	SELECT id, facility, severity, hostname, timestamp, application, message FROM log
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"tmp/output"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	dbiin =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="Program (im_exec)"><div class="titlepage"><div><div><h3 class="title"><a name="im_exec"></a>Program (im_exec)</h3></div></div></div><p>
    This module will execute a program or script on startup and will read its standard
    output.
    It can be used to easily integrate with exotic log sources which can be read only with the
    help of scripts or programs.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="im_exec_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the im_exec module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="im_exec_config_command"></a>Command</span></dt><dd>
	      This directive is mandatory. It specifies the name of the script/program
	      to be executed.
	    </dd><dt><span class="term"><a name="im_exec_config_arg"></a>Arg</span></dt><dd>
	      This is an optional parameter, multiple can be specified for each
	      argument needed to pass to the 
	      <a class="link" href="#im_exec_config_command">Command</a>.
	      Note that specifying multiple arguments with one Arg directive separated with
	      spaces will not work because the Command will receive it as one argument,
	      so you will need to split them up.
	    </dd><dt><span class="term"><a name="im_exec_config_inputtype"></a>InputType</span></dt><dd>
	      See the description about <a class="link" href="#config_inputtype" title="InputType">InputType</a>
	      in the global module config section.
	    </dd><dt><span class="term"><a name="im_exec_config_restart"></a>Restart</span></dt><dd>
	      Restart the process if it exits. There is a 1 second delay before it is restarted
	      in order not to DOS the system when a process is not behaving nicely.
	      Looping should be implemented in the script itself, this directive is only to
	      provide some safety against malfunctioning scripts and programs.
	      This boolean directive defaults to FALSE.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="im_exec_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp35085968"></a><p class="title"><b>Exampleï¿½6.33.ï¿½Emulating im_file</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input input&gt;
    Module	im_exec
    Command	/usr/bin/tail
    Arg		-f
    Arg		/var/log/messages
&lt;/Input&gt;

&lt;Output fileout&gt;
    Module	om_file
    File	"tmp/output"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	input =&gt; fileout
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
      This exact same configuration is not recommended for real use because
      <a class="link" href="#im_file" title="File (im_file)">im_file</a> was designed to read log messages from files.
      This example only demonstrates the use of the im_exec module.
    </p></div></div><div class="section" title="File (im_file)"><div class="titlepage"><div><div><h3 class="title"><a name="im_file"></a>File (im_file)</h3></div></div></div><p>
    This module can be used to read log messages from files. The file position can be 
    persistently saved across restarts in order to avoid reading from the beginning again
    when nxlog is restarted.
    It also supports external rotation tools. When the module cannot read any more data
    from the file, it checks whether the opened file descriptor belongs to the
    same filename it opened originally. If the inodes differ, the module assumes the file was
    moved and reopens its input.
  </p><p>
    im_file uses a 1 second interval to monitor files for new messages. This method was
    implemented because polling a regular file is not supported on all platforms.
    If there is no more data to read, the module will sleep for 1 second.
  </p><p>
    By using wildcards, the module can read multiple files simultaneously and will open
    new files as they appear. It will also enter newly created directories if recursion
    is enabled.
    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	The module needs to scan the directory content in case of a wildcarded file monitoring.
	This can present a significant load if there are many files (hundreds or thousands) in
	the monitored directory. For this reason it is highly recommended to rotate files out
	of the monitored directory either using the
	<a class="link" href="#processing_log_rotation" title="Log rotation and retention">built-in log rotation</a> capabilities of nxlog
	or using external tools.
      </p></div><p>
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="im_file_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the im_file module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="im_file_config_file"></a>File</span></dt><dd><p>
	      This mandatory directive specifies the name of the input file to open.
	      It must be a <a class="link" href="#lang_type_string">string</a> type
	      <a class="link" href="#lang_expressions" title="Expressions">expression</a>.
	      For relative filenames you should be aware that nxlog changes its working
	      directory to '/' unless the global
	      <a class="link" href="#config_global_spooldir">SpoolDir</a> is set to something else.
	      On Windows systems the directory separator is backslash. For compatibility reasons
	      the forward slash '/' character can be also used as the directory separator,
	      but this only works for filenames which don't contain wildcards. If the
	      filename is specified using wildcards, you should use backslash for the directory
	      separator.
	      </p><p>
	      Wildcards are supported in filenames only, directory names in the path cannot
	      be wildcarded. Wildcards are not regular expressions, these are patterns commonly
	      used by unix shells to expand filenames which is also known as globbing.
	      </p><div class="variablelist"><dl><dt><span class="term">?</span></dt><dd><p>
		      Matches a single character only.
		    </p></dd><dt><span class="term">*</span></dt><dd><p>
		      Matches zero or more characters.
		    </p></dd><dt><span class="term">\*</span></dt><dd><p>
		      Matches the asterisk '*' character.
		    </p></dd><dt><span class="term">\?</span></dt><dd><p>
		      Matches the question mark '?' character.
		    </p></dd><dt><span class="term">[...]</span></dt><dd><p>
		      Used to specify a single character. If the first character of the class
		      description is ^ or !, the sense of the description is reversed.
		      The rest of the class description is a list of single characters or pairs
		      of characters separated by -. Any of those characters can have a backslash
		      in front of them, which is ignored; this lets you use the characters ]
		      and - in the character class, as well as ^ and ! at the beginning.
		    </p></dd></dl></div><p>
	      </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a name="im_file_config_file_note"></a>Note</h3><p>
		  The backslash character '\' is used to escape the wildcard
		  characters, unfortunately this is the same as the directory separator on Windows.
		  Take this into account when specifying wildcarded filenames on this platform.
		  Lets suppose that we have log files under the directory <code class="filename">C:\test</code>
		  which need to be monitored. Specifying the wildcard <em class="replaceable"><code>'C:\test\*.log'</code></em>
		  will not match because '\*' becomes a literal asterisk, thus it is treated as a
		  non-wildcarded filename. For this reason the directory separator needs to be escaped,
		  so the <em class="replaceable"><code>'C:\test\\*.log'</code></em> will match our files. 
		  <em class="replaceable"><code>'C:\\test\\*.log'</code></em> will also work.
		  When specifying the filename using double quotes, this would became 
		  <em class="replaceable"><code>"C:\\test\\\\*.log"</code></em> because the backslash is also
		  used as an escape character inside double quoted 
		  <a class="link" href="#lang_literal_string">string literals</a>.
		  Filenames on Windows systems are treated case-insensitively. Unix/Linux is case-sensitive.
		</p></div><p>
	    </p></dd><dt><span class="term"><a name="im_file_config_savepos"></a>SavePos</span></dt><dd>
	      This directive takes a boolean value of TRUE or FALSE and specifies whether
	      the file position should be saved when nxlog exits.
	      The file position will be read from the cache file upon startup.	      
	      The file position is saved by default if this directive is not specified
	      in the configuration.
	      Even if SavePos is enabled, it can be explicitly turned off with the
	      <a class="link" href="#config_global_nocache">NoCache</a> directive.
	    </dd><dt><span class="term"><a name="im_file_config_readfromlast"></a>ReadFromLast</span></dt><dd>
	      This optional directive takes a boolean value. If it is set to TRUE, it instructs
	      the module to only read logs which arrived after nxlog was started in case the
	      saved position could not be read (for example on first start).
	      When SavePos is TRUE and a previously saved position value could be read,
	      the module will resume reading from this saved position.
	      If this is FALSE, the module will read all logs from the file. This can result
	      in quite a lot of messages which is usually not the expected behaviour.
	      If this directive is not specified, it defaults to TRUE.
	    </dd><dt><span class="term"><a name="im_file_config_recursive"></a>Recursive</span></dt><dd>
	      This directive takes a boolean value of TRUE or FALSE and specifies whether
	      input files should be searched recursively under subdirectories.
	      The default value is TRUE.
	      This option takes effect only if wildcards are used in the filename.
	      For example if '/var/log/*.log' is specified in the
	      <a class="link" href="#im_file_config_file">File</a> directive, then 
	      '/var/log/apache2/access.log' will also match.
	      Because wildcards in directory names of the path are not supported, this directive
	      makes it possible to read  multiple files from different subdirectories
	      with a single im_file module instance only.
	    </dd><dt><span class="term"><a name="im_file_config_pollinterval"></a>PollInterval</span></dt><dd>
	      This directive specifies in seconds how frequently the module will check for
	      new files and new log entries. If this directive is not specified it defaults 
	      to 1 second.
	      Fractional seconds may be specified, i.e. to check twice every second you should
	      set the following: <em class="replaceable"><code>PollInterval 0.5</code></em>
	    </dd><dt><span class="term"><a name="im_file_config_dircheckinterval"></a>DirCheckInterval</span></dt><dd>
	      This directive specifies in seconds how frequently the module will check the monitored
	      directory for modifications to files and new files in case of a wildcarded 
	      <a class="link" href="#im_file_config_file">File</a> path.
	      If this directive is not specified it defaults to double of the value of the 
	      <a class="link" href="#im_file_config_pollinterval">PollInterval</a> directive, i.e.
	      it is 2 seconds if <a class="link" href="#im_file_config_pollinterval">PollInterval</a>
	      isn't defined either.
	      Fractional seconds may be specified.
	      It is recommended to increase the default in case there are many files which cannot
	      be rotated out and the nxlog process has a high CPU load.
	    </dd><dt><span class="term"><a name="im_file_config_activefiles"></a>ActiveFiles</span></dt><dd>
	      This directive specifies how many files nxlog will actively monitor at most.
	      If there are modifications to more files in parallel than the value of this directive,
	      then modifications to files above this limit will only get noticed after the 
	      <a class="link" href="#im_file_config_dircheckinterval">DirCheckInterval</a>, i.e. all data should
	      be collected eventually. 
	      Typically there is only one or at most a couple log sources which actively append data to
	      log files, the rest of the files are usually dormant after being rotated, so the default
	      value of 10 should be sufficient in most cases.
	      This directive is also only relevant in case of a wildcarded 
	      <a class="link" href="#im_file_config_file">File</a> path.
	    </dd><dt><span class="term"><a name="im_file_config_renamecheck"></a>RenameCheck</span></dt><dd><p>
	      This directive takes a boolean value of TRUE or FALSE and specifies whether
	      input files should be monitored for possible file rotation via renaming in order
	      to avoid rereading the file contents.
	      A file is considered to be rotated when nxlog detects a new file whose inode and
	      size matches that of another watched file which has just been deleted.
	      Note that this does not always work correctly and can yield false positives when
	      a log file is deleted and another is added with the same size. The file system is
	      likely to reuse to inode number of the deleted file and thus the module will falsely 
	      detect this as a rename/rotation.
	      For this reason the default value of the RenameCheck directive is FALSE.
	      When this directive is FALSE, renamed files are considered as new and the file
	      contents will be reread.
	    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
		It is recommended to use a naming scheme for rotated files such that their name
		does not match the wildcard and are not monitored anymore after rotation
		instead of trying to solve the renaming issue by enabling this directive.
	      </p></div></dd><dt><span class="term"><a name="im_file_config_closewhenidle"></a>CloseWhenIdle</span></dt><dd><p>
	      This directive takes a boolean value of TRUE or FALSE and specifies whether
	      open input files should be closed as soon as possible after there is no more data to read.
	      Some applications request an exclusive lock on the log file written or rotated, this directive
	      can possibly help if the application can/does retry to acquire the lock.
	      This directive defaults to FALSE unless specified explicitly.
	    </p></dd><dt><span class="term"><a name="im_file_config_inputtype"></a>InputType</span></dt><dd>
	      See the description about <a class="link" href="#config_inputtype" title="InputType">InputType</a>
	      in the global module config section.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Functions and procedures exported by im_file"><div class="titlepage"><div><div><h4 class="title"><a name="im_file_funcproc"></a>Functions and procedures exported by im_file</h4></div></div></div><div class="section" title="Functions exported by im_file"><div class="titlepage"><div><div><h5 class="title"><a name="im_file_functions"></a>Functions exported by im_file</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="im_file_func_file_name"></a>
       <code class="function">string file_name();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Return the name of the file currently open which the log was read from.
     </dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd></dl></div></div></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="im_file_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp35162976"></a><p class="title"><b>Exampleï¿½6.34.ï¿½Forwarding logs from a file to a remote host</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input in&gt;
    Module	im_file
    File	"/var/log/messages"
    SavePos	TRUE
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_tcp
    Host	192.168.1.1
    Port	514
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="Internal (im_internal)"><div class="titlepage"><div><div><h3 class="title"><a name="im_internal"></a>Internal (im_internal)</h3></div></div></div><p>
    This module makes it possible to insert internal log messages of nxlog into a route.
    nxlog generates messages about error conditions, console.logging messages, etc. In addition
    internal messages can be also generated from the nxlog language using the
    <a class="link" href="#core_proc_log_info">log_info()</a>,
    <a class="link" href="#core_proc_log_warning">log_warning()</a> and
    <a class="link" href="#core_proc_log_error">log_error()</a> procedure calls.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      Only messages with loglevel INFO and above are supported. console.log messages are ignored
      due to technical reasons. 
      For console.logging purposes the direct logging facility should be used, see the global
      <a class="link" href="#config_global_logfile">LogFile</a> and 
      <a class="link" href="#config_global_loglevel">LogLevel</a> directives.
    </p><p>
      One must be careful about the use of the im_internal module because it is easy to
      cause a message loop.
      For example consider the situation when the internal messages are sent to a database.
      If the database is experiencing errors which result in internal error messages then
      these are again routed to the database and this will trigger further error messages and
      is easy to see that this will result in a loop.
      In order to avoid a resource exhaustion, the im_internal module will drop its
      messages when the queue of next module in the route is full.
      It is recommended to always put the im_internal module instance in a separate route.
    </p></div><p>
    The im_internal does not have any module specific configuration directives in addition
    to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      If you require internal messages in syslog format, you need to explicitely convert them
      with <a class="link" href="#pm_transformer" title="Message format converter (pm_transformer)">pm_transformer</a> or using the
      <a class="link" href="#xm_syslog_proc_to_syslog_bsd">to_syslog_bsd()</a> procedure of
      the <a class="link" href="#xm_syslog" title="Syslog (xm_syslog)">xm_syslog</a> module, because the 
      <a class="link" href="#im_mark_field_raw_event">$raw_event</a> field is not generated in
      syslog format.
    </p></div><div class="section" title="Fields generated by im_internal"><div class="titlepage"><div><div><h4 class="title"><a name="im_internal_fields"></a>Fields generated by im_internal</h4></div></div></div><p>
  The following fields are set by im_internal:

  </p><div class="variablelist"><dl><dt><span class="term"><a name="im_internal_field_raw_event"></a>$raw_event</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Will be set to the string passed to the log_info() and other log() procedures.
      </p></dd><dt><span class="term"><a name="im_internal_field_Message"></a>$Message</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Set to the same value as $raw_event.
      </p></dd><dt><span class="term"><a name="im_internal_field_SeverityValue"></a>$SeverityValue</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	Depending on the log level of the internal message, the syslog severity is
	set to the value corresponding to "console.log", "info", "warning", "error" or "critical".
      </p></dd><dt><span class="term"><a name="im_internal_field_Severity"></a>$Severity</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The severity name of the event.
      </p></dd><dt><span class="term"><a name="im_internal_field_EventTime"></a>$EventTime</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_datetime">datetime</a></td></tr></table><p>
	Will be set to the current time.
      </p></dd><dt><span class="term"><a name="im_internal_field_SourceName"></a>$SourceName</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Will be set to 'nxlog'.
      </p></dd><dt><span class="term"><a name="im_internal_field_ProcessID"></a>$ProcessID</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The field is filled with the process id of the nxlog process.
      </p></dd><dt><span class="term"><a name="im_internal_field_Hostname"></a>$Hostname</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The hostname where the log is produced
      </p></dd><dt><span class="term"><a name="im_internal_field_ErrorCode"></a>$ErrorCode</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	If an error is logged resulting from an OS error, this field contains
	the error number provided by the Apache portable runtime library.
      </p></dd></dl></div><p>

 </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="im_internal_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp35226880"></a><p class="title"><b>Exampleï¿½6.35.ï¿½Forwaring internal messages over syslog udp</b></p><div class="example-contents"><pre class="programlisting">
&lt;Extension syslog&gt;
    Module      xm_syslog
&lt;/Extension&gt;

&lt;Input internal&gt;
    Module	im_internal
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_udp
    Host	192.168.1.1
    Port	514
    Exec	to_syslog_bsd();
&lt;/Output&gt;

&lt;Route internal&gt;
    Path	internal =&gt; out
&lt;/Route&gt;

</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="Kernel (im_kernel)"><div class="titlepage"><div><div><h3 class="title"><a name="im_kernel"></a>Kernel (im_kernel)</h3></div></div></div><p>
    This module can collect kernel log messages from the kernel log buffer.
    Currently this module works on linux only.
    On Linux the klogctl() system call is used for this purpose.
    In order to be able to read kernel logs, special privileges are required.
    For this reason nxlog needs to be started as root. Using the
    <a class="link" href="#config_global_user">User</a> and
    <a class="link" href="#config_global_group">Group</a> global directives nxlog can then
    drop its root privileges but it will keep the CAP_SYS_ADMIN capability to be able
    to read the kernel log buffer.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      Unfortunately it is not possible to read from the /proc/kmsg pseudo file for an
      unprivileged process even if the CAP_SYS_ADMIN capability is kept. 
      For this reason the /proc/kmsg interface is not supported by the im_kernel module.
      The <a class="link" href="#im_file" title="File (im_file)">im_file</a> module should work fine with the
      /proc/kmsg pseudo file if one wishes to collect kernel logs this way, though this
      will require nxlog to be running as root.
    </p></div><p>
    The kernel messages are emitted in the following form.
    </p><pre class="programlisting">
&lt;[0-7]&gt;Some message from the kernel.
</pre><p>
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      Kernel messages are valid BSD syslog messages but do not contain timestamp and
      hostname fields.
      These can be parsed with
      <a class="link" href="#pm_transformer" title="Message format converter (pm_transformer)">pm_transformer</a> or using the
      <a class="link" href="#xm_syslog_proc_parse_syslog_bsd">parse_syslog_bsd()</a> procedure of
      the <a class="link" href="#xm_syslog" title="Syslog (xm_syslog)">xm_syslog</a> module, this will set the timestamp and
      hostname fields.
    </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="im_kernel_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp35241888"></a><p class="title"><b>Exampleï¿½6.36.ï¿½Storing raw kernel logs into a file</b></p><div class="example-contents"><pre class="programlisting">
# drop privileges after being started as root
User nxlog
Group nxlog

&lt;Input kern&gt;
    Module      im_kernel
&lt;/Input&gt;

&lt;Output fileout&gt;
    Module      om_file
    File        "tmp/output"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path        kern =&gt; fileout
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="Mark (im_mark)"><div class="titlepage"><div><div><h3 class="title"><a name="im_mark"></a>Mark (im_mark)</h3></div></div></div><p>
    Mark messages are used to indicate periodic activity in order to be assured that
    the logger is running in case there are no log messages coming in from other sources.
  </p><p>
    By default, without specifying any of the module specific directives, a log message
    is emitted every 30 minutes containing "-- MARK --".
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      If you require mark messages in syslog format, you need to explicitely convert them
      with <a class="link" href="#pm_transformer" title="Message format converter (pm_transformer)">pm_transformer</a> or using the
      <a class="link" href="#xm_syslog_proc_to_syslog_bsd">to_syslog_bsd()</a> procedure of
      the <a class="link" href="#xm_syslog" title="Syslog (xm_syslog)">xm_syslog</a> module, because the 
      <a class="link" href="#im_mark_field_raw_event">$raw_event</a> field is not generated in
      syslog format.
    </p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      The functionality of the im_mark module can be also achieved using the
      <a class="link" href="#config_module_schedule" title="Schedule">Schedule</a> block with a
      <a class="link" href="#core_proc_log_info">log_info("--MARK--")</a> Exec statement which would
      insert the messages via the <a class="link" href="#im_internal" title="Internal (im_internal)">im_internal</a>
      module into a route.
      Using a single module for this task can simplify and possibly make the configuration
      easier to understand. Just wanted to point out that 
      "there is more than one way to do it" :)
    </p></div><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="im_mark_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the im_mark module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="im_mark_config_mark"></a>Mark</span></dt><dd>
	      This optional directive can set the string for the mark message.
	      If not specified, the default is "-- MARK --".
	    </dd><dt><span class="term"><a name="im_mark_config_markinterval"></a>MarkInterval</span></dt><dd>
	      This optional directive sets the interval for mark messages in minutes.
	      If not specified, the default value of 30 minutes is used.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Fields generated by im_mark"><div class="titlepage"><div><div><h4 class="title"><a name="im_mark_fields"></a>Fields generated by im_mark</h4></div></div></div><p>
  The following fields are set by im_mark:

  </p><div class="variablelist"><dl><dt><span class="term"><a name="im_mark_field_raw_event"></a>$raw_event</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Will be set to "-- MARK --" or the value defined with the 
	Mark configuration directive.
      </p></dd><dt><span class="term"><a name="im_mark_field_Message"></a>$Message</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Set to the same value as $raw_event.
      </p></dd><dt><span class="term"><a name="im_mark_field_SeverityValue"></a>$SeverityValue</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	Its value will be set to 6 which is the "info" severity level.
      </p></dd><dt><span class="term"><a name="im_mark_field_Severity"></a>$Severity</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The severity name of the event.
      </p></dd><dt><span class="term"><a name="im_mark_field_EventTime"></a>$EventTime</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_datetime">datetime</a></td></tr></table><p>
	Will be set to the current time.
      </p></dd><dt><span class="term"><a name="im_mark_field_SourceName"></a>$SourceName</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Will be set to 'nxlog'.
      </p></dd><dt><span class="term"><a name="im_mark_field_ProcessID"></a>$ProcessID</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The field is filled with the process id of the nxlog process.
      </p></dd></dl></div><p>

 </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="im_mark_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp35300352"></a><p class="title"><b>Exampleï¿½6.37.ï¿½Using the im_mark module</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input mark&gt;
    Module	im_mark
    MarkInterval 1
    Mark	-=| MARK |=-
&lt;/Input&gt;

&lt;Output fileout&gt;
    Module	om_file
    File	"tmp/output"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	mark =&gt; fileout
&lt;/Route&gt;

</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="MS EventLog for Windows XP/2000/2003 (im_mseventlog)"><div class="titlepage"><div><div><h3 class="title"><a name="im_mseventlog"></a>MS EventLog for Windows XP/2000/2003 (im_mseventlog)</h3></div></div></div><p>
    This module can be used to collect EventLog messages on Microsoft Windows platforms.
    The module looks up the available EventLog sources stored under the registry key
    "SYSTEM\\CurrentControlSet\\Services\\Eventlog" and will poll logs from each of these or
    only the sources defined with the <a class="link" href="#im_mseventlog_config_sources">Sources</a>
    directive.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      Windows Vista, Windows 2008 and later use a new EventLog API which is not backward
      compatible. Messages in some events produced by sources in this new format cannot be 
      resolved with the old API which is used by this module.
      If such an event is encountered, a Message similar to the following will be set:
      </p><pre class="programlisting">The description for EventID XXXX from source SOURCE cannot be read by im_mseventlog because this does not support the newer WIN2008/Vista EventLog API.
</pre><p>
      Though the majority of event messages can be read with this module even on Windows 2008/Vista and
      later, it is recommended to use the <a class="link" href="#im_msvistalog" title="MS EventLog for Windows 2008/Vista and later (im_msvistalog)">im_msvistalog</a> module
      instead.
    </p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      Strings are stored in dll and executable files and these need to be looked up by the
      module when reading eventlog messages. If a program (dll/exe) is already uninstalled
      and cannot be opened to look up the strings in the message, the following message
      will appear instead:
	</p><pre class="programlisting">The description for EventID XXXX from source SOURCE cannot be found.
</pre><p>
    </p></div><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="im_mseventlog_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the im_mseventlog module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="im_mseventlog_config_savepos"></a>SavePos</span></dt><dd>
	      This directive takes a boolean value of TRUE or FALSE and specifies whether
	      the file position should be saved when nxlog exits.
	      The file position will be read from the cache file upon startup.
	      The file position is saved by default if this directive is not specified
	      in the configuration.
	      Even if SavePos is enabled, it can be explicitly turned off with the
	      <a class="link" href="#config_global_nocache">NoCache</a> directive.
	    </dd><dt><span class="term"><a name="im_mseventlog_config_readfromlast"></a>ReadFromLast</span></dt><dd>
	      This optional directive takes a boolean value. If it is set to TRUE, it instructs
	      the module to only read logs which arrived after nxlog was started in case the
	      saved position could not be read (for example on first start).
	      When SavePos is TRUE and a previously saved position value could be read,
	      the module will resume reading from this saved position.
	      If this is FALSE, the module will read all logs from the EventLog. This can result
	      in quite a lot of messages which is usually not the expected behaviour.
	      If this directive is not specified, it defaults to TRUE.
	    </dd><dt><span class="term"><a name="im_mseventlog_config_sources"></a>Sources</span></dt><dd>
	      This optional directive takes a comma separated list of eventlog file names,
	      such as 'Security, Application', to read only specific eventlog sources.
	      If this directive is not specified, then all available eventlog sources 
	      are read (as listed in the registry).
	      This directive should not be confused with the 
	      <a class="link" href="#im_mseventlog_field_SourceName">SourceName</a> containted
	      within the eventlog and it is not a list of such names. The value of this
	      is stored in the <a class="link" href="#im_mseventlog_field_FileName">FileName</a>
	      field.
	    </dd><dt><span class="term"><a name="im_mseventlog_config_utf8"></a>UTF8</span></dt><dd>
	      This optional directive takes a boolean value. If it is set to TRUE, all strings
	      will be converted to UTF-8 encoding. Internally this calls the 
	      <a class="link" href="#xm_charconv_proc_convert_fields">convert_fields</a> procedure.
	      The <a class="link" href="#xm_charconv" title="Character set conversion (xm_charconv)">xm_charconv</a> module must be loaded for
	      the character set conversoion to work.
	      If this UTF8 directive is not defined, it defaults to TRUE, but conversion will
	      only occur if the <a class="link" href="#xm_charconv" title="Character set conversion (xm_charconv)">xm_charconv</a> module is loaded,
	      otherwise strings will be in the local codepage.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Fields generated by im_mseventlog"><div class="titlepage"><div><div><h4 class="title"><a name="im_mseventlog_fields"></a>Fields generated by im_mseventlog</h4></div></div></div><p>
  The following fields are set by im_mseventlog:

  </p><div class="variablelist"><dl><dt><span class="term"><a name="im_mseventlog_field_raw_event"></a>$raw_event</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Contains the timestamp, hostname, severity and message from the event
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_Message"></a>$Message</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Contains the message from the event
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_EventTime"></a>$EventTime</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_datetime">datetime</a></td></tr></table><p>
	Will be set to the TimeGenerated field of the EventRecord.
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_EventTimeWritten"></a>$EventTimeWritten</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_datetime">datetime</a></td></tr></table><p>
	Will be set to the TimeWritten field of the EventRecord.
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_Hostname"></a>$Hostname</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The host or computer name field of the EventRecord.
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_SourceName"></a>$SourceName</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The event source which produced the event, this is the subsystem or application name.
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_EventID"></a>$EventID</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The event id of the EventRecord.
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_CategoryNumber"></a>$CategoryNumber</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The category number, stored as Category in the EventRecord.
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_Category"></a>$Category</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The category name resolved from CategoryNumber.
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_FileName"></a>$FileName</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The logfile source (e.g. Security, Application) of the event.
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_AccountName"></a>$AccountName</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The username associated with the event.
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_AccountType"></a>$AccountType</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The type of the account. Possible values are: User, Group, Domain, Alias, Well Known Group, Deleted Account, Invalid, Unknown, Computer.
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_Domain"></a>$Domain</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The domain name of the user.
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_SeverityValue"></a>$SeverityValue</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	Normalized severity number of the event.
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_Severity"></a>$Severity</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Normalized severity name of the event.
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_EventType"></a>$EventType</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The type of the event which is a string describing the severity.
	It takes the following values: "ERROR", "AUDIT_FAILURE", "AUDIT_SUCCESS", "INFO", "WARNING", "UNKNOWN"
      </p></dd><dt><span class="term"><a name="im_mseventlog_field_RecordNumber"></a>$RecordNumber</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The number of the event record.
      </p></dd></dl></div><p>

 </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="im_mseventlog_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp35414144"></a><p class="title"><b>Exampleï¿½6.38.ï¿½Forwarding EventLogs from a windows machine to a remote host</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input in&gt;
    Module      im_mseventlog
&lt;/Input&gt;

&lt;Output out&gt;
    Module      om_tcp
    Host        192.168.1.1
    Port        514
&lt;/Output&gt;

&lt;Route 1&gt;
    Path        in =&gt; out
&lt;/Route&gt;</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="MS EventLog for Windows 2008/Vista and later (im_msvistalog)"><div class="titlepage"><div><div><h3 class="title"><a name="im_msvistalog"></a>MS EventLog for Windows 2008/Vista and later (im_msvistalog)</h3></div></div></div><p>
    This module can be used to collect EventLog messages on Microsoft Windows platforms which support
    the newer EventLog API (also known as the Crimson Eventlog subsystem), namely Windows 2008/Vista
    and later. 
    You can refer to the official Microsoft documentation about 
    <a class="ulink" href="http://technet.microsoft.com/en-us/library/cc722404.aspx" target="_top">Event Logs</a>.
    The module supports reading all System, Application and Custom events.
    It looks up the available channels and monitors events in each unless the
    <a class="link" href="#im_msvistalog_config_query">Query</a> and the 
    <a class="link" href="#im_msvistalog_config_channel">Channel</a> directives are explicitely defined.
    Event logs can be collected from remote servers over MS RPC (Note: Enterprise Edition only).
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      This module will not work on Windows 2003 and earlier because Windows Vista, Windows 2008
      and later use a new EventLog API which is not available in earlier Windows versions.
      If you need to collect EventLog messages on these platforms, you should use the 
      <a class="link" href="#im_mseventlog" title="MS EventLog for Windows XP/2000/2003 (im_mseventlog)">im_mseventlog</a> module instead.
    </p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      The Windows EventLog subsystem does not support subscriptions to console.log and Analytic channels,
      thus it is not possible to collect these type of events with this module.
    </p></div><p>
    In addition to the standard set of <a class="link" href="#im_msvistalog_fields" title="Fields generated by im_msvistalog">fields</a> which are
    listed under the System section, event providers can define their own additional schema which
    enables logging additional data under the EventData section.
    The Security log makes use of this new feature and such additional fields can be seen as
    in the following XML snippet:
</p><pre class="programlisting">
&lt;EventData&gt;
  &lt;Data Name="SubjectUserSid"&gt;S-1-5-18&lt;/Data&gt; 
  &lt;Data Name="SubjectUserName"&gt;WIN-OUNNPISDHIG$&lt;/Data&gt; 
  &lt;Data Name="SubjectDomainName"&gt;WORKGROUP&lt;/Data&gt; 
  &lt;Data Name="SubjectLogonId"&gt;0x3e7&lt;/Data&gt; 
  &lt;Data Name="TargetUserSid"&gt;S-1-5-18&lt;/Data&gt; 
  &lt;Data Name="TargetUserName"&gt;SYSTEM&lt;/Data&gt; 
  &lt;Data Name="TargetDomainName"&gt;NT AUTHORITY&lt;/Data&gt; 
  &lt;Data Name="TargetLogonId"&gt;0x3e7&lt;/Data&gt; 
  &lt;Data Name="LogonType"&gt;5&lt;/Data&gt; 
  &lt;Data Name="LogonProcessName"&gt;Advapi&lt;/Data&gt; 
  &lt;Data Name="AuthenticationPackageName"&gt;Negotiate&lt;/Data&gt; 
  &lt;Data Name="WorkstationName" /&gt; 
  &lt;Data Name="LogonGuid"&gt;{00000000-0000-0000-0000-000000000000}&lt;/Data&gt; 
  &lt;Data Name="TransmittedServices"&gt;-&lt;/Data&gt; 
  &lt;Data Name="LmPackageName"&gt;-&lt;/Data&gt; 
  &lt;Data Name="KeyLength"&gt;0&lt;/Data&gt; 
  &lt;Data Name="ProcessId"&gt;0x1dc&lt;/Data&gt; 
  &lt;Data Name="ProcessName"&gt;C:\Windows\System32\services.exe&lt;/Data&gt; 
  &lt;Data Name="IpAddress"&gt;-&lt;/Data&gt; 
  &lt;Data Name="IpPort"&gt;-&lt;/Data&gt; 
&lt;/EventData&gt;</pre><p>
  nxlog can extract this data when fields are logged using this schema. The values will be available
  in the fields of the internal nxlog log structure. This is especially useful because there is
  no need to write pattern matching rules to extract this data from the message. These fields
  can be used in filtering rules, writing them into SQL tables or to trigger actions.
  Consider the following example which filters using the <a class="link" href="#config_module_exec" title="Exec">Exec</a>
  directive:
</p><pre class="programlisting">
&lt;Input in&gt;
    Module       im_msvistalog
    Exec         if ($TargetUserName == 'SYSTEM') OR ($EventType == 'VERBOSE') drop();
&lt;/Input&gt;</pre><p>
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="im_msvistalog_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the im_msvistalog module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="im_msvistalog_config_savepos"></a>SavePos</span></dt><dd>
	      This directive takes a boolean value of TRUE or FALSE and specifies whether
	      the file position should be saved when nxlog exits.
	      The file position will be read from the cache file upon startup.
	      The file position is saved by default if this directive is not specified
	      in the configuration.
	      Even if SavePos is enabled, it can be explicitly turned off with the
	      <a class="link" href="#config_global_nocache">NoCache</a> directive.
	    </dd><dt><span class="term"><a name="im_msvistalog_config_readfromlast"></a>ReadFromLast</span></dt><dd>
	      This optional directive takes a boolean value. If it is set to TRUE, it instructs
	      the module to only read logs which arrived after nxlog was started in case the
	      saved position could not be read (for example on first start).
	      When SavePos is TRUE and a previously saved position value could be read,
	      the module will resume reading from this saved position.
	      If this is FALSE, the module will read all logs from the EventLog. This can result
	      in quite a lot of messages which is usually not the expected behaviour.
	      If this directive is not specified, it defaults to TRUE.
	    </dd><dt><span class="term"><a name="im_msvistalog_config_query"></a>Query</span></dt><dd><p>
	      This directive specifies the query if one wishes to pull only specific eventlog sources.
	      See the MSDN docs about 
	      <a class="ulink" href="http://msdn.microsoft.com/en-us/library/aa385231.aspx" target="_top">Event Selection</a>.
	      Note that this directive needs a single-line parameter, so multi-line query XML 
	      should be specified with line continuation marks (\) as in the following example:
</p><pre class="programlisting">
     Query &lt;QueryList&gt;                                             \
             &lt;Query Id='1'&gt;                                        \
              &lt;Select Path='Security'&gt;*[Security/Level=4]&lt;/Select&gt; \
             &lt;/Query&gt;                                              \
           &lt;/QueryList&gt;</pre><p>
             When the Query contains an XPath style expression, the 
             <a class="link" href="#im_msvistalog_config_channel">Channel</a> must also be specified.
	     Otherwise if an XML Query is specified, the
	     <a class="link" href="#im_msvistalog_config_channel">Channel</a> should not be used.
	    </p></dd><dt><span class="term"><a name="im_msvistalog_config_queryxml"></a>QueryXML</span></dt><dd><p>
	      This directive is the same as the <a class="link" href="#im_msvistalog_config_query">Query</a>
	      directive above except that it can be used as a block to help with multi-line XML queries so that
	      there is no need need to add line continuation marks (\) at the end of each line and the
	      XML Query can be directly copied from Event Viewer.
</p><pre class="programlisting">
     &lt;QueryXML&gt;
       &lt;QueryList&gt;
         &lt;Query Id='1'&gt;
           &lt;Select Path='Security'&gt;*[Security/Level=4]&lt;/Select&gt;
         &lt;/Query&gt;
       &lt;/QueryList&gt;
    &lt;/QueryXML&gt;
</pre><p>
	    </p></dd><dt><span class="term"><a name="im_msvistalog_config_channel"></a>Channel</span></dt><dd>
	      The name of the Channel to query. If not specified, the module will read from all
	      sources defined in the registry.
	      See the MSDN docs about 
	      <a class="ulink" href="http://msdn.microsoft.com/en-us/library/aa385231.aspx" target="_top">Event Selection</a>.
	    </dd><dt><span class="term"><a name="im_msvistalog_config_pollinterval"></a>PollInterval</span></dt><dd>
	      This directive specifies in seconds how frequently the module will check for
	      new events. If this directive is not specified it defaults to 1 second.
	      Fractional seconds may be specified, i.e. to check twice every second you should
	      set the following: <em class="replaceable"><code>PollInterval 0.5</code></em>
	    </dd><dt><span class="term"><a name="im_msvistalog_config_batchsize"></a>BatchSize</span></dt><dd>
	      This optional directive can be used to specify the number of event records the EventLog API will pass to
	      the module for processing. Larger sizes may increase throughput.
	      Note that there is a known issue in the EventLog subsystem (i.e Windows bug) when this value is higher than 31
	      it may fail to retrieve some events with the error 
	      <em class="replaceable"><code>EvtNext failed with error 1734: The array bounds are invalid.</code></em> on busy systems 
	      when there are a lot of events generated. For this reason it is not recommended to increase this value.
	      If the BatchSize directive is not specified it defaults to <em class="replaceable"><code>31</code></em>.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Fields generated by im_msvistalog"><div class="titlepage"><div><div><h4 class="title"><a name="im_msvistalog_fields"></a>Fields generated by im_msvistalog</h4></div></div></div><p>
  The following fields are set by im_msvistalog:

  </p><div class="variablelist"><dl><dt><span class="term"><a name="im_msvistalog_field_raw_event"></a>$raw_event</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Contains the EventTime, Hostname, Severity EventID and Message from the event.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_Message"></a>$Message</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Contains the message from the event.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_EventTime"></a>$EventTime</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_datetime">datetime</a></td></tr></table><p>
	Will be set to the EvtSystemTimeCreated field.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_Hostname"></a>$Hostname</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Contains the EvtSystemComputer field.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_SourceName"></a>$SourceName</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The event source which produced the event, this is the EvtSystemProviderName field.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_EventID"></a>$EventID</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The event id as in EvtSystemEventID.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_Task"></a>$Task</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The task number as in EvtSystemTask.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_Category"></a>$Category</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The category name resolved from Task.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_Keywords"></a>$Keywords</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The value of the Keywords field from EvtSystemKeywords.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_Channel"></a>$Channel</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The Channel (e.g. Security, Application) of the event source.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_AccountName"></a>$AccountName</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The username associated with the event.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_AccountType"></a>$AccountType</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The type of the account. Possible values are: User, Group, Domain, Alias, Well Known Group, Deleted Account, Invalid, Unknown, Computer.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_Domain"></a>$Domain</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The domain name of the user.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_UserID"></a>$UserID</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The SID which resolves to AccountName, stored in EvtSystemUserID.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_SeverityValue"></a>$SeverityValue</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	Normalized severity number of the event.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_Severity"></a>$Severity</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Normalized severity name of the event (CRITICAL|ERROR|WARNING|INFO|console.log).
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_EventType"></a>$EventType</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The type of the event which is a string describing the severity.
	This is translated to its string representation from EvtSystemLevel.
	It takes the following values: "CRITICAL", "ERROR", "AUDIT_FAILURE", "AUDIT_SUCCESS", "INFO", "WARNING", "VERBOSE"
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_ProviderGuid"></a>$ProviderGuid</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The GUI of the event's provider as stored in EvtSystemProviderGuid. This corresponds to the name of the provider stored in the SourceName field.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_Version"></a>$Version</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The Version number of the event as in EvtSystemVersion.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_OpcodeValue"></a>$OpcodeValue</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The Opcode number of the event as in EvtSystemOpcode.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_Opcode"></a>$Opcode</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The opcode string resolved from OpcodeValue.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_ActivityID"></a>$ActivityID</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The ActivityID as stored in EvtSystemActivityID.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_RelatedActivityID"></a>$RelatedActivityID</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The RelatedActivityID as stored in EvtSystemRelatedActivityID.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_ProcessID"></a>$ProcessID</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The process identifier of the event producer as in EvtSystemProcessID.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_ThreadID"></a>$ThreadID</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The thread identifier of the event producer as in EvtSystemThreadID.
      </p></dd><dt><span class="term"><a name="im_msvistalog_field_RecordNumber"></a>$RecordNumber</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The number of the event record.
      </p></dd></dl></div><p>

 </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="im_msvistalog_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp35584976"></a><p class="title"><b>Exampleï¿½6.39.ï¿½Forwarding Windows EventLog from a windows machine to a remote host in syslog format</b></p><div class="example-contents"><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module       im_msvistalog
    ReadFromLast TRUE
    &lt;QueryXML&gt;
       &lt;QueryList&gt;
         &lt;Query Id='1'&gt;
	   &lt;Select Path='Application'&gt;*&lt;/Select&gt;
           &lt;Select Path='Security'&gt;*[Security/Level=4]&lt;/Select&gt;
	   &lt;Select Path='System'&gt;*&lt;/Select&gt;
         &lt;/Query&gt;
       &lt;/QueryList&gt;
   &lt;/QueryXML&gt;
&lt;/Input&gt;

&lt;Output out&gt;
    Module       om_tcp
    Host         192.168.1.1
    Port         514
    Exec         to_syslog_bsd();
&lt;/Output&gt;

&lt;Route 1&gt;
    Path        in =&gt; out
&lt;/Route&gt;

</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="Null (im_null)"><div class="titlepage"><div><div><h3 class="title"><a name="im_null"></a>Null (im_null)</h3></div></div></div><p>
    This module does not generate any input, so basically it does nothing.
    Yet it can be useful for creating a dummy route, testing purposes, and it can have 
    <a class="link" href="#config_module_schedule" title="Schedule">Scheduled</a> nxlog code execution as well,
    so it is not completely useless.
    This module does not have any module specific configuration directives.
    See <a class="link" href="#config_example_routes" title="Exampleï¿½4.14.ï¿½Different routes">this example</a> for usage.
  </p></div><div class="section" title="TLS/SSL (im_ssl)"><div class="titlepage"><div><div><h3 class="title"><a name="im_ssl"></a>TLS/SSL (im_ssl)</h3></div></div></div><p>
    The im_ssl module provides an SSL/TLS transport using the OpenSSL library beneath the
    surface. It behaves similarly to the <a class="link" href="#im_tcp" title="TCP (im_tcp)">im_tcp</a> module,
    except that an SSL handshake is performed at connection time and the data is sent over a
    secure channel.
    Because log messages transferred over plain TCP can be eavasdropped or even altered with a 
    man-in-the-middle attack, using the im_ssl module provides a secure log message transport.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="im_ssl_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the im_ssl module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="im_ssl_config_host"></a>Host</span></dt><dd>
	      This specifies the IP address or a dns hostname which the module should 
	      listen on to accept connections.
	    </dd><dt><span class="term"><a name="im_ssl_config_port"></a>Port</span></dt><dd>
	      This specifies the port number which the module will listen on for
	      incoming conenctions.
	    </dd><dt><span class="term"><a name="im_ssl_config_certfile"></a>CertFile</span></dt><dd>
	      This specifies the path of the certificate file to be used in
	      the SSL handshake.
	    </dd><dt><span class="term"><a name="im_ssl_config_certkeyfile"></a>CertKeyFile</span></dt><dd>
	      This specifies the path of the certificate key file to be used in
	      the SSL handshake.
	    </dd><dt><span class="term"><a name="im_ssl_config_keypass"></a>KeyPass</span></dt><dd>
	      Optional password of the certificate key file defined in 
 	      <a class="link" href="#im_ssl_config_certkeyfile">CertKeyFile</a>.
	      For passwordless private keys the directive is not needed.
	    </dd><dt><span class="term"><a name="im_ssl_config_cafile"></a>CAFile</span></dt><dd>
	      This specifies the path of the certificate of the CA which
	      will be used to check the certificate of the remote socket against.
	    </dd><dt><span class="term"><a name="im_ssl_config_cadir"></a>CADir</span></dt><dd>
	      This specifies the path of CA certificates which will be 
	      used to check the certificate of the remote socket against.
	      The cert file names in this directory must be in the OpenSSL hashed format.
	    </dd><dt><span class="term"><a name="im_ssl_config_crlfile"></a>CRLFile</span></dt><dd>
	      This specifies the path of the certificate revocation list (CRL) which
	      will be used to check the certificate of the remote socket against.
	    </dd><dt><span class="term"><a name="im_ssl_config_crldir"></a>CRLDir</span></dt><dd>
	      This specifies the path of certificate revocation lists (CRLs) which will be
	      used to check the certificate of the remote socket against.
	      The file names in this directory must be in the OpenSSL hashed format.
	    </dd><dt><span class="term"><a name="im_ssl_config_requirecert"></a>RequireCert</span></dt><dd>
	      This takes a boolean value of TRUE or FALSE and specifies whether
	      the remote must present a certificate.
	      If set to TRUE and there is no certificate presented during the handshake 
	      of the accepted connection, the connection will be refused.
	      The default value is TRUE if this directive is not specified, meaning that
	      all connections must use a certificate by default.
	    </dd><dt><span class="term"><a name="im_ssl_config_allowuntrusted"></a>AllowUntrusted</span></dt><dd>
	      This takes a boolean value of TRUE or FALSE and specifies whether
	      the remote connection should be allowed without certificate verification.

	      If set to TRUE the remote will be able to connect with unknown and self-signed
	      certificates.
	      The default value is FALSE if this directive is not specified, meaning that
	      all connections must present a trusted certificate by default.
	    </dd><dt><span class="term"><a name="im_ssl_config_inputtype"></a>InputType</span></dt><dd>
	      See the description about <a class="link" href="#config_inputtype" title="InputType">InputType</a>
	      in the global module config section.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Fields generated by im_ssl"><div class="titlepage"><div><div><h4 class="title"><a name="im_ssl_fields"></a>Fields generated by im_ssl</h4></div></div></div><p>
  The following fields are set by im_ssl:

  </p><div class="variablelist"><dl><dt><span class="term"><a name="im_ssl_field_raw_event"></a>$raw_event</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Will be set to the string received.
      </p></dd><dt><span class="term"><a name="im_ssl_field_MessageSourceAddress"></a>$MessageSourceAddress</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Set to the IP address of the remote host.
      </p></dd></dl></div><p>

 </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="im_ssl_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp35641952"></a><p class="title"><b>Exampleï¿½6.40.ï¿½Reading binary data forwarded from another nxlog agent</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input ssl&gt;
    Module	im_ssl
    Host	localhost
    Port	23456
    CAFile	%CERTDIR%/ca.pem
    CertFile	%CERTDIR%/client-cert.pem
    CertKeyFile	%CERTDIR%/client-key.pem
    KeyPass	secret
    InputType	Binary
&lt;/Input&gt;

&lt;Output fileout&gt;
    Module	om_file
    File	"tmp/output"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	ssl =&gt; fileout
&lt;/Route&gt;

</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="TCP (im_tcp)"><div class="titlepage"><div><div><h3 class="title"><a name="im_tcp"></a>TCP (im_tcp)</h3></div></div></div><p>
    This module accepts TCP connections on the address and port specified in the configuration.
    It can handle multiple simultaneous connections.
    The TCP transfer protocol provides more reliable log transmission than UDP.
    If security is a concern, consider using the <a class="link" href="#im_ssl" title="TLS/SSL (im_ssl)">im_ssl</a>
    module instead.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      There is no access control built in the module.
      If you need to deny some hosts connecting to the module's TCP port, you should use
      appropriate firewall rules for this purpose.
    </p></div><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="im_tcp_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the im_tcp module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="im_tcp_config_host"></a>Host</span></dt><dd><p>
	      This specifies the IP address or a dns hostname which the module should 
	      listen on to accept connections.
	    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
		Because of security reasons the default listen address is 
		<em class="replaceable"><code>localhost</code></em> if this
		directive is not specified (the <em class="replaceable"><code>localhost</code></em>
		loopback address is not accessible from the outside). You will most probably want to
		send logs from remote hosts, so make sure that the address specified here is 
		accessible. The any address <em class="replaceable"><code>0.0.0.0</code></em> is commonly used here.
	      </p></div></dd><dt><span class="term"><a name="im_tcp_config_port"></a>Port</span></dt><dd>
	      This specifies the port number which the module will listen on for
	      incoming conenctions.
	      The default port is 514 if this directive is not specified.
	    </dd><dt><span class="term"><a name="im_tcp_config_inputtype"></a>InputType</span></dt><dd>
	      See the description about <a class="link" href="#config_inputtype" title="InputType">InputType</a>
	      in the global module config section.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Fields generated by im_tcp"><div class="titlepage"><div><div><h4 class="title"><a name="im_tcp_fields"></a>Fields generated by im_tcp</h4></div></div></div><p>
  The following fields are set by im_tcp:

  </p><div class="variablelist"><dl><dt><span class="term"><a name="im_tcp_field_raw_event"></a>$raw_event</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Will be set to the string received.
      </p></dd><dt><span class="term"><a name="im_tcp_field_MessageSourceAddress"></a>$MessageSourceAddress</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Set to the IP address of the remote host.
      </p></dd></dl></div><p>

 </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="im_tcp_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp35676368"></a><p class="title"><b>Exampleï¿½6.41.ï¿½Using the im_tcp module</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input in&gt;
    Module	im_tcp
    Host	0.0.0.0
    Port	1514
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"tmp/output"
&lt;/Output&gt;

&lt;Route r&gt;
    Path	in =&gt; out
&lt;/Route&gt;

</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="UDP (im_udp)"><div class="titlepage"><div><div><h3 class="title"><a name="im_udp"></a>UDP (im_udp)</h3></div></div></div><p>
    This module accepts UDP datagrams on the address and port specified in the configuration.
    UDP is the transport protocol of the old BSD syslog standard as described in RFC 3164, 
    so this module can be particularly useful to receive such messages from older devices
    which do not support other transports.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      There is no access control built in the module.
      If you need to deny some hosts sending logs to the module's UDP port, you should use
      appropriate firewall rules for this purpose.
    </p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      UDP packets can be dropped by the operating system because the protocol does not
      guarantee reliable message delivery.
      It is recommended to use the <a class="link" href="#im_tcp" title="TCP (im_tcp)">tcp</a> or
      <a class="link" href="#im_ssl" title="TLS/SSL (im_ssl)">ssl</a> transport modules instead if message loss is a concern.
    </p><p>
      Though nxlog <a class="link" href="#features_no_message_dropping" title="Avoiding lost messages">was designed</a>
      to minimize message loss even in the case of UDP, adjusting the kernel buffers could
      also help in avoiding UDP message loss on a loaded system.
      The <a class="link" href="#config_route_priority" title="Priority">Priority</a> directive in the 
      route block can also help in this situation.
    </p></div><p>
    For parsing syslog messages, take a look at
    the <a class="link" href="#pm_transformer" title="Message format converter (pm_transformer)">pm_transformer</a> module or the
    <a class="link" href="#xm_syslog_proc_to_syslog_bsd">parse_syslog_bsd()</a> procedure of
    the <a class="link" href="#xm_syslog" title="Syslog (xm_syslog)">xm_syslog</a>.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="im_udp_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the im_udp module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="im_udp_config_host"></a>Host</span></dt><dd>
	      This specifies the IP address or a dns hostname which the module should 
	      listen on to accept connections.
	      The default address is "localhost" if this is not specified.
	    </dd><dt><span class="term"><a name="im_udp_config_port"></a>Port</span></dt><dd>
	      This specifies the port number which the module will listen on for
	      incoming conenctions.
	      The default port is 514 if this directive is not specified.
	    </dd><dt><span class="term"><a name="im_udp_config_sockbufsize"></a>SockBufSize</span></dt><dd>
	      This optional directive sets the socket buffer size (SO_RCVBUF) to the value
	      specified. Otherwise the OS defaults are used.
	      If you are experiencing UDP packet loss at the kernel level, setting this to a
	      high value (e.g. 150000000) may help. On Microsoft Windows systems the default
	      socket buffer size is extremely low, using this option is highly recommended.
	    </dd><dt><span class="term"><a name="im_udp_config_inputtype"></a>InputType</span></dt><dd>
	      See the description about <a class="link" href="#config_inputtype" title="InputType">InputType</a>
	      in the global module config section.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Fields generated by im_udp"><div class="titlepage"><div><div><h4 class="title"><a name="im_udp_fields"></a>Fields generated by im_udp</h4></div></div></div><p>
  The following fields are set by im_udp:

  </p><div class="variablelist"><dl><dt><span class="term"><a name="im_udp_field_raw_event"></a>$raw_event</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Will be set to the string received.
      </p></dd><dt><span class="term"><a name="im_udp_field_MessageSourceAddress"></a>$MessageSourceAddress</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Set to the IP address of the remote host.
      </p></dd></dl></div><p>

 </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="im_udp_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp35717392"></a><p class="title"><b>Exampleï¿½6.42.ï¿½Using the im_udp module</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input in&gt;
    Module	im_udp
    Host	192.168.1.1
    Port	514
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"tmp/output"
&lt;/Output&gt;

&lt;Route r&gt;
    Path	in =&gt; out
&lt;/Route&gt;

</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="Unix Domain Socket (im_uds)"><div class="titlepage"><div><div><h3 class="title"><a name="im_uds"></a>Unix Domain Socket (im_uds)</h3></div></div></div><p>
    This module allows log messages to be received over a unix domain socket.
    Traditionally unix systems have a socket, typically /dev/log used by the system
    logger to accept messages from. Applications wishing to send messages to the system log
    use the syslog(3) system call.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      This module supports SOCK_DGRAM type sockets only. SOCK_STREAM type sockets may be supported
      in the future.
    </p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      It is recommended to disable <a class="link" href="#config_module_flowcontrol" title="FlowControl">FlowControl</a>
      when this module is used to collect local syslog from the <code class="filename">/dev/log</code>
      unix domain socket. Otherwise the syslog() system call will block in all programs which
      are trying to write to the system log if the Output queue becomes full and this will result
      in an unresponsive system.
    </p></div><p>
    For parsing syslog messages, take a look at the
    <a class="link" href="#pm_transformer" title="Message format converter (pm_transformer)">pm_transformer</a> module or the
    <a class="link" href="#xm_syslog_proc_to_syslog_bsd">parse_syslog_bsd()</a> procedure of
    the <a class="link" href="#xm_syslog" title="Syslog (xm_syslog)">xm_syslog</a>.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="im_uds_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the im_uds module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="im_uds_config_uds"></a>UDS</span></dt><dd>
	      This specifies the path of the unix domain socket.
	      The default is /dev/log if this is not specified.
	    </dd><dt><span class="term"><a name="im_uds_config_inputtype"></a>InputType</span></dt><dd>
	      See the description about <a class="link" href="#config_inputtype" title="InputType">InputType</a>
	      in the global module config section.
	      This defaults to <em class="replaceable"><code>dgram</code></em> if not specified because
	      unix domain sockets are SOCK_DGRAM type on Linux and the module does not yet support
	      SOCK_STREAM sockets.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="im_uds_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp35739136"></a><p class="title"><b>Exampleï¿½6.43.ï¿½Using the im_uds module</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input unix&gt;
    Module	im_uds
    uds		/dev/log
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"/var/log/messages"
&lt;/Output&gt;

&lt;Route 1&gt;
       Path unix =&gt; out
&lt;/Route&gt;

</pre></div></div><p><br class="example-break">
    </p></div></div></div><div class="section" title="Processor modules"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="modules_processor"></a>Processor modules</h2></div></div></div><p>
   </p><div class="section" title="Blocker (pm_blocker)"><div class="titlepage"><div><div><h3 class="title"><a name="pm_blocker"></a>Blocker (pm_blocker)</h3></div></div></div><p>
    This module can block log messages and can be used to simulate when a route is blocked.
    When the module blocks the data flow, log messages are first accumulated in the buffers,
    and then the flow-control mechanism pauses the input modules.
    Using the <a class="link" href="#pm_blocker_proc_block">block()</a> procedure it is possibile
    to programatically stop or resume the data flow. It can be useful for real-world scenarios
    as well as testing. See the examples below.
    When the module starts, the blocking mode is disabled by default, i.e. it operate
    just like <a class="link" href="#pm_null" title="Null (pm_null)">pm_null</a> would.
  </p><div class="section" title="Functions and procedures exported by pm_blocker"><div class="titlepage"><div><div><h4 class="title"><a name="pm_blocker_funcproc"></a>Functions and procedures exported by pm_blocker</h4></div></div></div><div class="section" title="Functions exported by pm_blocker"><div class="titlepage"><div><div><h5 class="title"><a name="pm_blocker_functions"></a>Functions exported by pm_blocker</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="pm_blocker_func_is_blocking"></a>
       <code class="function">boolean is_blocking();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Return TRUE if the module is currently blocking the data flow, FALSE otherwise.
     </dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_boolean">boolean</a>
           </dd></dl></div></dd></dl></div></div><div class="section" title="Procedures exported by pm_blocker"><div class="titlepage"><div><div><h5 class="title"><a name="pm_blocker_procedures"></a>Procedures exported by pm_blocker</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="pm_blocker_proc_block"></a>
       <code class="function">block(boolean mode);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       When mode is TRUE, the module will block. You should call block(FALSE)
       from a schedule block or another module, otherwise it might not get invoked
       if the queue is already full.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">mode</span></dt><dd>
                type: <a class="link" href="#lang_type_boolean">boolean</a>
               </dd></dl></div></dd></dl></div></dd></dl></div></div></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="pm_blocker_config_examples"></a>Configuration examples</h4></div></div></div><div class="example"><a name="idp35770400"></a><p class="title"><b>Exampleï¿½6.44.ï¿½Using the pm_blocker module</b></p><div class="example-contents"><p>
	In this example we collect messages received over UDP and forward it to another host
	via TCP. The log data is forwarded during non-working hours between 19 pm and 8 am.
	During the other half of the day data is buffered on the disk to be sent out only after
	19 pm.
	</p><pre class="programlisting">
&lt;Input in&gt;
    Module	im_udp
    Host	0.0.0.0
    Port	1514
&lt;/Input&gt;

&lt;Processor buffer&gt;
    Module      pm_buffer
    # 100Mb disk buffer
    MaxSize	102400
    Type	disk
&lt;/Processor&gt;

&lt;Processor blocker&gt;
    Module	pm_blocker
    &lt;Schedule&gt;
	When	0 8 * * *
	Exec	blocker-&gt;block(TRUE);
    &lt;/Schedule&gt;
    &lt;Schedule&gt;
	When	0 19 * * *
	Exec	blocker-&gt;block(FALSE);
    &lt;/Schedule&gt;
&lt;/Processor&gt;

&lt;Output out&gt;
    Module	om_tcp
    Host	192.168.1.1
    Port	1514
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; buffer =&gt; blocker =&gt; out
&lt;/Route&gt;
</pre><p>
      </p></div></div><br class="example-break"></div></div><div class="section" title="Buffer (pm_buffer)"><div class="titlepage"><div><div><h3 class="title"><a name="pm_buffer"></a>Buffer (pm_buffer)</h3></div></div></div><p>
    Messages received over UDP may be dropped by the operating system unless packets are
    read from the message buffer fast enough. Some logging subsystems using a small circular
    buffer can also overwrite logs old logs in the buffer if it is not read, thus there is a
    chance of missing important log data.  Such situations can lead to
    <a class="link" href="#features_no_message_dropping" title="Avoiding lost messages">dropped or lost messages</a>
    and other problems where buffering can help.
  </p><p>
    The pm_buffer module supports disk and memory based log message buffering.
    If both are required, multiple pm_buffer instances can be used with different settings.
    Because a memory buffer can be faster, though its size is limited, combining memory and
    disk based buffering can be a good idea in case buffering is frequently used.
  </p><p>
    The disk based buffering mode stores the log message data in chunks. When all the data is
    successfully forwarded from a chunk, it is then deleted in order to save disk space.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      Using pm_buffer is only recommended when there is a chance of message loss.
      The built-in flow-control in nxlog ensures that messages will not be read by the input
      module until the output side can send/store/forward.
      When reading from files (with <a class="link" href="#im_file" title="File (im_file)">im_file</a>)
      or the Windows Eventlog (with <a class="link" href="#im_mseventlog" title="MS EventLog for Windows XP/2000/2003 (im_mseventlog)">im_mseventlog</a> or
      <a class="link" href="#im_msvistalog" title="MS EventLog for Windows 2008/Vista and later (im_msvistalog)">im_msvistalog</a>) it is rarely necessary to use
      the pm_buffer module unless there is a chance of log rotation (and thus a possibility
      of missing some data) while the output module (e.g. TCP or SSL) is being blocked.
    </p></div><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="pm_buffer_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the pm_buffer module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_buffer_config_maxsize"></a>MaxSize</span></dt><dd>
	      Specifies the size of the buffer in kilobytes. This paramater is mandatory.
	    </dd><dt><span class="term"><a name="pm_buffer_config_warnlimit"></a>WarnLimit</span></dt><dd>
	      Specifies an optional limit smaller than 
	      <a class="link" href="#pm_buffer_config_maxsize">MaxSize</a> which will trigger a warning
	      message when reached.
	      The log message will not be emitted again until the buffer size drops to half
	      of WarnLimit and reaches it again in order to protect against a warning message flood.
	    </dd><dt><span class="term"><a name="pm_buffer_config_type"></a>Type</span></dt><dd>
	      Type can be either 'Mem' or 'Disk' to select memory or disk based buffering
	      respectively.
	    </dd><dt><span class="term"><a name="pm_buffer_config_directory"></a>Directory</span></dt><dd>
	      Name of the directory used to store the disk buffer file chunks.
	      This is only valid with
	      <a class="link" href="#pm_buffer_config_type">Type</a> set to 'Disk' mode.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Functions and procedures exported by pm_buffer"><div class="titlepage"><div><div><h4 class="title"><a name="pm_buffer_funcproc"></a>Functions and procedures exported by pm_buffer</h4></div></div></div><div class="section" title="Functions exported by pm_buffer"><div class="titlepage"><div><div><h5 class="title"><a name="pm_buffer_functions"></a>Functions exported by pm_buffer</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="pm_buffer_func_buffer_size"></a>
       <code class="function">integer buffer_size();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Return the size of the memory buffer in bytes.
     </dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="pm_buffer_func_buffer_count"></a>
       <code class="function">integer buffer_count();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Return the number of log messages held in the memory buffer.
     </dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd></dl></div></div></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="pm_buffer_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp35815664"></a><p class="title"><b>Exampleï¿½6.45.ï¿½Using a memory buffer to protect against udp message loss</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input udp&gt;
    Module	im_udp
    Host	0.0.0.0
    Port	514
&lt;/Input&gt;

&lt;Processor buffer&gt;
    Module      pm_buffer
    # 1Mb buffer
    MaxSize	1024
    Type	Mem
    # warn at 512k
    WarnLimit	512
&lt;/Processor&gt;

&lt;Output tcp&gt;
    Module	om_tcp
    Host	192.168.1.1
    Port	1514
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	udp =&gt; buffer =&gt; tcp
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="Event correlator (pm_evcorr)"><div class="titlepage"><div><div><h3 class="title"><a name="pm_evcorr"></a>Event correlator (pm_evcorr)</h3></div></div></div><p>
    The pm_evcorr module provides event correlation functionality in addition to
    the already available nxlog language features such as
    <a class="link" href="#lang_variables" title="Variables">variables</a> and 
    <a class="link" href="#lang_stat" title="Statistical counters">statistical counters</a> which can be also used for 
    event correlation purposes.
  </p><p>
    This module was greatly inspired by the Perl based correlation tool
    <a class="ulink" href="http://simple-evcorr.sourceforge.net/" target="_top">SEC</a>. Some of the rules of the
    pm_evcorr module were designed to mimic those available in SEC.
    This module aims to be a better alternative to SEC with the following advantages:
    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
	  The correlation rules in SEC work with the current time. With pm_evcorr it is possible
	  to specify a time field wich is used for elapsed time calculation making
	  <a class="link" href="#features_offline_mode" title="Offline processing mode">offline</a> event correlation also possible.
	</p></li><li class="listitem"><p>
	  SEC uses regular expressions extensively which can become quite slow in case of
	  many correlation rules. In contrast this module can correlate preprocessed
	  messages using fields for example from the <a class="link" href="#pm_pattern" title="Pattern matcher (pm_pattern)">pattern matcher</a>
	  and the <a class="link" href="#xm_syslog" title="Syslog (xm_syslog)">syslog</a> parser without requiring the use of regular
	  expressions (though these are also available for use by correlation rules). 
	  Thus testing conditions can be significantly faster when simple comparison is used
	  instead of regular expression based pattern matching.
	</p></li><li class="listitem"><p>
	  This module was designed to operate on fields thus making it possible to correlate
	  structured logs in addition to simple free-form log messages.
	</p></li><li class="listitem"><p>
	  Most importantly, this module is written in C and SEC is pure Perl which could have
	  major performance benefits.
	</p></li></ul></div><p>
  </p><p>
    The rulesets of this module can use a context. A context is an expression which is
    evaluated during runtime to a value and the correlation rule is checked in the context
    of this value. For example if we wanted to count the number of failed logins per user
    and alert if the failed logins exceed 3 for the user, then we'd use the $AccountName
    as the context.
    There is a separate context storage is for each correlation rule instance. If you need
    global contexts accessible from all rule instances, take a look at 
    <a class="link" href="#lang_variables" title="Variables">module variables</a> and 
    <a class="link" href="#lang_stat" title="Statistical counters">statistical counters</a>.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="pm_evcorr_config"></a>Configuration</h4></div></div></div><p>
      The pm_evcorr configuration contains correlation rules which are evaluated for each 
      log message processed by the module.
      Currently there are five rule types supported by pm_evcorr:
      <a class="link" href="#pm_evcorr_config_simple">Simple</a>,
      <a class="link" href="#pm_evcorr_config_suppressed">Suppressed</a>,
      <a class="link" href="#pm_evcorr_config_pair">Pair</a>,
      <a class="link" href="#pm_evcorr_config_absence">Absence</a> and
      <a class="link" href="#pm_evcorr_config_thresholded">Thresholded</a>. These rules are defined
      in config blocks.
      The order of the rules is important because the rules are evaluated in the order they
      are defined. For example a correlation rule can change a state, variable or field which
      can be then used by a later rule.
      <a class="link" href="#config_include" title="File inclusion">File inclusion</a> can be useful to move the correlation
      rules into a standalone file.
    </p><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the pm_evcorr module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_evcorr_config_timefield"></a>TimeField</span></dt><dd><p>
	      Specifies the name of the <a class="link" href="#lang_fields" title="Fields">field</a> to use
	      for calculating elapsed time such as 'EventTime'.
	      The name of the field must be specified without the leading dollar "$" sign.
	      If this parameter is not specified, the current time is assumed.
	      This directive makes it possible to accurately correlate events based on the 
	      event time recorded in the logs and to do non real-time event correlation also.
	    </p></dd><dt><span class="term"><a name="pm_evcorr_config_contextcleantime"></a>ContextCleanTime</span></dt><dd><p>
	      When a Context is used in the correlation rules, these must be purged from
	      memory after they are expired, otherwise using too many context values could
	      result in a high memory usage.
	      This optional directive specifies the interval between context cleanups in
	      seconds.
	      By default a 1 minute cleanup interval is used if any rules use a Context and
	      this directive is not specified.
	    </p></dd><dt><span class="term"><a name="pm_evcorr_config_simple"></a>Simple</span></dt><dd><p>
	      This rule is essentially the same as the
	      <a class="link" href="#config_module_exec" title="Exec">Exec</a> directive supported by all modules.
	      Because <a class="link" href="#config_module_exec" title="Exec">Exec</a>s are evaluated before
	      the correlation rules, the Simple rule was also needed to be able to 
	      evaluate a statement as the other rules do, following the rule order.
	      The Simple block has one directive also with the same name.
	      </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_evcorr_config_simple_exec"></a>Exec</span></dt><dd>
		      One or more Exec directives must be specified which takes
		      a <a class="link" href="#lang_statements" title="Statements">statement</a> as argument.
		    </dd></dl></div><p>
	    </p></dd><dt><span class="term"><a name="pm_evcorr_config_suppressed"></a>Suppressed</span></dt><dd><p>
	      This rule matches the given condition. If the condition evaluates to TRUE,
	      the statement specified with the 
	      <a class="link" href="#pm_evcorr_config_suppressed_exec">Exec</a> directive is
	      evaluated.
	      The rule will then ignore any log messages for the time specified with
	      <a class="link" href="#pm_evcorr_config_suppressed_interval">Interval</a> directive.
	      For example this rule is useful to suppress creating many alerts in a short
	      period when a condition is satisfied.
	      </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_evcorr_config_suppressed_condition"></a>Condition</span></dt><dd>
		      This mandatory directive takes an expression as argument which must
		      evaluate to a <a class="link" href="#lang_type_boolean">boolean</a> value.
		    </dd><dt><span class="term"><a name="pm_evcorr_config_suppressed_interval"></a>Interval</span></dt><dd>
		      This mandatory directive takes an integer argument specifying the 
		      number of seconds to ignore the condition.
		      The <a class="link" href="#pm_evcorr_config_timefield">TimeField</a>
		      directive is used to calculate time.
		    </dd><dt><span class="term"><a name="pm_evcorr_config_suppressed_context"></a>Context</span></dt><dd>
		      This optional directive specifies an expression to be used as the context.
		      It must evaluate to a value. Most often a field is specified here.
		    </dd><dt><span class="term"><a name="pm_evcorr_config_suppressed_exec"></a>Exec</span></dt><dd>
		      One or more Exec directives must be specified which takes
		      a <a class="link" href="#lang_statements" title="Statements">statement</a> as argument.
		    </dd></dl></div><p>
	    </p></dd><dt><span class="term"><a name="pm_evcorr_config_pair"></a>Pair</span></dt><dd><p>
	      When <a class="link" href="#pm_evcorr_config_pair_triggercondition">TriggerCondition</a>
	      evaluates to TRUE, this rule type will wait 
	      <a class="link" href="#pm_evcorr_config_pair_interval">Interval</a> seconds
	      for <a class="link" href="#pm_evcorr_config_pair_requiredcondition">RequiredCondition</a> to
	      become TRUE, it then executes the statement(s) in the
	      <a class="link" href="#pm_evcorr_config_pair_exec">Exec</a> directive(s).
	      </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_evcorr_config_pair_triggercondition"></a>TriggerCondition</span></dt><dd>
		      This mandatory directive takes an expression as argument which must
		      evaluate to a <a class="link" href="#lang_type_boolean">boolean</a> value.
		    </dd><dt><span class="term"><a name="pm_evcorr_config_pair_requiredcondition"></a>RequiredCondition</span></dt><dd>
		      This mandatory directive takes an expression as argument which must
		      evaluate to a <a class="link" href="#lang_type_boolean">boolean</a> value.
		      When this evaluates to TRUE after 
		      <a class="link" href="#pm_evcorr_config_pair_triggercondition">TriggerCondition</a> evaluated
		      to TRUE within 
		      <a class="link" href="#pm_evcorr_config_pair_interval">Interval</a> seconds,
		      the statement(s) in the
		      <a class="link" href="#pm_evcorr_config_pair_exec">Exec</a> directive(s) are
		      executed.
		    </dd><dt><span class="term"><a name="pm_evcorr_config_pair_interval"></a>Interval</span></dt><dd>
		      Thisdirective takes an integer argument specifying the 
		      number of seconds to wait for 
		      <a class="link" href="#pm_evcorr_config_pair_requiredcondition">RequiredCondition</a>
		      to become TRUE.
		      If this directive is 0 or not specified, the rule will wait
		      indefinitely for 
		      <a class="link" href="#pm_evcorr_config_pair_requiredcondition">RequiredCondition</a>
		      to become TRUE.
		      The <a class="link" href="#pm_evcorr_config_timefield">TimeField</a>
		      directive is used to calculate time.
		    </dd><dt><span class="term"><a name="pm_evcorr_config_pair_context"></a>Context</span></dt><dd>
		      This optional directive specifies an expression to be used as the context.
		      It must evaluate to a value. Most often a field is specified here.
		    </dd><dt><span class="term"><a name="pm_evcorr_config_pair_exec"></a>Exec</span></dt><dd>
		      One or more Exec directives must be specified which takes
		      a <a class="link" href="#lang_statements" title="Statements">statement</a> as argument.
		    </dd></dl></div><p>
	    </p></dd><dt><span class="term"><a name="pm_evcorr_config_absence"></a>Absence</span></dt><dd><p>
	      This rule type does the opposite of <a class="link" href="#pm_evcorr_config_pair">Pair</a>.
	      When <a class="link" href="#pm_evcorr_config_absence_triggercondition">TriggerCondition</a>
	      evaluates to TRUE, this rule type will wait 
	      <a class="link" href="#pm_evcorr_config_absence_interval">Interval</a> seconds
	      for <a class="link" href="#pm_evcorr_config_absence_requiredcondition">RequiredCondition</a> to
	      become TRUE. If it does not become TRUE it then executes the statement(s) in the
	      <a class="link" href="#pm_evcorr_config_absence_exec">Exec</a> directive(s).
	      </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_evcorr_config_absence_triggercondition"></a>TriggerCondition</span></dt><dd>
		      This mandatory directive takes an expression as argument which must
		      evaluate to a <a class="link" href="#lang_type_boolean">boolean</a> value.
		    </dd><dt><span class="term"><a name="pm_evcorr_config_absence_requiredcondition"></a>RequiredCondition</span></dt><dd>
		      This mandatory directive takes an expression as argument which must
		      evaluate to a <a class="link" href="#lang_type_boolean">boolean</a> value.
		      When this evaluates to TRUE after 
		      <a class="link" href="#pm_evcorr_config_absence_triggercondition">TriggerCondition</a> evaluated
		      to TRUE within 
		      <a class="link" href="#pm_evcorr_config_absence_interval">Interval</a> seconds,
		      the statement(s) in the
		      <a class="link" href="#pm_evcorr_config_absence_exec">Exec</a> directive(s) are
		      NOT executed.
		    </dd><dt><span class="term"><a name="pm_evcorr_config_absence_interval"></a>Interval</span></dt><dd>
		      This mandatory directive takes an integer argument specifying the 
		      number of seconds to wait for 
		      <a class="link" href="#pm_evcorr_config_absence_requiredcondition">RequiredCondition</a>
		      to become TRUE. Its value must be greater than 0.
		      The <a class="link" href="#pm_evcorr_config_timefield">TimeField</a>
		      directive is used to calculate time.
		    </dd><dt><span class="term"><a name="pm_evcorr_config_absence_context"></a>Context</span></dt><dd>
		      This optional directive specifies an expression to be used as the context.
		      It must evaluate to a value. Most often a field is specified here.
		    </dd><dt><span class="term"><a name="pm_evcorr_config_absence_exec"></a>Exec</span></dt><dd><p>
		      One or more Exec directives must be specified which takes
		      a <a class="link" href="#lang_statements" title="Statements">statement</a> as argument.
		      </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
			  The evaluation of this Exec is not triggered by a log event,
			  thus it does not make sense to use log data related operations
			  such as accessing fields.
			</p></div><p>
		    </p></dd></dl></div><p>
	    </p></dd><dt><span class="term"><a name="pm_evcorr_config_thresholded"></a>Thresholded</span></dt><dd><p>
	      This rule will execute the statement(s) in the
	      <a class="link" href="#pm_evcorr_config_thresholded_exec">Exec</a> directive(s)
	      if the 
	      <a class="link" href="#pm_evcorr_config_thresholded_condition">Condition</a>
	      evaluates to TRUE 
	      <a class="link" href="#pm_evcorr_config_thresholded_threshold">Threshold</a> or
	      more times during the 
	      <a class="link" href="#pm_evcorr_config_thresholded_interval">Interval</a> specified.
	      The advantage of this rule over the use of 
	      <a class="link" href="#lang_stat" title="Statistical counters">statistical counters</a> is that the time window
	      is dynamic and shifts as log messages are processed. Thus the problem described 
	      <a class="link" href="#lang_variable_example_corr_note">in this</a> example
	      is not present with this rule.
	      </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_evcorr_config_thresholded_condition"></a>Condition</span></dt><dd>
		      This mandatory directive takes an expression as argument which must
		      evaluate to a <a class="link" href="#lang_type_boolean">boolean</a> value.
		    </dd><dt><span class="term"><a name="pm_evcorr_config_thresholded_interval"></a>Interval</span></dt><dd>
		      This mandatory directive takes an integer argument specifying a time
		      window for 
		      <a class="link" href="#pm_evcorr_config_thresholded_condition">Condition</a>
		      to become TRUE. Its value must be greater than 0.
		      The <a class="link" href="#pm_evcorr_config_timefield">TimeField</a>
		      directive is used to calculate time.
		      This time window is dynamic, meaning that it will shift.
		    </dd><dt><span class="term"><a name="pm_evcorr_config_thresholded_threshold"></a>Threshold</span></dt><dd>
		      This mandatory directive takes an integer argument specifying the number
		      of times 
		      <a class="link" href="#pm_evcorr_config_thresholded_condition">Condition</a>
		      must evaluate to TRUE within the given time 
		      <a class="link" href="#pm_evcorr_config_thresholded_interval">Interval</a>.
		      When the treshold is reached, the module executes the statement(s) in the
		      <a class="link" href="#pm_evcorr_config_thresholded_exec">Exec</a> directive(s).
		    </dd><dt><span class="term"><a name="pm_evcorr_config_thresholded_context"></a>Context</span></dt><dd>
		      This optional directive specifies an expression to be used as the context.
		      It must evaluate to a value. Most often a field is specified here.
		    </dd><dt><span class="term"><a name="pm_evcorr_config_thresholded_exec"></a>Exec</span></dt><dd>
		      One or more Exec directives must be specified which takes
		      a <a class="link" href="#lang_statements" title="Statements">statement</a> as argument.
		    </dd></dl></div><p>
	    </p></dd><dt><span class="term"><a name="pm_evcorr_config_stop"></a>Stop</span></dt><dd><p>
	      This rule will stop evaluating successive rules if the
	      <a class="link" href="#pm_evcorr_config_stop_condition">Condition</a>
	      evaluates to TRUE.
	      The optional <a class="link" href="#pm_evcorr_config_stop_exec">Exec</a> directive
	      will be evaluated in this case.
	      </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_evcorr_config_stop_condition"></a>Condition</span></dt><dd>
		      This mandatory directive takes an expression as argument which must
		      evaluate to a <a class="link" href="#lang_type_boolean">boolean</a> value.
		      When it evaluates to TRUE, the correlation rule engine will stop
		      checking any further rules.
		    </dd><dt><span class="term"><a name="pm_evcorr_config_stop_exec"></a>Exec</span></dt><dd>
		      One or more Exec directives can be specified which takes
		      a <a class="link" href="#lang_statements" title="Statements">statement</a> as argument.
		      This will be evaluated when the specified
		      <a class="link" href="#pm_evcorr_config_stop_condition">Condition</a> is
		      satisfied. This Exec directive is optional.
		    </dd></dl></div><p>
	    </p></dd></dl></div><p>
    </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="pm_evcorr_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp35957408"></a><p class="title"><b>Exampleï¿½6.46.ï¿½Correlation rules</b></p><div class="example-contents"><p>
	  This following configuration sample contains a rule for each type.
	  </p><pre class="programlisting">
&lt;Input in&gt;
    Module	im_file
    File	"modules/processor/evcorr/testinput_evcorr2.txt"
    SavePos	FALSE
    ReadFromLast FALSE
    Exec	if ($raw_event =~ /^(\d\d\d\d-\d\d-\d\d \d\d:\d\d:\d\d) (.+)/) {  \
                    $EventTime = parsedate($1);                                   \
                    $Message = $2;                                                \
                    $raw_event = $Message;                                        \
                }
&lt;/Input&gt;

&lt;Input internal&gt;
    Module	im_internal
    Exec	$raw_event = $Message;
    Exec	$EventTime = 2010-01-01 00:01:00;
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	'tmp/output'
&lt;/Output&gt;

&lt;Processor evcorr&gt;
    Module	   pm_evcorr
    TimeField	   EventTime

    &lt;Simple&gt;
	Exec	   if $Message =~ /^simple/ $raw_event = "got simple";
    &lt;/Simple&gt;

    &lt;Suppressed&gt;
	# match input event and execute an action list, but ignore the following
    	# matching events for the next t seconds.
      	Condition  $Message =~ /^suppressed/
   	Interval   30
   	Exec	   $raw_event = "suppressing..";
    &lt;/Suppressed&gt;

    &lt;Pair&gt;
	# If TriggerCondition is true, wait Interval seconds for RequiredCondition to be true and then do the Exec
    	# If Interval is 0, there is no window on matching
       	TriggerCondition  $Message =~ /^pair-first/
       	RequiredCondition $Message =~ /^pair-second/
       	Interval   30
       	Exec	   $raw_event = "got pair";
    &lt;/Pair&gt;

    &lt;Absence&gt;
	# If TriggerCondition is true, wait Interval seconds for RequiredCondition to be true. 
	# If RequiredCondition does not become true within the specified interval then do the Exec
	TriggerCondition  $Message =~ /^absence-trigger/
   	RequiredCondition $Message =~ /^absence-required/
   	Interval 	  10
   	Exec	 	  log_info("'absence-required' not received within 10 secs");
    &lt;/Absence&gt;

    &lt;Thresholded&gt;
	# if the number of events exceeeds the given threshold within the interval do the Exec
    	# Same as SingleWithThreshold in SEC
       	Condition  $Message =~ /^thresholded/
       	Threshold  3
       	Interval   60
       	Exec	   $raw_event = "got thresholded";
    &lt;/Thresholded&gt;

    &lt;Stop&gt;
        Condition  $EventTime &lt; 2010-01-02 00:00:00
	Exec	   log_console.log("got stop");
    &lt;/Stop&gt;

    &lt;Simple&gt;
        # This will be rewritten only if the previous Stop condition is FALSE
	Exec	$raw_event = "rewritten";
    &lt;/Simple&gt;

&lt;/Processor&gt;

&lt;Route 1&gt;
    Path	in, internal =&gt; evcorr =&gt; out
&lt;/Route&gt;


</pre><p>
	  The contents of the input file are the following:
	  </p><pre class="programlisting">
2010-01-01 00:00:00 Not simple
2010-01-01 00:00:01 suppressed1 - Suppress kicks in, will log 'suppressing..'
2010-01-01 00:00:10 simple1
2010-01-01 00:00:12 pair-first - now look for pair-second
2010-01-01 00:00:13 thresholded1
2010-01-01 00:00:15 thresholded2
2010-01-01 00:00:19 simple2
2010-01-01 00:00:20 thresholded3 - will log 'got thresholded'
2010-01-01 00:00:21 suppressed2 - suppressed and logged as is
2010-01-01 00:00:22 pair-second - will log 'got pair'
2010-01-01 00:00:23 suppressed3 - suppressed and logged as is
2010-01-01 00:00:25 pair-first
2010-01-01 00:00:26 absence-trigger
2010-01-01 00:00:29 absence-required - will not log 'got absence'
2010-01-01 00:00:46 absence-trigger
2010-01-01 00:00:56 pair-second - will not log 'got pair' because it is over the interval
2010-01-01 00:00:57 absence-required - will log an additional 'absence-required not received within 10 secs'
2010-01-02 00:00:00 this will be rewritten 
2010-01-02 00:00:10 this too

</pre><p>
	  After this is processed, the resulting output will contain these lines:
	  </p><pre class="programlisting">
Not simple
suppressing..
got simple
pair-first - now look for pair-second
thresholded1
thresholded2
got simple
got thresholded
suppressed2 - suppressed and logged as is
got pair
suppressed3 - suppressed and logged as is
pair-first
absence-trigger
absence-required - will not log 'got absence'
absence-trigger
pair-second - will not log 'got pair' because it is over the interval
absence-required - will log an additional 'absence-required not received within 10 secs'
rewritten
rewritten
'absence-required' not received within 10 secs

</pre><p>
	</p></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="Filter (pm_filter)"><div class="titlepage"><div><div><h3 class="title"><a name="pm_filter"></a>Filter (pm_filter)</h3></div></div></div><p>
    This is a simple module which forwards log messages if the specified condition is TRUE.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      This module has been obsoleted by the nxlog language because filtering is now possible
      in any module using the <a class="link" href="#core_proc_drop">drop()</a> procedure
      conditionally in the <a class="link" href="#config_module_exec" title="Exec">Exec</a> directive.
      </p><div class="example"><a name="idp35972480"></a><p class="title"><b>Exampleï¿½6.47.ï¿½Dropping messages conditionally</b></p><div class="example-contents"><pre class="programlisting">
if $raw_event =~ /^console.log/ drop();
</pre></div></div><p><br class="example-break">
    </p></div><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="pm_filter_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the pm_filter module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_filter_config_condition"></a>Condition</span></dt><dd>
	      This mandatory directive takes an expression as argument which must
	      evaluate to a <a class="link" href="#lang_type_boolean">boolean</a> value.
	      If the expression does not evaluate to TRUE, the log message is discarded.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="pm_filter_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp35982464"></a><p class="title"><b>Exampleï¿½6.48.ï¿½Filtering messages</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input unix&gt;
    Module	im_uds
    uds		/dev/log
&lt;/Input&gt;

&lt;Processor filter&gt;
    Module pm_filter
    Condition $raw_event =~ /failed/ or $raw_event =~ /error/
&lt;/Processor&gt;

&lt;Output out&gt;
    Module	om_file
    File	"/var/log/error"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path unix =&gt; filter =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="Message deduplicator (pm_norepeat)"><div class="titlepage"><div><div><h3 class="title"><a name="pm_norepeat"></a>Message deduplicator (pm_norepeat)</h3></div></div></div><p>
    This module can be used to filter out repeating messages. Similarly to syslog daemons,
    this module checks the previous message against the current. If they match, the current
    message is dropped. The module waits one second for duplicated messages to arrive. 
    If duplicates are detected, the first message is forwarded, the rest is dropped and
    a message containing "last message repeated X times" is sent instead.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="pm_norepeat_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the pm_norepeat module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_norepeat_config_checkfields"></a>CheckFields</span></dt><dd>
	      This optional directive takes a comma separated list of field names
	      which are used to compare log messages. Only the fields listed here
	      are compared, the others are ignored. For example the 'EventTime'
	      field will be different in repeating messages, so this field should not be used 
	      in the comparison.
	      If this directive is not specified, the default field to be checked is
	      'Message'.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Fields generated by pm_norepeat"><div class="titlepage"><div><div><h4 class="title"><a name="pm_norepeat_fields"></a>Fields generated by pm_norepeat</h4></div></div></div><p>
  The following fields are set by pm_norepeat:

  </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_norepeat_field_raw_event"></a>$raw_event</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Will be set to "last message repeated X times".
      </p></dd><dt><span class="term"><a name="pm_norepeat_field_Message"></a>$Message</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Set to the same value as $raw_event.
      </p></dd><dt><span class="term"><a name="pm_norepeat_field_SeverityValue"></a>$SeverityValue</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	Its value will be set to 6 which is the "info" severity level.
      </p></dd><dt><span class="term"><a name="pm_norepeat_field_Severity"></a>$Severity</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	The severity name of the event.
      </p></dd><dt><span class="term"><a name="pm_norepeat_field_EventTime"></a>$EventTime</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_datetime">datetime</a></td></tr></table><p>
	Will be set to the time of the last event or the current time if EventTime was not present in the last event.
      </p></dd><dt><span class="term"><a name="pm_norepeat_field_SourceName"></a>$SourceName</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
	Will be set to 'nxlog'.
      </p></dd><dt><span class="term"><a name="pm_norepeat_field_ProcessID"></a>$ProcessID</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
	The field is filled with the process id of the nxlog process.
      </p></dd></dl></div><p>

 </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="pm_norepeat_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp36031472"></a><p class="title"><b>Exampleï¿½6.49.ï¿½Filtering out duplicated messages</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input in&gt;
    Module	im_uds
    UDS		/dev/log
&lt;/Input&gt;

&lt;Processor norepeat&gt;
    Module	pm_norepeat
    CheckFields	Hostname, SourceName, Message
&lt;/Processor&gt;

&lt;Output out&gt;
    Module	om_file
    File	"/var/log/messages"
&lt;/Output&gt;


&lt;Route 1&gt;
    Path	in =&gt; norepeat =&gt; out
&lt;/Route&gt;

</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="Null (pm_null)"><div class="titlepage"><div><div><h3 class="title"><a name="pm_null"></a>Null (pm_null)</h3></div></div></div><p>
    This module does not do any special processing, so basically it does nothing.
    Though the <a class="link" href="#config_module_exec" title="Exec">Exec</a> and the 
    <a class="link" href="#config_module_schedule" title="Schedule">Schedule</a> directive is available
    in this module just like in any other, thus it can be quite useful.
    This module does not have any module specific configuration directives.
    See <a class="link" href="#xm_syslog_example2" title="Exampleï¿½6.27.ï¿½Conditional rewrite of the syslog facility - version 2">this example</a> for usage.
  </p></div><div class="section" title="Pattern matcher (pm_pattern)"><div class="titlepage"><div><div><h3 class="title"><a name="pm_pattern"></a>Pattern matcher (pm_pattern)</h3></div></div></div><p>
    This module makes it possible to execute pattern matching efficiently using a pattern
    database file in XML format.
    Using this module is more efficient than having nxlog regular expression rules
    listed in <a class="link" href="#config_module_exec" title="Exec">Exec</a> directives, because the
    pm_pattern module was designed in such a way that patterns need not to be matched linearly.
    In addition, the module does an automatic on-the-fly pattern reordering internally for
    further speed improvements and it has a feature which can be used to tag messages
    with additional fields useful for message classification.
    See the <a class="link" href="#processing_pattern_matching" title="Pattern matching and message classification">Pattern matching and message classification</a>
    section for additional examples.
  </p><p>
    Regular expressions are the most widely used in pattern matching. Unfortunately 
    using a large number of regular expression based patterns does not scale well, because
    these need to be evaluated linearly. There are other techniques such as the radix tree
    which solve the linearity problem, the drawback is that usually these require a special
    syntax for specifying patterns which users must learn.
    If the log message is already parsed and is not treated as single line of message,
    then it is possible to process only a subset of the patterns which partially solves the 
    linearity problem.
    With the other performance improvement tricks employed within the pm_pattern module, its
    speed can compare to the other techniques such as a radix tree based pattern matcher. Yet
    the pm_pattern module can keep using regular expressions which all programmers and system
    administrators are familiar with and this also provides an easy migration of regexp
    patterns from other tools and already existing patterns.
  </p><p>
    Traditionally pattern matching on log messages has employed a technique where the 
    log message was one string and the pattern (regular expression or radix tree based pattern)
    was executed against it. To match patterns against logs which contain structured data
    (such as the Windows EventLog), this structured data (the fields of the log) must be
    converted to a single string. This is a simple but inefficient method used by many
    tools.
  </p><p>
    The nxlog patterns defined in the XML pattern database file can contain more than one
    field, this allows multi-dimensional pattern matching.
    Thus with nxlog's pm_pattern module there is no need to convert all fields into a single
    string as it can work with multiple fields.
  </p><p>
    Patterns can be grouped together under pattern groups. Pattern groups serve an optimization
    purpose. The group can have an optional <em class="replaceable"><code>matchfield</code></em> block which
    can check a condition. If the condtion (such as <em class="replaceable"><code>$SourceName</code></em> matches 
    <em class="replaceable"><code>sshd</code></em>) is satisfied, the pm_pattern module will dive into the group
    and check each pattern against the log.
    If the pattern group's condition didn't match (i.e. <em class="replaceable"><code>$SourceName</code></em> wasn't
    <em class="replaceable"><code>sshd</code></em>), the module can thus skip all patterns in the group without
    having to check each pattern one by one.
  </p><p>
    When the pm_pattern module finds a matching pattern, the <em class="replaceable"><code>PatternID</code></em>
    and <em class="replaceable"><code>PatternName</code></em> fields are set on the log message.
    These can be used later in conditional processing and correlation rules
    for example.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      The pm_pattern module does not process all patterns. It exits after the first
      matching pattern is found. This means that at most one pattern can match a log message.
      You should avoid writing a pattern to be used with pm_pattern which can match a subset
      of logs that match another pattern. For example if you have two regular expression patterns
      <em class="replaceable"><code>^\d+</code></em> and <em class="replaceable"><code>^\d\d</code></em>, the second may be
      never matched because of the first. 
      The internal order of patterns and pattern groups is changed dynamically by pm_pattern.
      Those patterns are placed and tried first which have the highest match count.
      Reasons for this operation mode are:
      </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
	    Performance optimization,
	  </p></li><li class="listitem"><p>
	    Setting the value of <em class="replaceable"><code>$PatternID</code></em> would be problematic with multiple values
	    because the language does not support arrays.
	  </p></li></ul></div><p>
      If you want a strictly linearly executing mattern matcher, you should use the
      <a class="link" href="#config_module_exec" title="Exec">Exec</a>  directive and write your rules there.
    </p></div><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="pm_pattern_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the pm_pattern module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_pattern_config_patternfile"></a>PatternFile</span></dt><dd>
	      This mandatory directive specifies the name of the 
	      <a class="link" href="#pm_pattern_pattern_database" title="Pattern database file">pattern database file</a>.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Pattern database file"><div class="titlepage"><div><div><h4 class="title"><a name="pm_pattern_pattern_database"></a>Pattern database file</h4></div></div></div><p>
      </p><div class="example"><a name="idp36065072"></a><p class="title"><b>Exampleï¿½6.50.ï¿½A simple pattern database</b></p><div class="example-contents"><p>
	  This pattern database contains two patterns to match ssh authentication messages.
	  The patterns are under a group named <em class="replaceable"><code>ssh</code></em> which
	  checks whether the field <em class="replaceable"><code>SourceName</code></em> is
	  <em class="replaceable"><code>sshd</code></em> and only tries to match the patterns if the logs
	  are indeed from sshd.
	  The patterns both extract <em class="replaceable"><code>AuthMethod</code></em>,
	  <em class="replaceable"><code>AccountName</code></em>
	  and <em class="replaceable"><code>SourceIP4Address</code></em> from the log message when the pattern
	  matches the log. Additionally <em class="replaceable"><code>TaxonomyStatus</code></em> and
	  <em class="replaceable"><code>TaxonomyAction</code></em> are set.
	  The second pattern utilizes the <a class="link" href="#config_module_exec" title="Exec">Exec</a> block
	  which is evaluated when the pattern matches.
	  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	      For this pattern to work, the logs must be parsed with parse_syslog() prior to
	      feeding it to the pm_pattern module because it uses
	      the <em class="replaceable"><code>SourceName</code></em> and <em class="replaceable"><code>Message</code></em> fields.
	    </p></div><p>
	</p><pre class="programlisting">
&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;patterndb&gt;
 &lt;created&gt;2010-01-01 01:02:03&lt;/created&gt;
 &lt;version&gt;42&lt;/version&gt;
 
 &lt;group&gt;
   &lt;name&gt;ssh&lt;/name&gt;
   &lt;id&gt;42&lt;/id&gt;
   &lt;matchfield&gt;
    &lt;name&gt;SourceName&lt;/name&gt;
    &lt;type&gt;exact&lt;/type&gt;
    &lt;value&gt;sshd&lt;/value&gt;
   &lt;/matchfield&gt;

   &lt;pattern&gt;
    &lt;id&gt;1&lt;/id&gt;
    &lt;name&gt;ssh auth success&lt;/name&gt;

    &lt;matchfield&gt;
     &lt;name&gt;SourceName&lt;/name&gt;
     &lt;type&gt;exact&lt;/type&gt;
     &lt;value&gt;sshd&lt;/value&gt;
    &lt;/matchfield&gt;

    &lt;matchfield&gt;
     &lt;name&gt;Message&lt;/name&gt;
     &lt;type&gt;regexp&lt;/type&gt;
        &lt;!-- Accepted publickey for nxlogfan from 192.168.1.1 port 4242 ssh2 --&gt;
     &lt;value&gt;^Accepted (\S+) for (\S+) from (\S+) port \d+ ssh2&lt;/value&gt;
     &lt;capturedfield&gt;
	&lt;name&gt;AuthMethod&lt;/name&gt;
	&lt;type&gt;string&lt;/type&gt;
     &lt;/capturedfield&gt;
     &lt;capturedfield&gt;
	&lt;name&gt;AccountName&lt;/name&gt;
	&lt;type&gt;string&lt;/type&gt;
     &lt;/capturedfield&gt;
     &lt;capturedfield&gt;
	&lt;name&gt;SourceIP4Address&lt;/name&gt;
        &lt;type&gt;string&lt;/type&gt;
     &lt;/capturedfield&gt;
    &lt;/matchfield&gt;

    &lt;set&gt;
     &lt;field&gt;
       &lt;name&gt;TaxonomyStatus&lt;/name&gt;
       &lt;value&gt;success&lt;/value&gt;
       &lt;type&gt;string&lt;/type&gt;
     &lt;/field&gt;
     &lt;field&gt;
       &lt;name&gt;TaxonomyAction&lt;/name&gt;
       &lt;value&gt;authenticate&lt;/value&gt;
       &lt;type&gt;string&lt;/type&gt;
     &lt;/field&gt;
    &lt;/set&gt;
   &lt;/pattern&gt;

   &lt;pattern&gt;
    &lt;id&gt;2&lt;/id&gt;
    &lt;name&gt;ssh auth failure&lt;/name&gt;

    &lt;matchfield&gt;
     &lt;name&gt;SourceName&lt;/name&gt;
     &lt;type&gt;exact&lt;/type&gt;
     &lt;value&gt;sshd&lt;/value&gt;
    &lt;/matchfield&gt;

    &lt;matchfield&gt;
     &lt;name&gt;Message&lt;/name&gt;
     &lt;type&gt;regexp&lt;/type&gt;
     &lt;value&gt;^Failed (\S+) for invalid user (\S+) from (\S+) port \d+ ssh2&lt;/value&gt;

     &lt;capturedfield&gt;
	&lt;name&gt;AuthMethod&lt;/name&gt;
	&lt;type&gt;string&lt;/type&gt;
     &lt;/capturedfield&gt;
     &lt;capturedfield&gt;
	&lt;name&gt;AccountName&lt;/name&gt;
	&lt;type&gt;string&lt;/type&gt;
     &lt;/capturedfield&gt;
     &lt;capturedfield&gt;
	&lt;name&gt;SourceIP4Address&lt;/name&gt;
        &lt;type&gt;string&lt;/type&gt;
     &lt;/capturedfield&gt;
    &lt;/matchfield&gt;

    &lt;set&gt;
     &lt;field&gt;
       &lt;name&gt;TaxonomyStatus&lt;/name&gt;
       &lt;value&gt;failure&lt;/value&gt;
       &lt;type&gt;string&lt;/type&gt;
     &lt;/field&gt;
     &lt;field&gt;
       &lt;name&gt;TaxonomyAction&lt;/name&gt;
       &lt;value&gt;authenticate&lt;/value&gt;
       &lt;type&gt;string&lt;/type&gt;
     &lt;/field&gt;
    &lt;/set&gt;

    &lt;exec&gt;
      $TestField = 'test';
    &lt;/exec&gt;
    &lt;exec&gt;
      $TestField = $Testfield + 'value';
    &lt;/exec&gt;
   &lt;/pattern&gt;

 &lt;/group&gt;

&lt;/patterndb&gt;

</pre></div></div><p><br class="example-break">
    </p></div><div class="section" title="Fields generated by pm_pattern"><div class="titlepage"><div><div><h4 class="title"><a name="pm_pattern_fields"></a>Fields generated by pm_pattern</h4></div></div></div><p>
  The following fields are set by pm_pattern:

  </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_pattern_field_PatternID"></a>$PatternID</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_integer">integer</a></td></tr></table><p>
        Set to the id number of the pattern which matched the message.
      </p></dd><dt><span class="term"><a name="pm_pattern_field_PatternName"></a>$PatternName</span></dt><dd><p>
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Type</td><td><a class="link" href="#lang_type_string">string</a></td></tr></table><p>
        Set to the name of the pattern which matched the message.
      </p></dd></dl></div><p>

 </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="pm_pattern_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp36091024"></a><p class="title"><b>Exampleï¿½6.51.ï¿½Using the pm_pattern module</b></p><div class="example-contents"><pre class="programlisting">
&lt;Extension syslog&gt;
    Module      xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_uds
    UDS		/dev/log
    Exec	parse_syslog_bsd();
&lt;/Input&gt;

&lt;Processor pattern&gt;
    Module	pm_pattern
    PatternFile /var/lib/nxlog/patterndb.xml
&lt;/Processor&gt;

&lt;Output out&gt;
    Module	om_file
    File	"/var/log/messages"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; pattern =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="Message format converter (pm_transformer)"><div class="titlepage"><div><div><h3 class="title"><a name="pm_transformer"></a>Message format converter (pm_transformer)</h3></div></div></div><p>
    The pm_transformer module provides parsers for syslog (both legacy and the newer IETF
    standard), CSV, JSON and XML formatted data and can also convert between.
    This module is now obsoleted by the functions and procedures provided by the following
    modules:
    </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
	<a class="link" href="#xm_syslog" title="Syslog (xm_syslog)">xm_syslog</a>
      </td></tr><tr><td>
	<a class="link" href="#xm_csv" title="CSV (xm_csv)">xm_csv</a>
      </td></tr><tr><td>
	<a class="link" href="#xm_json" title="JSON (xm_json)">xm_json</a>
      </td></tr><tr><td>
	<a class="link" href="#xm_xml" title="XML (xm_xml)">xm_xml</a>
      </td></tr></table><p>
    Though using this pm_transformer module can be slightly faster than calling these procedures
    from an <a class="link" href="#config_module_exec" title="Exec">Exec</a> directive.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="pm_transformer_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the pm_transformer module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_transformer_config_inputformat"></a>InputFormat</span></dt><dd><p>
	      This directive specifies the input format of the $raw_event field so that it is 
	      further parsed into fields. If this directive is not
	      specified, no parsing will be done.
	      </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_transformer_config_inputformat_syslog_rfc3164"></a>syslog_rfc3164</span></dt><dd>
		      Input is parsed in bsd syslog format as defined by RFC 3164. This does the
		      same as the 
		      <a class="link" href="#xm_syslog_proc_parse_syslog_bsd">parse_syslog_bsd()</a>
		      procedure.
		    </dd><dt><span class="term"><a name="pm_transformer_config_inputformat_syslog_bsd"></a>syslog_bsd</span></dt><dd>
		      Same as <a class="link" href="#pm_transformer_config_inputformat_syslog_rfc3164">syslog_rfc3164</a>.
		    </dd><dt><span class="term"><a name="pm_transformer_config_inputformat_syslog_rfc5424"></a>syslog_rfc5424</span></dt><dd>
		      Input is parsed in IETF syslog format as defined by RFC 5424. This does the
		      same as the 
		      <a class="link" href="#xm_syslog_proc_parse_syslog_ietf">parse_syslog_ietf()</a>
		      procedure.
		    </dd><dt><span class="term"><a name="pm_transformer_config_inputformat_syslog_ietf"></a>syslog_ietf</span></dt><dd>
		      Same as <a class="link" href="#pm_transformer_config_inputformat_syslog_rfc5424">syslog_rfc5424</a>.
		    </dd><dt><span class="term"><a name="pm_transformer_config_inputformat_csv"></a>CSV</span></dt><dd>
		      Input is parsed as a comma separated list of values.
		      See <a class="link" href="#xm_csv" title="CSV (xm_csv)">xm_csv</a> for similar functionality.
		      The input fields must be defined defined by
		      <a class="link" href="#pm_transformer_config_csvinputfields">CSVInputFields</a>
		    </dd><dt><span class="term"><a name="pm_transformer_config_inputformat_xml"></a>XML</span></dt><dd>
		      Input is parsed as XML. This does the same as the 
		      <a class="link" href="#xm_xml_proc_parse_xml">parse_xml()</a>
		      procedure.
		    </dd><dt><span class="term"><a name="pm_transformer_config_inputformat_json"></a>JSON</span></dt><dd>
		      Input is parsed as JSON. This does the same as the 
		      <a class="link" href="#xm_json_proc_parse_json">parse_json()</a>
		      procedure.
		    </dd></dl></div><p>
  	    </p></dd><dt><span class="term"><a name="pm_transformer_config_csvinputfields"></a>CSVInputFields</span></dt><dd><p>
	      This is a comma separated list of fields which will be filled from the input
	      parsed. The field names must have the dollar sign "$" prepended.
  	    </p></dd><dt><span class="term"><a name="pm_transformer_config_csvinputfieldtypes"></a>CSVInputFieldTypes</span></dt><dd><p>
	      This optional directive specifies the list of types corresponding to the
	      field names defined in <a class="link" href="#pm_transformer_config_csvinputfields">CSVInputFields</a>.
	      If specified, the number of types must match the number of field names specified
	      with <a class="link" href="#pm_transformer_config_csvinputfields">CSVInputFields</a>.
	      If this directive is omitted, all fields will be stored as 
	      <a class="link" href="#lang_type_string">strings</a>.
	      This directive has no effect on the fields-to-csv conversion.
  	    </p></dd><dt><span class="term"><a name="pm_transformer_config_outputformat"></a>OutputFormat</span></dt><dd><p>
	      This directive specifies the output transformation. If this directive is not
	      specified, fields are not converted and $raw_event is left unmodified.
	      </p><div class="variablelist"><dl><dt><span class="term"><a name="pm_transformer_config_outputformat_syslog_rfc3164"></a>syslog_rfc3164</span></dt><dd>
		      Output in $raw_event is formatted in bsd syslog format as defined by
		      RFC 3164. This does the same as the 
		      <a class="link" href="#xm_syslog_proc_to_syslog_bsd">to_syslog_bsd()</a>
		      procedure.
		    </dd><dt><span class="term"><a name="pm_transformer_config_outputformat_syslog_bsd"></a>syslog_bsd</span></dt><dd>
		      Same as <a class="link" href="#pm_transformer_config_outputformat_syslog_rfc3164">syslog_rfc3164</a>.
		    </dd><dt><span class="term"><a name="pm_transformer_config_outputformat_syslog_rfc5424"></a>syslog_rfc5424</span></dt><dd>
		      Output in $raw_event is formatted in IETF syslog format as defined by
		      RFC 5424. This does the same as the 
		      <a class="link" href="#xm_syslog_proc_to_syslog_ietf">to_syslog_ietf()</a>
		      procedure.
		    </dd><dt><span class="term"><a name="pm_transformer_config_outputformat_syslog_ietf"></a>syslog_ietf</span></dt><dd>
		      Same as <a class="link" href="#pm_transformer_config_outputformat_syslog_rfc5424">syslog_rfc5424</a>.
		    </dd><dt><span class="term"><a name="pm_transformer_config_outputformat_syslog_snare"></a>syslog_snare</span></dt><dd>
		      Output in $raw_event is formatted in SNARE syslog format.
		      This does the same as the 
		      <a class="link" href="#xm_syslog_proc_to_syslog_snare">to_syslog_snare()</a>
		      procedure. This is to be used in conjunction with the
		      <a class="link" href="#im_mseventlog" title="MS EventLog for Windows XP/2000/2003 (im_mseventlog)">im_mseventlog</a> or 
		      <a class="link" href="#im_msvistalog" title="MS EventLog for Windows 2008/Vista and later (im_msvistalog)">im_msvistalog</a> module to produce an output
		      compatible with <a class="ulink" href="http://www.intersectalliance.com/projects/BackLogNT/" target="_top">Snare Agent for Windows</a>.
		    </dd><dt><span class="term"><a name="pm_transformer_config_outputformat_csv"></a>CSV</span></dt><dd>
		      Output in $raw_event is formatted as a comma separated list of values.
		      See <a class="link" href="#xm_csv" title="CSV (xm_csv)">xm_csv</a> for similar functionality.
		    </dd><dt><span class="term"><a name="pm_transformer_config_outputformat_xml"></a>XML</span></dt><dd>
		      Output in $raw_event is formatted in XML. This does the same as the
		      <a class="link" href="#xm_xml_proc_to_xml">to_xml()</a>
		      procedure.
		    </dd><dt><span class="term"><a name="pm_transformer_config_outputformat_json"></a>JSON</span></dt><dd>
		      Output in $raw_event is formatted as JSON. This does the same as the
		      <a class="link" href="#xm_json_proc_to_json">to_json()</a>
		      procedure.
		    </dd></dl></div><p>
  	    </p></dd><dt><span class="term"><a name="pm_transformer_config_csvoutputfields"></a>CSVOutputFields</span></dt><dd><p>
	      This is a comma separated list of message fields which are placed in the CSV 
	      lines. The field names must have the dollar sign "$" prepended.
  	    </p></dd></dl></div><p>
    </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="pm_transformer_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp36170544"></a><p class="title"><b>Exampleï¿½6.52.ï¿½Using the pm_transformer module</b></p><div class="example-contents"><pre class="programlisting">
&lt;Extension syslog&gt;
    Module      xm_syslog
&lt;/Extension&gt;

&lt;Input filein&gt;
    Module	im_file
    File	"tmp/input"
&lt;/Input&gt;

&lt;Processor transformer&gt;
    Module	pm_transformer
    InputFormat syslog_rfc3164
#    OutputFormat syslog_rfc3164
    OutputFormat csv
    CSVOutputFields $facility, $severity, $timestamp, $hostname, $application, $pid, $message
&lt;/Processor&gt;

&lt;Output fileout&gt;
    Module	om_file
    File	"tmp/output"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	filein =&gt; transformer =&gt; fileout
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div></div><div class="section" title="Output modules"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="modules_output"></a>Output modules</h2></div></div></div><p>
   </p><div class="section" title="Blocker (om_blocker)"><div class="titlepage"><div><div><h3 class="title"><a name="om_blocker"></a>Blocker (om_blocker)</h3></div></div></div><p>
    This module serves testing purposes mostly. It will block log messages in order to 
    simulate a blocked route. This can easily create a similar situation when a network
    transport output module such as <a class="link" href="#om_tcp" title="TCP (om_tcp)">om_tcp</a> blocks because
    of a network problem.
    See the <a class="link" href="#core_proc_sleep">sleep()</a> procedure which can delay log message
    output and can also help testing similar situations.
  </p><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="om_blocker_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp36181008"></a><p class="title"><b>Exampleï¿½6.53.ï¿½Testing buffering with the om_blocker module</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input uds&gt;
    Module	im_uds
    Uds		/dev/log
&lt;/Input&gt;

&lt;Processor buffer&gt;
    Module	pm_buffer
    WarnLimit	512
    MaxSize	1024
    Type	Mem
&lt;/Processor&gt;

&lt;Output blocker&gt;
    Module	om_blocker
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	uds =&gt; buffer =&gt; blocker
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="DBI (om_dbi)"><div class="titlepage"><div><div><h3 class="title"><a name="om_dbi"></a>DBI (om_dbi)</h3></div></div></div><p>
    The om_dbi module utilizes the <a class="ulink" href="http://libdbi.sourceforge.net" target="_top">libdbi</a>
    database abstraction library to enable storing logs in various database engines supported
    by the library such as MySQL, PostgreSQL, MSSQL, Sybase, Oracle, SQLite, Firebird.
    This module makes it possible to insert logs directly into an SQL database. You can specify
    the INSERT statement which will be executed for each log, this enables inserts into
    any table schema.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      The im_dbi and om_dbi modules support GNU/Linux only because of the libdbi library.
      The im_odbc and om_odbc modules provide native database access on Windows (available only in 
      the NXLog Enterprise Edition).
    </p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      libdbi needs <a class="link" href="#om_dbi_config_driver">drivers</a> to be able to access
      the database engines. These are in the <em class="replaceable"><code>libdbd-*</code></em> packages on Debian and Ubuntu Linux.
      On Centos 5.6 there is a libdbi-drivers rpm package but this does seem to contain any 
      driver binaries under /usr/lib64/dbd. The real driver for MySQL lives in libdbi-dbd-mysql.
      Same for PostgreSQL. Make sure you have these installed, otherwise you will get a libdbi
      driver initialization error.
    </p></div><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="om_dbi_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the om_dbi module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="om_dbi_config_driver"></a>Driver</span></dt><dd>
	      This mandatory directive specifies the name of the libdbi driver which will be used
	      to connect to the database. 
	      You will need to provide a DRIVER name here for which a loadable driver module 
	      exists under the name libdbdDRIVER.so (usually under /usr/lib/dbd/).
	      The mysql driver is in the libdbdmysql.so file.
	    </dd><dt><span class="term"><a name="om_dbi_config_sql"></a>SQL</span></dt><dd>
	      This directive should specify the INSERT statement which is executed for each log
	      message. The fields names (names with a $ sign) will be replaced with the value
	      they contain. String types will be quoted.
	    </dd><dt><span class="term"><a name="om_dbi_config_option"></a>Option</span></dt><dd>
	      This directive can be used to specify additional driver options such as
	      the connection parameters. The manual of the libdbi driver should contain
	      the available options which can be used here.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="om_dbi_config_examples"></a>Configuration examples</h4></div></div></div><p>
      These two examples below are for the plain syslog fields. Depending on your requirements,
      you may want to store additional or other fields which were generated by parsers, regexp rules,
      the <a class="link" href="#pm_pattern" title="Pattern matcher (pm_pattern)">pm_pattern</a> pattern matcher module or input modules.
      Notably the <a class="link" href="#im_msvistalog" title="MS EventLog for Windows 2008/Vista and later (im_msvistalog)">im_msvistalog</a> and 
      <a class="link" href="#im_mseventlog" title="MS EventLog for Windows XP/2000/2003 (im_mseventlog)">im_mseventlog</a> modules generate different fields 
      which you may want to store in an SQL database similarly to these examples.
      </p><div class="example"><a name="idp36205264"></a><p class="title"><b>Exampleï¿½6.54.ï¿½Storing syslog in a PostgreSQL database</b></p><div class="example-contents"><p>
	  Below is a table schema which can be used to store syslog data.
</p><pre class="programlisting">
CREATE TABLE log (
	id serial,
        timestamp timestamp  not null,
	hostname varchar(32) default NULL,
	facility varchar(10) default NULL,
	severity varchar(10) default NULL,
	application varchar(10) default NULL,
	message text,
	PRIMARY KEY (id)
);</pre><p>
	And the config file:
	</p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_tcp
    Port	1234
    Host	0.0.0.0
    Exec	parse_syslog_bsd();
&lt;/Input&gt;

&lt;Output dbi&gt;
    Module	om_dbi
    SQL         INSERT INTO log (facility, severity, hostname, timestamp, application, message) \
                VALUES ($SyslogFacility, $SyslogSeverity, $Hostname, '$EventTime', $SourceName, $Message)
    Driver	pgsql
    Option	host 127.0.0.1
    Option	username dbuser
    Option	password secret
    Option      dbname logdb 
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; dbi
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p><p>
      </p><div class="example"><a name="idp36209856"></a><p class="title"><b>Exampleï¿½6.55.ï¿½Storing logs in a MySQL database</b></p><div class="example-contents"><pre class="programlisting">
&lt;Extension syslog&gt;
    Module      xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_uds
    UDS		/dev/log
    Exec	parse_syslog_bsd();
&lt;/Input&gt;

&lt;Output dbi&gt;
    Module	om_dbi
    SQL         INSERT INTO log (facility, severity, hostname, timestamp, application, message) \
                VALUES ($SyslogFacility, $SyslogSeverity, $Hostname, '$EventTime', $SourceName, $Message)
    Driver	mysql
    Option	host 127.0.0.1
    Option	username mysql
    Option	password mysql
    Option      dbname logdb 
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; dbi
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="Program (om_exec)"><div class="titlepage"><div><div><h3 class="title"><a name="om_exec"></a>Program (om_exec)</h3></div></div></div><p>
    This module will execute a program or script on startup and will write (pipe) the log
    data to the program's standard input.
    Unless <a class="link" href="#om_exec_config_outputtype">OutputType</a> is set to something
    else, only the contents of the $raw_event field are sent over the pipe.
    The execution of the program or script will terminate when the module is stopped,
    which usually happens when nxlogs exits and the pipe is closed.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      The program or script is started when nxlog start and must not exit until the module is
      stopped.
      To invoke a script for each log message, use <a class="link" href="#xm_exec" title="External program execution (xm_exec)">xm_exec</a>
      instead.
    </p></div><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="om_exec_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the om_exec module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="om_exec_config_command"></a>Command</span></dt><dd>
	      This directive is mandatory. It specifies the name of the script/program
	      to be executed.
	    </dd><dt><span class="term"><a name="om_exec_config_arg"></a>Arg</span></dt><dd>
	      This is an optional parameter, multiple can be specified for each
	      argument needed to pass to the 
	      <a class="link" href="#om_exec_config_command">Command</a>.
	      Note that specifying multiple arguments with one Arg directive separated with
	      spaces will not work because the Command will receive it as one argument,
	      so you will need to split them up.
	    </dd><dt><span class="term"><a name="om_exec_config_outputtype"></a>OutputType</span></dt><dd>
	      See the description about <a class="link" href="#config_outputtype" title="OutputType">OutputType</a>
	      in the global module config section.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="om_exec_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp36231200"></a><p class="title"><b>Exampleï¿½6.56.ï¿½Piping logs to an external program</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input in&gt;
    Module	im_uds
    uds		/dev/log
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_exec
    Command	/usr/bin/someprog
    Arg		-
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
      This exact same configuration is not recommended for real use because
      <a class="link" href="#im_file" title="File (im_file)">im_file</a> was designed to read log messages from files.
      This example only demonstrates the use of the om_exec module.
    </p></div></div><div class="section" title="File (om_file)"><div class="titlepage"><div><div><h3 class="title"><a name="om_file"></a>File (om_file)</h3></div></div></div><p>
    This module can be used to write log messages to a file. 
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="om_file_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the om_file module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="om_file_config_file"></a>File</span></dt><dd><p>
	      This mandatory directive specifies the name of the output file to open.
	      It must be a <a class="link" href="#lang_type_string">string</a> type
	      <a class="link" href="#lang_expressions" title="Expressions">expression</a>. 
	      If the expression in the File directive is not a constant string (i.e. it contains
	      functions, field names or operators), it will be evaluated before each event is
	      written to the file (and after the <a class="link" href="#config_module_exec" title="Exec">Exec</a>
	      is evaluated).
	      Note that the filename must be quoted to be a valid string literal unlike in
	      other directives which take a filename argument.
	      For relative filenames you should be aware that nxlog changes its working
	      directory to '/' unless the global
	      <a class="link" href="#config_global_spooldir">SpoolDir</a> is set to something else.
	    </p><p>
	      Below are 3 different variations for specifying the same output file on a Windows system:
	    </p><pre class="programlisting">
File 'C:\logs\logmsg.txt'
File "C:\\logs\\logmsg.txt"
File 'C:/logs/logmsg.txt'
</pre><p>
	    </p></dd><dt><span class="term"><a name="om_file_config_createdir"></a>CreateDir</span></dt><dd>
	      This optional directive takes a boolean value of TRUE or FALSE.
	      If not specified, the default value is FALSE.
	      If it is set to TRUE, the directory will be created if it doesn't exist before opening
	      the file for writing.
	    </dd><dt><span class="term"><a name="om_file_config_truncate"></a>Truncate</span></dt><dd>
	      This optional directive takes a boolean value of TRUE or FALSE.
	      If set to TRUE, the file will be truncated before each write, meaning that only
	      the most recent log message is saved.
	      By default this is FALSE.
	    </dd><dt><span class="term"><a name="om_file_config_sync"></a>Sync</span></dt><dd>
	      This optional directive takes a boolean value of TRUE or FALSE.
	      If set to TRUE, the file is synced after each log message, ensuring that it
	      is really written to disk from the buffers.
	      This can hurt performance, thus by default it is turned off.
	    </dd><dt><span class="term"><a name="om_file_config_outputtype"></a>OutputType</span></dt><dd>
	      See the description about <a class="link" href="#config_outputtype" title="OutputType">OutputType</a>
	      in the global module config section.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Functions and procedures exported by om_file"><div class="titlepage"><div><div><h4 class="title"><a name="om_file_funcproc"></a>Functions and procedures exported by om_file</h4></div></div></div><div class="section" title="Functions exported by om_file"><div class="titlepage"><div><div><h5 class="title"><a name="om_file_functions"></a>Functions exported by om_file</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="om_file_func_file_name"></a>
       <code class="function">string file_name();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Return the name of the file currently open which was specified using the
       File directive.
       Note that this will be the old name if the file name changes dynamically.
       If you want the new name, use the expression you specified for the File
       directive instead of usng this function.
     </dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_string">string</a>
           </dd></dl></div></dd><dt><span class="term">
       <a name="om_file_func_file_size"></a>
       <code class="function">integer file_size();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Return the size of the currently open output file in bytes.
       It will return undef if the file is not open. This can happend if
       'File' is not a string literal expression and there was no log message.
     </dd><dt><span class="term">return type</span></dt><dd>
            <a class="link" href="#lang_type_integer">integer</a>
           </dd></dl></div></dd></dl></div></div><div class="section" title="Procedures exported by om_file"><div class="titlepage"><div><div><h5 class="title"><a name="om_file_procedures"></a>Procedures exported by om_file</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="om_file_proc_rotate_to"></a>
       <code class="function">rotate_to(string filename);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Rotate the current file to the filename specified. The module will then open
       the original file specified with the 'File' directive. 
       Note that the rename(2) system call is used internally which does not support 
       moving files across different devices on some platforms. If this is a problem,
       first rotate the file on the same device and then using the exec_async() procedure
       of the xm_exec module you can copy it to another device or file system or 
       use the file_copy() procedure call provided by the xm_fileop module.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">filename</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd><dt><span class="term">
       <a name="om_file_proc_reopen"></a>
       <code class="function">reopen();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Reopen the File. This function should be called if the file has been
       removed or renamed e.g. with the file_cycle(), file_remove(), file_rename() functions
       of the xm_file module.
       This does not need to be called after rotate_to() because that reopens
       the file automatically.
     </dd></dl></div></dd></dl></div></div></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="om_file_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp36292736"></a><p class="title"><b>Exampleï¿½6.57.ï¿½Storing raw syslog messages into a file</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input in&gt;
    Module	im_uds
    UDS		/dev/log
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"/var/log/messages"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
      </p><div class="example"><a name="om_file_config_example_rotate1"></a><p class="title"><b>Exampleï¿½6.58.ï¿½File rotation based on size</b></p><div class="example-contents"><pre class="programlisting">
&lt;Extension exec&gt;
    Module	xm_exec
&lt;/Extension&gt;

&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_tcp
    Port	1514
    Host	0.0.0.0
    Exec	parse_syslog_bsd();
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"tmp/output_" + $Hostname + "_" + month(now())
    &lt;Exec&gt;
        if out-&gt;file_size() &gt; 15M
        {
             $newfile = "tmp/output_" + $Hostname + "_" + strftime(now(), "%Y%m%d%H%M%S");
             out-&gt;rotate_to($newfile);
             exec_async("/bin/bzip2", $newfile);
        }
     &lt;/Exec&gt;
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="HTTP(s) (om_http)"><div class="titlepage"><div><div><h3 class="title"><a name="om_http"></a>HTTP(s) (om_http)</h3></div></div></div><p>
    This module will connect to the <a class="link" href="#om_http_config_url">url</a>
    specified in the configuration in either plain HTTP or HTTPS mode.
    Each event data is transferred in a single POST request. The module then waits for a
    response containing a successful status code (200, 201 or 202).
    It will reconnect and retry the delivery if the remote has closed the connection or
    a timeout is exceeded while waiting for the repsponse. This HTTP-level acknowledgement
    ensures that no messages are lost during transfer.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="om_http_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the om_http module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="om_http_config_url"></a>Url</span></dt><dd>
	      This mandatory directive specifies the URL where the module should
	      POST the event data. The module checks the url whether to operate in plain HTTP
	      or HTTPS mode. It connects to the hostname specified in the url. If the port number
	      is not explicitly indicated it defaults to 80 and 443 for HTTP and HTTPS
	      respectively.
	    </dd><dt><span class="term"><a name="om_http_config_httpscertfile"></a>HTTPSCertFile</span></dt><dd>
	      This specifies the path of the certificate file to be used in
	      the HTTPS handshake.
	    </dd><dt><span class="term"><a name="om_http_config_httpscertkeyfile"></a>HTTPSCertKeyFile</span></dt><dd>
	      This specifies the path of the certificate key file to be used in
	      the HTTPS handshake.
	    </dd><dt><span class="term"><a name="om_http_config_httpskeypass"></a>HTTPSKeyPass</span></dt><dd>
	      Optional password of the certificate key file defined in 
 	      <a class="link" href="#om_http_config_httpscertkeyfile">HTTPSCertKeyFile</a>.
	      For passwordless private keys the directive is not needed.
	    </dd><dt><span class="term"><a name="om_http_config_httpscafile"></a>HTTPSCAFile</span></dt><dd>
	      This specifies the path of the certificate of the CA which
	      will be used to check the certificate of the remote HTTPS server.
	    </dd><dt><span class="term"><a name="om_http_config_httpscadir"></a>HTTPSCADir</span></dt><dd>
	      This specifies the path of CA certificates which will be 
	      used to check the certificate of the remote HTTPS server.
	      The cert file names in this directory must be in the OpenSSL hashed format.
	    </dd><dt><span class="term"><a name="om_http_config_httpscrlfile"></a>HTTPSCRLFile</span></dt><dd>
	      This specifies the path of the certificate revocation list (CRL) which
	      will be used to check the certificate of the remote HTTPS server.
	    </dd><dt><span class="term"><a name="om_http_config_httpscrldir"></a>HTTPSCRLDir</span></dt><dd>
	      This specifies the path of certificate revocation lists (CRLs) which will be
	      used to check the certificate of the remote HTTPS server.
	      The file names in this directory must be in the OpenSSL hashed format.
	    </dd><dt><span class="term"><a name="om_http_config_httpsallowuntrusted"></a>HTTPSAllowUntrusted</span></dt><dd>
	      This takes a boolean value of TRUE or FALSE and specifies whether
	      the connection should be allowed without certificate verification.

	      If set to TRUE the connection will be allowed even if the remote HTTPS
              server presents unknown and self-signed certificates.
	      The default value is FALSE if this directive is not specified, meaning that
	      the remote end must present a trusted certificate by default.
	    </dd><dt><span class="term"><a name="om_http_config_contenttype"></a>ContentType</span></dt><dd>
	      Sets the Content-Type HTTP header to the string specified with this directive. The Content-Type is set to
	      'text/plain' by default unless this directive is set.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Functions and procedures exported by om_http"><div class="titlepage"><div><div><h4 class="title"><a name="om_http_funcproc"></a>Functions and procedures exported by om_http</h4></div></div></div><div class="section" title="Procedures exported by om_http"><div class="titlepage"><div><div><h5 class="title"><a name="om_http_procedures"></a>Procedures exported by om_http</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="om_http_proc_set_http_request_path"></a>
       <code class="function">set_http_request_path(string path);</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Sets the path in the HTTP request to the string specified.
       This is useful if the URL is dynamic and parameters such as event id need to be included in the URL.
       Note that the string must be url encoded if it contains reserved characters.
     </dd><dt><span class="term">arguments</span></dt><dd><div class="variablelist"><dl><dt><span class="term">path</span></dt><dd>
                type: <a class="link" href="#lang_type_string">string</a>
               </dd></dl></div></dd></dl></div></dd></dl></div></div></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="om_http_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp36344176"></a><p class="title"><b>Exampleï¿½6.59.ï¿½Sending logs over HTTPS</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input in&gt;
    Module		im_file
    File		'input.log'
    ReadFromLast	FALSE
&lt;/Input&gt;

&lt;Output out&gt;
    Module		om_http
    URL			https://server:8080/
    HTTPSCertFile	%CERTDIR%/client-cert.pem
    HTTPSCertKeyFile	%CERTDIR%/client-key.pem
    HTTPSCAFile		%CERTDIR%/ca.pem
    HTTPSAllowUntrusted	FALSE
&lt;/Output&gt;

&lt;Route httpout&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="Null (om_null)"><div class="titlepage"><div><div><h3 class="title"><a name="om_null"></a>Null (om_null)</h3></div></div></div><p>
    Log messages sent to the om_null module instance are discarded, this module does not
    write its output anywhere.
    It can be useful for creating a dummy route, testing purposes. It can have 
    <a class="link" href="#config_module_schedule" title="Schedule">Scheduled</a> nxlog code execution as well
    like any other module,  so it is not completely useless.
    This module does not have any module specific configuration directives.
    See <a class="link" href="#config_example_routes" title="Exampleï¿½4.14.ï¿½Different routes">this example</a> for usage.
  </p></div><div class="section" title="TLS/SSL (om_ssl)"><div class="titlepage"><div><div><h3 class="title"><a name="om_ssl"></a>TLS/SSL (om_ssl)</h3></div></div></div><p>
    The om_ssl module provides an SSL/TLS transport using the OpenSSL library beneath the
    surface. It behaves similarly to the <a class="link" href="#om_tcp" title="TCP (om_tcp)">om_tcp</a> module,
    except that an SSL handshake is performed at connection time and the data is received over a
    secure channel.
    Because log messages transferred over plain TCP can be eavasdropped or even altered with a 
    man-in-the-middle attack, using the om_ssl module provides a secure log message transport.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="om_ssl_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the om_ssl module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="om_ssl_config_host"></a>Host</span></dt><dd>
	      This specifies the IP address or a dns hostname where the module should 
	      connect to.
	    </dd><dt><span class="term"><a name="om_ssl_config_port"></a>Port</span></dt><dd>
	      This specifies the port number where the module should connect to.
	    </dd><dt><span class="term"><a name="om_ssl_config_reconnect"></a>Reconnect</span></dt><dd>
	      This directive has been deprecated as of version 2.4.
	      The module will try to reconnect automatically at increasing intervals on all errors.
	    </dd><dt><span class="term"><a name="om_ssl_config_certfile"></a>CertFile</span></dt><dd>
	      This specifies the path of the certificate file to be used in
	      the SSL handshake.
	    </dd><dt><span class="term"><a name="om_ssl_config_certkeyfile"></a>CertKeyFile</span></dt><dd>
	      This specifies the path of the certificate key file to be used in
	      the SSL handshake.
	    </dd><dt><span class="term"><a name="om_ssl_config_keypass"></a>KeyPass</span></dt><dd>
	      Optional password of the certificate key file defined in 
 	      <a class="link" href="#om_ssl_config_certkeyfile">CertKeyFile</a>.
	      For passwordless private keys the directive is not needed.
	    </dd><dt><span class="term"><a name="om_ssl_config_cafile"></a>CAFile</span></dt><dd>
	      This specifies the path of the certificate of the CA which
	      will be used to check the certificate of the remote socket against.
	    </dd><dt><span class="term"><a name="om_ssl_config_cadir"></a>CADir</span></dt><dd>
	      This specifies the path of CA certificates which will be 
	      used to check the certificate of the remote socket against.
	      The cert file names in this directory must be in the OpenSSL hashed format.
	    </dd><dt><span class="term"><a name="om_ssl_config_crlfile"></a>CRLFile</span></dt><dd>
	      This specifies the path of the certificate revocation list (CRL) which
	      will be used to check the certificate of the remote socket against.
	    </dd><dt><span class="term"><a name="om_ssl_config_crldir"></a>CRLDir</span></dt><dd>
	      This specifies the path of certificate revocation lists (CRLs) which will be
	      used to check the certificate of the remote socket against.
	      The file names in this directory must be in the OpenSSL hashed format.
	    </dd><dt><span class="term"><a name="om_ssl_config_allowuntrusted"></a>AllowUntrusted</span></dt><dd>
	      This takes a boolean value of TRUE or FALSE and specifies whether
	      the connection should be allowed without certificate verification.

	      If set to TRUE the connection will be allowed even if the remote server presents
	      unknown and self-signed certificates.
	      The default value is FALSE if this directive is not specified, meaning that
	      the remote end must present a trusted certificate by default.
	    </dd><dt><span class="term"><a name="om_ssl_config_outputtype"></a>OutputType</span></dt><dd>
	      See the description about <a class="link" href="#config_outputtype" title="OutputType">OutputType</a>
	      in the global module config section.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Functions and procedures exported by om_ssl"><div class="titlepage"><div><div><h4 class="title"><a name="om_ssl_funcproc"></a>Functions and procedures exported by om_ssl</h4></div></div></div><div class="section" title="Procedures exported by om_ssl"><div class="titlepage"><div><div><h5 class="title"><a name="om_ssl_procedures"></a>Procedures exported by om_ssl</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="om_ssl_proc_reconnect"></a>
       <code class="function">reconnect();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Forces a reconnection. This can be used from a Schedule block to periodically reconnect to the server.
     </dd></dl></div></dd></dl></div></div></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="om_ssl_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp36397152"></a><p class="title"><b>Exampleï¿½6.60.ï¿½Writing nxlog binary data to another nxlog agent</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input in&gt;
    Module	im_uds
    UDS		tmp/socket
&lt;/Input&gt;

&lt;Output sslout&gt;
    Module	om_ssl
    Host	localhost
    Port	23456
    CAFile	%CERTDIR%/ca.pem
    CertFile	%CERTDIR%/client-cert.pem
    CertKeyFile	%CERTDIR%/client-key.pem
    KeyPass	secret
    AllowUntrusted TRUE
    OutputType	Binary
&lt;/Output&gt;


&lt;Route 1&gt;
    Path	in =&gt; sslout
&lt;/Route&gt;

</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="TCP (om_tcp)"><div class="titlepage"><div><div><h3 class="title"><a name="om_tcp"></a>TCP (om_tcp)</h3></div></div></div><p>
    This module initiates a TCP connection to a remote host and transfers log messages.
    The TCP transfer protocol provides more reliable log transmission than UDP.
    If security is a concern, consider using the <a class="link" href="#om_ssl" title="TLS/SSL (om_ssl)">om_ssl</a>
    module instead.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="om_tcp_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the om_tcp module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="om_tcp_config_host"></a>Host</span></dt><dd>
	      This mandatory directive specifies the IP address or a dns hostname 
	      where the module should connect to.
	    </dd><dt><span class="term"><a name="om_tcp_config_port"></a>Port</span></dt><dd>
	      This specifies the port number where the module should connect to.
	      The default port is 514 if this directive is not specified.
	    </dd><dt><span class="term"><a name="om_tcp_config_reconnect"></a>Reconnect</span></dt><dd>
	      This directive has been deprecated as of version 2.4.
	      The module will try to reconnect automatically at increasing intervals on all errors.
	    </dd><dt><span class="term"><a name="om_tcp_config_outputtype"></a>OutputType</span></dt><dd>
	      See the description about <a class="link" href="#config_outputtype" title="OutputType">OutputType</a>
	      in the global module config section.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Functions and procedures exported by om_tcp"><div class="titlepage"><div><div><h4 class="title"><a name="om_tcp_funcproc"></a>Functions and procedures exported by om_tcp</h4></div></div></div><div class="section" title="Procedures exported by om_tcp"><div class="titlepage"><div><div><h5 class="title"><a name="om_tcp_procedures"></a>Procedures exported by om_tcp</h5></div></div></div><div class="variablelist"><dl><dt><span class="term">
       <a name="om_tcp_proc_reconnect"></a>
       <code class="function">reconnect();</code>
     </span></dt><dd><div class="variablelist"><dl><dt><span class="term">description</span></dt><dd>
       Forces a reconnection. This can be used from a Schedule block to periodically reconnect to the server.
     </dd></dl></div></dd></dl></div></div></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="om_tcp_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp36425936"></a><p class="title"><b>Exampleï¿½6.61.ï¿½Transferring raw logs over TCP</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input in&gt;
    Module	im_uds
    UDS		/dev/log
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_tcp
    Host	192.168.1.1
    Port	1514
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="UDP (om_udp)"><div class="titlepage"><div><div><h3 class="title"><a name="om_udp"></a>UDP (om_udp)</h3></div></div></div><p>
    This module sends log messages as UDP datagrams to the address and port specified in the
    configuration.
    UDP is the transport protocol of the old BSD syslog standard as described in RFC 3164, 
    so this module can be particularly useful to send such messages to devices or syslog
    daemons which do not support other transports.
  </p><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="om_udp_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the om_udp module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="om_udp_config_host"></a>Host</span></dt><dd>
	      This mandatory directive specifies the IP address or a dns hostname which the
	      module will send UDP datagrams to.
	    </dd><dt><span class="term"><a name="om_udp_config_port"></a>Port</span></dt><dd>
	      This specifies the port number which the module will send UDP packets to.
	      The default port is 514 if this directive is not specified.
	    </dd><dt><span class="term"><a name="om_udp_config_sockbufsize"></a>SockBufSize</span></dt><dd>
	      This optional directive sets the socket buffer size (SO_SNDBUF) to the value
	      specified. Otherwise the OS defaults are used.
	    </dd><dt><span class="term"><a name="om_udp_config_outputtype"></a>OutputType</span></dt><dd>
	      See the description about <a class="link" href="#config_outputtype" title="OutputType">OutputType</a>
	      in the global module config section.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="om_udp_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp36445808"></a><p class="title"><b>Exampleï¿½6.62.ï¿½Sending raw syslog over udp</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input in&gt;
    Module	im_uds
    UDS		/dev/log
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_udp
    Host	192.168.1.1
    Port	1514
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div><div class="section" title="UDS (om_uds)"><div class="titlepage"><div><div><h3 class="title"><a name="om_uds"></a>UDS (om_uds)</h3></div></div></div><p>
    This module allows log messages to be sent to a unix domain socket.
    Traditionally unix systems have a socket, typically /dev/log used by the system
    logger to accept messages from. Applications wishing to send messages to the system log
    use the syslog(3) system call. nxlog can use this module to send log messages to the
    socket (=system logger) directly if another syslog daemon is in use.
  </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      This module supports SOCK_DGRAM type sockets only. SOCK_STREAM type sockets will be supported
      in the future.
    </p></div><div class="section" title="Configuration"><div class="titlepage"><div><div><h4 class="title"><a name="om_uds_config"></a>Configuration</h4></div></div></div><p>
      In addition to the <a class="link" href="#config_module_common" title="Common module directives">common module directives</a>,
      the following can be used to configure the om_uds module instance.
      </p><div class="variablelist"><dl><dt><span class="term"><a name="om_uds_config_uds"></a>UDS</span></dt><dd>
	      This specifies the path of the unix domain socket.
	      The default is /dev/log if this is not specified.
	    </dd><dt><span class="term"><a name="om_uds_config_outputtype"></a>OutputType</span></dt><dd>
	      See the description about <a class="link" href="#config_outputtype" title="OutputType">OutputType</a>
	      in the global module config section.
	    </dd></dl></div><p>
    </p></div><div class="section" title="Configuration examples"><div class="titlepage"><div><div><h4 class="title"><a name="om_uds_config_examples"></a>Configuration examples</h4></div></div></div><p>
      </p><div class="example"><a name="idp36462080"></a><p class="title"><b>Exampleï¿½6.63.ï¿½Using the om_uds module</b></p><div class="example-contents"><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file
    File	"/var/log/custom_app.log"
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_uds
    # defaulting syslog fields and creating syslog output
    Exec	parse_syslog_bsd(); to_syslog_bsd();
    uds		/dev/log
&lt;/Output&gt;

&lt;Route 1&gt;
       Path in =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
    </p></div></div></div></div><div class="chapter" title="Chapterï¿½7.ï¿½Offline log processing"><div class="titlepage"><div><div><h2 class="title"><a name="offline"></a>Chapterï¿½7.ï¿½Offline log processing</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#nxlog_processor">nxlog-processor</a></span></dt></dl></div><div class="section" title="nxlog-processor"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="nxlog_processor"></a>nxlog-processor</h2></div></div></div><p>
     The nxlog-processor tool is similar to the nxlog daemon, it uses the same configuration file.
     The difference is that it runs in foreground and will exit if there are no more log messages
     available from the input sources. The input sources are typically file and database sources.
     This tool is useful for offline log processing tasks such as loading a bunch of files
     into a database, converting between different formats (e.g. CSV and syslog), testing
     patterns, doing offline event correlation or HMAC message integrity checking.
   </p></div></div><div class="chapter" title="Chapterï¿½8.ï¿½Reading and receiving logs"><div class="titlepage"><div><div><h2 class="title"><a name="sources"></a>Chapterï¿½8.ï¿½Reading and receiving logs</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#sources_os">Operating Systems</a></span></dt><dd><dl><dt><span class="section"><a href="#sources_os_windows">Microsoft Windows</a></span></dt><dt><span class="section"><a href="#sources_os_linux">GNU/Linux</a></span></dt><dt><span class="section"><a href="#sources_os_android">Android</a></span></dt></dl></dd><dt><span class="section"><a href="#sources_network">Network</a></span></dt><dd><dl><dt><span class="section"><a href="#sources_network_udp">UDP</a></span></dt><dt><span class="section"><a href="#sources_network_tcp">TCP</a></span></dt><dt><span class="section"><a href="#sources_network_ssl">TLS/SSL over TCP</a></span></dt><dt><span class="section"><a href="#sources_network_syslog">Syslog</a></span></dt></dl></dd><dt><span class="section"><a href="#sources_database">Database</a></span></dt><dd><dl><dt><span class="section"><a href="#sources_database_dbi">Using im_dbi</a></span></dt><dt><span class="section"><a href="#sources_database_odbc">Using im_odbc</a></span></dt></dl></dd><dt><span class="section"><a href="#sources_file">Files</a></span></dt><dt><span class="section"><a href="#sources_program">External programs and scripts</a></span></dt><dt><span class="section"><a href="#sources_app">Applications</a></span></dt><dd><dl><dt><span class="section"><a href="#sources_app_apache">Apache HTTP Server</a></span></dt><dt><span class="section"><a href="#sources_app_tomcat">Apache Tomcat and java application logs</a></span></dt></dl></dd><dt><span class="section"><a href="#sources_device">Devices</a></span></dt><dd><dl><dt><span class="section"><a href="#sources_device_cisco">Cisco</a></span></dt><dt><span class="section"><a href="#sources_device_checkpoint">Checkpoint</a></span></dt></dl></dd></dl></div><p>
     This chapter deals with log sources such as 
     <a class="link" href="#sources_os" title="Operating Systems">operating systems</a>,
     <a class="link" href="#sources_network" title="Network">network</a>,
     <a class="link" href="#sources_database" title="Database">database</a>,
     <a class="link" href="#sources_file" title="Files">files</a>,
     <a class="link" href="#sources_app" title="Applications">applications</a> and 
     <a class="link" href="#sources_device" title="Devices">special devices</a>.
     Some of these log sources need a dedicated input module or a special parser to
     be able to read and interpret the log messages.
     A parser can be a dedicated module implementing the parser routines and exporting
     these to the nxlog core as procedures and functions such as the 
     <a class="link" href="#xm_syslog" title="Syslog (xm_syslog)">xm_syslog</a> module.
     Alternatively parsers can be directly implemented in the nxlog language by
     constructs such as <a class="link" href="#lang_type_regexp">regular expressions</a>
     using capturing or the other built-in functions and procedures available for string
     manipulation. Writing parsers in the nxlog language is especially useful if there
     is no dedicated parser module for the specific log source. 
   </p><div class="section" title="Operating Systems"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sources_os"></a>Operating Systems</h2></div></div></div><p>
       This section provides information and examples about collecting system messages
       of various operating systems. OS specific applications are also discussed here.
       The following sources are not operating system specific but work on most supported
       platforms:
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="link" href="#sources_network" title="Network">Network</a></td></tr><tr><td><a class="link" href="#sources_database" title="Database">Database</a></td></tr><tr><td><a class="link" href="#sources_file" title="Files">Files</a></td></tr><tr><td><a class="link" href="#sources_program" title="External programs and scripts">External programs and scripts</a></td></tr><tr><td><a class="link" href="#sources_app" title="Applications">Multi-platform applications</a></td></tr></table><p>

     </p><div class="section" title="Microsoft Windows"><div class="titlepage"><div><div><h3 class="title"><a name="sources_os_windows"></a>Microsoft Windows</h3></div></div></div><p>
       </p><div class="section" title="Windows EventLog"><div class="titlepage"><div><div><h4 class="title"><a name="sources_os_windows_eventlog"></a>Windows EventLog</h4></div></div></div><p>
	   To collect log messages from the EventLog subsystem on Windows 2000 and 2003, use the
	   <a class="link" href="#im_mseventlog" title="MS EventLog for Windows XP/2000/2003 (im_mseventlog)">im_mseventlog</a> module. This will also work
	   on later versions, but the <a class="link" href="#im_msvistalog" title="MS EventLog for Windows 2008/Vista and later (im_msvistalog)">im_msvistalog</a> module
	   is recommended for use on Windows 2008, Vista and later.
	   See the <a class="link" href="#im_mseventlog_config_examples" title="Configuration examples">im_mseventlog</a> and
	   <a class="link" href="#im_msvistalog_config_examples" title="Configuration examples">im_msvistalog</a>
	   configuration examples.
	 </p></div><div class="section" title="Microsoft SQL Server"><div class="titlepage"><div><div><h4 class="title"><a name="sources_os_windows_mssql"></a>Microsoft SQL Server</h4></div></div></div><p>
	   Microsoft SQL Server stores its logs in UTF-16 encoding using a line-based format.
	   It is recommended to normalize the encoding to UTF-8. The following config snippet
	   will do that.

	   </p><pre class="programlisting">
&lt;Extension _charconv&gt;
    Module      xm_charconv
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file
    File	"C:\\MSSQL\\ERRORLOG"
    Exec	$raw_event = convert($raw_event, 'UCS-2LE','UTF-8'); if $raw_event == '' drop();
&lt;/Input&gt;</pre><p>
	   As of this writing, the <a class="link" href="#config_inputtype_linebased">LineBased</a>
	   parser, the default <a class="link" href="#config_inputtype" title="InputType">InputType</a> for 
	   <a class="link" href="#im_file" title="File (im_file)">im_file</a>
           is not able to properly read the double-byte UTF-16 encoded files and will read 
           an additional empty line (because of the double-byte CRLF). The above drop() call
           is intended to fix this.
           <span class="command"><strong>convert_fields('UTF-16','UTF-8');</strong></span> might also work instead of UCS-2LE.
	 </p></div><div class="section" title="Microsoft IIS"><div class="titlepage"><div><div><h4 class="title"><a name="sources_os_windows_iis"></a>Microsoft IIS</h4></div></div></div><p>
	   Microsoft Internet Information Server supports
	   <a class="ulink" href="http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/bea506fd-38bc-4850-a4fb-e3a0379d321f.mspx" target="_top">different log file formats</a>.
	   Log files created by IIS are line-based and can be read with <a class="link" href="#im_file" title="File (im_file)">im_file</a>.
</p><pre class="programlisting">
&lt;Input IIS&gt;
	Module	im_file
	File	'C:\inetpub\logs\LogFiles\u_ex*'
&lt;/Input&gt;</pre><p>
          The above needs to be extended with appropriate parser rules if you want to parse the
individual fields. See the following options depending on the format which is configured for your
instance.
	 </p><div class="section" title="W3C Extended Log File Format"><div class="titlepage"><div><div><h5 class="title"><a name="sources_os_windows_iis_format_w3c"></a>W3C Extended Log File Format</h5></div></div></div><p>
	     See the <a class="link" href="#processing_parsers_w3c" title="W3C Extended Log File Format">W3C Extended Log File Format</a>
	     section in the <a class="link" href="#processing" title="Chapterï¿½9.ï¿½Processing logs">Processing messages</a> chapter,
	     the <a class="ulink" href="http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/676400bc-8969-4aa7-851a-9319490a9bbb.mspx?mfr=true" target="_top">W3C Extended Log File Format (IIS 6.0)</a> docs
	     and the
	     <a class="ulink" href="http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/ffdd7079-47be-4277-921f-7a3a6e610dcb.mspx?mfr=true" target="_top">W3C Extended Log File Examples (IIS 6.0)</a>.
	   </p></div><div class="section" title="Microsoft IIS Format"><div class="titlepage"><div><div><h5 class="title"><a name="sources_os_windows_iis_format_iis"></a>Microsoft IIS Format</h5></div></div></div><p>
	     The IIS format is line-based, fields are comma separated. It can be parsed with
	     the help of the <a class="link" href="#xm_csv" title="CSV (xm_csv)">xm_csv</a> module or with regular expressions.
	   </p></div><div class="section" title="NCSA Common Log File Format"><div class="titlepage"><div><div><h5 class="title"><a name="sources_os_windows_iis_format_common_log"></a>NCSA Common Log File Format</h5></div></div></div><p>

	   </p></div><div class="section" title="ODBC Logging"><div class="titlepage"><div><div><h5 class="title"><a name="sources_os_windows_iis_format_odbc"></a>ODBC Logging</h5></div></div></div><p>
	     To read IIS logs from the ODBC datastore, use the im_odbc module.
	   </p></div></div></div><div class="section" title="GNU/Linux"><div class="titlepage"><div><div><h3 class="title"><a name="sources_os_linux"></a>GNU/Linux</h3></div></div></div><p>

	 </p><div class="variablelist"><dl><dt><span class="term">Kernel logs</span></dt><dd><p>
		 The <a class="link" href="#im_kernel" title="Kernel (im_kernel)">im_kernel</a> module is dedicated to
		 read the kernel log buffer.
	       </p></dd><dt><span class="term">Local syslog</span></dt><dd><p>
		 Local syslog is sent to the unix domain socket at /dev/log.
		 The <a class="link" href="#im_uds" title="Unix Domain Socket (im_uds)">im_uds</a> module should be used together with
		 <a class="link" href="#xm_syslog" title="Syslog (xm_syslog)">xm_syslog</a> or
		 <a class="link" href="#pm_transformer" title="Message format converter (pm_transformer)">pm_transformer</a>.
	       </p></dd></dl></div><p>
       </p></div><div class="section" title="Android"><div class="titlepage"><div><div><h3 class="title"><a name="sources_os_android"></a>Android</h3></div></div></div><p>
	 </p><div class="variablelist"><dl><dt><span class="term">Kernel logs</span></dt><dd><p>
		 The Linux kernel log can be read with the
		 <a class="link" href="#im_kernel" title="Kernel (im_kernel)">im_kernel</a> module.
	       </p></dd><dt><span class="term">Android device logs</span></dt><dd><p>
		 Android has a special in-kernel logging system. The 
		 im_android module can read this.
	       </p></dd></dl></div><p>
       </p></div></div><div class="section" title="Network"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sources_network"></a>Network</h2></div></div></div><p>
       This section provides information and examples about receiving log messages from
       the network over various protocols.
     </p><div class="section" title="UDP"><div class="titlepage"><div><div><h3 class="title"><a name="sources_network_udp"></a>UDP</h3></div></div></div><p>
	 See <a class="link" href="#im_udp" title="UDP (im_udp)">im_udp</a>.
       </p></div><div class="section" title="TCP"><div class="titlepage"><div><div><h3 class="title"><a name="sources_network_tcp"></a>TCP</h3></div></div></div><p>
	 See <a class="link" href="#im_tcp" title="TCP (im_tcp)">im_tcp</a>.
       </p></div><div class="section" title="TLS/SSL over TCP"><div class="titlepage"><div><div><h3 class="title"><a name="sources_network_ssl"></a>TLS/SSL over TCP</h3></div></div></div><p>
	 See <a class="link" href="#im_ssl" title="TLS/SSL (im_ssl)">im_ssl</a>.
       </p></div><div class="section" title="Syslog"><div class="titlepage"><div><div><h3 class="title"><a name="sources_network_syslog"></a>Syslog</h3></div></div></div><p>
	 If you need to receive syslog over the network, the
	 <a class="link" href="#xm_syslog" title="Syslog (xm_syslog)">xm_syslog</a> or
	 <a class="link" href="#pm_transformer" title="Message format converter (pm_transformer)">pm_transformer</a> module should be coupled
	 with one of the network modules above. Syslog parsing is not even required if you
	 only want to forward or store syslog as is.
       </p></div></div><div class="section" title="Database"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sources_database"></a>Database</h2></div></div></div><p>
       With special modules it is possible to read logs directly from database servers.
     </p><div class="section" title="Using im_dbi"><div class="titlepage"><div><div><h3 class="title"><a name="sources_database_dbi"></a>Using im_dbi</h3></div></div></div><p>
	 The im_dbi module can be used on POSIX systems where libdbi is available.
	 See the <a class="link" href="#im_dbi" title="DBI (im_dbi)">im_dbi</a> module documentation.
       </p></div><div class="section" title="Using im_odbc"><div class="titlepage"><div><div><h3 class="title"><a name="sources_database_odbc"></a>Using im_odbc</h3></div></div></div><p>
	 The im_odbc module can be used with ODBC compatible databases on Windows, Linux and Unix.
       </p></div></div><div class="section" title="Files"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sources_file"></a>Files</h2></div></div></div><p>
       The <a class="link" href="#im_file" title="File (im_file)">im_file</a> module can be used to read logs from files.
       See <a class="link" href="#processing" title="Chapterï¿½9.ï¿½Processing logs">Processing messages</a> chapter about parsing various
       formats.
     </p></div><div class="section" title="External programs and scripts"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sources_program"></a>External programs and scripts</h2></div></div></div><p>
       The <a class="link" href="#im_exec" title="Program (im_exec)">im_exec</a> module can be used to read logs from
       external programs and scripts over a pipe.
       See <a class="link" href="#processing" title="Chapterï¿½9.ï¿½Processing logs">Processing messages</a> chapter about parsing various
       formats.
     </p></div><div class="section" title="Applications"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sources_app"></a>Applications</h2></div></div></div><p>
       This section provides information and examples about collecting log messages from
       various operating system independent (i.e. multi-platform) applications.
       Operating system applications are discussed in the 
       <a class="link" href="#sources_os" title="Operating Systems">previous</a> section.
     </p><div class="section" title="Apache HTTP Server"><div class="titlepage"><div><div><h3 class="title"><a name="sources_app_apache"></a>Apache HTTP Server</h3></div></div></div><p>
	 The Apache HTTP Server provides very comprehensive and flexible 
	 <a class="ulink" href="http://httpd.apache.org/docs/2.0/logs.html" target="_top">logging capabilities</a>
       </p><div class="section" title="Access log - Common Log Format"><div class="titlepage"><div><div><h4 class="title"><a name="sources_app_apache_access_log_common"></a>Access log - Common Log Format</h4></div></div></div><p>

	 </p></div><div class="section" title="Access log - Combined Log Format"><div class="titlepage"><div><div><h4 class="title"><a name="sources_app_apache_access_log_combined"></a>Access log - Combined Log Format</h4></div></div></div><p>
	   See the <a class="link" href="#processing_parsers_combined_log_format" title="NCSA Combined Log Format">NCSA Combined Log Format</a>
	   section in the <a class="link" href="#processing" title="Chapterï¿½9.ï¿½Processing logs">Processing messages</a> chapter.
	 </p></div></div><div class="section" title="Apache Tomcat and java application logs"><div class="titlepage"><div><div><h3 class="title"><a name="sources_app_tomcat"></a>Apache Tomcat and java application logs</h3></div></div></div><p>
	 Apache tomcat and java applications are
	 <a class="ulink" href="http://tomcat.apache.org/tomcat-6.0-doc/logging.html" target="_top">very flexible</a>
	 and can be configured for different transports and formats.
       </p><p>
	 Here is a log sample consisting of 3 events. The log message of the second event 
	 spans multiple lines.
	 </p><pre class="programlisting">
2001-01-25 17:31:42,136 INFO [org.nxlog.somepackage.Class] - single line
2001-01-25 17:41:16,268 ERROR [org.nxlog.somepackage.Class] - Error retrieving names: ; nested exception is:
        java.net.ConnectException: Connection refused
AxisFault
 faultCode: {http://schemas.xmlsoap.org/soap/envelope/}Server.userException
 faultSubcode:
 faultString: java.net.ConnectException: Connection refused
 faultActor:
 faultNode:
 faultDetail:
        {http://xml.apache.org/axis/}stackTrace:java.net.ConnectException: Connection refused
2001-01-25 17:57:38,469 INFO [org.nxlog.somepackage.Class] - third log message
</pre><p>
	 
	 </p><div class="example"><a name="idp31140096"></a><p class="title"><b>Exampleï¿½8.1.ï¿½Parsing tomcat logs into fields</b></p><div class="example-contents"><p>
	     This can be very useful to filter messages by the emitting java class for example.
	   </p><pre class="programlisting">
&lt;Input log4j&gt;
        Module  im_file
        File    "/var/log/tomcat6/catalina.out"
        &lt;Exec&gt;
            if $raw_event =~ /^(\d{4}\-\d{2}\-\d{2} \d{2}\:\d{2}\:\d{2}),\d{3} (\S+) \[(\S+)\] \- (.*)/
            {
                $log4j.time = parsedate($1);
                $log4j.loglevel = $2;
                $log4j.class = $3;
                $log4j.msg = $4;
            }
        &lt;/Exec&gt;
&lt;/Input&gt;

&lt;Output out&gt;
        Module  om_null
&lt;/Output&gt;

&lt;Route tomcat&gt;
    Path        log4j =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">
	 To parse and process multi-line messages such as the above, see the 
	 <a class="link" href="#processing_multiline" title="Dealing with multi-line messages">Dealing with multi-line messages</a> section.
       </p></div></div><div class="section" title="Devices"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sources_device"></a>Devices</h2></div></div></div><p>
       This section deals with special devices such as routers, firewalls, switches and other
       appliances.
     </p><div class="section" title="Cisco"><div class="titlepage"><div><div><h3 class="title"><a name="sources_device_cisco"></a>Cisco</h3></div></div></div><p>
	 Cisco devices can be instructed to log over syslog. Unfortunately the lousy syslog RFC
	 standards compliance and the different formats of cisco devices make it hard to have a
	 universal cisco syslog parser. Some examples follow.
       </p><div class="example"><a name="idp30032704"></a><p class="title"><b>Exampleï¿½8.2.ï¿½Cisco Secure Access Control Server</b></p><div class="example-contents"><p>
	   Refer to the <a class="ulink" href="http://www.cisco.com/en/US/docs/net_mgmt/cisco_secure_access_control_server_for_windows/4.1/configuration/guide/syslog.html#wp999729" target="_top">Configuring Syslog Logging</a> 
	   section in the Cisco Configuration Guide.
	   An example syslog record from a Cisco ACS device looks like the following:
	   </p><pre class="programlisting">&lt;38&gt;Oct 16 21:01:29 10.0.1.1 CisACS_02_FailedAuth 1k1fg93nk 1 0 Message-Type=Authen failed,User-Name=John,NAS-IP-Address=10.0.1.2,AAA Server=acs01</pre><p>
	   The following configuration file instructs nxlog to accept syslog messages on UDP port 
	   1514. The payload is parsed as syslog and then the ACS specific fields are
	   extracted. The output is written to a file in JSON format.
	   </p><pre class="programlisting">
&lt;Extension json&gt;
    Module      xm_json
&lt;/Extension&gt;

&lt;Extension syslog&gt;
    Module      xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_udp
    Host	0.0.0.0
    Port	1514
    &lt;Exec&gt;
        parse_syslog_bsd();
        if ( $Message =~ /^CisACS_(\d\d)_(\S+) (\S+) (\d+) (\d+) (.*)$/ )
        {
             $ACSCategoryNumber = $1;
             $ACSCategoryName = $2;
             $ACSMessageId = $3;
             $ACSTotalSegments = $4;
             $ACSSegmentNumber = $5;
             $Message = $6;
             if ( $Message =~ /Message-Type=([^\,]+)/ ) { $ACSMessageType = $1; }
             if ( $Message =~ /User-Name=([^\,]+)/ ) { $AccountName = $1; }
             if ( $Message =~ /NAS-IP-Address=([^\,]+)/ ) { $ACSNASIPAddress = $1; }
             if ( $Message =~ /AAA Server=([^\,]+)/ ) { $ACSAAAServer = $1; }
        }
#       else log_warning("does not match: " + to_json());
    &lt;/Exec&gt;
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"tmp/output.txt"
    Exec	to_json();
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre><p>
	 </p></div></div><br class="example-break"><div class="example"><a name="idp30038000"></a><p class="title"><b>Exampleï¿½8.3.ï¿½Cisco PIX and Cisco ASA</b></p><div class="example-contents"><p>
	   The PIX  <a class="ulink" href="http://www.cisco.com/en/US/docs/security/pix/pix63/system/message/pixemint.html#wp1020170" target="_top">Log Message Format</a> 
	   is described in the <em class="replaceable"><code>Cisco PIX Firewall System Log Messages</code></em> 
	   document.
	   An example syslog record from a Cisco ASA device looks like the following:
	   </p><pre class="programlisting">&lt;38&gt;Oct 12 2004 22:45:15 : %ASA-2-106006: Deny inbound UDP from 10.0.1.2/137 to 10.0.1.1/137 on interface inside</pre><p>
	   The following configuration file instructs nxlog to accept syslog messages on UDP port 
	   1514. The payload is parsed as syslog and then the ASA/PIX specific fields are
	   extracted. The output is written to a file in JSON format.
	   </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	       The <a class="ulink" href="http://www.cisco.com/en/US/docs/security/pix/pix63/system/message/pixemint.html#wp1040486" target="_top">variables</a>
	       can be extracted into fields with further parsing rules based on <em class="replaceable"><code>CiscoMessageNumber</code></em>.
	       See the <a class="ulink" href="http://www.cisco.com/en/US/docs/security/asa/asa72/system/message/logmsgs.html" target="_top">System Log Messages</a>
	       for a complete list.
	       If you intend to create parsing rules for a lot of message types, consider using
	       the <a class="link" href="#pm_pattern" title="Pattern matcher (pm_pattern)">pm_pattern</a> module.
	     </p></div><p>
	   </p><pre class="programlisting">
&lt;Extension json&gt;
    Module      xm_json
&lt;/Extension&gt;

&lt;Extension syslgo&gt;
    Module      xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_udp
    Host	0.0.0.0
    Port	1514
    Exec	parse_syslog_bsd();
    &lt;Exec&gt;
        if ( $Message =~ /^\: \%(ASA|PIX)-(\d)-(\d\d\d\d\d\d)\: (.*)$/ )
        {
            $CiscoSeverityNumber = $2;
            $CiscoMessageNumber = $3;
            $Message = $4;
        }
        else log_warning("does not match: " + $raw_event);
    &lt;/Exec&gt;
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"tmp/output.txt"
    Exec	to_json();
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre><p>
	   
	 </p></div></div><br class="example-break"></div><div class="section" title="Checkpoint"><div class="titlepage"><div><div><h3 class="title"><a name="sources_device_checkpoint"></a>Checkpoint</h3></div></div></div><p>
	 The im_checkpoint module can collect logs from Checkpoint devices over the OPSEC LEA protocol.
	 (Note: available in the Enterprise Edition only).
       </p></div></div></div><div class="chapter" title="Chapterï¿½9.ï¿½Processing logs"><div class="titlepage"><div><div><h2 class="title"><a name="processing"></a>Chapterï¿½9.ï¿½Processing logs</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#processing_parsers">Parsing various formats</a></span></dt><dd><dl><dt><span class="section"><a href="#processing_parsers_w3c">W3C Extended Log File Format</a></span></dt><dt><span class="section"><a href="#processing_parsers_combined_log_format">NCSA Combined Log Format</a></span></dt><dt><span class="section"><a href="#processing_parsers_csv">Field delimited formats (CSV)</a></span></dt><dt><span class="section"><a href="#processing_parsers_json">JSON</a></span></dt><dt><span class="section"><a href="#processing_parsers_xml">XML</a></span></dt></dl></dd><dt><span class="section"><a href="#processing_datetime">Parsing date and time strings</a></span></dt><dt><span class="section"><a href="#processing_filtering">Filtering messages</a></span></dt><dd><dl><dt><span class="section"><a href="#processing_filtering_drop">Using drop()</a></span></dt><dt><span class="section"><a href="#processing_filtering_pm_filter">Filtering through pm_filter</a></span></dt></dl></dd><dt><span class="section"><a href="#processing_multiline">Dealing with multi-line messages</a></span></dt><dd><dl><dt><span class="section"><a href="#processing_multiline_module_vars">Using module variables</a></span></dt><dt><span class="section"><a href="#processing_multiline_xm_multiline">Using xm_multiline</a></span></dt></dl></dd><dt><span class="section"><a href="#processing_alerting_scripts">Alerting, calling external scripts and programs</a></span></dt><dd><dl><dt><span class="section"><a href="#processing_calling_scripts_om_exec">Sending all messages to an external program</a></span></dt><dt><span class="section"><a href="#processing_calling_scripts_xm_exec">Invoking a script or program for each message</a></span></dt><dt><span class="section"><a href="#processing_calling_scripts_alerting">Alerting</a></span></dt></dl></dd><dt><span class="section"><a href="#processing_rewrite">Rewriting and modifying messages</a></span></dt><dt><span class="section"><a href="#processing_format_conversion">Message format conversion</a></span></dt><dt><span class="section"><a href="#processing_charset_conversion">Character set conversion</a></span></dt><dt><span class="section"><a href="#processing_discarding">Discarding messages</a></span></dt><dt><span class="section"><a href="#processing_rate_limiting">Rate limiting</a></span></dt><dt><span class="section"><a href="#processing_buffering">Buffering</a></span></dt><dt><span class="section"><a href="#processing_pattern_matching">Pattern matching and message classification</a></span></dt><dd><dl><dt><span class="section"><a href="#processing_pattern_matching_regexp">Regular expressions in the Exec directive</a></span></dt><dt><span class="section"><a href="#processing_pattern_matching_pm_pattern">Using pm_pattern</a></span></dt></dl></dd><dt><span class="section"><a href="#processing_correlation">Event correlation</a></span></dt><dt><span class="section"><a href="#processing_log_rotation">Log rotation and retention</a></span></dt><dt><span class="section"><a href="#processing_explicit_drop">Explicit drop</a></span></dt></dl></div><p>
     This chapter deals with various tasks that might be required after a log message is 
     received by nxlog.
   </p><div class="section" title="Parsing various formats"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="processing_parsers"></a>Parsing various formats</h2></div></div></div><p>
       There are a couple standard log file formats in use by various applications such as
       web servers, firewalls, ftp servers etc. This section tries to give a hand by providing
       config snippets to parse these formats.
     </p><p>
       Data is parsed and processed in multiple steps. For stream based data (e.g. files,
       TCP, SSL) the input module must know the log message boundary in order to be able to read
       each message frame. The framing depends on the format. The most common type is line-based, 
       where each log message is separated by a linebreak. Log messages may be separated by the header
       only such as multi-line messages (e.g. stack and exception traces in java).
       So the first step during message reception is to read the frames, i.e. the log messages.
       This task is done by the input reader functions which can be specified with the
       <a class="link" href="#config_inputtype" title="InputType">InputType</a> directive. There are a couple built-in
       input reader functions, others may be registered by modules.
     </p><p>
       There may be additional parsing involved or required after a message is read. 
       For example when a BSD syslog message is read, the message frame is read by the 
       <a class="link" href="#config_inputtype_linebased">LineBased</a> input reader. Then this message
       may be further parsed (i.e. to extract the hostname, date, severity)  by modules
       (such as <a class="link" href="#xm_syslog" title="Syslog (xm_syslog)">xm_syslog</a>)
       or using nxlog language constructs in the <a class="link" href="#config_module_exec" title="Exec">Exec</a>
       directive. This will result in nxlog message <a class="link" href="#lang_fields" title="Fields">fields</a>
       filled with value.
       There may be additional processing taken place to further tokenize or parse specific
       field contents (e.g. $Message) using regular expressions or the
       <a class="link" href="#pm_pattern" title="Pattern matcher (pm_pattern)">pm_pattern</a> module.
     </p><div class="section" title="W3C Extended Log File Format"><div class="titlepage"><div><div><h3 class="title"><a name="processing_parsers_w3c"></a>W3C Extended Log File Format</h3></div></div></div><p>
	 See the <a class="ulink" href="http://www.w3.org/TR/WD-logfile.html" target="_top">specification draft</a>
	 of the format, it's not all that long.
	 The important header line is the one which starts with <em class="replaceable"><code>#Fields</code></em>.
	 Using this information you can set up a parser rule to tokenize the fields using either
	 <a class="link" href="#xm_csv" title="CSV (xm_csv)">xm_csv</a> (as shown in the example below), 
	 <a class="link" href="#pm_transformer" title="Message format converter (pm_transformer)">pm_transformer</a> or 
	 using regular expressions directly (similarly to how it's done in the
	 <a class="link" href="#processing_parsers_combined_log_format_example" title="Exampleï¿½9.2.ï¿½Parsing apache logs in Combined Log Format">Parsing apache logs in Combined Log Format</a>
	 example).
	 </p><div class="example"><a name="idp33701584"></a><p class="title"><b>Exampleï¿½9.1.ï¿½Parsing the W3C Extended Log File Format using xm_csv</b></p><div class="example-contents"><p>
	     Here is a sample log in this format which we need to parse:
	     </p><pre class="programlisting">#Version: 1.0
#Date: 2011-07-01 00:00:00
#Fields: date time cs-method cs-uri
2011-07-01 00:34:23 GET /foo/bar1.html
2011-07-01 12:21:16 GET /foo/bar2.html
2011-07-01 12:45:52 GET /foo/bar3.html
2011-07-01 12:57:34 GET /foo/bar4.html</pre><p>
	     The following configuration reads this file, tokenizes it with the csv parser.
	     Header lines starting with a leading sharp (<em class="replaceable"><code>#</code></em>) are 
	     ignored.
	     The <em class="replaceable"><code>EventTime</code></em> field is constructed from the
	     <em class="replaceable"><code>date</code></em> and <em class="replaceable"><code>time</code></em> fields and is
	     converted to a <a class="link" href="#lang_type_datetime">datetime</a> type.
	     Finally the fields are output as JSON into another file.
	     </p><pre class="programlisting">
&lt;Extension w3c&gt;
    Module      xm_csv
    Fields	$date, $time, $HTTPMethod, $HTTPURL
    FieldTypes  string, string, string, string
    Delimiter	' '
    EscapeChar  '"'
    QuoteChar   '"'
    EscapeControl FALSE
    UndefValue  -
&lt;/Extension&gt;

&lt;Extension json&gt;
    Module      xm_json
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_file
    File	"tmp/iis.log"
    ReadFromLast FALSE
    &lt;Exec&gt;
        if $raw_event =~ /^#/ drop();
        else
        {
            w3c-&gt;parse_csv();
            $EventTime = parsedate($date + " " + $time);
        }
    &lt;/Exec&gt;
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    Exec	$raw_event = to_json();
    File	"tmp/output.json"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre><p>
	   </p></div></div><p><br class="example-break">
       </p></div><div class="section" title="NCSA Combined Log Format"><div class="titlepage"><div><div><h3 class="title"><a name="processing_parsers_combined_log_format"></a>NCSA Combined Log Format</h3></div></div></div><p>
	 </p><div class="example"><a name="processing_parsers_combined_log_format_example"></a><p class="title"><b>Exampleï¿½9.2.ï¿½Parsing apache logs in Combined Log Format</b></p><div class="example-contents"><p>
	     The following configuration shows an example for filtering access logs and
	     only storing those related to the user 'john':
	     </p><pre class="programlisting">
&lt;Input access_log&gt;
	Module	im_file
	File	"/var/log/apache2/access.log"
        &lt;Exec&gt;
            if $raw_event =~ /^(\S+) (\S+) (\S+) \[([^\]]+)\] \"(\S+) (.+) HTTP.\d\.\d\" (\d+) (\d+) \"([^\"]+)\" \"([^\"]+)\"/
            {
                $Hostname = $1;
                if $3 != '-' $AccountName = $3;
                $EventTime = parsedate($4);
                $HTTPMethod = $5;
                $HTTPURL = $6;
                $HTTPResponseStatus = $7;
                $FileSize = $8;
                $HTTPReferer = $9;
                $HTTPUserAgent = $10;
            }
        &lt;/Exec&gt;
&lt;/Input&gt;

&lt;Output out&gt;
	Module	om_file
	File	'/var/log/john_access.log'
	Exec	if not (defined($AccountName) and ($AccountName == 'john')) drop();
&lt;/Output&gt;

&lt;Route apache&gt;
    Path	access_log =&gt; out
&lt;/Route&gt;
</pre><p>
	   </p></div></div><p><br class="example-break">
       </p></div><div class="section" title="Field delimited formats (CSV)"><div class="titlepage"><div><div><h3 class="title"><a name="processing_parsers_csv"></a>Field delimited formats (CSV)</h3></div></div></div><p>
	 Comma, space, semicolon separated field list is a frequently used format.
	 See the <a class="link" href="#xm_csv" title="CSV (xm_csv)">xm_csv</a> and/or 
	 <a class="link" href="#pm_transformer" title="Message format converter (pm_transformer)">pm_transformer</a> modules.
       </p></div><div class="section" title="JSON"><div class="titlepage"><div><div><h3 class="title"><a name="processing_parsers_json"></a>JSON</h3></div></div></div><p>
	 See the <a class="link" href="#xm_json" title="JSON (xm_json)">xm_json</a> module about parsing structured data in JSON.
       </p></div><div class="section" title="XML"><div class="titlepage"><div><div><h3 class="title"><a name="processing_parsers_xml"></a>XML</h3></div></div></div><p>
	 See the <a class="link" href="#xm_xml" title="XML (xm_xml)">xm_xml</a> module about parsing structured data in XML.
       </p></div></div><div class="section" title="Parsing date and time strings"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="processing_datetime"></a>Parsing date and time strings</h2></div></div></div><p>
       The <a class="link" href="#core_func_parsedate">parsedate()</a> function can be used to efficiently
       parse strings representing a date.
       See the <a class="link" href="#processing_parsers_combined_log_format_example" title="Exampleï¿½9.2.ï¿½Parsing apache logs in Combined Log Format">Parsing apache logs in Combined Log Format</a>
       example for sample usage.
     </p><p>
       The following formats are supported by <code class="function">parsedate()</code>:
	 </p><div class="variablelist"><dl><dt><span class="term"><a name="processing_datetime_rfc3164"></a>RFC 3164 date</span></dt><dd><p>
		 Legacy syslog messages contain the date in this format which lacks the year. Example:
		 </p><pre class="programlisting">Sun 6 Nov 08:49:37</pre><p>
		 Unfortunately there are some deviations in some implementations, so the following 
		 are also recognized:
		 </p><pre class="programlisting">Sun 06 Nov 08:49:37
Sun  6 Nov 08:49:37
</pre><p>
	       </p></dd><dt><span class="term"><a name="processing_datetime_rfc1123"></a>RFC 1123</span></dt><dd><p>
		 RFC 1123 compliant dates are also supported, including a couple others which are
		 similar such as those defined in RFC 822, RFC 850 and RFC 1036.
		 Here is the concrete list:
		 </p><pre class="programlisting">Sun, 06 Nov 1994 08:49:37 GMT  ; RFC 822, updated by RFC 1123
Sunday, 06-Nov-94 08:49:37 GMT ; RFC 850, obsoleted by RFC 1036
Sun Nov  6 08:49:37 1994       ; ANSI C's asctime() format
Sun, 6 Nov 1994 08:49:37 GMT   ; RFC 822, updated by RFC 1123
Sun, 06 Nov 94 08:49:37 GMT    ; RFC 822
Sun,  6 Nov 94 08:49:37 GMT    ; RFC 822
Sun, 6 Nov 94 08:49:37 GMT     ; RFC 822
Sun, 06 Nov 94 08:49 GMT       ; Unknown
Sun, 6 Nov 94 08:49 GMT        ; Unknown
Sun, 06 Nov 94 8:49:37 GMT     ; Unknown [Elm 70.85]
Sun, 6 Nov 94 8:49:37 GMT      ; Unknown [Elm 70.85] 
Mon,  7 Jan 2002 07:21:22 GMT  ; Unknown [Postfix]
Sun, 06-Nov-1994 08:49:37 GMT  ; RFC 850 with four digit years</pre><p>
		 The above formats are recognized even without the leading day of week and without a
		 timezone.
	       </p></dd><dt><span class="term"><a name="processing_datetime_apache"></a>Apache/NCSA date</span></dt><dd><p>
		 This format can be found in Apache access logs 
		 (<a class="link" href="#processing_parsers_combined_log_format" title="NCSA Combined Log Format">NCSA Combined Log Format</a>)
		 and possibly other sources. Example:
		 </p><pre class="programlisting">24/Aug/2009:16:08:57 +0200</pre><p>
	       </p></dd><dt><span class="term"><a name="processing_datetime_iso"></a>ISO and RFC 3339 date</span></dt><dd><p>
		 nxlog can parse the ISO format with or without subsecond resolution, and
		 with or without timezone information. It accepts either a comma (,) or a dot (.)
		 in case there is sub-second resolution.
		 Examples:
		 </p><pre class="programlisting">1977-09-06 01:02:03
1977-09-06 01:02:03.004
1977-09-06T01:02:03.004Z
1977-09-06T01:02:03.004+02:00
2011-5-29 0:3:21
2011-5-29 0:3:21+02:00
2011-5-29 0:3:21.004
2011-5-29 0:3:21.004+02:00</pre><p>
	       </p></dd><dt><span class="term"><a name="processing_datetime_cisco"></a>CISCO syslog date</span></dt><dd><p>
		 This is an RFC 3164 format with millisecond precision. Example:
		 </p><pre class="programlisting">Nov 3 14:50:30.403
Nov  3 14:50:30.403
Nov 03 14:50:30.403
</pre><p>
		 The following format is also recognized (with or without millisecond precision):
		 </p><pre class="programlisting">Nov 3 2005 14:50:30.403
Nov  3 2005 14:50:30.403
Nov 03 2005 14:50:30.403
Nov 3 2005 14:50:30
Nov  3 2005 14:50:30
Nov 03 2005 14:50:30
</pre><p>
	       </p></dd><dt><span class="term"><a name="processing_datetime_windows"></a>Windows timestamp format</span></dt><dd><p>
		 This format is YYYYMMDDhhmmss.USEC with an optional timezone offset, for example:
		 </p><pre class="programlisting">20100426151354.537875-000
20100426151354.537875000
</pre><p>
	       </p></dd><dt><span class="term"><a name="processing_datetime_timestamp"></a>Integer timestamp format</span></dt><dd><p>
		 This format is XXXXXXXXXXXX.USEC. The value is expressed as an integer showing the
		 number of seconds elapsed since the epoch. The fractional microsecond part is optional.
		 The value is treated as GMT/UTC time.
		 Example:
		 </p><pre class="programlisting">1258531221.650359
1258531221
</pre><p>
	       </p></dd></dl></div><p>
	 Dates without timezone information are treated as local time. The year will be set to 1970
	 for dates missing the year such as in the 
	 <a class="link" href="#processing_datetime_rfc3164">RFC 3164 date format</a>.
	 Use the <a class="link" href="#core_func_fix_year">fix_year()</a> function to correct the year 
	 in such cases.
     </p><p>
       The <a class="link" href="#core_func_parsedate">parsedate()</a> function returns an undefined datetime value if it
       fails to parse the input string.
       You should take care of checking the return value for errors as in the example below.
	 </p><div class="example"><a name="idp32581744"></a><p class="title"><b>Exampleï¿½9.3.ï¿½Using the parsedate() function</b></p><div class="example-contents"><p>
	     Since our regular expression is quite vague, it may match strings which are invalid. 
	     In this case <a class="link" href="#core_func_parsedate">parsedate()</a> will return an undefined datetime value.
	     </p><pre class="programlisting">
$raw_event = "2020-02-03 04:05:06 ......";
if $raw_event =~ /^(\S+)\s+(\S+)/
{
   $EventTime = parsedate($1 + " " + $2);
}
# making sure $EventTime doesn't stay empty
if not defined($EventTime) $EventTime = now();

</pre><p>
	   </p></div></div><p><br class="example-break">
     </p><p>
       If the above doesn't cut it, there is also <a class="link" href="#core_func_strptime">strptime()</a>
       to parse more exotic formats.
	 </p><div class="example"><a name="idp32586464"></a><p class="title"><b>Exampleï¿½9.4.ï¿½Parsing date and time from Exchange logs</b></p><div class="example-contents"><p>
	     The following example is from an Exchange log. The date and time are delimited by a tab
	     (i.e. they are two distinct fields). Also it uses a non standard single digit format instead
	     of fixed width with double digits:
	     </p><pre class="programlisting">2011-5-29	0:3:2 GMT	...</pre><p>
	     To parse this, we can use a regexp and strptime():
	     </p><pre class="programlisting">
if $raw_event =~ /^(\d+-\d+-\d+\t\d+:\d+:\d+) GMT/ {
    $EventTime = strptime($1, '%Y-%m-%d%t%H:%M:%S');
}
</pre><p>
	   </p></div></div><p><br class="example-break">
     </p></div><div class="section" title="Filtering messages"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="processing_filtering"></a>Filtering messages</h2></div></div></div><p>
       Message filtering is a process where only a subset of the messages is let through.
       Filtering is possible using regular expressions or other operators using any of the fields.
     </p><div class="section" title="Using drop()"><div class="titlepage"><div><div><h3 class="title"><a name="processing_filtering_drop"></a>Using drop()</h3></div></div></div><p>
	 Use the <a class="link" href="#core_proc_drop">drop()</a> procedure to conditionally discard
	 messages in an <a class="link" href="#config_module_exec" title="Exec">Exec</a> directive.
	 </p><pre class="programlisting">
&lt;Input file&gt;
    Module	im_file
    File	"/var/log/myapp/*.log"
    Exec 	if not ($raw_event =~ /failed/ or $raw_event =~ /error/) drop();
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"/var/log/myapp/errors.txt"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path file =&gt; =&gt; out
&lt;/Route&gt;
</pre><p>
       </p></div><div class="section" title="Filtering through pm_filter"><div class="titlepage"><div><div><h3 class="title"><a name="processing_filtering_pm_filter"></a>Filtering through pm_filter</h3></div></div></div><p>
	 The other option is to use the <a class="link" href="#pm_filter" title="Filter (pm_filter)">pm_filter</a> module as
	 in the following example:
	 </p><pre class="programlisting">
&lt;Input unix&gt;
    Module	im_uds
    uds		/dev/log
&lt;/Input&gt;

&lt;Processor filter&gt;
    Module pm_filter
    Condition $raw_event =~ /failed/ or $raw_event =~ /error/
&lt;/Processor&gt;

&lt;Output out&gt;
    Module	om_file
    File	"/var/log/error"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path unix =&gt; filter =&gt; out
&lt;/Route&gt;
</pre><p>
       </p></div></div><div class="section" title="Dealing with multi-line messages"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="processing_multiline"></a>Dealing with multi-line messages</h2></div></div></div><p>
     </p><div class="section" title="Using module variables"><div class="titlepage"><div><div><h3 class="title"><a name="processing_multiline_module_vars"></a>Using module variables</h3></div></div></div><p>
	 This example uses regular expressions and module variables to concatenate
	 lines belonging to a single event.
       </p><div class="example"><a name="idp33593520"></a><p class="title"><b>Exampleï¿½9.5.ï¿½Parsing multiline messages using module variables</b></p><div class="example-contents"><pre class="programlisting">
&lt;Input log4j&gt;
        Module	im_file
        File	"/var/log/tomcat6/catalina.out"
        &lt;Exec&gt;
                if $raw_event =~ /^\d{4}\-\d{2}\-\d{2} \d{2}\:\d{2}\:\d{2},\d{3} \S+ \[\S+\] \- .*/
                {
                    if defined(get_var('saved'))
                    {
                       $tmp = $raw_event;
                       $raw_event = get_var('saved');
                       set_var('saved', $tmp);
                       $tmp = undef;
                       log_info($raw_event);
                    }
                    else
                    {
                        set_var('saved', $raw_event);
                        drop();
                    }
                }
                else
                {
                  set_var('saved', get_var('saved') + "\n" + $raw_event);
                  drop();
                }
        &lt;/Exec&gt;
&lt;/Input&gt;

&lt;Output out&gt;
	Module	om_null
&lt;/Output&gt;

&lt;Route tomcat&gt;
    Path	log4j =&gt; out
&lt;/Route&gt;
</pre><p>
	   Unfortunately this solution has a minor flaw. The log message of an event is
	   only forwarded if a new log is read, otherwise it is kept in the 'saved'
	   variable indefinitely. 
	 </p></div></div><br class="example-break"></div><div class="section" title="Using xm_multiline"><div class="titlepage"><div><div><h3 class="title"><a name="processing_multiline_xm_multiline"></a>Using xm_multiline</h3></div></div></div><p>
	 There is a dedicated extension module <a class="link" href="#xm_multiline" title="Multi-line message parser (xm_multiline)">xm_multiline</a>
	 which makes it easier to deal with multi-line messages without the need to use
	 module variables and write complex rules.
       </p></div></div><div class="section" title="Alerting, calling external scripts and programs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="processing_alerting_scripts"></a>Alerting, calling external scripts and programs</h2></div></div></div><p>
       There are a couple ways to invoke external scripts and pass data to them.
     </p><div class="section" title="Sending all messages to an external program"><div class="titlepage"><div><div><h3 class="title"><a name="processing_calling_scripts_om_exec"></a>Sending all messages to an external program</h3></div></div></div><p>
	 Using the <a class="link" href="#om_exec" title="Program (om_exec)">om_exec</a> module, all messages can be piped
	 to an external program or script which should be running until the module
	 (or nxlog) is stopped.
       </p></div><div class="section" title="Invoking a script or program for each message"><div class="titlepage"><div><div><h3 class="title"><a name="processing_calling_scripts_xm_exec"></a>Invoking a script or program for each message</h3></div></div></div><p>
	 The <a class="link" href="#xm_exec" title="External program execution (xm_exec)">xm_exec</a> module provides two procedure calls,
	 <a class="link" href="#xm_exec_proc_exec">exec()</a> and
	 <a class="link" href="#xm_exec_proc_exec_async">exec_async()</a>,
	 to spawn an external script or program. 
	 See this <a class="link" href="#om_file_config_example_rotate1" title="Exampleï¿½6.58.ï¿½File rotation based on size">file rotation</a> example
	 where bzip is executed to compress a logfile.
       </p></div><div class="section" title="Alerting"><div class="titlepage"><div><div><h3 class="title"><a name="processing_calling_scripts_alerting"></a>Alerting</h3></div></div></div><p>
	 Alerting is a process when a notification message is triggered if a certain
	 condition is satisfied.
	 Alerting can be implemented using one of the previous two modules.
	 When using <a class="link" href="#om_exec" title="Program (om_exec)">om_exec</a>, the alerting script will receive
	 all messages.
	 The following example shows how to send an email using 
	 <a class="link" href="#xm_exec" title="External program execution (xm_exec)">xm_exec</a> when a regexp condition is met:
	 </p><pre class="programlisting">
&lt;Extension exec&gt;
    Module	xm_exec
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_tcp
    Host	0.0.0.0
    Port	1514
    &lt;Exec&gt;
        if $raw_event =~ /alertcondition/ 
        {
           exec_async("/bin/sh", "-c", 'echo "' + $Hostname + '\n\nRawEvent:\n' + $raw_event +
                        '"|/usr/bin/mail -a "Content-Type: text/plain; charset=UTF-8" -s "ALERT" ' +
                        'user@domain.com');
        }
    &lt;/Exec&gt;
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"/var/log/messages"
&lt;/Output&gt;

&lt;Route r&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre><p>
       </p></div></div><div class="section" title="Rewriting and modifying messages"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="processing_rewrite"></a>Rewriting and modifying messages</h2></div></div></div><p>
       There are many ways to modify log messages. A simple method which does not always
       work is to modify the $raw_event field (in case of syslog) without parsing the message.
       This can be done with regular expressions using capturing, for example:
       </p><pre class="programlisting">
if $raw_event =~ /^(aaaa)(replaceME)(.+)/ $raw_event = $1 + 'replaceMENT' + $3;
</pre><p>
       The more complex method is to parse the message into fields, modify some fields and 
       finally reconstruct the message from the fields.
       The <a class="link" href="#xm_syslog_example1" title="Exampleï¿½6.26.ï¿½Conditional rewrite of the syslog facility - version 1">conditional rewrite of the syslog facility</a>
       example shows such a syslog message modification method.
     </p></div><div class="section" title="Message format conversion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="processing_format_conversion"></a>Message format conversion</h2></div></div></div><p>
       To convert between CSV formats, see <a class="link" href="#xm_csv_example1" title="Exampleï¿½6.1.ï¿½Complex CSV format conversion">this example</a>.
     </p><p>
       The following example shows an nxlog configuration which receives IETF syslog over UDP and
       forwards in the old BSD syslog format over TCP:
       </p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_udp
    Port 	514
    Host	0.0.0.0
    Exec	parse_syslog_ietf(); to_syslog_bsd();
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_tcp
    Host	1.2.3.4
    Port	1514
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre><p>
     </p><p>
       Take a look at the <a class="link" href="#pm_transformer" title="Message format converter (pm_transformer)">pm_transformer</a> module which can
       do format conversion.
     </p><p>
       The requirements and possibilities for format conversion are endless. It is possible
       to do this using the nxlog language, dedicated modules, functions and procedures.
       For special cases a processor or extension module can be crafted to achieve this.
     </p></div><div class="section" title="Character set conversion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="processing_charset_conversion"></a>Character set conversion</h2></div></div></div><p>
       It is recommended to normalize logs to UTF-8. Even if you don't, there may be cases where
       you need to convert a string (a field) or the whole message to another character set.
       See th <a class="link" href="#xm_charconv" title="Character set conversion (xm_charconv)">xm_charconv</a> module which adds support
       for character set conversion.
     </p></div><div class="section" title="Discarding messages"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="processing_discarding"></a>Discarding messages</h2></div></div></div><p>
       See the <a class="link" href="#core_proc_drop">drop()</a> procedure which can be invoked
       conditionally in the <a class="link" href="#config_module_exec" title="Exec">Exec</a> directive.
       The <a class="link" href="#processing_filtering_drop" title="Using drop()">Filtering messages</a> section shows
       an example for using drop().
       There is also <a class="link" href="#om_null" title="Null (om_null)">om_null</a> which could work in some
       situations.
     </p></div><div class="section" title="Rate limiting"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="processing_rate_limiting"></a>Rate limiting</h2></div></div></div><p>
       The poor man's tool for rate limiting is the <a class="link" href="#core_proc_sleep">sleep()</a>
       procedure.
      </p><div class="example"><a name="idp32549856"></a><p class="title"><b>Exampleï¿½9.6.ï¿½Using sleep for rate limiting</b></p><div class="example-contents"><p>
	  In the following example <code class="function">sleep</code> is invoked with 500 microseconds. This means that
	  the input module will be able to read at most 2000 messages per second.
	  </p><pre class="programlisting">
&lt;Input in&gt;
    Module	im_tcp
    Host	0.0.0.0
    Port	1514
    Exec	sleep(500);
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_null
&lt;/Output&gt;

&lt;Route r&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre><p>
	</p></div></div><p><br class="example-break">
      While this is not very precise because the module can do additional processing which can
      add some to the total execution time, it gets fairly close.
      </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  Be careful if you are planning to add rate limiting to a route which reads logs over UDP.
	</p></div><p>
     </p></div><div class="section" title="Buffering"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="processing_buffering"></a>Buffering</h2></div></div></div><p>
       Each input module has its own read buffer which is used to fill with data during a read
       on a socket or file. Each processor and output has a limited queue where the 
       log messages are put by the preceeding module in the route. The default limit for these
       internal queues is 100.
       Nevertheless, for buffering bigger amount of data, the 
       <a class="link" href="#pm_buffer" title="Buffer (pm_buffer)">pm_buffer</a> module can do disk and memory based buffering.
     </p></div><div class="section" title="Pattern matching and message classification"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="processing_pattern_matching"></a>Pattern matching and message classification</h2></div></div></div><p>
       Pattern matching is commonly used for message classification. When certain strings are
       detected in a log message, the message gets tagged with classifiers. Thus it is possible
       to query or take action on these type of messages via the classifier only.
     </p><div class="section" title="Regular expressions in the Exec directive"><div class="titlepage"><div><div><h3 class="title"><a name="processing_pattern_matching_regexp"></a>Regular expressions in the Exec directive</h3></div></div></div><p>
	 The first option is to use the <a class="link" href="#lang_binop_regmatch">=~</a> operator in
	 an <a class="link" href="#config_module_exec" title="Exec">Exec</a> directive.
	 The following code snippet shows an example for message classification.
	 </p><div class="example"><a name="idp32561856"></a><p class="title"><b>Exampleï¿½9.7.ï¿½Regular expression based message classification</b></p><div class="example-contents"><p>
	     When the contents of the Message field match against the regular expression,
	     the <code class="varname">AccountName</code> and <code class="varname">AccountID</code> fields are filled
	     with the appropriate values from the referenced captured substrings. Additionally
	     the value <code class="literal">LoginEvent</code> is  stored in the <code class="varname">Action</code>
	     field.
	     </p><pre class="programlisting">
if $Message =~ /^pam_unix\(sshd:session\): session opened for user (\S+) by \(uid=(\d+)\)/ {
    $AccountName = $1;
    $AccountID = integer($2);
    $Action = 'LoginEvent';
}
</pre><p>
	   </p></div></div><p><br class="example-break">
       </p></div><div class="section" title="Using pm_pattern"><div class="titlepage"><div><div><h3 class="title"><a name="processing_pattern_matching_pm_pattern"></a>Using pm_pattern</h3></div></div></div><p>
	 When there are a lot of patterns, writing these in the configuration file will make
	 it bloated, ugly and is not as efficient as using the 
	 <a class="link" href="#pm_pattern" title="Pattern matcher (pm_pattern)">pm_pattern</a> module.
	 The above pattern matching rule can be defined in pm_pattern's XML format the following
	 way which will accomplish the same.
       </p><pre class="programlisting">
&lt;pattern&gt;
   &lt;id&gt;42&lt;/id&gt;
   &lt;name&gt;ssh_pam_session_opened&lt;/name&gt;
   &lt;description&gt;ssh pam session opened&lt;/description&gt;
   &lt;matchfield&gt;
      &lt;name&gt;Message&lt;/name&gt;
      &lt;type&gt;REGEXP&lt;/type&gt;
      &lt;value&gt;^pam_unix\(sshd:session\): session opened for user (\S+) by \(uid=(\d+)\)&lt;/value&gt;
      &lt;capturedfield&gt;
         &lt;name&gt;AccountName&lt;/name&gt;
         &lt;type&gt;STRING&lt;/type&gt;
      &lt;/capturedfield&gt;
      &lt;capturedfield&gt;
         &lt;name&gt;AccountID&lt;/name&gt;
         &lt;type&gt;INTEGER&lt;/type&gt;
      &lt;/capturedfield&gt;
   &lt;/matchfield&gt;
   &lt;set&gt;
      &lt;field&gt;
          &lt;name&gt;Action&lt;/name&gt;
          &lt;type&gt;STRING&lt;/type&gt;
          &lt;value&gt;LoginEvent&lt;/value&gt;
      &lt;/field&gt;
   &lt;/set&gt;
&lt;/pattern&gt;</pre><p>
       </p></div></div><div class="section" title="Event correlation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="processing_correlation"></a>Event correlation</h2></div></div></div><p>
       It is possible to write correlation rules in the nxlog language using the builtin
       features such as the <a class="link" href="#lang_variables" title="Variables">variables</a> and 
       <a class="link" href="#lang_stat" title="Statistical counters">statistical counters</a>. While these are quite powerful,
       some cases cannot be detected with these, escpecially thoses conditions which require
       a sliding window.
     </p><p>
       A dedicated nxlog module, <a class="link" href="#pm_evcorr" title="Event correlator (pm_evcorr)">pm_evcorr</a> is available for 
       advanced correlation requirements. It has similar features as 
       <a class="ulink" href="http://simple-evcorr.sourceforge.net/" target="_top">SEC</a>
       and greatly enhances the correlation capabilites of nxlog. 
     </p></div><div class="section" title="Log rotation and retention"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="processing_log_rotation"></a>Log rotation and retention</h2></div></div></div><p>
       nxlog makes it possible to implement custom log rotation and retention policies for
       files written by nxlog and files written by other sources.
       The <a class="link" href="#om_file" title="File (om_file)">om_file</a> and <a class="link" href="#xm_fileop" title="File operations (xm_fileop)">xm_fileop</a>
       modules export various procedures which can be used for this purpose:
       </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
	   <a class="link" href="#om_file_proc_rotate_to">rotate_to</a>
	 </td></tr><tr><td>
	   <a class="link" href="#om_file_proc_reopen">reopen</a>
	 </td></tr><tr><td>
	   <a class="link" href="#xm_fileop_proc_file_cycle">file_cycle</a>
	 </td></tr><tr><td>
	   <a class="link" href="#xm_fileop_proc_file_rename">file_rename</a>
	 </td></tr><tr><td>
	   <a class="link" href="#xm_fileop_proc_file_remove">file_remove</a>
	 </td></tr><tr><td>
	   <a class="link" href="#xm_fileop_proc_file_copy">file_copy</a>
	 </td></tr><tr><td>
	   <a class="link" href="#xm_fileop_proc_file_truncate">file_truncate</a>
	 </td></tr></table><p>
       Should these native language construct be insufficient, it is always possible
       to <a class="link" href="#xm_exec" title="External program execution (xm_exec)">call an exeternal script or program</a>.
       
     </p><div class="example"><a name="idp33275344"></a><p class="title"><b>Exampleï¿½9.8.ï¿½Rotation of the internal LogFile</b></p><div class="example-contents"><p>
	 This example shows how to rotate the internal logfile based on time and size.
       </p><pre class="programlisting">
#define LOGFILE C:\Program Files\nxlog\data\nxlog.log
define LOGFILE /var/log/nxlog/nxlog.log

&lt;Extension fileop&gt;
    Module      xm_fileop

    # Check the size of our log file every hour and rotate if it is larger than 1Mb
    &lt;Schedule&gt;
        Every   1 hour
        Exec    if (file_size('%LOGFILE%') &gt;= 1M) file_cycle('%LOGFILE%', 2);
    &lt;/Schedule&gt;

    # Rotate our log file every week on sunday at midnight
    &lt;Schedule&gt;
        When    @weekly
        Exec    file_cycle('%LOGFILE%', 2);
    &lt;/Schedule&gt;
&lt;/Extension&gt;
</pre></div></div><br class="example-break"><div class="example"><a name="idp33278640"></a><p class="title"><b>Exampleï¿½9.9.ï¿½File rotation based on size</b></p><div class="example-contents"><pre class="programlisting">
&lt;Extension exec&gt;
    Module	xm_exec
&lt;/Extension&gt;

&lt;Extension syslog&gt;
    Module	xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module	im_tcp
    Port	1514
    Host	0.0.0.0
    Exec	parse_syslog_bsd();
&lt;/Input&gt;

&lt;Output out&gt;
    Module	om_file
    File	"tmp/output_" + $Hostname + "_" + month(now())
    &lt;Exec&gt;
        if out-&gt;file_size() &gt; 15M
        {
             $newfile = "tmp/output_" + $Hostname + "_" + strftime(now(), "%Y%m%d%H%M%S");
             out-&gt;rotate_to($newfile);
             exec_async("/bin/bzip2", $newfile);
        }
     &lt;/Exec&gt;
&lt;/Output&gt;

&lt;Route 1&gt;
    Path	in =&gt; out
&lt;/Route&gt;
</pre></div></div><br class="example-break"></div><div class="section" title="Explicit drop"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="processing_explicit_drop"></a>Explicit drop</h2></div></div></div><p>
       nxlog does not drop messages voluntarily. The built-in flow control mechanism ensures
       that the input modules will pause until the output modules can write. This can be problematic
       in some situations when it is preferable to drop messages than to block.
       The following example illustrates the use of the <a class="link" href="#core_proc_drop">drop()</a>
       procedure used in conjunction with <a class="link" href="#pm_buffer" title="Buffer (pm_buffer)">pm_buffer</a>.
     </p><div class="example"><a name="idp31670992"></a><p class="title"><b>Exampleï¿½9.10.ï¿½Explicitly dropping messages when the network module is blocked</b></p><div class="example-contents"><p>
	 In the following configuration we use two routes which send the input read from the UDP
	 socket to two outputs, a file and a TCP destination.
	 Without this setup when the TCP connection can transmit slower than the rate of incoming 
	 UDP packets or the TCP connetion is down, the whole chain (both routes) would
	 be blocked which would result in dropped UDP packets.
	 In this situation it is preferable to only drop log messages in the <em class="replaceable"><code>tcp</code></em> 
	 route.	In this route a <a class="link" href="#pm_buffer" title="Buffer (pm_buffer)">pm_buffer</a>
	 module is used and the size of the buffer is checked. If the buffer size goes over a
	 certain limit we assume that the TCP output is blocked (or sending too slow)
	 and instruct to drop log messages using the
	 <a class="link" href="#core_proc_drop">drop()</a> procedure.
	 This way the UDP input will not get paused and all messages will be written to the
	 output file regardless of the state of the TCP connection.
       </p><pre class="programlisting">
&lt;Processor buffer&gt;
	Module	pm_buffer
	WarnLimit	800
	MaxSize	1000
	Type	Mem
	Exec	if buffer_size() &gt;= 80k drop();
&lt;/Processor&gt;

&lt;Input udpin&gt;
	Module	im_udp
	Host	0.0.0.0
	Port	1514
&lt;/Input&gt;

&lt;Output tcpout&gt;
	Module	om_tcp
	Host	192.168.1.1
	Port	1515
&lt;/Output&gt;

&lt;Output fileout&gt;
	Module	om_file
	File	'out.txt'
&lt;/Output&gt;

&lt;Route tcp&gt;
    Path	udpin =&gt; buffer =&gt; tcpout
&lt;/Route&gt;
&lt;Route file&gt;
    Path	udpin =&gt; fileout
&lt;/Route&gt;
</pre></div></div><br class="example-break"></div></div><div class="chapter" title="Chapterï¿½10.ï¿½Forwarding and storing logs"><div class="titlepage"><div><div><h2 class="title"><a name="forwarding"></a>Chapterï¿½10.ï¿½Forwarding and storing logs</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#forwarding_format">Data format of the output</a></span></dt><dt><span class="section"><a href="#forwarding_network">Forwarding over the network</a></span></dt><dt><span class="section"><a href="#forwarding_files_sockets">Sending to sockets and files</a></span></dt><dt><span class="section"><a href="#forwarding_database">Storing logs in a database</a></span></dt></dl></div><p>
     This chapter deals with the output side, i.e. how to forward, send and store messages
     to various destinations.
   </p><div class="section" title="Data format of the output"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="forwarding_format"></a>Data format of the output</h2></div></div></div><p>
       In addition to the transport protocol, the data format is an important factor.
       If the remote receiver cannot parse the message, it will likely discard
       or it may be just improperly processed.
     </p><div class="variablelist"><dl><dt><span class="term"><a name="forwarding_format_syslog"></a>Syslog</span></dt><dd><p>
	      There are two formats, the older BSD Syslog and the newer IETF syslog format
	      as defined by RFC 3164 and RFC 5424.
	      The transport protocol in syslog can be UDP, TCP or SSL. See the
	      <a class="link" href="#xm_syslog" title="Syslog (xm_syslog)">xm_syslog</a> module about formatting and sending
	      syslog messages to remote hosts over the network.
	    </p></dd><dt><span class="term"><a name="forwarding_format_syslog_snare"></a>Syslog SNARE</span></dt><dd><p>
	      The SNARE agent format is a special format on top of BSD Syslog which is used
	      and understood by several tools and log analyzer frontends.
	      This format is most useful when forwaring Windows EventLog data,
	      i.e. in conjunction with <a class="link" href="#im_mseventlog" title="MS EventLog for Windows XP/2000/2003 (im_mseventlog)">im_mseventlog</a> and/or
	      <a class="link" href="#im_msvistalog" title="MS EventLog for Windows 2008/Vista and later (im_msvistalog)">im_msvistalog</a>.
	      The <a class="link" href="#xm_syslog_proc_to_syslog_snare">to_syslog_snare</a>
	      procedure call can construct SNARE syslog formatted messages.
	      The following example shows a configuration for reading the windows eventlog and
	      forwarding it over UDP in the SNARE Agent format.
	      </p><div class="example"><a name="idp30031456"></a><p class="title"><b>Exampleï¿½10.1.ï¿½Forwarding EventLogs from a windows machine to a remote host in the SNARE Agent format</b></p><div class="example-contents"><pre class="programlisting">
&lt;Extension syslog&gt;
    Module      xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module      im_msvistalog
&lt;/Input&gt;

&lt;Output out&gt;
    Module      om_udp
    Host        192.168.1.1
    Port        514
    Exec        to_syslog_snare();
&lt;/Output&gt;

&lt;Route 1&gt;
    Path        in =&gt; out
&lt;/Route&gt;</pre></div></div><p><br class="example-break">
	    </p></dd><dt><span class="term"><a name="forwarding_format_binary"></a>NXLOG Binary format</span></dt><dd><p>
	      The <a class="link" href="#config_outputtype_binary">binary</a> format is only understood
	      by nxlog.
	      All the fields are preserved when the data is sent in this format so there is no
	      need to parse it again.
	      You need to add this to the output module:
	      </p><pre class="programlisting">OutputType    Binary</pre><p>
	      And the receiver nxlog module should contain this:
	      </p><pre class="programlisting">InputType    Binary</pre><p>
	    </p></dd><dt><span class="term"><a name="forwarding_format_csv"></a>CSV</span></dt><dd><p>
	      To send logs in CSV, use the <a class="link" href="#xm_csv" title="CSV (xm_csv)">xm_csv</a> or the
	      <a class="link" href="#pm_transformer" title="Message format converter (pm_transformer)">pm_transformer</a> module.
	    </p></dd><dt><span class="term"><a name="forwarding_format_gelf"></a>Graylog Extended Log Format (GELF)</span></dt><dd><p>
	      The <a class="link" href="#xm_gelf" title="GELF (xm_gelf)">xm_gelf</a> module can be used to generate GELF
	      output.
	    </p></dd><dt><span class="term"><a name="forwarding_format_json"></a>JSON</span></dt><dd><p>
	      See the <a class="link" href="#xm_json" title="JSON (xm_json)">xm_json</a> module docs about generating JSON
	      output.
	    </p></dd><dt><span class="term"><a name="forwarding_format_xml"></a>XML</span></dt><dd><p>
	      See the <a class="link" href="#xm_xml" title="XML (xm_xml)">xm_xml</a> module docs about generating XML
	      output.
	    </p></dd></dl></div></div><div class="section" title="Forwarding over the network"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="forwarding_network"></a>Forwarding over the network</h2></div></div></div><p>
       The following network protocols can be used. There is a trade-off between 
       speed, reliablilty, compatibility and security.
     </p><div class="variablelist"><dl><dt><span class="term"><a name="forwarding_network_udp"></a>UDP</span></dt><dd><p>
	     To send logs in UDP packets, use the <a class="link" href="#om_udp" title="UDP (om_udp)">om_udp</a> module.
	   </p></dd><dt><span class="term"><a name="forwarding_network_tcp"></a>TCP</span></dt><dd><p>
	     To send logs over TCP, use the <a class="link" href="#om_tcp" title="TCP (om_tcp)">om_tcp</a> module.
	   </p></dd><dt><span class="term"><a name="forwarding_network_ssl"></a>SSL/TLS</span></dt><dd><p>
	     To send logs over a trusted secure SSL connection, use the 
	     <a class="link" href="#om_ssl" title="TLS/SSL (om_ssl)">om_ssl</a> module.
	   </p></dd></dl></div></div><div class="section" title="Sending to sockets and files"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="forwarding_files_sockets"></a>Sending to sockets and files</h2></div></div></div><p>
     </p><div class="variablelist"><dl><dt><span class="term"><a name="forwarding_files"></a>Files</span></dt><dd><p>
	     To store logs in local files, use the <a class="link" href="#om_file" title="File (om_file)">om_file</a> module.
	   </p></dd><dt><span class="term"><a name="forwarding_pipe"></a>Piping to an external script or program</span></dt><dd><p>
	     To send logs to an external program or script, use the 
	     <a class="link" href="#om_exec" title="Program (om_exec)">om_exec</a> module.
	   </p></dd><dt><span class="term"><a name="forwarding_uds"></a>Unix Domain Socket</span></dt><dd><p>
	     To send logs to a unix domain socket, use the 
	     <a class="link" href="#om_uds" title="UDS (om_uds)">om_uds</a> module.
	   </p></dd></dl></div></div><div class="section" title="Storing logs in a database"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="forwarding_database"></a>Storing logs in a database</h2></div></div></div><p>
       The <a class="link" href="#om_dbi" title="DBI (om_dbi)">om_dbi</a> and om_odbc modules can be used to store logs in databases.
     </p></div></div><div class="chapter" title="Chapterï¿½11.ï¿½Tips and tricks"><div class="titlepage"><div><div><h2 class="title"><a name="tips"></a>Chapterï¿½11.ï¿½Tips and tricks</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#tips_no_logs">Detecting a dead agent or log source</a></span></dt></dl></div><p>
     This chapter addresses some common problems or log management requirements.
   </p><div class="section" title="Detecting a dead agent or log source"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tips_no_logs"></a>Detecting a dead agent or log source</h2></div></div></div><p>
       It is a common requirement to be able to detect conditions when there are no log
       messages coming from a source. This usually indicates a problem with the log source,
       such as a broken network connection, server down or an application/system service
       is stuck.
       Usually this problem should be detected by monitoring tools (nagios, openview etc),
       but the absence of logs can be also a good reason to investigate such a situation.
     </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	 The <a class="link" href="#im_mark" title="Mark (im_mark)">im_mark</a> module exists for a similar purpose.
	 It can emit messages periodically in order to show that the system logger
	 is not suffering problems.
       </p></div><p>
       The solution to this problem is the combined use of 
       <a class="link" href="#lang_stat" title="Statistical counters">statistical counters</a> and
       <a class="link" href="#config_module_schedule" title="Schedule">Scheduled</a> checks.
       The input module can update a statistical counter configured to calculate
       events per hour for example. In the same input module a 
       <a class="link" href="#config_module_schedule" title="Schedule">Schedule</a> block is defined
       which checks the value of the statistical counter periodically. 
       When the event rate is zero or drops below a certain limit, an appropriate 
       action can be <a class="link" href="#config_module_schedule_exec">executed</a> such
       as sending out an alert email or generating an internal warning message.
       Note that probably there are other ways to solve this issue and this method
       might not be the optimal for all situations.
     </p><div class="example"><a name="idp30023600"></a><p class="title"><b>Exampleï¿½11.1.ï¿½Alerting on absence of log messages</b></p><div class="example-contents"><p>
	 The following configuration example creates a statistical counter in the context of
	 the im_tcp module to calculate the number of events received per hour.
	 The <a class="link" href="#config_module_schedule" title="Schedule">Schedule</a> block within the
	 context of the same module checks the value of the "msgrate" statistical counter
	 and generates an internal error message when there were no logs received in the
	 past hour.
       </p><pre class="programlisting">
&lt;Input in&gt;
    Module      im_tcp
    Port        2345
    Exec        create_stat("msgrate", "RATE", 3600); add_stat("msgrate", 1);

    &lt;Schedule&gt;
        Every   3600 sec
        &lt;Exec&gt;
            create_stat("msgrate", "RATE", 10); add_stat("msgrate", 0);
            if defined get_stat("msgrate") and get_stat("msgrate") &lt;= 1
            {
                log_error("No messages received from the source!");
            }
        &lt;/Exec&gt;
    &lt;/Schedule&gt;
&lt;/Input&gt;

&lt;Output out&gt;
    Module      om_file
    File        "tmp/output"
&lt;/Output&gt;

&lt;Route 1&gt;
    Path        in =&gt; out
&lt;/Route&gt;

</pre></div></div><br class="example-break"></div></div><div class="chapter" title="Chapterï¿½12.ï¿½Troubleshooting"><div class="titlepage"><div><div><h2 class="title"><a name="troubleshooting"></a>Chapterï¿½12.ï¿½Troubleshooting</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#troubleshooting_logging">nxlog's internal logs</a></span></dt><dd><dl><dt><span class="section"><a href="#troubleshooting_logfile">Check the contents of the LogFile</a></span></dt><dt><span class="section"><a href="#troubleshooting_im_internal">Injecting own logs into a route</a></span></dt><dt><span class="section"><a href="#troubleshooting_loglevel">LogLevel</a></span></dt><dt><span class="section"><a href="#troubleshooting_foreground">Running in foreground</a></span></dt><dt><span class="section"><a href="#troubleshooting_exec_log_info">Using log_info() in the Exec directive</a></span></dt></dl></dd><dt><span class="section"><a href="#troubleshooting_common_problems">Common problems</a></span></dt><dd><dl><dt><span class="section"><a href="#troubleshooting_common_problems_missing_logdata">Missing logdata</a></span></dt><dt><span class="section"><a href="#troubleshooting_common_problems_invalid_conf">nxlog failed to start, cannot read configuration file</a></span></dt><dt><span class="section"><a href="#troubleshooting_common_problems_nxlog_log_in_use">nxlog.log is in use by another application and cannot be accessed</a></span></dt><dt><span class="section"><a href="#troubleshooting_common_problems_connection_refused">Connection refused when trying to connect to im_tcp or im_ssl</a></span></dt></dl></dd><dt><span class="section"><a href="#troubleshooting_log_message_content">console.logging the data</a></span></dt><dt><span class="section"><a href="#troubleshooting_console.logging">console.logging</a></span></dt><dd><dl><dt><span class="section"><a href="#troubleshooting_console.logging_memleaks">console.logging memory leaks</a></span></dt></dl></dd></dl></div><p>
     According to Murphy, anything that can go wrong will go wrong. This chapter is to help
     diagnosing problems, be that configuration errors or possible bugs.
   </p><div class="section" title="nxlog's internal logs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="troubleshooting_logging"></a>nxlog's internal logs</h2></div></div></div><p>
       While nxlog is a tool to handle logs from external sources, it can and will emit logs
       about its own operations. These are essential to troubleshoot problems.
     </p><div class="section" title="Check the contents of the LogFile"><div class="titlepage"><div><div><h3 class="title"><a name="troubleshooting_logfile"></a>Check the contents of the LogFile</h3></div></div></div><p>
	 nxlog will log important events including errors and warnings into its logfile. So the first
	 place to look for errors is the <a class="link" href="#config_global_logfile">LogFile</a>.
	 If this directive is not specified in the configuration, you should add it.
	 </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	     Some windows applications (e.g. wordpad) cannot open the logfile while nxlog is
	     running because of exclusive file locking. 
	     Use a text file viewer which does not lock the file (e.g. notepad).
	   </p></div><p>
       </p></div><div class="section" title="Injecting own logs into a route"><div class="titlepage"><div><div><h3 class="title"><a name="troubleshooting_im_internal"></a>Injecting own logs into a route</h3></div></div></div><p>
	 Internal logs can be read as a log source with the 
	 <a class="link" href="#im_internal" title="Internal (im_internal)">im_internal</a> module. This makes it possible to
	 forward the internal logs over the network for example.
	 </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	     This method will not work if the route which <a class="link" href="#im_internal" title="Internal (im_internal)">im_internal</a>
	     is part of is not functional.  Logging with <a class="link" href="#config_global_logfile">LogFile</a>
	     is more fault-tolerant and this is the recommended way for troubleshooting.
	   </p></div><p>
       </p></div><div class="section" title="LogLevel"><div class="titlepage"><div><div><h3 class="title"><a name="troubleshooting_loglevel"></a>LogLevel</h3></div></div></div><p>
	 Internal logs are emitted only on LogLevel of INFO and above.
	 It is possible to get detailed information about what nxlog is doing by setting
	 <a class="link" href="#config_global_loglevel">LogLevel</a> to console.log.
	 This can produce an extreme amount of logs, it is recommended to enable this only
	 for troubleshooting.
       </p></div><div class="section" title="Running in foreground"><div class="titlepage"><div><div><h3 class="title"><a name="troubleshooting_foreground"></a>Running in foreground</h3></div></div></div><p>
	 When nxlog is running in foreground, it will emit logs to STDOUT and STDERR so the logs
	 will be visible in the running terminal.
	 This is the same log which is written to the <a class="link" href="#config_global_logfile">LogFile</a>.
	 It can be started to run in foreground with <span class="command"><strong>nxlog -f</strong></span>.
       </p></div><div class="section" title="Using log_info() in the Exec directive"><div class="titlepage"><div><div><h3 class="title"><a name="troubleshooting_exec_log_info"></a>Using log_info() in the Exec directive</h3></div></div></div><p>
	 Internal logs can be emitted from the configuration via the
	 <a class="link" href="#core_proc_log_info">log_info()</a> procedure call in the
	 <a class="link" href="#config_module_exec" title="Exec">Exec</a> directive. This can be extremely useful
	 to print and console.log message contents. Consider the following example:
</p><pre class="programlisting">
&lt;Input in&gt;
    Module	im_udp
    Port 	514
    Exec        if $raw_event =~ /keyword/ log_info("FOUND KEYWORD IN MSG: [" + $raw_event + "]");
&lt;/Input&gt;
</pre><p>
        Anything which is printed with the <a class="link" href="#core_proc_log_info">log_info()</a>
        and family of procedure calls will appear in <a class="link" href="#config_global_logfile">LogFile</a>,
        on the STDOUT/STDERR of nxlog in foreground mode and wil be emitted by
        <a class="link" href="#im_internal" title="Internal (im_internal)">im_internal</a>.
       </p></div></div><div class="section" title="Common problems"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="troubleshooting_common_problems"></a>Common problems</h2></div></div></div><p>
       This section will list a couple problems which you are likely to run into.
     </p><div class="section" title="Missing logdata"><div class="titlepage"><div><div><h3 class="title"><a name="troubleshooting_common_problems_missing_logdata"></a>Missing logdata</h3></div></div></div><p>
	 As discussed in the <a class="link" href="#architecture" title="Chapterï¿½3.ï¿½Architecture and concepts">architecture</a> chapter, logs
	 are received by input modules, forwarded to the processor modules and finally handled by
	 the output modules. When these modules handle a log message, the
	 <a class="link" href="#config_module_exec" title="Exec">Exec</a> directive is evaluated. There are a few
	 situations when such statements can be evaluated but the required log is not
	 available in the current context. When the so called logdata is not available in the
	 current context, any dependent operation will fail and the evaluation of the Exec code
	 will terminate. Most notably these operations are
	 <a class="link" href="#lang_statement_assignment" title="Assignment">field assignments</a> and function or
	 procedure calls which access fields such as 
	 <a class="link" href="#xm_charconv_proc_convert_fields">convert_fields()</a>.
	 Consider the following example.
	 </p><div class="example"><a name="idp31684240"></a><p class="title"><b>Exampleï¿½12.1.ï¿½Assignment after drop()</b></p><div class="example-contents"><p>
	     In this example the message is conditionally dropped. When the $raw_event field
	     matches the keyword, the <a class="link" href="#core_proc_drop">drop()</a> operation is
	     invoked which discards the log completely. If a subsequent statement follows
	     which accesses the log, it will fail.
	     </p><pre class="programlisting">
&lt;Input in&gt;
    Module	im_udp
    Port 	514
    Exec        if $raw_event =~ /keyword/ drop(); $EventTime = now();
&lt;/Input&gt;
</pre><p>
	     In this case the following internal error log will be emitted:
	 </p><pre class="programlisting">missing logdata, assignment possibly after drop()</pre><p>
	 The following config snippet fixes the above error by correctly using conditional
	 statements.
	 </p><pre class="programlisting">
&lt;Input in&gt;
    Module	im_udp
    Port 	514
    Exec        if $raw_event =~ /keyword/  \
                   drop();                  \
                else                        \
                   $EventTime = now();
&lt;/Input&gt;
</pre><p>
	   </p></div></div><p><br class="example-break">
	 The "logdata will be missing" in the following cases:
	 </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
	     Accessing a field or calling a procedure/function which needs the logdata
	     after the <a class="link" href="#core_proc_drop">drop()</a> procedure.
	   </td></tr><tr><td>
	     Accessing a field or calling a procedure/function which needs the logdata
	     from the <a class="link" href="#config_module_schedule_exec">Exec directive of a Schedule block</a>.
	     Since this scheduled Exec is not triggered by the log message, such operation
	     will result in an error.
	   </td></tr></table><p>

       </p></div><div class="section" title="nxlog failed to start, cannot read configuration file"><div class="titlepage"><div><div><h3 class="title"><a name="troubleshooting_common_problems_invalid_conf"></a>nxlog failed to start, cannot read configuration file</h3></div></div></div><p>
	 You may receive this error message in nxlog.log when nxlog fails to start:
</p><pre class="programlisting">
nxlog failed to start: Invalid keyword: ï¿½ï¿½# at C:\Program Files (x86)\nxlog\conf\nxlog.conf:1
</pre><p>
Some text editors may save the configuration file in UTF-16 or in UTF-8 with a
BOM header. The configuration file must be encoded in ASCII or plain UTF-8,
otherwise you will get this error. On windows using notepad.exe should work properly.
       </p></div><div class="section" title="nxlog.log is in use by another application and cannot be accessed"><div class="titlepage"><div><div><h3 class="title"><a name="troubleshooting_common_problems_nxlog_log_in_use"></a>nxlog.log is in use by another application and cannot be accessed</h3></div></div></div><p>
	 You may receive this error message on Windows when trying to open the logfile (usually
	 <code class="filename">nxlog.log</code>) with a text editor which uses exclusive locking.
	 You can only open the log after nxlog is stopped. By using a text viewer or
	 text editor which does not use exclusive locking (such as notepad.exe), you can
	 open the logfile without the need to stop nxlog.
       </p></div><div class="section" title="Connection refused when trying to connect to im_tcp or im_ssl"><div class="titlepage"><div><div><h3 class="title"><a name="troubleshooting_common_problems_connection_refused"></a>Connection refused when trying to connect to im_tcp or im_ssl</h3></div></div></div><p>
	 Make sure that you have no firewall blocking the connection. The interface address 
	 or the hostname which resolves to the interface address must be accessible from the
	 outside. See the <a class="link" href="#im_tcp_config_host">Host</a> directive of im_tcp.
       </p></div></div><div class="section" title="console.logging the data"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="troubleshooting_log_message_content"></a>console.logging the data</h2></div></div></div><p>
       When creating complex processing rules and configurations, you will most likely run
       into a problem and need to console.log the stream of event log messages to see
       </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
	     what has been received/read by the input(s),
	   </p></li><li class="listitem"><p>
	     whether some required field exists and what its value is,
	   </p></li><li class="listitem"><p>
	     if the parser is working correctly and populating the fields as it should,
	   </p></li><li class="listitem"><p>
	     all the fields and their values contained in the event log after parsing.
	   </p></li></ul></div><p>
       The following configuration snippets show some examples how this can be done.

      </p><div class="example"><a name="troubleshooting_example_file_write"></a><p class="title"><b>Exampleï¿½12.2.ï¿½Writing the values of fields to an external file</b></p><div class="example-contents"><p>
	  The <a class="link" href="#xm_fileop_proc_file_write">file_write()</a> procedure provided by
	  the <a class="link" href="#xm_fileop" title="File operations (xm_fileop)">xm_fileop</a> module can be used to dump information
	  into an external file.
	</p><pre class="programlisting">
&lt;Extension fileop&gt;
    Module      xm_fileop
&lt;/Extension&gt;

&lt;Extension syslog&gt;
    Module      xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module      im_tcp
    Host        0.0.0.0
    Port        1514
    Exec	parse_syslog_bsd();
    # console.log SyslogSeverity and Hostname fields
    Exec        file_write("/tmp/console.log.txt", "Severity: " + $SyslogSeverity + ", Hostname: " + $Hostname);
&lt;/Input&gt;

&lt;Output out&gt;
    Module      om_null
&lt;/Output&gt;

&lt;Route r&gt;
    Path        in =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">

      </p><div class="example"><a name="troubleshooting_example_log_info"></a><p class="title"><b>Exampleï¿½12.3.ï¿½Writing the values of fields to the internal log</b></p><div class="example-contents"><p>
	  Using the <a class="link" href="#core_proc_log_info">log_info</a> procedure the values
	  can be sent to the internal log. This will be visible in the file defined with the
	  <a class="link" href="#config_global_logfile">LogFile</a> global directive, 
	  in the input from the <a class="link" href="#im_internal" title="Internal (im_internal)">im_internal</a> module and
	  on standard output when running <span class="command"><strong>nxlog</strong></span> in foreground with the
	  <code class="option">-f</code> command line switch.
	</p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module      xm_syslog
&lt;/Extension&gt;

&lt;Input in&gt;
    Module      im_tcp
    Host        0.0.0.0
    Port        1514
    Exec	parse_syslog_bsd();
    # console.log SyslogSeverity and Hostname fields
    Exec        log_info("Severity: " + $SyslogSeverity + ", Hostname: " + $Hostname);
&lt;/Input&gt;

&lt;Output out&gt;
    Module      om_null
&lt;/Output&gt;

&lt;Route r&gt;
    Path        in =&gt; out
&lt;/Route&gt;
</pre></div></div><p><br class="example-break">

      </p><div class="example"><a name="troubleshooting_example_to_json"></a><p class="title"><b>Exampleï¿½12.4.ï¿½Dumping all the fields</b></p><div class="example-contents"><p>
	  Using the <a class="link" href="#xm_json_proc_to_json">to_json</a> procedure 
	  provided by the <a class="link" href="#xm_json" title="JSON (xm_json)">xm_json</a> module, all the fields
	  can be dumped.
	  If you prefer, you can use the <a class="link" href="#xm_xml_proc_to_xml">to_xml</a>
	  procedure provided by the <a class="link" href="#xm_xml" title="XML (xm_xml)">xm_xml</a> module.
	</p><pre class="programlisting">
&lt;Extension syslog&gt;
    Module      xm_syslog
&lt;/Extension&gt;

&lt;Extension json&gt;
    Module      xm_json
&lt;/Extension&gt;

&lt;Input in&gt;
    Module      im_tcp
    Host        0.0.0.0
    Port        1514
    Exec	parse_syslog_bsd();
    # Dump $raw_event
    Exec	log_info("raw event is: " + $raw_event);
    # Dump fields in JSON
    Exec        log_info("Other fields are: " + to_json());
&lt;/Input&gt;

&lt;Output out&gt;
    Module      om_null
&lt;/Output&gt;

&lt;Route r&gt;
    Path        in =&gt; out
&lt;/Route&gt;
</pre><p>
	  This will produce the following output in the logs:
</p><pre class="programlisting">2012-05-18 13:11:35 INFO raw event is: &lt;27&gt;2010-10-12 12:49:06 host app[12345]: test message
2012-05-18 13:11:35 INFO Other fields are: {"MessageSourceAddress":"127.0.0.1","EventReceivedTime":"2012-05-18 13:11:35",
            "SourceModuleName":"in","SourceModuleType":"im_tcp","SyslogFacilityValue":3,"SyslogFacility":"DAEMON",
            "SyslogSeverityValue":3,"SyslogSeverity":"ERR","SeverityValue":4,"Severity":"ERROR","Hostname":"host",
            "EventTime":"2010-10-12 12:49:06","SourceName":"app","ProcessID":"12345","Message":"test message"}
</pre><p>
	</p></div></div><p><br class="example-break">
     </p><p>
       In some cases nxlog is already receiving some invalid data it cannot grok. To
       verify that indeed this is the case, use a network traffic analyzer such as
       wireshark or tcpdump.
     </p></div><div class="section" title="console.logging"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="troubleshooting_console.logging"></a>console.logging</h2></div></div></div><p>
       This section will list a few methods you can use to hunt bugs in NXLog.
     </p><div class="section" title="console.logging memory leaks"><div class="titlepage"><div><div><h3 class="title"><a name="troubleshooting_console.logging_memleaks"></a>console.logging memory leaks</h3></div></div></div><p>
	 If you see the memory usage climb up and exceed 100Mb this is most likely a sign of a memory leak.
	 <span class="productname">Valgrind</span> is an excellent tool on GNU/Linux to console.log memory leaks. To console.log memory leaks with
	 <span class="productname">Valgrind</span>, you will need the following.
	 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
	       Install the <code class="filename">dbg</code> package which contains console.log symbols,
	       e.g. <code class="filename">nxlog-dbg_2.8.1248_amd64.deb</code>.
	     </p></li><li class="listitem"><p>
	       Edit <code class="filename">nxlog.conf</code> and add the following:
	       </p><pre class="programlisting">NoFreeOnExit TRUE</pre><p>
	       This ensures that modules are not unloaded when NXLog is stopped and <span class="productname">Valgrind</span>
	       can properly resolve backtraces into modules.
	     </p></li><li class="listitem"><p>
	       Start NXLog under <span class="command"><strong>valgrind</strong></span> with the following command.
	       If you have <em class="parameter"><code>User</code></em> set to <em class="parameter"><code>nxlog</code></em> in your <code class="filename">nxlog.conf</code>
	       then the command must be executed via <span class="command"><strong>su</strong></span>, otherwise <span class="command"><strong>valgrind</strong></span> will
	       not be able to create the <code class="filename">massif.out</code> file at the end of the sampling process.
	       </p><pre class="programlisting"># cd /tmp
# su nxlog - -c "valgrind --tool=massif --pages-as-heap=yes /usr/bin/nxlog -f"</pre><p>
	       Let it run for a while until the <span class="command"><strong>valgrind</strong></span> process shows the memory increase and then interrupt it
	       with <strong class="userinput"><code>control-c</code></strong>.
	       Now you should find a <code class="filename">massif.out.xxxx</code> in the directory.
	     </p></li><li class="listitem"><p>
	       You can send the <code class="filename">massif.out.xxxx</code> along with your bug report or alternatively you can create 
	       a report out of this with the <span class="command"><strong>ms_print</strong></span> command:
	       </p><pre class="programlisting">ms_print massif.out.xxx</pre><p>
	       The output of the <span class="command"><strong>ms_print</strong></span> report will contain an ascii chart at the top that should show
	       the increase of the memory usage.
	       Alternatively you can send this report along with your bug report.
	     </p></li><li class="listitem"><p>
	       In the ascii chart you will see the sample number with the highest memory usage marked with <span class="guilabel">(peak)</span>.
	       This should be normally at the end of the chart, i.e. the last sample. You should scroll down in the output to this sample
	       and read the backtrace to see where the most memory is allocated at.
	     </p></li></ol></div><p>
       </p></div></div></div></div></body></html>
